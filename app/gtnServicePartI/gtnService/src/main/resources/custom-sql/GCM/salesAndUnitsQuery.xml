<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<custom-sql>
    <sql id="contractCount">
        <![CDATA[
            select count(distinct CON.CONTRACT_MASTER_SID) from  PROJECTION_DETAILS PD 
            join CCP_DETAILS CCPD ON CCPD.CCP_DETAILS_SID=PD.CCP_DETAILS_SID AND CCPD.COMPANY_MASTER_SID in (?) 
            AND CCPD.CONTRACT_MASTER_SID='?' 
            join CONTRACT_MASTER CON ON CON.CONTRACT_MASTER_SID=CCPD.CONTRACT_MASTER_SID 
            AND PD.PROJECTION_MASTER_SID= '?'
        ]]>
    </sql>
    <sql id="brandCount">
        <![CDATA[
            select count(distinct BM.BRAND_MASTER_SID) from  PROJECTION_DETAILS PD 
            join CCP_DETAILS CCPD ON CCPD.CCP_DETAILS_SID=PD.CCP_DETAILS_SID AND CCPD.COMPANY_MASTER_SID in (?)  
            AND CCPD.CONTRACT_MASTER_SID='?' AND PD.PROJECTION_MASTER_SID= '?' 
            join ITEM_MASTER IM ON IM.ITEM_MASTER_SID=CCPD.ITEM_MASTER_SID 
            join BRAND_MASTER BM ON IM.BRAND_MASTER_SID=BM.BRAND_MASTER_SID
        ]]>
    </sql>
    <sql id="itemCount">
        <![CDATA[
            select count(distinct IM.ITEM_MASTER_SID) from  PROJECTION_DETAILS PD 
            join CCP_DETAILS CCPD ON CCPD.CCP_DETAILS_SID=PD.CCP_DETAILS_SID AND CCPD.COMPANY_MASTER_SID in (?)  
            AND CCPD.CONTRACT_MASTER_SID='?' AND PD.PROJECTION_MASTER_SID= '?' 
            join ITEM_MASTER IM ON IM.ITEM_MASTER_SID=CCPD.ITEM_MASTER_SID AND IM.BRAND_MASTER_SID='?'
        ]]>
    </sql>
    <sql id="getContract">
        <![CDATA[
        select CON.CONTRACT_MASTER_SID as ID,CON.CONTRACT_NAME as COM_NAME ,I."YEAR" as YEARS, I.? as PERIODS, 
        sum(TEMP_NMSP.?) as Sales,sum(TEMP_NMSP.?) as Units, CON.CONTRACT_NO,
        sum(NMSP.?) as totSales,sum(NMSP.?) as totUnits,
        (sum(NMSP.?)-sum(TEMP_NMSP.?)) as salesVarience,
        (sum(NMSP.?)-sum(TEMP_NMSP.?)) as unitVarience, 
        (case when  sum(TEMP_NMSP.?)!=0 then ((sum(NMSP.?)-sum(TEMP_NMSP.?))/ sum(TEMP_NMSP.?)) else 0 end) as salesChange,
        (case when  sum(TEMP_NMSP.?)!=0 then ((sum(NMSP.?)-sum(TEMP_NMSP.?))/ sum(TEMP_NMSP.?)) else 0 end) as unitChange

        from  PROJECTION_DETAILS PD
        join CCP_DETAILS CCPD ON CCPD.CCP_DETAILS_SID=PD.CCP_DETAILS_SID AND CCPD.COMPANY_MASTER_SID in (?)   AND CCPD.CONTRACT_MASTER_SID=?
        join CONTRACT_MASTER CON ON CON.CONTRACT_MASTER_SID=CCPD.CONTRACT_MASTER_SID 
        join ? TEMP_NMSP ON  TEMP_NMSP.PROJECTION_DETAILS_SID=PD.PROJECTION_DETAILS_SID 
        join ? NMSP ON  NMSP.PROJECTION_DETAILS_SID=TEMP_NMSP.PROJECTION_DETAILS_SID
        join "PERIOD" I on I.PERIOD_SID = TEMP_NMSP.PERIOD_SID  WHERE PD.PROJECTION_MASTER_SID='?'  AND TEMP_NMSP.PERIOD_SID=NMSP.PERIOD_SID 
        AND TEMP_NMSP.SESSION_ID=?
        group by CON.CONTRACT_MASTER_SID,CON.CONTRACT_NAME,I."YEAR", I.?,CON.CONTRACT_NO order by CON.CONTRACT_MASTER_SID;
        ]]>
    </sql>
    <sql id="getCompany">
        <![CDATA[
            select IMTD.COMPANY_MASTER_SID as ID, IMTD.COMPANY_NAME as COM_NAME,I."YEAR" as YEARS, I.? as PERIODS, sum(NMSP.?) as Sales,
            sum(NMSP.?) as Units,CCPD.CONTRACT_MASTER_SID,IMTD.COMPANY_NO AS companyNo  from  PROJECTION_DETAILS PD 
            join CCP_DETAILS CCPD ON CCPD.CCP_DETAILS_SID=PD.CCP_DETAILS_SID AND CCPD.COMPANY_MASTER_SID in (?)  
            AND CCPD.CONTRACT_MASTER_SID='?' join ? NMSP ON  NMSP.PROJECTION_DETAILS_SID=PD.PROJECTION_DETAILS_SID 
            join "PERIOD" I on I.PERIOD_SID = NMSP.PERIOD_SID 
            join COMPANY_MASTER IMTD ON IMTD.COMPANY_MASTER_SID IN (?) WHERE PD.PROJECTION_MASTER_SID= '?'  AND NMSP.SESSION_ID=?
            group by CCPD.CONTRACT_MASTER_SID, I."YEAR", I.?, IMTD.COMPANY_MASTER_SID, IMTD.COMPANY_NAME, IMTD.COMPANY_NO order by IMTD.COMPANY_MASTER_SID;
        ]]>
    </sql>
    <sql id="getBrandForSales">
        <![CDATA[
            select BM.BRAND_MASTER_SID as ID,BM.BRAND_NAME as COM_NAME,I."YEAR" as YEARS, I.? as PERIODS,
            sum(NMSP.?) as Sales,sum(NMSP.?) as Units,CCPD.CONTRACT_MASTER_SID,CCPD.COMPANY_MASTER_SID, BM.BRAND_ID from  PROJECTION_DETAILS PD 
            join CCP_DETAILS CCPD ON CCPD.CCP_DETAILS_SID=PD.CCP_DETAILS_SID AND CCPD.COMPANY_MASTER_SID in (?)  
            AND CCPD.CONTRACT_MASTER_SID='?' 
            join ITEM_MASTER IM ON IM.ITEM_MASTER_SID=CCPD.ITEM_MASTER_SID 
            join BRAND_MASTER BM ON IM.BRAND_MASTER_SID=BM.BRAND_MASTER_SID 
             join ? NMSP 
            ON  NMSP.PROJECTION_DETAILS_SID=PD.PROJECTION_DETAILS_SID 
            join "PERIOD" I on I.PERIOD_SID = NMSP.PERIOD_SID WHERE PD.PROJECTION_MASTER_SID= '?'   AND NMSP.SESSION_ID=?
            group by BM.BRAND_MASTER_SID, BM.BRAND_NAME,CCPD.CONTRACT_MASTER_SID,CCPD.COMPANY_MASTER_SID,I."YEAR", I.?,BM.BRAND_ID order by BM.BRAND_MASTER_SID;
        ]]>
    </sql>
    <sql id="getItem">
        <![CDATA[
            select IM.ITEM_MASTER_SID as ID,IM.ITEM_NAME as COM_NAME,I."YEAR" as YEARS, I.? as PERIODS,
            sum(NMSP.?) as Sales,sum(NMSP.?) as Units, IM.ITEM_NO from  PROJECTION_DETAILS PD 
            join CCP_DETAILS CCPD ON CCPD.CCP_DETAILS_SID=PD.CCP_DETAILS_SID AND CCPD.COMPANY_MASTER_SID in (?)  
            AND CCPD.CONTRACT_MASTER_SID='?' 
            join ITEM_MASTER IM ON IM.ITEM_MASTER_SID=CCPD.ITEM_MASTER_SID AND IM.BRAND_MASTER_SID='?' 
             join ? NMSP 
            ON  NMSP.PROJECTION_DETAILS_SID=PD.PROJECTION_DETAILS_SID 
            join "PERIOD" I on I.PERIOD_SID = NMSP.PERIOD_SID WHERE PD.PROJECTION_MASTER_SID= '?'   AND NMSP.SESSION_ID=?
            group by IM.ITEM_MASTER_SID,IM.ITEM_NAME,I."YEAR", I.?, IM.ITEM_NO order by IM.ITEM_NO;
        ]]>
    </sql>
    <sql id="companyCount">
        <![CDATA[
            select count(distinct TEMP.COMPANY_MASTER_SID) from  GCM_COMPANY_DETAILS TEMP 
            WHERE TEMP.COMPANY_MASTER_SID in (?)
        ]]>
    </sql>
</custom-sql>
