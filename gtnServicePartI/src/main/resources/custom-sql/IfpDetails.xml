<?xml version="1.0"?>

<custom-sql>
	<sql id="findItemDetails">
		<![CDATA[
			
select com_ItemFamilyPlanDetails.ItemSystemId,
com_ItemMaster.ItemNo, 
com_ItemMaster.ItemName, 
com_ItemMaster.ItemStartDate,
com_ItemMaster.ItemEndDate,
com_ItemFamilyPlanDetails.AttachedStatus,
com_ItemFamilyPlanDetails.StartDate, 
com_ItemFamilyPlanDetails.EndDate,
com_ItemFamilyPlanDetails.TotalVolumeCommitment,
com_ItemFamilyPlanDetails.TotalDollarCommitment,
com_ItemFamilyPlanDetails.TotalMarketshareCommitment,
com_ItemFamilyPlanDetails.CommitmentPeriod,
com_ItemFamilyPlanDetails.ItemFamilyPlanSystemId,
com_ItemMaster.PackageSize,
com_ItemMaster.PrimaryUom,
com_ItemFamilyPlanDetails.CreatedBy,
com_ItemFamilyPlanDetails.CreatedDate,
com_ItemFamilyPlanDetails.ModifiedBy,
com_ItemFamilyPlanDetails.ModifiedDate,
com_ItemFamilyPlanDetails.AttachedDate
    from com_ItemFamilyPlanDetails, com_ItemMaster 
    where com_ItemMaster.ItemSystemId = com_ItemFamilyPlanDetails.ItemSystemId
		]]>
	</sql>
	
	<sql id="deleteItemDetails">
		<![CDATA[			
		delete from com_ItemFamilyPlanDetails
		]]>
	</sql>
	
	<sql id="findItems">
		<![CDATA[			
		select com_ItemMaster.ItemSystemId,
				com_ItemMaster.ItemNo, 
				com_ItemMaster.ItemName, 
				com_ItemMaster.PackageSize,
				com_ItemMaster.PrimaryUom
    	from com_ItemMaster
    	]]>
	</sql>
	
	<sql id="findIrtItems">
		<![CDATA[			
		select com_ItemMaster.ItemSystemId,
				com_ItemMaster.ItemNo, 
				com_ItemMaster.ItemName, 
				com_ItemMaster.PackageSize,
				com_ItemMaster.PrimaryUom,
				com_ItemIrtIdentifier.ItemIdentifier
    	from com_ItemMaster,com_ItemIrtIdentifier
    	 where com_ItemMaster.ItemSystemId=com_ItemIrtIdentifier.ItemSystemId
		]]>
	</sql>
	
	<sql id="deleteItemsFromPs">
		<![CDATA[			
		delete from com_PriceScheduleDetails
		]]>
	</sql>
	
	<sql id="deleteItemsFromRs">
		<![CDATA[			
		delete from com_RebateScheduleDetails
		]]>
	</sql>
	
	<sql id="selectDistinctPsIds">
		<![CDATA[			
		select distinct com_PriceScheduleDetails.PriceScheduleSystemId from com_PriceScheduleDetails
		]]>
	</sql>
	
	<sql id="selectDistinctRsIds">
		<![CDATA[			
		select distinct com_RebateScheduleDetails.RebateScheduleSystemId from com_RebateScheduleDetails
		]]>
	</sql>
        
        <sql id="ifpFlagupdate1">
		<![CDATA[			
	UPDATE IMTD_IFP_DETAILS SET IFP_MODEL_SID=? WHERE USERS_SID='?' AND SESSION_ID='?' AND CAST(CREATED_DATE As DATE)='?' AND CHECK_BOX=1;	
      MERGE IFP_DETAILS AS Target USING 
         (SELECT  IFP_MODEL_SID,ITEM_MASTER_SID,IFP_DETAILS_ATTACHED_STATUS,IFP_DETAILS_START_DATE,IFP_DETAILS_END_DATE,
         OPERATION, CHECK_BOX,CREATED_BY, CREATED_DATE, MODIFIED_BY, MODIFIED_DATE 
         FROM dbo.IMTD_IFP_DETAILS
        WHERE USERS_SID='?' AND SESSION_ID='?' AND CAST(CREATED_DATE AS DATE)='?' AND CHECK_BOX=1) AS Source
        
        ON (Target.IFP_MODEL_SID = Source.IFP_MODEL_SID 
     AND Target.ITEM_MASTER_SID=Source.ITEM_MASTER_SID AND Target.INBOUND_STATUS = 'D')
        WHEN MATCHED THEN
        
        UPDATE SET 
      
        	Target.ITEM_IFP_ATTACHED_STATUS=Source.IFP_DETAILS_ATTACHED_STATUS,
  		Target.START_DATE=Source.IFP_DETAILS_START_DATE,
  		Target.END_DATE=Source.IFP_DETAILS_END_DATE,
  		Target.INBOUND_STATUS='A',
  		Target.RECORD_LOCK_STATUS=0,
  		Target.CREATED_BY=Source.CREATED_BY,
  		Target.CREATED_DATE=Source.CREATED_DATE,
  		Target.MODIFIED_BY=Source.MODIFIED_BY,
  		Target.MODIFIED_DATE=Source.MODIFIED_DATE      
       
        WHEN NOT matched THEN
        
  		INSERT(IFP_MODEL_SID, ITEM_MASTER_SID,ITEM_IFP_ATTACHED_STATUS,
  		START_DATE,END_DATE,INBOUND_STATUS,
  		RECORD_LOCK_STATUS,CREATED_BY,CREATED_DATE,MODIFIED_BY,MODIFIED_DATE)  		
  		VALUES(Source.IFP_MODEL_SID,Source.ITEM_MASTER_SID,Source.IFP_DETAILS_ATTACHED_STATUS,Source.IFP_DETAILS_START_DATE,Source.IFP_DETAILS_END_DATE,'A',0,Source.CREATED_BY,Source.CREATED_DATE,Source.MODIFIED_BY,Source.MODIFIED_DATE);
       DELETE FROM IMTD_PS_DETAILS WHERE USERS_SID='?' AND SESSION_ID='?';
		]]>
	</sql>
        
        
        <sql id="ifpupdate1">
		<![CDATA[			
		UPDATE IFP
      SET    IFP.IFP_MODEL_SID = tmp.IFP_MODEL_SID,
             IFP.ITEM_MASTER_SID = tmp.ITEM_MASTER_SID,
             IFP.START_DATE = tmp.IFP_DETAILS_START_DATE,
             IFP.END_DATE = tmp.IFP_DETAILS_END_DATE,
             IFP.ITEM_IFP_ATTACHED_STATUS = tmp.IFP_DETAILS_ATTACHED_STATUS,
             IFP.ITEM_IFP_ATTACHED_DATE = tmp.IFP_DETAILS_ATTACHED_DATE,
             IFP.CREATED_BY = tmp.IFP_DETAILS_CREATED_BY,
             IFP.CREATED_DATE = tmp.IFP_DETAILS_CREATED_DATE,
             IFP.MODIFIED_BY = tmp.IFP_DETAILS_MODIFIED_BY,
             IFP.MODIFIED_DATE = tmp.IFP_DETAILS_MODIFIED_DATE,
             IFP.INBOUND_STATUS = 'D'
      FROM   IMTD_IFP_DETAILS tmp
             JOIN IFP_DETAILS IFP
               ON tmp.IFP_MODEL_SID = IFP.IFP_MODEL_SID
                  AND tmp.ITEM_MASTER_SID = IFP.ITEM_MASTER_SID
      WHERE  tmp.OPERATION <> 'F'
             AND tmp.CHECK_BOX = 0
		]]>
	</sql>
        
        <sql id="ifpupdate2">
		<![CDATA[			
		UPDATE IFP
      SET    IFP.IFP_MODEL_SID = tmp.IFP_MODEL_SID,
             IFP.ITEM_MASTER_SID = tmp.ITEM_MASTER_SID,
             IFP.START_DATE = tmp.IFP_DETAILS_START_DATE,
             IFP.END_DATE = tmp.IFP_DETAILS_END_DATE,
             IFP.ITEM_IFP_ATTACHED_STATUS = tmp.IFP_DETAILS_ATTACHED_STATUS,
             IFP.ITEM_IFP_ATTACHED_DATE = tmp.IFP_DETAILS_ATTACHED_DATE,
             IFP.CREATED_BY = tmp.IFP_DETAILS_CREATED_BY,
             IFP.CREATED_DATE = tmp.IFP_DETAILS_CREATED_DATE,
             IFP.MODIFIED_BY = tmp.IFP_DETAILS_MODIFIED_BY,
             IFP.MODIFIED_DATE = tmp.IFP_DETAILS_MODIFIED_DATE,
             IFP.INBOUND_STATUS = tmp.OPERATION
      FROM   IMTD_IFP_DETAILS tmp
             JOIN IFP_DETAILS IFP
               ON tmp.IFP_DETAILS_SID = IFP.IFP_DETAILS_SID
      WHERE  tmp.OPERATION IN( 'U', 'D' )
             AND tmp.CHECK_BOX = 1
		]]>
	</sql>
        
        <sql id="ifpupdate3">
		<![CDATA[			
		MERGE IFP_DETAILS AS T
      USING IMTD_IFP_DETAILS AS S
      ON ( S.IFP_MODEL_SID = T.IFP_MODEL_SID
           AND S.ITEM_MASTER_SID = T.ITEM_MASTER_SID )
      WHEN NOT MATCHED BY TARGET AND S.IFP_DETAILS_SID=0 AND S.OPERATION='A' AND S.CHECK_BOX = 1 and 
      ]]>
	</sql>
 
         <sql id="ifpupdate4">
		<![CDATA[
        THEN
        INSERT( IFP_MODEL_SID,
                ITEM_MASTER_SID,
                START_DATE,
                END_DATE,
                ITEM_IFP_ATTACHED_STATUS,
                ITEM_IFP_ATTACHED_DATE,
                CREATED_BY,
                CREATED_DATE,
                MODIFIED_BY,
                MODIFIED_DATE,
                INBOUND_STATUS
      )
        VALUES(S.IFP_MODEL_SID,
               S.ITEM_MASTER_SID,
               S.IFP_DETAILS_START_DATE,
               S.IFP_DETAILS_END_DATE,
               S.IFP_DETAILS_ATTACHED_STATUS,
               S.IFP_DETAILS_ATTACHED_DATE,
               S.IFP_DETAILS_CREATED_BY,
               S.IFP_DETAILS_CREATED_DATE,
               S.IFP_DETAILS_MODIFIED_BY,
               S.IFP_DETAILS_MODIFIED_DATE,
               S.OPERATION
      )
      WHEN MATCHED AND S.IFP_DETAILS_SID=0 AND S.OPERATION='A' AND S.CHECK_BOX = 1 and 
      ]]>
	</sql>
 
        <sql id="ifpupdate5">
        <![CDATA[   THEN
        UPDATE SET T.IFP_MODEL_SID = S.IFP_MODEL_SID,
                   T.ITEM_MASTER_SID = S.ITEM_MASTER_SID,
                   T.START_DATE = S.IFP_DETAILS_START_DATE,
                   T.END_DATE = S.IFP_DETAILS_END_DATE,
                   T.ITEM_IFP_ATTACHED_STATUS = S.IFP_DETAILS_ATTACHED_STATUS,
                   T.ITEM_IFP_ATTACHED_DATE = S.IFP_DETAILS_ATTACHED_DATE,
                   T.CREATED_BY = S.IFP_DETAILS_CREATED_BY,
                   T.CREATED_DATE = S.IFP_DETAILS_CREATED_DATE,
                   T.MODIFIED_BY = S.IFP_DETAILS_MODIFIED_BY,
                   T.MODIFIED_DATE = S.IFP_DETAILS_MODIFIED_DATE,
                   T.INBOUND_STATUS = S.OPERATION;
		]]>
	</sql>
        
        <sql id="ifpSelectTempTableData">
            <![CDATA[   
                SELECT CHECK_BOX,IFP_DETAILS_ATTACHED_STATUS,IFP_DETAILS_START_DATE,
                    IFP_DETAILS_END_DATE,ITEM_ID,ITEM_NO,ITEM_NAME,ITEM_STATUS,
                    ITEM_DESC,ITEM_START_DATE,ITEM_END_DATE,ITEM_PRIMARY_UOM,ITEM_PACKAGE_SIZE,
                    ITEM_BRAND,ITEM_FORM,ITEM_THERAPEUTIC_CLASS,ITEM_STRENGTH,
                    IFP_DETAILS_CREATED_BY,IFP_DETAILS_MODIFIED_BY,IFP_DETAILS_CREATED_DATE,
                    IFP_DETAILS_MODIFIED_DATE,IFP_DETAILS_ATTACHED_DATE,IMTD_IFP_DETAILS_SID  FROM IMTD_IFP_DETAILS
                    WHERE OPERATION NOT IN ('D','F')   
		]]>
        </sql>
        
        <sql id="ifpSelectTempTableCount">
            <![CDATA[   
                 SELECT COUNT(IMTD_IFP_DETAILS_SID)FROM IMTD_IFP_DETAILS WHERE OPERATION NOT IN ('D','F')
		]]>
        </sql>
        
        <sql id="ifpViewTempTableData">
            <![CDATA[   
                 SELECT IM.FORM,IM.BRAND_MASTER_SID, IM.ITEM_ID, IM.ITEM_NO, IM.ITEM_NAME, 
                    IM.PACKAGE_SIZE, IM.PRIMARY_UOM, IM.STRENGTH, IM.THERAPEUTIC_CLASS, IFD.ITEM_IFP_ATTACHED_STATUS, 
                    IFD.START_DATE, IFD.END_DATE, IFD.CREATED_BY, IFD.CREATED_DATE, IFD.MODIFIED_BY, IFD.MODIFIED_DATE, 
                    IFD.ITEM_IFP_ATTACHED_DATE, IM.ITEM_START_DATE, IM.ITEM_END_DATE, IM.ITEM_STATUS,IM.ITEM_DESC
                    from dbo.ITEM_MASTER IM, dbo.IFP_DETAILS IFD
		]]>
        </sql>
        
        <sql id="ifpViewTempTableCount">
            <![CDATA[   
                 SELECT COUNT(ITEM_MASTER_SID) FROM IFP_DETAILS WHERE INBOUND_STATUS <> 'D' AND INBOUND_STATUS IS NOT NULL
		]]>
        </sql>
        
</custom-sql>