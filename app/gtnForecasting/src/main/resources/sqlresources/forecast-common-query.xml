<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<sql>
<entity id="checktpcustomeractual">
<query> <![CDATA[
        
                    
        select
	case
		when exists(
			SELECT
				PROJECTION_DETAILS_SID
			FROM
				PROJECTION_DETAILS P
			JOIN CCP_DETAILS C ON
				P.CCP_DETAILS_SID = C.CCP_DETAILS_SID
			JOIN(
					SELECT
						DISTINCT CCP.COMPANY_MASTER_SID
					FROM
						PROJECTION_DETAILS PD
					JOIN CCP_DETAILS CCP ON
						CCP.CCP_DETAILS_SID = PD.CCP_DETAILS_SID
						AND PD.PROJECTION_MASTER_SID = @PROJECTION_ID
					LEFT JOIN ACTUALS_MASTER AM ON
						AM.COMPANY_MASTER_SID = CCP.COMPANY_MASTER_SID
						AND AM.ITEM_MASTER_SID = CCP.ITEM_MASTER_SID
						AND AM.CONTRACT_MASTER_SID = CCP.CONTRACT_MASTER_SID
					GROUP BY
						CCP.COMPANY_MASTER_SID
					HAVING
						SUM( AM.SALES_AMOUNT ) = 0
						OR SUM( AM.SALES_AMOUNT ) IS NULL
				) COMP ON
				COMP.COMPANY_MASTER_SID = C.COMPANY_MASTER_SID
				AND P.PROJECTION_MASTER_SID = @PROJECTION_ID
		) then 1
		else 0
	end
        
        
    ]]> </query>
</entity>
</sql>
