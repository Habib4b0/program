<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->

<sql>
    <entity id="period-config-query">        
        <query>
            <![CDATA[
;WITH CTE AS (

                Select MODULES.DESCRIPTION as MODULES,
                case when  PCM.BUSINESS_PROCESS_TYPE=-1 then 'Adjustment Summary' 
                WHEN PCM.BUSINESS_PROCESS_TYPE<-1 THEN 'Balance Summary Report - ' + REPLACE(HT_CONFIG.DESCRIPTION,'Balance Summary', '')
                ELSE ADJUST_CONFIG.TRANSACTION_NAME end as TRANSACTION_NAME ,Company.COMPANY_NO+' - '+Company.COMPANY_NAME as Company_NAME,
                 Buciness_Unit.COMPANY_NO+' - '+Buciness_Unit.COMPANY_NAME as BUSCINESS_UNIT,'Multiple' as PERIOD_VIEW, 
                FROM_MODE.DESCRIPTION as FROM_MODE,FROM_FRE.DESCRIPTION as FROM_FRE,PCD.FROM_PERIOD AS FROM_PERIOD,PCD.FROM_PERIOD_DATE AS FROM_PERIOD_DATE,
                FROM_DEF_MODE.DESCRIPTION as FROM_DEF_MODE ,FROM_DEF_FRE.DESCRIPTION as FROM_DEF_FRE,PCD.FROM_DEFAULT_PERIOD AS FROM_DEFAULT_PERIOD ,PCD.FROM_DEFAULT_PERIOD_DATE AS FROM_DEFAULT_PERIOD_DATE,
                TO_MODE.DESCRIPTION as TO_MODE ,TO_FRE.DESCRIPTION as TO_FRE,PCD.TO_PERIOD AS TO_PERIOD,PCD.TO_PERIOD_DATE AS TO_PERIOD_DATE,
                TO_DEF_MODE.DESCRIPTION as TO_DEF_MODE,TO_DEF_FRE.DESCRIPTION as TO_DEF_FRE,PCD.TO_DEFAULT_PERIOD AS TO_DEFAULT_PERIOD,PCD.TO_DEFUALT_PERIOD_DATE AS TO_DEFUALT_PERIOD_DATE,PCD.VERSION_NO as v_NO,PCD.CREATED_BY AS CREATED_BY,PERIOD_VIEW.DESCRIPTION as PV,case when  UDC1.VERSION_NO=PCD.VERSION_NO then 'Active' else 'Inactive' end as active_flag,UDC1.VERSION_NO AS UDC1_VERSION_NO,PCD.PERIOD_CONFIG_DETAILS_SID As PERIOD_CONFIG_DETAILS_SID , usr.lastName AS LAST_NAME   
                from PERIOD_CONFIG_DETAILS PCD 
                left join PERIOD_CONFIG_MASTER PCM ON PCM.PERIOD_CONFIG_MASTER_SID=PCD.PERIOD_CONFIG_MASTER_SID
                left JOIN COMPANY_MASTER Company ON Company.COMPANY_MASTER_SID=PCM.COMPANY_MASTER_SID
                left JOIN COMPANY_MASTER Buciness_Unit ON Buciness_Unit.COMPANY_MASTER_SID=PCM.BU_COMPANY_MASTER_SID
                left JOIN ARM_ADJUSTMENT_CONFIG ADJUST_CONFIG ON ADJUST_CONFIG.ARM_ADJUSTMENT_CONFIG_SID=PCM.BUSINESS_PROCESS_TYPE
                LEFT JOIN(SELECT PERIOD_CONFIG_MASTER_SID,RIGHT(BUSINESS_PROCESS_TYPE, LEN(BUSINESS_PROCESS_TYPE) - 1) AS BUSINESS_PROCESS_TYPE
                FROM PERIOD_CONFIG_MASTER PCM1 WHERE PCM1.BUSINESS_PROCESS_TYPE < - 1) PCM2 ON
                PCM2.PERIOD_CONFIG_MASTER_SID = PCM.PERIOD_CONFIG_MASTER_SID
                LEFT JOIN HELPER_TABLE HT_CONFIG ON HT_CONFIG.HELPER_TABLE_SID = PCM2.BUSINESS_PROCESS_TYPE 
                left JOIN HELPER_TABLE MODULES ON PCM."MODULE"=MODULES.HELPER_TABLE_SID AND MODULES.LIST_NAME='PERIODCONFIG_MODULES'
                left JOIN HELPER_TABLE FROM_MODE ON PCD.FROM_MODE=FROM_MODE.HELPER_TABLE_SID AND FROM_MODE.LIST_NAME='PERIODCONFIG_MODE'
                left JOIN HELPER_TABLE FROM_DEF_MODE ON PCD.FROM_DEFAULT_MODE=FROM_DEF_MODE.HELPER_TABLE_SID AND FROM_DEF_MODE.LIST_NAME='PERIODCONFIG_MODE'
                left JOIN HELPER_TABLE TO_MODE ON PCD.TO_MODE=TO_MODE.HELPER_TABLE_SID AND TO_MODE.LIST_NAME='PERIODCONFIG_MODE'
                left JOIN HELPER_TABLE TO_DEF_MODE ON PCD.TO_DEFAULT_MODE=TO_DEF_MODE.HELPER_TABLE_SID AND TO_DEF_MODE.LIST_NAME='PERIODCONFIG_MODE'
                left JOIN HELPER_TABLE FROM_FRE ON PCD.FROM_FREQUENCY=FROM_FRE.HELPER_TABLE_SID AND FROM_FRE.LIST_NAME='PERIODCONFIG_FREQUENCY'
                left JOIN HELPER_TABLE FROM_DEF_FRE ON PCD.FROM_DEFAULT_FREQUERNCY=FROM_DEF_FRE.HELPER_TABLE_SID AND FROM_DEF_FRE.LIST_NAME='PERIODCONFIG_FREQUENCY'
                left JOIN HELPER_TABLE TO_FRE ON PCD.TO_FREQUENCY=TO_FRE.HELPER_TABLE_SID AND TO_FRE.LIST_NAME='PERIODCONFIG_FREQUENCY'
                left JOIN HELPER_TABLE TO_DEF_FRE ON PCD.TO_DEFAULT_FREQUERNCY=TO_DEF_FRE.HELPER_TABLE_SID AND TO_DEF_FRE.LIST_NAME='PERIODCONFIG_FREQUENCY'  left JOIN HELPER_TABLE PERIOD_VIEW ON PCD.PERIOD_VIEW=PERIOD_VIEW.HELPER_TABLE_SID AND PERIOD_VIEW.LIST_NAME='PERIODCONFIG_VIEW'  
                Left JOIN @CATALOGUE.dbo.User_ usr ON usr.UserId = PCD.CREATED_BY  Left JOIN (Select Max(TPCD.VERSION_NO) as VERSION_NO,TPCD.PERIOD_CONFIG_MASTER_SID as PERIOD_CONFIG_MASTER_SID from PERIOD_CONFIG_DETAILS TPCD 
                 group by  TPCD.PERIOD_CONFIG_MASTER_SID ) as UDC1 ON UDC1.PERIOD_CONFIG_MASTER_SID=PCD.PERIOD_CONFIG_MASTER_SID)
                 
                 SELECT @VARIABLE FROM CTE 
        ]]> 
        </query>
      </entity>  
</sql>

