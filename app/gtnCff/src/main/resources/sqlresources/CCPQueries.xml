<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->

<sql> 
    <entity id="selected-hierarchy-no">
        <query>
            <![CDATA[
                IF Object_id('TEMPDB..#SELECTED_HIERARCHY_NO') IS NOT NULL
                DROP TABLE #SELECTED_HIERARCHY_NO
                CREATE TABLE #SELECTED_HIERARCHY_NO (HIERARCHY_NO varchar(50),CCP_DETAILS_SID INT,INSTR INT)

                INSERT INTO #SELECTED_HIERARCHY_NO
                (HIERARCHY_NO,
                CCP_DETAILS_SID,INSTR)
                SELECT HIERARCHY_NO,CH.CCP_DETAILS_SID,INSTR
                FROM   (VALUES 	[?HIERARCHY_NO_VALUES])A(HIERARCHY_NO,INSTR)                
                [?SELECTED_HIERARCHY_JOIN]
            ]]>
        </query>
    </entity>
    
    <entity id="custom-view-count-query">
        <query>
            <![CDATA[    
                SELECT
                    COUNT(DISTINCT SHN.HIERARCHY_NO)
                FROM
                    #SELECTED_HIERARCHY_NO SHN;        
            ]]>
        </query>
    </entity>	
    
    <entity id="custom-view-hiearchy-no-query">
        <query>
            <![CDATA[    
                 SELECT 
                   HIERARCHY_NO 
                 FROM 
                   #SELECTED_HIERARCHY_NO
                 GROUP BY HIERARCHY_NO ORDER BY MIN([INSTR]) ASC
                 OFFSET [?START] ROWS FETCH NEXT [?END] ROWS ONLY;        
            ]]>
        </query>
    </entity>	
    
    <entity id="hiearchy-no-count-query">
        <query>
            <![CDATA[    
                IF Object_id('TEMPDB..#SELECTED_HIERARCHY_NO') IS NOT NULL
                DROP TABLE #SELECTED_HIERARCHY_NO
                CREATE TABLE #SELECTED_HIERARCHY_NO (HIERARCHY_NO varchar(50),INSTR INT,CCP_DETAILS_SID INT,RELATIONSHIP_LEVEL_VALUES VARCHAR(50))

                INSERT INTO #SELECTED_HIERARCHY_NO 
                (HIERARCHY_NO,INSTR,
                CCP_DETAILS_SID,RELATIONSHIP_LEVEL_VALUES)
                SELECT A.HIERARCHY_NO,INSTR,CH.CCP_DETAILS_SID,RELATIONSHIP_LEVEL_VALUES
                FROM   (VALUES [?HIERARCHY_NO_VALUES])A(HIERARCHY_NO,INSTR)
                JOIN ST_CCP_HIERARCHY CH ON CH.[?HIERARCHY_COLUMN] LIKE A.HIERARCHY_NO+'%'
                [?TAB_BASED_JOIN]

            ]]>
        </query>
    </entity>
    
    <entity id="hiearchy-no-query">
        <query>
            <![CDATA[    
                IF Object_id('TEMPDB..#SELECTED_HIERARCHY_NO') IS NOT NULL
                DROP TABLE #SELECTED_HIERARCHY_NO
                CREATE TABLE #SELECTED_HIERARCHY_NO (HIERARCHY_NO varchar(50),INSTR INT,CCP_DETAILS_SID INT,RELATIONSHIP_LEVEL_VALUES VARCHAR(50))

                INSERT INTO #SELECTED_HIERARCHY_NO 
                (HIERARCHY_NO,INSTR,
                CCP_DETAILS_SID,RELATIONSHIP_LEVEL_VALUES)
                SELECT A.HIERARCHY_NO,INSTR,CH.CCP_DETAILS_SID,RELATIONSHIP_LEVEL_VALUES
                FROM   (VALUES [?HIERARCHY_NO_VALUES])A(HIERARCHY_NO,INSTR)
                JOIN ST_CCP_HIERARCHY CH ON CH.[?HIERARCHY_COLUMN] LIKE A.HIERARCHY_NO+'%'
                [?TAB_BASED_JOIN]

            ]]>
        </query>
    </entity>	
     <entity id="Drop.DynamicTempTables">
        <query> 
            <![CDATA[
     DECLARE @SQL        VARCHAR(MAX)='',
        @USER    INT=@USER_ID,
        @SESSION VARCHAR(100)='@SESSION_ID'

SET @SQL = (SELECT Concat('DROP TABLE ', Quotename(Upper(NAME)), '; ')
            FROM   SYS.TABLES
            WHERE  NAME LIKE Concat('ST_%', @USER, '_', @SESSION, '_', Replace(CONVERT(VARCHAR(50), Getdate(), 2), '.', ''))
            FOR XML PATH (''))
--select @sql
EXEC( @SQL ) 
   ]]>
        </query> 
    </entity>
    
    <entity id="selected-hierarchy-no-for-custom">
        <query>
            <![CDATA[
                IF Object_id('TEMPDB..#SELECTED_HIERARCHY_NO') IS NOT NULL
                DROP TABLE #SELECTED_HIERARCHY_NO
                CREATE TABLE #SELECTED_HIERARCHY_NO (HIERARCHY_NO varchar(50),CCP_DETAILS_SID INT,INSTR INT,RELATIONSHIP_LEVEL_VALUES VARCHAR(50))

                INSERT INTO #SELECTED_HIERARCHY_NO
                (HIERARCHY_NO,
                CCP_DETAILS_SID,INSTR,RELATIONSHIP_LEVEL_VALUES)
                SELECT DISTINCT A.HIERARCHY_NO,CH.CCP_DETAILS_SID,INSTR,RELATIONSHIP_LEVEL_VALUES
                FROM   (VALUES 	[?HIERARCHY_NO_VALUES])A(HIERARCHY_NO,INSTR)                
                [?SELECTED_HIERARCHY_JOIN]
            ]]>
        </query>
    </entity>

    <entity id="PARENT-VALIDATE">
        <query>
            <![CDATA[
            
                  IF Object_id('TEMPDB..#PARENT_VALIDATE') IS NOT NULL DROP
	TABLE
		#PARENT_VALIDATE CREATE
			TABLE
				#PARENT_VALIDATE(
					RS_CONTRACT_SID INT,
					PARENT_HIERARCHY VARCHAR(MAX)
				) INSERT
					into
						#PARENT_VALIDATE(
							RS_CONTRACT_SID,
							PARENT_HIERARCHY
						) SELECT
							DISTINCT mas.RS_CONTRACT_SID,
							RLD.PARENT_HIERARCHY_NO
						FROM
							ST_CCP_DEDUCTION_HIERARCHY MAS
						JOIN RELATIONSHIP_LEVEL_DEFINITION RLD ON
							LEVEL_NO = 10
							AND relationship_builder_sid = @RELVALUE
                                                        AND VERSION_NO = @RELVERSION
							AND RLD.RELATIONSHIP_LEVEL_VALUES = MAS.RS_CONTRACT_SID
 
 
            ]]>
        </query>
    </entity> 
    <entity id="custom-view-condition-query">
        <query>
            <![CDATA[    
SELECT  convert(VARCHAR(8000),HIERARCHY_NO) HIERARCHY_NO  FROM (SELECT DISTINCT HIERARCHY_NO = STUFF((
			SELECT DISTINCT ', ' + HIERARCHY_NO
			FROM #SELECTED_HIERARCHY_NO B
			WHERE B.RELATIONSHIP_LEVEL_VALUES = A.RELATIONSHIP_LEVEL_VALUES
			FOR XML PATH('')
			), 1, 2, ''),INSTR
FROM #SELECTED_HIERARCHY_NO A
@RELJOIN )S
ORDER BY INSTR
                OFFSET [?START] ROWS FETCH NEXT [?END] ROWS ONLY;  
            ]]>
        </query>
        </entity>
        
         <entity id="get-ccp-query">
        <query>
            <![CDATA[  
            IF OBJECT_ID('TEMPDB..#SELECTED_HIERARCHY_NO_TEMP') IS NOT NULL
                 DROP TABLE #SELECTED_HIERARCHY_NO_TEMP  
      SELECT CCP_DETAILS_SID,CONVERT(VARCHAR(8000),HIERARCHY_NO) HIERARCHY_NO  INTO #SELECTED_HIERARCHY_NO_TEMP  FROM (SELECT CCP_DETAILS_SID,HIERARCHY_NO = STUFF((
			SELECT DISTINCT ', ' + HIERARCHY_NO
			FROM #SELECTED_HIERARCHY_NO B
			WHERE B.RELATIONSHIP_LEVEL_VALUES = A.RELATIONSHIP_LEVEL_VALUES
			FOR XML PATH('')
			), 1, 2, '')
FROM #SELECTED_HIERARCHY_NO A
@RELJOIN )S
            ]]>
        </query>
    </entity>
    
                <entity id="custom-view-count-condition-query">
        <query>
            <![CDATA[  
              SELECT COUNT(DISTINCT HIERARCHY_NO)   FROM (SELECT HIERARCHY_NO = STUFF((
			SELECT DISTINCT ', ' + HIERARCHY_NO
			FROM #SELECTED_HIERARCHY_NO B
			WHERE B.RELATIONSHIP_LEVEL_VALUES = A.RELATIONSHIP_LEVEL_VALUES
			FOR XML PATH('')
			), 1, 2, '')
FROM #SELECTED_HIERARCHY_NO A
@RELJOIN )S
            ]]>
        </query>
    </entity>	
    	
    <entity id="custom-view-count-condition-query-forPV">
        <query>
            <![CDATA[  
              SELECT COUNT(DISTINCT HIERARCHY_NO)  
FROM #SELECTED_HIERARCHY_NO A
            ]]>
        </query>
    </entity>		
    <entity id = "customViewDeclaration">
        <query>
            <![CDATA[
            DECLARE @LEVEL_NO INT

            SELECT @LEVEL_NO = Max(LEVEL_NO)
            FROM   CUST_VIEW_DETAILS
            WHERE  CUSTOM_VIEW_MASTER_SID = [$CUSTOM_VIEW_MASTER_SID] 

            ]]>
        </query>
    </entity>	
    
    <entity id="getHierarchyTableDetailsCustom">
<query> <![CDATA[
		
                    SELECT distinct 
                    CASE WHEN HLD.LEVEL_VALUE_REFERENCE='User Defined'  THEN 'LEVEL_VALUES' ELSE 
                        CASE WHEN HLD.TABLE_NAME=JVIEW.REFERENCE_TABLE_NAME OR JVIEW.REFERENCE_TABLE_NAME='HELPER_TABLE' THEN JVIEW.REFERENCE_COLUMN_NAME ELSE JVIEW.DESC_COLUMN_NAME END END DISPLAY_COLUMN,
                    CASE WHEN HLD.LEVEL_VALUE_REFERENCE='User Defined'  THEN 'HIERARCHY_LEVEL_VALUES' ELSE 
                        CASE WHEN HLD.TABLE_NAME=JVIEW.REFERENCE_TABLE_NAME THEN HLD.TABLE_NAME ELSE JVIEW.REFERENCE_TABLE_NAME  END END H_TABLE_NAME,
                    CASE WHEN HLD.LEVEL_VALUE_REFERENCE='User Defined'  THEN 'HIERARCHY_LEVEL_VALUES_SID' ELSE 
                        CASE WHEN JVIEW.MAPPING_COLUMN_NAME is null THEN JVIEW.PRIMARY_KEY_COLUMN_NAME ELSE JVIEW.MAPPING_COLUMN_NAME END END FIELD_NAME,
                    RLD.LEVEL_NO
                    FROM CUST_VIEW_DETAILS  RLD 
                    JOIN HIERARCHY_LEVEL_DEFINITION HLD ON HLD.HIERARCHY_LEVEL_DEFINITION_SID=RLD.HIERARCHY_ID AND RLD.CUSTOM_VIEW_MASTER_SID =?RBSID
                    and HIERARCHY_INDICATOR IN('C','P')
                    JOIN HIERARCHY_DEFINITION HD ON HD.HIERARCHY_DEFINITION_SID=HLD.HIERARCHY_DEFINITION_SID
                    LEFT JOIN vw_helper_list JVIEW ON JVIEW.ACTUAL_TABLE_NAME=HLD.TABLE_NAME AND JVIEW.ACTUAL_COLUMN_NAME=HLD.FIELD_NAME
                    JOIN HELPER_TABLE HT ON HT.HELPER_TABLE_SID=HD.HIERARCHY_CATEGORY ORDER BY RLD.LEVEL_NO;
                
    ]]> </query>
</entity>

<entity id="getRelationshipCustomCCP">
		<query> 
            <![CDATA[ 
              IF OBJECT_ID('tempdb..#CUSTOM_CCP_SALES') IS NOT NULL
                            DROP TABLE #CUSTOM_CCP_SALES
                 SELECT CUST_VIEW_MASTER_SID,RELATIONSHIP_LEVEL_VALES,LEVEL_NO,HIERARCHY_NO INTO #CUSTOM_CCP_SALES FROM CUSTOM_CCP_SALES_@CUSTOMSID  CCCP
                 JOIN  ST_CCP_HIERARCHY CCP ON CCP.CCP_DETAILS_SID=CCCP.CCP_DETAILS_SID WHERE CUST_VIEW_MASTER_SID=?RBSID 
                 GROUP BY CUST_VIEW_MASTER_SID,RELATIONSHIP_LEVEL_VALES,LEVEL_NO,HIERARCHY_NO
                                
            ]]>
		</query>
	</entity>
        
        <entity id="getHierarchyTableDetailsDeductionCustom">
		<query> 
            <![CDATA[         
                select
	LEVEL_NO,
	FIELD_NAME_HLD,
	CASE
		WHEN H_TABLE_NAME = 'HELPER_TABLE' THEN 1
		ELSE 0
	END AS HELPER_TABLE_JOIN_NEEDED,
	CASE
		WHEN FIELD_NAME_HLD LIKE '%UDC%' THEN 1
		ELSE 0
		END AS UDC_JOIN_NEEDED
from
	(
		SELECT
			distinct 
			CASE
				WHEN HLD.LEVEL_VALUE_REFERENCE = 'User Defined' THEN 'HIERARCHY_LEVEL_VALUES'
				ELSE CASE
					WHEN HLD.TABLE_NAME = JVIEW.REFERENCE_TABLE_NAME THEN HLD.TABLE_NAME
					ELSE JVIEW.REFERENCE_TABLE_NAME
				END
			END H_TABLE_NAME,
			convert(
				int,
				RLD.LEVEL_NO
			) AS LEVEL_NO,
			HLD.FIELD_NAME AS FIELD_NAME_HLD
		FROM
			CUST_VIEW_DETAILS  RLD
		JOIN HIERARCHY_LEVEL_DEFINITION HLD ON
			HLD.HIERARCHY_LEVEL_DEFINITION_SID = RLD.HIERARCHY_ID and HIERARCHY_INDICATOR ='D'
			AND CUSTOM_VIEW_MASTER_SID  = ?RBSID
		JOIN HIERARCHY_DEFINITION HD ON
			HD.HIERARCHY_DEFINITION_SID = HLD.HIERARCHY_DEFINITION_SID
		LEFT JOIN vw_helper_list JVIEW ON
			JVIEW.ACTUAL_TABLE_NAME = HLD.TABLE_NAME
			AND JVIEW.ACTUAL_COLUMN_NAME = HLD.FIELD_NAME
		JOIN HELPER_TABLE HT ON
			HT.HELPER_TABLE_SID = HD.HIERARCHY_CATEGORY
	) AB order by LEVEL_NO
             ]]>
		</query>
	</entity>
        
        
        
        
        <entity id="getRelationshipLevelValuesForDeductionCustomDiscount">
		<query> 
            <![CDATA[ 
               SELECT DISTINCT CCP.HIERARCHY_NO,
                HT.DESCRIPTION AS DESCRIPTION,
                CD.LEVEL_NAME,
                CD.LEVEL_NO,
                CCP.RELATIONSHIP_LEVEL_VALES,
                NULL           AS COLUMN_0,
                NULL           AS COLUMN_1
FROM   CUST_VIEW_DETAILS CD
       JOIN CUSTOM_CCP_SALES_@MASTERSID CCP
         ON CD.CUSTOM_VIEW_MASTER_SID = CCP.CUST_VIEW_MASTER_SID
            AND CD.CUSTOM_VIEW_MASTER_SID = ?RBSID
            AND CD.HIERARCHY_INDICATOR = 'D' and cd.LEVEL_NAME='Schedule Category'
       JOIN RS_CONTRACT RS
         ON RS.RS_CATEGORY = CCP.RELATIONSHIP_LEVEL_VALES
       JOIN HELPER_TABLE HT
         ON HT.HELPER_TABLE_SID = RS.RS_CATEGORY
       JOIN ST_NM_DISCOUNT_PROJ_MASTER ST
         ON ST.RS_CONTRACT_SID = RS.RS_CONTRACT_SID
            AND CCP.CCP_DETAILS_SID = ST.CCP_DETAILS_SID
GROUP  BY CCP.HIERARCHY_NO,
          HT.DESCRIPTION,
          CD.LEVEL_NAME,
          CD.LEVEL_NO,
          CCP.RELATIONSHIP_LEVEL_VALES
UNION ALL
SELECT DISTINCT CCP.HIERARCHY_NO,
                HT.DESCRIPTION AS DESCRIPTION,
                CD.LEVEL_NAME,
                CD.LEVEL_NO,
                CCP.RELATIONSHIP_LEVEL_VALES,
                NULL           AS COLUMN_0,
                NULL           AS COLUMN_1
FROM   CUST_VIEW_DETAILS CD
       JOIN CUSTOM_CCP_SALES_@MASTERSID CCP
         ON CD.CUSTOM_VIEW_MASTER_SID = CCP.CUST_VIEW_MASTER_SID
            AND CD.CUSTOM_VIEW_MASTER_SID = ?RBSID
            AND CD.HIERARCHY_INDICATOR = 'D' and cd.LEVEL_NAME='Schedule Type'
       JOIN RS_CONTRACT RS
         ON RS.RS_TYPE = CCP.RELATIONSHIP_LEVEL_VALES
       JOIN HELPER_TABLE HT
         ON HT.HELPER_TABLE_SID = RS.RS_TYPE
       JOIN ST_NM_DISCOUNT_PROJ_MASTER ST
         ON ST.RS_CONTRACT_SID = RS.RS_CONTRACT_SID
            AND CCP.CCP_DETAILS_SID = ST.CCP_DETAILS_SID
GROUP  BY CCP.HIERARCHY_NO,
          HT.DESCRIPTION,
          CD.LEVEL_NAME,
          CD.LEVEL_NO,
          CCP.RELATIONSHIP_LEVEL_VALES
UNION ALL
SELECT DISTINCT CCP.HIERARCHY_NO,
                HT.DESCRIPTION AS DESCRIPTION,
                CD.LEVEL_NAME,
                CD.LEVEL_NO,
                CCP.RELATIONSHIP_LEVEL_VALES,
                NULL           AS COLUMN_0,
                NULL           AS COLUMN_1
FROM   CUST_VIEW_DETAILS CD
       JOIN CUSTOM_CCP_SALES_@MASTERSID CCP
         ON CD.CUSTOM_VIEW_MASTER_SID = CCP.CUST_VIEW_MASTER_SID
            AND CD.CUSTOM_VIEW_MASTER_SID = ?RBSID
            AND CD.HIERARCHY_INDICATOR = 'D'
       JOIN RS_CONTRACT RS
         ON RS.REBATE_PROGRAM_TYPE = CCP.RELATIONSHIP_LEVEL_VALES  and cd.LEVEL_NAME='Program Type'
       JOIN HELPER_TABLE HT
         ON HT.HELPER_TABLE_SID = RS.REBATE_PROGRAM_TYPE
       JOIN ST_NM_DISCOUNT_PROJ_MASTER ST
         ON ST.RS_CONTRACT_SID = RS.RS_CONTRACT_SID
            AND CCP.CCP_DETAILS_SID = ST.CCP_DETAILS_SID
GROUP  BY CCP.HIERARCHY_NO,
          HT.DESCRIPTION,
          CD.LEVEL_NAME,
          CD.LEVEL_NO,
          CCP.RELATIONSHIP_LEVEL_VALES
UNION ALL
SELECT DISTINCT CCP.HIERARCHY_NO,
                HT.DESCRIPTION AS DESCRIPTION,
                cd.LEVEL_NAME,
                cd.LEVEL_NO,
                CCP.RELATIONSHIP_LEVEL_VALES,
                NULL           AS COLUMN_0,
                NULL           AS COLUMN_1
FROM   CUST_VIEW_DETAILS CD
       JOIN CUSTOM_CCP_SALES_@MASTERSID CCP
         ON CD.CUSTOM_VIEW_MASTER_SID = CCP.CUST_VIEW_MASTER_SID
            AND CD.CUSTOM_VIEW_MASTER_SID = ?RBSID
            AND CD.HIERARCHY_INDICATOR = 'D' and LEVEL_NAME='UDC 1'
       JOIN UDCS U
         ON U.UDC1 = CCP.RELATIONSHIP_LEVEL_VALES
       JOIN RS_CONTRACT RS
         ON RS.RS_CONTRACT_SID = U.MASTER_SID
            AND U.MASTER_TYPE = 'RS_CONTRACT'
       JOIN ST_NM_DISCOUNT_PROJ_MASTER ST
         ON ST.RS_CONTRACT_SID = RS.RS_CONTRACT_SID
            AND CCP.CCP_DETAILS_SID = ST.CCP_DETAILS_SID
       JOIN HELPER_TABLE HT
         ON HT.HELPER_TABLE_SID = U.UDC1
GROUP  BY CCP.HIERARCHY_NO,
          HT.DESCRIPTION,
          cd.LEVEL_NAME,
          cd.LEVEL_NO,
          CCP.RELATIONSHIP_LEVEL_VALES
UNION ALL
SELECT DISTINCT CCP.HIERARCHY_NO,
                HT.DESCRIPTION AS DESCRIPTION,
                cd.LEVEL_NAME,
                cd.LEVEL_NO,
                CCP.RELATIONSHIP_LEVEL_VALES,
                NULL           AS COLUMN_0,
                NULL           AS COLUMN_1
FROM   CUST_VIEW_DETAILS CD
       JOIN CUSTOM_CCP_SALES_@MASTERSID CCP
         ON CD.CUSTOM_VIEW_MASTER_SID = CCP.CUST_VIEW_MASTER_SID
            AND CD.CUSTOM_VIEW_MASTER_SID = ?RBSID
            AND CD.HIERARCHY_INDICATOR = 'D' and LEVEL_NAME='UDC 2'
       JOIN UDCS U
         ON U.UDC2 = CCP.RELATIONSHIP_LEVEL_VALES
       JOIN RS_CONTRACT RS
         ON RS.RS_CONTRACT_SID = U.MASTER_SID
            AND U.MASTER_TYPE = 'RS_CONTRACT'
       JOIN ST_NM_DISCOUNT_PROJ_MASTER ST
         ON ST.RS_CONTRACT_SID = RS.RS_CONTRACT_SID
            AND CCP.CCP_DETAILS_SID = ST.CCP_DETAILS_SID
       JOIN HELPER_TABLE HT
         ON HT.HELPER_TABLE_SID = U.UDC1
GROUP  BY CCP.HIERARCHY_NO,
          HT.DESCRIPTION,
          cd.LEVEL_NAME,
          cd.LEVEL_NO,
          CCP.RELATIONSHIP_LEVEL_VALES
UNION ALL
SELECT DISTINCT CCP.HIERARCHY_NO,
                HT.DESCRIPTION AS DESCRIPTION,
                cd.LEVEL_NAME,
                cd.LEVEL_NO,
                CCP.RELATIONSHIP_LEVEL_VALES,
                NULL           AS COLUMN_0,
                NULL           AS COLUMN_1
FROM   CUST_VIEW_DETAILS CD
       JOIN CUSTOM_CCP_SALES_@MASTERSID CCP
         ON CD.CUSTOM_VIEW_MASTER_SID = CCP.CUST_VIEW_MASTER_SID
            AND CD.CUSTOM_VIEW_MASTER_SID = ?RBSID
            AND CD.HIERARCHY_INDICATOR = 'D' and LEVEL_NAME='UDC 3'
       JOIN UDCS U
         ON U.UDC3 = CCP.RELATIONSHIP_LEVEL_VALES
       JOIN RS_CONTRACT RS
         ON RS.RS_CONTRACT_SID = U.MASTER_SID
            AND U.MASTER_TYPE = 'RS_CONTRACT'
       JOIN ST_NM_DISCOUNT_PROJ_MASTER ST
         ON ST.RS_CONTRACT_SID = RS.RS_CONTRACT_SID
            AND CCP.CCP_DETAILS_SID = ST.CCP_DETAILS_SID
       JOIN HELPER_TABLE HT
         ON HT.HELPER_TABLE_SID = U.UDC1
GROUP  BY CCP.HIERARCHY_NO,
          HT.DESCRIPTION,
          cd.LEVEL_NAME,
          cd.LEVEL_NO,
          CCP.RELATIONSHIP_LEVEL_VALES
UNION ALL
SELECT DISTINCT CCP.HIERARCHY_NO,
                HT.DESCRIPTION AS DESCRIPTION,
                cd.LEVEL_NAME,
                cd.LEVEL_NO,
                CCP.RELATIONSHIP_LEVEL_VALES,
                NULL           AS COLUMN_0,
                NULL           AS COLUMN_1
FROM   CUST_VIEW_DETAILS CD
       JOIN CUSTOM_CCP_SALES_@MASTERSID CCP
         ON CD.CUSTOM_VIEW_MASTER_SID = CCP.CUST_VIEW_MASTER_SID
            AND CD.CUSTOM_VIEW_MASTER_SID = ?RBSID
            AND CD.HIERARCHY_INDICATOR = 'D' and LEVEL_NAME='UDC 4'
       JOIN UDCS U
         ON U.UDC4 = CCP.RELATIONSHIP_LEVEL_VALES
       JOIN RS_CONTRACT RS
         ON RS.RS_CONTRACT_SID = U.MASTER_SID
            AND U.MASTER_TYPE = 'RS_CONTRACT'
       JOIN ST_NM_DISCOUNT_PROJ_MASTER ST
         ON ST.RS_CONTRACT_SID = RS.RS_CONTRACT_SID
            AND CCP.CCP_DETAILS_SID = ST.CCP_DETAILS_SID
       JOIN HELPER_TABLE HT
         ON HT.HELPER_TABLE_SID = U.UDC1
GROUP  BY CCP.HIERARCHY_NO,
          HT.DESCRIPTION,
          cd.LEVEL_NAME,
          cd.LEVEL_NO,
          CCP.RELATIONSHIP_LEVEL_VALES
UNION ALL
SELECT DISTINCT CCP.HIERARCHY_NO,
                HT.DESCRIPTION AS DESCRIPTION,
                cd.LEVEL_NAME,
                cd.LEVEL_NO,
                CCP.RELATIONSHIP_LEVEL_VALES,
                NULL           AS COLUMN_0,
                NULL           AS COLUMN_1
FROM   CUST_VIEW_DETAILS CD
       JOIN CUSTOM_CCP_SALES_@MASTERSID CCP
         ON CD.CUSTOM_VIEW_MASTER_SID = CCP.CUST_VIEW_MASTER_SID
            AND CD.CUSTOM_VIEW_MASTER_SID = ?RBSID
            AND CD.HIERARCHY_INDICATOR = 'D' and LEVEL_NAME='UDC 5'
       JOIN UDCS U
         ON U.UDC5 = CCP.RELATIONSHIP_LEVEL_VALES
       JOIN RS_CONTRACT RS
         ON RS.RS_CONTRACT_SID = U.MASTER_SID
            AND U.MASTER_TYPE = 'RS_CONTRACT'
       JOIN ST_NM_DISCOUNT_PROJ_MASTER ST
         ON ST.RS_CONTRACT_SID = RS.RS_CONTRACT_SID
            AND CCP.CCP_DETAILS_SID = ST.CCP_DETAILS_SID
       JOIN HELPER_TABLE HT
         ON HT.HELPER_TABLE_SID = U.UDC1
GROUP  BY CCP.HIERARCHY_NO,
          HT.DESCRIPTION,
          cd.LEVEL_NAME,
          cd.LEVEL_NO,
          CCP.RELATIONSHIP_LEVEL_VALES
UNION ALL
SELECT DISTINCT CCP.HIERARCHY_NO,
                HT.DESCRIPTION AS DESCRIPTION,
                cd.LEVEL_NAME,
                cd.LEVEL_NO,
                CCP.RELATIONSHIP_LEVEL_VALES,
                NULL           AS COLUMN_0,
                NULL           AS COLUMN_1
FROM   CUST_VIEW_DETAILS CD
       JOIN CUSTOM_CCP_SALES_@MASTERSID CCP
         ON CD.CUSTOM_VIEW_MASTER_SID = CCP.CUST_VIEW_MASTER_SID
            AND CD.CUSTOM_VIEW_MASTER_SID = ?RBSID
            AND CD.HIERARCHY_INDICATOR = 'D' and LEVEL_NAME='UDC 6'
       JOIN UDCS U
         ON U.UDC6 = CCP.RELATIONSHIP_LEVEL_VALES
       JOIN RS_CONTRACT RS
         ON RS.RS_CONTRACT_SID = U.MASTER_SID
            AND U.MASTER_TYPE = 'RS_CONTRACT'
       JOIN ST_NM_DISCOUNT_PROJ_MASTER ST
         ON ST.RS_CONTRACT_SID = RS.RS_CONTRACT_SID
            AND CCP.CCP_DETAILS_SID = ST.CCP_DETAILS_SID
       JOIN HELPER_TABLE HT
         ON HT.HELPER_TABLE_SID = U.UDC1
GROUP  BY CCP.HIERARCHY_NO,
          HT.DESCRIPTION,
          cd.LEVEL_NAME,
          cd.LEVEL_NO,
          CCP.RELATIONSHIP_LEVEL_VALES
UNION ALL
SELECT DISTINCT CCP.HIERARCHY_NO,
                RS.RS_ID   AS DESCRIPTION,
                cd.LEVEL_NAME,
                cd.LEVEL_NO,
                CCP.RELATIONSHIP_LEVEL_VALES,
                RS.RS_NO   AS COLUMN_22,
                RS.RS_NAME AS COLUMN_23
FROM   CUST_VIEW_DETAILS CD
       JOIN CUSTOM_CCP_SALES_@MASTERSID CCP
         ON CD.CUSTOM_VIEW_MASTER_SID = CCP.CUST_VIEW_MASTER_SID
            AND CD.CUSTOM_VIEW_MASTER_SID = ?RBSID
            AND CD.HIERARCHY_INDICATOR = 'D' and cd.LEVEL_NAME='Schedule ID'
       JOIN RS_CONTRACT RS
         ON RS.RS_CONTRACT_SID = CCP.RELATIONSHIP_LEVEL_VALES
       JOIN ST_NM_DISCOUNT_PROJ_MASTER ST
         ON ST.RS_CONTRACT_SID = RS.RS_CONTRACT_SID
            AND CCP.CCP_DETAILS_SID = ST.CCP_DETAILS_SID
GROUP  BY CCP.HIERARCHY_NO,
          RS.RS_ID,
          cd.LEVEL_NAME,
          cd.LEVEL_NO,
          CCP.RELATIONSHIP_LEVEL_VALES,
          RS.RS_NO,
          RS.RS_NAME
             
order  BY Level_No
              
            ]]>
		</query>
	</entity>
        <entity id="getRelationshipLevelValuesSalesCustomCP">
		<query> 
            <![CDATA[ 
                SELECT DISTINCT
                    RLD.HIERARCHY_NO,
                    TEMP.?FIELD VALUE,
                    CM.LEVEL_NAME,
                    CM.LEVEL_NO,
                    RLD.RELATIONSHIP_LEVEL_VALES
                     ?DISPLAYFORMATCOLUMN ,CM.HIERARCHY_INDICATOR
               FROM
                    #CUSTOM_CCP_SALES RLD
                           JOIN CUST_VIEW_DETAILS CM ON CM.CUSTOM_VIEW_MASTER_SID=RLD.CUST_VIEW_MASTER_SID
                          
                JOIN ?TABLE  TEMP ON
                                TEMP.?IDCOL = RLD.RELATIONSHIP_LEVEL_VALES
                                AND CM.LEVEL_NO = ?LNO AND RLD.LEVEL_NO=?LNO 
                                
            ]]>
		</query>
	</entity>
</sql>
