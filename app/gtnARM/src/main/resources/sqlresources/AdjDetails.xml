<sql>
    <entity id="Adjustment Reserve Details common query For data new">
     
        <query>
            <![CDATA[
                   
 DECLARE @PROJECTION_MASTER_SID INT = @PROJECTIONMASTER,
              @ACCOUNT VARCHAR(1000) = '@ACC_VAL1'
              @SESSION_DECLARE

IF EXISTS (SELECT 1 FROM @CONFIGTYPETEMPTABLE)
 BEGIN
 TRUNCATE TABLE @CONFIGTYPETEMPTABLE
 END

IF OBJECT_ID('TEMPDB..#ARM_ACC') IS NOT NULL
    DROP TABLE #ARM_ACC
CREATE TABLE  #ARM_ACC 
    (ACC_ID VARCHAR(50) )


INSERT INTO #ARM_ACC(ACC_ID)
SELECT TOKEN
FROM  UDF_SPLITSTRING(@ACCOUNT, ',')  

IF Object_id('TEMPDB..#ARM_ADJ_RES_CCP') IS NOT NULL
  DROP TABLE #ARM_ADJ_RES_CCP

SELECT DISTINCT A.ARM_ADJUSTMENT_DETAILS_SID,
                BM.BRAND_ID,
                BM.BRAND_MASTER_SID,
                C.CONTRACT_MASTER_SID,
                AC.TRANSACTION_NAME,
                AC.ARM_ADJUSTMENT_CONFIG_SID,
                WM.WORKFLOW_MASTER_SID,
                WM.WORKFLOW_ID,
                PM.PROJECTION_DESCRIPTION,
                pm.COMPANY_MASTER_SID,
                WM.WORKFLOW_STATUS_ID,
                R.RS_CATEGORY,
                R.RS_TYPE,
                R.REBATE_PROGRAM_TYPE,
                ARM_ADJ_RES_CONFIG_MASTER_SID,
                A.ADJUSTMENT_TYPE,
                A.ACCOUNT_CATEGORY,
                ht.description     AS ACCOUNT_TYPE,
                A.ACCOUNT,
                ht.description     ADJUSTMENT_LEVEL,
                A.ACCOUNT_TYPE     AS ACCOUNT_TYPE_V,
                a.ADJUSTMENT_LEVEL ADJUSTMENT_LEVEL_V,
                A.CREDIT,
                A.DEBIT,
                ACCOUNT_DESC,
                ACCOUNT_INDICATOR,
                COST_CENTER,
                PROJECT,
                FUTURE_1,
                FUTURE_2,
                UDC_1,
                UDC_2,
                UDC_3,
                UDC_4,
                UDC_5,
                UDC_6,
                BALANCE_TYPE,
                [DATABASE],
                DATA_ACCESS_SET,
                CHART_OF_ACCOUNTS,
                LEDGER,
                CATEGORY,
                A.SOURCE,
                CURRENCY,
                JOURNAL_NAME,
                JOURNAL_DESCRIPTION,
                REVERSE_JOURNAL,
                REVERSAL_PERIOD_DATE,
                LINE_DESCRIPTION,
                DIVISION
INTO   #ARM_ADJ_RES_CCP
FROM   ARM_ADJUSTMENT_MASTER AM
       JOIN ARM_ADJUSTMENT_CONFIG AC
         ON AM.TRANSACTION_TYPE = AC.ARM_ADJUSTMENT_CONFIG_SID
       JOIN ARM_ADJUSTMENT_DETAILS B
         ON AM.PROJECTION_MASTER_SID = B.PROJECTION_MASTER_SID
            AND B.PROJECTION_MASTER_SID = @PROJECTION_MASTER_SID
       INNER JOIN ARM_ADJ_RES_CCP A
               ON A.ARM_ADJUSTMENT_DETAILS_SID = B.ARM_ADJUSTMENT_DETAILS_SID
                  AND AM.TRANSACTION_TYPE = A.ADJUSTMENT_TYPE
       JOIN CCP_DETAILS C
         ON C.CCP_DETAILS_SID = B.CCP_DETAILS_SID
       JOIN ITEM_MASTER IM
         ON IM.ITEM_MASTER_SID = C.ITEM_MASTER_SID
       JOIN BRAND_MASTER BM
         ON BM.BRAND_MASTER_SID = IM.BRAND_MASTER_SID
       LEFT JOIN WORKFLOW_MASTER WM
              ON WM.PROJECTION_MASTER_SID = B.PROJECTION_MASTER_SID
       JOIN RS_CONTRACT R
         ON R.RS_MODEL_SID = B.RS_MODEL_SID
            AND R.CONTRACT_MASTER_SID = C.CONTRACT_MASTER_SID
       JOIN ARM_DEDUCTION_SELECTION ADS
         ON ADS.RS_CONTRACT_SID = R.RS_CONTRACT_SID
            AND B.PROJECTION_MASTER_SID = ADS.PROJECTION_MASTER_SID
            AND ADS.PROJECTION_MASTER_SID = @PROJECTION_MASTER_SID
       JOIN PROJECTION_MASTER PM
         ON PM.PROJECTION_MASTER_SID = ADS.PROJECTION_MASTER_SID
       JOIN HELPER_TABLE HT
         ON HT.HELPER_TABLE_SID = A.ADJUSTMENT_LEVEL
       JOIN HELPER_TABLE HT1
         ON HT1.HELPER_TABLE_SID = A.ACCOUNT_TYPE
WHERE  AM.PROJECTION_MASTER_SID = @PROJECTION_MASTER_SID
       AND EXISTS (SELECT 1
                   FROM   #ARM_ACC AAC
                   WHERE  A.ACCOUNT = AAC.ACC_ID)
       AND EXISTS (SELECT 1
                   FROM   ARM_ADJ_RES_CONFIG_MASTER AAM
                   WHERE  AAM.RS_CATEGORY = r.RS_CATEGORY
                          AND AAM.RS_TYPE = r.RS_TYPE
                          AND AAM.REBATE_PROGRAM_TYPE = r.REBATE_PROGRAM_TYPE
                          AND PM.COMPANY_MASTER_SID = AAM.GL_COMPANY_MASTER_SID
                          AND AM.BU_COMPANY_MASTER_SID = AAM.BU_COMPANY_MASTER_SID
                          AND aam.ARM_ADJ_RES_CONFIG_MASTER_SID = a.ARM_ADJ_RES_CONFIG_MASTER_SID
                          AND AAM.CONFIGURATION_TYPE = 0)
 
IF Object_id('TEMPDB..#ARM_ADJ_RES_CCP_BRAND') IS NOT NULL
  DROP TABLE #ARM_ADJ_RES_CCP_BRAND

SELECT DISTINCT BRAND_ID,
                ARM_ADJ_RES_CONFIG_MASTER_SID,
                ADJUSTMENT_TYPE,
                ACCOUNT_CATEGORY,
                ACCOUNT_TYPE_V     ACCOUNT_TYPE,
                ACCOUNT,
                ADJUSTMENT_LEVEL_V ADJUSTMENT_LEVEL,
                CREDIT,
                DEBIT,
                ACCOUNT_DESC,
                ACCOUNT_INDICATOR,
                COST_CENTER,
                PROJECT,
                FUTURE_1,
                FUTURE_2,
                UDC_1,
                UDC_2,
                UDC_3,
                UDC_4,
                UDC_5,
                UDC_6,
                BALANCE_TYPE,
                [DATABASE],
                DATA_ACCESS_SET,
                CHART_OF_ACCOUNTS,
                LEDGER,
                CATEGORY,
                SOURCE,
                CURRENCY,
                JOURNAL_NAME,
                JOURNAL_DESCRIPTION,
                REVERSE_JOURNAL,
                REVERSAL_PERIOD_DATE,
                LINE_DESCRIPTION,
                DIVISION
INTO   #ARM_ADJ_RES_CCP_BRAND
FROM   #ARM_ADJ_RES_CCP

IF Object_id('TEMPDB..#ARM_ADJ_RES_CCP_TOTAL') IS NOT NULL
  DROP TABLE #ARM_ADJ_RES_CCP_TOTAL

SELECT DISTINCT ARM_ADJ_RES_CONFIG_MASTER_SID,
                ADJUSTMENT_TYPE,
                ACCOUNT_CATEGORY,
                ACCOUNT_TYPE_V     ACCOUNT_TYPE,
                ACCOUNT,
                ADJUSTMENT_LEVEL_V ADJUSTMENT_LEVEL,
                CREDIT,
                DEBIT,
                ACCOUNT_DESC,
                ACCOUNT_INDICATOR,
                COST_CENTER,
                PROJECT,
                FUTURE_1,
                FUTURE_2,
                UDC_1,
                UDC_2,
                UDC_3,
                UDC_4,
                UDC_5,
                UDC_6,
                BALANCE_TYPE,
                [DATABASE],
                DATA_ACCESS_SET,
                CHART_OF_ACCOUNTS,
                LEDGER,
                CATEGORY,
                SOURCE,
                CURRENCY,
                JOURNAL_NAME,
                JOURNAL_DESCRIPTION,
                REVERSE_JOURNAL,
                REVERSAL_PERIOD_DATE,
                LINE_DESCRIPTION,
                DIVISION
INTO   #ARM_ADJ_RES_CCP_TOTAL
FROM   #ARM_ADJ_RES_CCP
 
IF Object_id ('tempdb..#TEMP_PROJ_RES_BRAND') IS NOT NULL
  DROP TABLE #TEMP_PROJ_RES_BRAND

CREATE TABLE #TEMP_PROJ_RES_BRAND
  (
     BRAND_MASTER_SID          INT,
     BRAND_ID                  VARCHAR(50),
     ACCOUNT                   VARCHAR(50),
     PERIOD_DATE               DATETIME,
     RS_CATEGORY               INT,
     RS_TYPE                   INT,
     REBATE_PROGRAM_TYPE       INT,
     DEBIT                     NUMERIC(22, 6),
     CREDIT                    NUMERIC(22, 6),
     ACCRUAL_AMOUNT            NUMERIC(22, 6),
     PROJECTION_MASTER_SID     INT,
     WORKFLOW_MASTER_SID       INT NULL,
     WORKFLOW_ID               VARCHAR(50),
     WORKFLOW_NAME             VARCHAR(500),
     WORKFLOW_STATUS           INT,
     ARM_ADJUSTMENT_CONFIG_SID INT,
     TRANSACTION_NAME          VARCHAR(50),
     COMPANY_MASTER_SID        INT
  )

INSERT INTO #TEMP_PROJ_RES_BRAND
            (BRAND_MASTER_SID,
             BRAND_ID,
             ACCOUNT,
             PERIOD_DATE,
             RS_CATEGORY,
             RS_TYPE,
             REBATE_PROGRAM_TYPE,
             DEBIT,
             CREDIT,
             ACCRUAL_AMOUNT,
             PROJECTION_MASTER_SID,
             WORKFLOW_MASTER_SID,
             WORKFLOW_ID,
             WORKFLOW_NAME,
             WORKFLOW_STATUS,
             ARM_ADJUSTMENT_CONFIG_SID,
             TRANSACTION_NAME,
             COMPANY_MASTER_SID)
SELECT AR.BRAND_MASTER_SID,
       AR.BRAND_ID,
       AR.ACCOUNT,
       B.PERIOD_DATE, 
       RS_CATEGORY, 
       RS_TYPE, 
       REBATE_PROGRAM_TYPE, 
       CASE WHEN ISNULL(SUM(B.DEBIT),0) -  ISNULL(SUM(B.CREDIT),0) > 0 THEN ISNULL(SUM(B.DEBIT),0) -  ISNULL(SUM(B.CREDIT),0) 
	       			        ELSE NULL END AS DEBIT,
				   CASE WHEN ISNULL(SUM(B.CREDIT),0) -  ISNULL(SUM(B.DEBIT),0) > 0 THEN ISNULL(SUM(B.CREDIT),0) -  ISNULL(SUM(B.DEBIT),0)
				   ELSE NULL END  AS CREDIT,
       ISNULL(SUM(B.CREDIT), 0) - ISNULL(SUM(B.DEBIT), 0) AS ACCRUAL_AMOUNT, 
       @PROJECTION_MASTER_SID                             PROJECTION_MASTER_SID,
       WORKFLOW_MASTER_SID, 
       WORKFLOW_ID,
       PROJECTION_DESCRIPTION,
       WORKFLOW_STATUS_ID,
       ARM_ADJUSTMENT_CONFIG_SID,
       TRANSACTION_NAME,
       AR.COMPANY_MASTER_SID
FROM   #ARM_ADJ_RES_CCP AR
       LEFT JOIN (SELECT ST.ARM_ADJUSTMENT_DETAILS_SID,
                         ST.PERIOD_SID,
                         ST.ADJUSTMENT_TYPE,
                         ST.ACCOUNT,
                         ST.DEBIT,
                         ST.CREDIT,
                         P.PERIOD_DATE
                  FROM   @TABLE_1 ST
                         JOIN PERIOD P
                           ON P.PERIOD_SID = ST.PERIOD_SID) B
              ON AR.ARM_ADJUSTMENT_DETAILS_SID = B.ARM_ADJUSTMENT_DETAILS_SID
                 AND AR.ACCOUNT = B.ACCOUNT
WHERE  AR.ADJUSTMENT_LEVEL = 'BRAND'
       AND b.PERIOD_DATE IS NOT NULL
	   @SESSION_INCLUDE
GROUP  BY AR.BRAND_MASTER_SID,
          AR.ACCOUNT,
          AR.BRAND_ID,
          b.PERIOD_DATE,
          RS_CATEGORY,
          RS_TYPE,
          REBATE_PROGRAM_TYPE,
          WORKFLOW_MASTER_SID,
          WORKFLOW_ID,
          PROJECTION_DESCRIPTION,
          WORKFLOW_STATUS_ID,
          ARM_ADJUSTMENT_CONFIG_SID,
          TRANSACTION_NAME,
       AR.COMPANY_MASTER_SID;
          
IF OBJECT_ID ('TEMPDB..#TEMP_PROJ_RES_TOTAL') IS NOT NULL
  DROP TABLE #TEMP_PROJ_RES_TOTAL

CREATE TABLE #TEMP_PROJ_RES_TOTAL
  (
     BRAND_MASTER_SID          INT,
     BRAND_ID                  VARCHAR(50),
     ACCOUNT                   VARCHAR(50),
     PERIOD_DATE               DATETIME,
     RS_CATEGORY               INT,
     RS_TYPE                   INT,
     REBATE_PROGRAM_TYPE       INT,
     DEBIT                     NUMERIC(22, 6),
     CREDIT                    NUMERIC(22, 6),
     ACCRUAL_AMOUNT            NUMERIC(22, 6),
     PROJECTION_MASTER_SID     INT,
     WORKFLOW_MASTER_SID       INT NULL,
     WORKFLOW_ID               VARCHAR(50),
     WORKFLOW_NAME             VARCHAR(500),
     WORKFLOW_STATUS           INT,
     ARM_ADJUSTMENT_CONFIG_SID INT,
     TRANSACTION_NAME          VARCHAR(50),
     COMPANY_MASTER_SID        INT
  )

INSERT INTO #TEMP_PROJ_RES_TOTAL
            (BRAND_MASTER_SID,
             BRAND_ID,
             ACCOUNT,
             PERIOD_DATE,
             RS_CATEGORY,
             RS_TYPE,
             REBATE_PROGRAM_TYPE,
             DEBIT,
             CREDIT,
             ACCRUAL_AMOUNT,
             PROJECTION_MASTER_SID,
             WORKFLOW_MASTER_SID,
             WORKFLOW_ID,
             WORKFLOW_NAME,
             WORKFLOW_STATUS,
             ARM_ADJUSTMENT_CONFIG_SID,
             TRANSACTION_NAME,
             COMPANY_MASTER_SID)
SELECT BRAND_MASTER_SID,
       BRAND_ID,
       AR.ACCOUNT,
       PERIOD_DATE,
       RS_CATEGORY,
       RS_TYPE,
       REBATE_PROGRAM_TYPE,
       ISNULL(SUM(B.DEBIT), 0)                            AS DEBIT,
       ISNULL(SUM(B.CREDIT), 0)                           AS CREDIT,
       ISNULL(SUM(B.CREDIT), 0) - ISNULL(SUM(B.DEBIT), 0) AS ACCRUAL_AMOUNT,
       @PROJECTION_MASTER_SID                             AS PROJECTION_MASTER_SID,
       WORKFLOW_MASTER_SID,
       WORKFLOW_ID,
       PROJECTION_DESCRIPTION,
       WORKFLOW_STATUS_ID,
       ARM_ADJUSTMENT_CONFIG_SID,
       TRANSACTION_NAME,
       AR.COMPANY_MASTER_SID
FROM   #ARM_ADJ_RES_CCP AR
       LEFT JOIN (SELECT ST.ARM_ADJUSTMENT_DETAILS_SID,
                         ST.PERIOD_SID,
                         ST.ADJUSTMENT_TYPE,
                         ST.ACCOUNT,
                         ST.DEBIT,
                         ST.CREDIT,
                         P.PERIOD_DATE
                  FROM   @TABLE_1 ST
                         JOIN PERIOD P
                           ON P.PERIOD_SID = ST.PERIOD_SID) B
              ON AR.ARM_ADJUSTMENT_DETAILS_SID = B.ARM_ADJUSTMENT_DETAILS_SID
                 AND AR.ACCOUNT = B.ACCOUNT
WHERE  AR.ADJUSTMENT_LEVEL = 'TOTAL'
       AND B.PERIOD_DATE IS NOT NULL
GROUP  BY BRAND_MASTER_SID,
          AR.ACCOUNT,
          BRAND_ID,
          PERIOD_DATE,
          RS_CATEGORY,
          RS_TYPE,
          REBATE_PROGRAM_TYPE,
          WORKFLOW_MASTER_SID,
          WORKFLOW_ID,
          PROJECTION_DESCRIPTION,
          WORKFLOW_STATUS_ID,
          ARM_ADJUSTMENT_CONFIG_SID,
          TRANSACTION_NAME,
       AR.COMPANY_MASTER_SID
 
INSERT INTO @CONFIGTYPETEMPTABLE(
        ADJUSTMENT_TYPE,
	BALANCE_TYPE,
	[DATABASE],
	DATA_ACCESS_SET,
	CHART_OF_ACCOUNTS,
	LEDGER,
	CATEGORY,
	SOURCE,
	CURRENCY,
	ACCOUNTING_DATE,
	BATCH_NAME,
	JOURNAL_NAME,
	JOURNAL_DESCRIPTION,
	REVERSE_JOURNAL,
	REVERSAL_PERIOD_DATE,
	COMPANY,
	DIVISION,
	BUSINESS_UNIT,
	COST_CENTER,
	ACCOUNT,
	BRAND,
	PROJECT,
	FUTURE_1,
	FUTURE_2,
	DEBIT,
	CREDIT,
	LINE_DESCRIPTION,
	UDC_1,
	UDC_2,
	UDC_3,
	UDC_4,
	UDC_5,
	UDC_6,
	ACCOUNT_CATEGORY,
	ACCOUNT_TYPE,
	ADJUSTMENT_LEVEL,
	ACCOUNT_INDICATOR,
        ACCOUNT_DESC,
	REDEMPTION_PERIOD,
	CALCULATION_PERIOD,
	WORKFLOW_ID,
	WORKFLOW_NAME,
WORKFLOW_STATUS)
        SELECT a.TRANSACTION_NAME       AS ADJUSTMENT_TYPE,
       AAD.BALANCE_TYPE         AS BALANCE_TYPE,
       AAD."DATABASE"           AS DATABASE_DESC,
       AAD.DATA_ACCESS_SET      AS DATA_ACCESS_SET,
       AAD.CHART_OF_ACCOUNTS    AS CHART_OF_ACCOUNTS,
       AAD.LEDGER               AS LEDGER,
       AAD.CATEGORY             AS CATEGORY,
       AAD."SOURCE"             AS SOURCE_DESC,
       AAD.CURRENCY             AS CURRENCY,
       B.GL_IMPACT_DATE         AS ACCOUNTING_DATE,
       BATCH_NAME = CASE
                      WHEN A.WORKFLOW_ID = NULL THEN ''
                      ELSE CONVERT(VARCHAR(100), A.TRANSACTION_NAME)
                           + ' - ' + Isnull(A.WORKFLOW_ID, ' ') + ' - '
                           + AAD.JOURNAL_DESCRIPTION
                    END,
       AAD.JOURNAL_NAME         AS JOURNAL_NAME,
       AAD.JOURNAL_DESCRIPTION  AS JOURNAL_DESCRIPTION,
       AAD.REVERSE_JOURNAL      AS REVERSE_JOURNAL,
       AAD.REVERSAL_PERIOD_DATE AS REVERSAL_PERIOD_DATE,
       GL.COMPANY_ID            AS GL_COMPANY_ID,
       AAD.DIVISION             AS DIVISION,
       BU.COMPANY_ID            AS BU,
       AAD.COST_CENTER          AS COST_CENTER,
       AAD.ACCOUNT              AS ACCOUNT,
       A.BRAND_ID               AS BRAND_ID,
       AAD.PROJECT              AS PROJECT,
       AAD.FUTURE_1             AS FUTURE_1,
       AAD.FUTURE_2             AS FUTURE_2,
       CASE WHEN (A.DEBIT IS NULL AND A.CREDIT IS NULL) THEN 0 ELSE  A.DEBIT END DEBIT,
       CASE WHEN (A.DEBIT IS NULL AND A.CREDIT IS NULL) THEN 0 ELSE A.CREDIT END CREDIT,
       AAD.LINE_DESCRIPTION     AS LINE_DESCRIPTION,
       UDC1.DESCRIPTION         AS UDC_1,
       AAD.UDC_2                AS UDC_2,
       AAD.UDC_3                AS UDC_3,
       AAD.UDC_4                AS UDC_4,
       AAD.UDC_5                AS UDC_5,
       AAD.UDC_6                AS UDC_6,
       AAD.ACCOUNT_CATEGORY     AS ACCOUNT_CATEGORY,
       HT.DESCRIPTION           AS ACCOUNT_TYPE,
       AAD.ADJUSTMENT_LEVEL     AS ADJUSTMENT_LEVEL,
       AAD.ACCOUNT_INDICATOR    AS ACCOUNT_INDICATOR,
       AAD.ACCOUNT_DESC         AS ACCOUNT_DESC,
       CASE
         WHEN AAC.REDEMPTION_PERIOD = 1 THEN A.PERIOD_DATE
         ELSE NULL
       END                      AS REP_PERIIOD,
       A.PERIOD_DATE            AS CALCULATION_PERIOD,
       A.WORKFLOW_ID,
       A.WORKFLOW_NAME,
       A.WORKFLOW_STATUS
FROM   #TEMP_PROJ_RES_BRAND A
       JOIN ARM_ADJUSTMENT_MASTER B
         ON A.PROJECTION_MASTER_SID = B.PROJECTION_MASTER_SID
       JOIN COMPANY_MASTER BU
         ON BU.COMPANY_MASTER_SID = B.BU_COMPANY_MASTER_SID
       JOIN COMPANY_MASTER GL
         ON GL.COMPANY_MASTER_SID = A.COMPANY_MASTER_SID
       JOIN ARM_ADJ_RES_CONFIG_MASTER AAM
         ON AAM.RS_CATEGORY = A.RS_CATEGORY
            AND AAM.RS_TYPE = A.RS_TYPE
            AND AAM.REBATE_PROGRAM_TYPE = A.REBATE_PROGRAM_TYPE
            AND a.COMPANY_MASTER_SID = AAM.GL_COMPANY_MASTER_SID
            AND B.BU_COMPANY_MASTER_SID = AAM.BU_COMPANY_MASTER_SID
            AND AAM.CONFIGURATION_TYPE = 0
       JOIN #ARM_ADJ_RES_CCP_BRAND AAD
         ON AAD.ARM_ADJ_RES_CONFIG_MASTER_SID = AAM.ARM_ADJ_RES_CONFIG_MASTER_SID
            AND A.ARM_ADJUSTMENT_CONFIG_SID = AAD.ADJUSTMENT_TYPE
            AND A.ACCOUNT = AAD.ACCOUNT
            AND A.BRAND_ID = AAD.BRAND_ID
       JOIN ARM_ADJUSTMENT_CONFIG AAC
         ON AAC.ARM_ADJUSTMENT_CONFIG_SID = AAD.ADJUSTMENT_TYPE
       JOIN HELPER_TABLE HT 
                 ON HT.HELPER_TABLE_SID = AAD.ACCOUNT_TYPE
       LEFT JOIN HELPER_TABLE UDC1
              ON UDC1.HELPER_TABLE_SID = AAD.UDC_1
WHERE 
        ?AMOUNTCONDITION
        
--A.ACCRUAL_AMOUNT>0.01 AND 
AAD.ADJUSTMENT_LEVEL = @ADJUSTMENTLEVELBRAND 
               AND AAD.ADJUSTMENT_TYPE = @ADJUSTMENT_TYPE 
                @CATEGORY 
               @TYPE 
               @ACCOUNT_CONDITION 



        UNION ALL
SELECT AAC.TRANSACTION_NAME     AS ADJUSTMENT_TYPE,
       AAD.BALANCE_TYPE         AS BALANCE_TYPE,
       AAD."DATABASE"           AS DATABASE_DESC,
       AAD.DATA_ACCESS_SET      AS DATA_ACCESS_SET,
       AAD.CHART_OF_ACCOUNTS    AS CHART_OF_ACCOUNTS,
       AAD.LEDGER               AS LEDGER,
       AAD.CATEGORY             AS CATEGORY,
       AAD."SOURCE"             AS SOURCE_DESC,
       AAD.CURRENCY             AS CURRENCY,
       A.ACCOUNTING_DATE        AS ACCOUNTING_DATE,
       BATCH_NAME = CASE
                      WHEN A.WORKFLOW_ID = NULL THEN ''
                      ELSE CONVERT(VARCHAR(100), A.TRANSACTION_NAME)
                           + ' - ' + Isnull(A.WORKFLOW_ID, ' ') + ' - '
                           + AAD.JOURNAL_DESCRIPTION
                    END,
       AAD.JOURNAL_NAME         AS JOURNAL_NAME,
       AAD.JOURNAL_DESCRIPTION  AS JOURNAL_DESCRIPTION,
       AAD.REVERSE_JOURNAL      AS REVERSE_JOURNAL,
       AAD.REVERSAL_PERIOD_DATE AS REVERSAL_PERIOD_DATE,
       A.GL_COMPANY_ID          AS GL_COMPANY_ID,
       AAD.DIVISION             AS DIVISION,
       A.BU_COMPANY_ID          AS BU,
       AAD.COST_CENTER          AS COST_CENTER,
       AAD.ACCOUNT              AS ACCOUNT,
       '000'                    AS BRAND_ID,
       AAD.PROJECT              AS PROJECT,
       AAD.FUTURE_1             AS FUTURE_1,
       AAD.FUTURE_2             AS FUTURE_2,
       CASE WHEN (A.DEBIT IS NULL AND A.CREDIT IS NULL) THEN 0 ELSE A.DEBIT END DEBIT,
       CASE WHEN (A.DEBIT IS NULL AND A.CREDIT IS NULL) THEN 0 ELSE  A.CREDIT END CREDIT, 
       AAD.LINE_DESCRIPTION     AS LINE_DESCRIPTION,
       UDC1.DESCRIPTION         AS UDC_1,
       AAD.UDC_2                AS UDC_2,
       AAD.UDC_3                AS UDC_3,
       AAD.UDC_4                AS UDC_4,
       AAD.UDC_5                AS UDC_5,
       AAD.UDC_6                AS UDC_6,
       AAD.ACCOUNT_CATEGORY     AS ACCOUNT_CATEGORY,
       HT.DESCRIPTION           AS ACCOUNT_TYPE,
       AAD.ADJUSTMENT_LEVEL     AS ADJUSTMENT_LEVEL,
       AAD.ACCOUNT_INDICATOR    AS ACCOUNT_INDICATOR,
       AAD.ACCOUNT_DESC         AS ACCOUNT_DESC,
       CASE
         WHEN AAC.REDEMPTION_PERIOD = 1 THEN A.REDEMPTION_PERIOD
         ELSE NULL
       END                      AS REP_PERIIOD,
       A.REDEMPTION_PERIOD      AS CALCULATION_PERIOD,
       A.WORKFLOW_ID,
       A.WORKFLOW_NAME,
       A.WORKFLOW_STATUS
FROM   (SELECT ARM_ADJ_RES_CONFIG_MASTER_SID,
               GL.COMPANY_ID       AS GL_COMPANY_ID,
               GL.COMPANY_NO       AS GL_COMPANY_NO,
               BU.COMPANY_ID       AS BU_COMPANY_ID,
               BU.COMPANY_NO       AS BU_COMPANY_NO,
               B.BU_COMPANY_MASTER_SID,
               B.GL_IMPACT_DATE    AS ACCOUNTING_DATE,
               PROJECTION_DESCRIPTION,
               CASE
                 WHEN Isnull(Sum(DEBIT), 0) - Isnull(Sum(CREDIT), 0) > 0 THEN Isnull(Sum(DEBIT), 0) - Isnull(Sum(CREDIT), 0)
                 ELSE 0
               END                 AS DEBIT,
               CASE
                 WHEN Isnull(Sum(CREDIT), 0) - Isnull(Sum(DEBIT), 0) > 0 THEN Isnull(Sum(CREDIT), 0) - Isnull(Sum(DEBIT), 0)
                 ELSE 0
               END                 AS CREDIT,
               Sum(ACCRUAL_AMOUNT) AS ACCRUAL_AMOUNT,
               WORKFLOW_ID,
               ARM_ADJUSTMENT_CONFIG_SID,
               TRANSACTION_NAME,
               A.ACCOUNT,
               A.PERIOD_DATE       AS REDEMPTION_PERIOD,
               WORKFLOW_NAME,
               WORKFLOW_STATUS
        FROM   #TEMP_PROJ_RES_TOTAL A
               JOIN ARM_ADJUSTMENT_MASTER B
                 ON A.PROJECTION_MASTER_SID = B.PROJECTION_MASTER_SID
               JOIN PROJECTION_MASTER PM
                 ON PM.PROJECTION_MASTER_SID = B.PROJECTION_MASTER_SID
               JOIN COMPANY_MASTER BU
                 ON BU.COMPANY_MASTER_SID = B.BU_COMPANY_MASTER_SID
               JOIN COMPANY_MASTER GL
                 ON GL.COMPANY_MASTER_SID = PM.COMPANY_MASTER_SID
               JOIN ARM_ADJ_RES_CONFIG_MASTER AAM
                 ON AAM.RS_CATEGORY = A.RS_CATEGORY
                    AND AAM.RS_TYPE = A.RS_TYPE
                    AND AAM.REBATE_PROGRAM_TYPE = A.REBATE_PROGRAM_TYPE
                    AND PM.COMPANY_MASTER_SID = AAM.GL_COMPANY_MASTER_SID
                    AND B.BU_COMPANY_MASTER_SID = AAM.BU_COMPANY_MASTER_SID
                    AND AAM.CONFIGURATION_TYPE = 0
        GROUP  BY ARM_ADJ_RES_CONFIG_MASTER_SID,
                  GL.COMPANY_ID,
                  GL.COMPANY_NO,
                  BU.COMPANY_ID,
                  BU.COMPANY_NO,
                  B.BU_COMPANY_MASTER_SID,
                  B.GL_IMPACT_DATE,
                  PROJECTION_DESCRIPTION,
                  WORKFLOW_ID,
                  ARM_ADJUSTMENT_CONFIG_SID,
                  TRANSACTION_NAME,
                  A.PERIOD_DATE,
                  WORKFLOW_NAME,
                  WORKFLOW_STATUS,
                  A.ACCOUNT) A
       JOIN #ARM_ADJ_RES_CCP_TOTAL AAD
         ON AAD.ARM_ADJ_RES_CONFIG_MASTER_SID = A.ARM_ADJ_RES_CONFIG_MASTER_SID
            --- Don't delete. This line is needed in the future for calculation changes
            AND A.ARM_ADJUSTMENT_CONFIG_SID = AAD.ADJUSTMENT_TYPE
            AND A.ACCOUNT = AAD.ACCOUNT
       JOIN HELPER_TABLE HT
         ON HT.HELPER_TABLE_SID = AAD.ACCOUNT_TYPE
       JOIN ARM_ADJUSTMENT_CONFIG AAC
         ON AAC.ARM_ADJUSTMENT_CONFIG_SID = AAD.ADJUSTMENT_TYPE
       LEFT JOIN HELPER_TABLE UDC1
              ON UDC1.HELPER_TABLE_SID = AAD.UDC_1
WHERE
        ?AMOUNTCONDITION
        
--A.ACCRUAL_AMOUNT>0.01 AND 
AAD.ADJUSTMENT_LEVEL = @ADJUSTMENTLEVELTOTAL 
               AND AAD.ADJUSTMENT_TYPE = @ADJUSTMENT_TYPE 
               @CATEGORY  
               @TYPE
               @ACCOUNT_CONDITION 

            ]]>  
        </query>
        
    </entity>
    

    <entity id="Adjustment GTN Details common query For data new">
     
        <query>
            <![CDATA[
                          DECLARE 
                @GL_COMP     INT = @GLCOMP,
                @PROJECTION_MASTER_SID INT = @PROJECTIONMASTER
                   @SESSION_DECLARE

IF EXISTS (SELECT 1 FROM @CONFIGTYPETEMPTABLE)
 BEGIN
 TRUNCATE TABLE @CONFIGTYPETEMPTABLE
 END

IF OBJECT_ID ('TEMPDB..#TEMP_PROJ_GTN') IS NOT NULL 
        DROP TABLE #TEMP_PROJ_GTN 
                   
CREATE TABLE  #TEMP_PROJ_GTN 
(
   ARM_ADJUSTMENT_DETAILS_SID INT,
   CCP_DETAILS_SID INT,
   RS_MODEL_SID INT,
   PERIOD_DATE DATETIME,
   ACCOUNT VARCHAR(50),
   DEBIT NUMERIC(22, 6),
   CREDIT NUMERIC(22, 6),
   ACCRUAL_AMOUNT NUMERIC(22, 6),
   ACCRUAL_RATE NUMERIC(22, 6)
)

INSERT INTO #TEMP_PROJ_GTN
(
   ARM_ADJUSTMENT_DETAILS_SID,
   CCP_DETAILS_SID,
   RS_MODEL_SID,
   PERIOD_DATE,
   ACCOUNT,
   DEBIT,
   CREDIT,
   ACCRUAL_AMOUNT,
   ACCRUAL_RATE
)
SELECT
A.ARM_ADJUSTMENT_DETAILS_SID,
A.CCP_DETAILS_SID,
A.RS_MODEL_SID,
P.PERIOD_DATE,
ARC.ACCOUNT,
ISNULL(SUM(AA.DEBIT),0) AS DEBIT,
ISNULL(SUM(AA.CREDIT),0) AS CREDIT,
 ISNULL(SUM(AA.CREDIT),0) - ISNULL(SUM(AA.DEBIT),0) AS ACCRUAL_AMOUNT,
 MAX(@RATE_COLUMN) AS RATE
FROM ARM_ADJUSTMENT_DETAILS A
JOIN @TABLE_1 B ON A.ARM_ADJUSTMENT_DETAILS_SID = B.ARM_ADJUSTMENT_DETAILS_SID

JOIN @TABLE_2 ARC ON ARC.ARM_ADJUSTMENT_DETAILS_SID=B.ARM_ADJUSTMENT_DETAILS_SID 

JOIN HELPER_TABLE HT ON HT.HELPER_TABLE_SID=ARC.ADJUSTMENT_LEVEL AND HT.DESCRIPTION='ITEM'
JOIN PERIOD P ON P.PERIOD_SID=B.PERIOD_SID 
LEFT JOIN @TABLE_3 AA ON AA.ARM_ADJUSTMENT_DETAILS_SID = B.ARM_ADJUSTMENT_DETAILS_SID
AND ARC.ADJUSTMENT_TYPE=AA.ADJUSTMENT_TYPE
AND ARC.ACCOUNT=AA.ACCOUNT AND B.PERIOD_SID= AA.PERIOD_SID
WHERE A.PROJECTION_MASTER_SID = @PROJECTION_MASTER_SID 
@SESSION_INCLUDE
GROUP BY A.ARM_ADJUSTMENT_DETAILS_SID,
A.CCP_DETAILS_SID,
A.RS_MODEL_SID ,
P.PERIOD_DATE,
ARC.ACCOUNT

IF OBJECT_ID
(
   'TEMPDB..#TEMP_GTN'
)
IS NOT NULL DROP TABLE #TEMP_GTN 
CREATE TABLE #TEMP_GTN
(
   ARM_ADJUSTMENT_DETAILS INT,
   CONTRACT_MASTER_SID INT,
   CONTRACT_ID VARCHAR(50),
   CONTRACT_NO VARCHAR(50),
   [CONTRACT_NAME] VARCHAR(100),
   COMPANY_MASTER_SID INT,
   COMPANY_ID VARCHAR(50),
   COMPANY_NO VARCHAR(50),
   COMPANY_NAME VARCHAR(100),
   ITEM_MASTER_SID INT,
   ITEM_ID VARCHAR(50),
   ITEM_NO VARCHAR(50),
   ITEM_NAME VARCHAR(100),
   BRAND_MASTER_SID INT,
   BRAND_ID VARCHAR(50),
   BRAND_NAME VARCHAR(100),
   RS_MODEL_SID INT,
   RS_CATEGORYÂ INT,
   RS_TYPEÂ INT,
   REBATE_PROGRAM_TYPEÂ INT,
   DEDUCTION_INCLUSION INT,
   RS_ID VARCHAR(50),
   RS_NAME VARCHAR(100),
   RS_NO VARCHAR(50),
   RS_UDC_1 INT,
   RS_UDC_2 INT,
   RS_UDC_3 INT,
   RS_UDC_4 INT,
   RS_UDC_5 INT,
   RS_UDC_6 INT,
   PROJECTION_MASTER_SID INT,
   WORKFLOW_MASTER_SID INT NULL ,
   CREATED_DATE DATETIME,
    WORKFLOW_ID VARCHAR(50),
    WORKFLOW_NAME VARCHAR(500),
    WORKFLOW_STATUS INT 
)
INSERT INTO #TEMP_GTN
(
   ARM_ADJUSTMENT_DETAILS,
   CONTRACT_MASTER_SID,
   CONTRACT_ID,
   CONTRACT_NO,
   [CONTRACT_NAME],
   COMPANY_MASTER_SID,
   COMPANY_ID,
   COMPANY_NO,
   COMPANY_NAME,
   ITEM_MASTER_SID,
   ITEM_ID,
   ITEM_NO,
   ITEM_NAME,
   BRAND_MASTER_SID,
   BRAND_ID,
   BRAND_NAME,
   RS_MODEL_SID,
   RS_CATEGORY,
   RS_TYPE,
   REBATE_PROGRAM_TYPE,
   DEDUCTION_INCLUSION,
   RS_ID,
   RS_NO,
   RS_NAME,
   RS_UDC_1,
   RS_UDC_2,
   RS_UDC_3,
   RS_UDC_4,
   RS_UDC_5,
   RS_UDC_6,
   PROJECTION_MASTER_SID,
   WORKFLOW_MASTER_SID,
   CREATED_DATE,
    WORKFLOW_ID ,
    WORKFLOW_NAME ,
    WORKFLOW_STATUS 
)
SELECT
A.ARM_ADJUSTMENT_DETAILS_SID,
C.CONTRACT_MASTER_SID,
CON.CONTRACT_ID,
CON.CONTRACT_NO,
CON.[CONTRACT_NAME],
C.COMPANY_MASTER_SID,
CM.COMPANY_ID,
CM.COMPANY_NO,
CM.COMPANY_NAME,
C.ITEM_MASTER_SID,
IM.ITEM_ID,
IM.ITEM_NO,
IM.ITEM_NAME,
BM.BRAND_MASTER_SID,
BM.BRAND_ID,
BM.BRAND_NAME,
A.RS_MODEL_SID,
RS_CATEGORY,
RS_TYPE,
REBATE_PROGRAM_TYPE,
DEDUCTION_INCLUSION,
R.RS_ID,
R.RS_NO,
R.RS_NAME,
U.UDC1 AS RS_UDC_1,
U.UDC2 AS RS_UDC_2,
U.UDC3 AS RS_UDC_3,
U.UDC4 AS RS_UDC_4,
U.UDC5 AS RS_UDC_5,
U.UDC6 AS RS_UDC_6,
A.PROJECTION_MASTER_SID,
WM.WORKFLOW_MASTER_SID,
WM.CREATED_DATE,
WM.WORKFLOW_ID,
PM.PROJECTION_DESCRIPTION,
WM.WORKFLOW_STATUS_ID
FROM ARM_ADJUSTMENT_DETAILS A
JOIN CCP_DETAILS C ON C.CCP_DETAILS_SID = A.CCP_DETAILS_SID AND  A.PROJECTION_MASTER_SID = @PROJECTION_MASTER_SID
JOIN PROJECTION_MASTER PM ON PM.PROJECTION_MASTER_SID = A.PROJECTION_MASTER_SID AND PM.PROJECTION_MASTER_SID=@PROJECTION_MASTER_SID
JOIN ITEM_MASTER IM ON IM.ITEM_MASTER_SID = C.ITEM_MASTER_SID
JOIN COMPANY_MASTER CM ON CM.COMPANY_MASTER_SID=C.COMPANY_MASTER_SID
JOIN CONTRACT_MASTER CON ON CON.CONTRACT_MASTER_SID=C.CONTRACT_MASTER_SID
JOIN BRAND_MASTER BM ON BM.BRAND_MASTER_SID = IM.BRAND_MASTER_SID
JOIN RS_CONTRACT R ON R.RS_MODEL_SID = A.RS_MODEL_SID
AND R.CONTRACT_MASTER_SID=C.CONTRACT_MASTER_SID
JOIN ARM_DEDUCTION_SELECTION ADS ON ADS.RS_CONTRACT_SID=R.RS_CONTRACT_SID
AND ADS.PROJECTION_MASTER_SID = PM.PROJECTION_MASTER_SID
AND ADS.PROJECTION_MASTER_SID = @PROJECTION_MASTER_SID
LEFT JOIN WORKFLOW_MASTER WM ON WM.PROJECTION_MASTER_SID=A.PROJECTION_MASTER_SID AND WM.PROJECTION_MASTER_SID = @PROJECTION_MASTER_SID
LEFT JOIN UDCS U ON U.MASTER_SID=R.RS_CONTRACT_SID
AND U.MASTER_TYPE='RS_CONTRACT'
WHERE A.PROJECTION_MASTER_SID = @PROJECTION_MASTER_SID
  INSERT INTO @CONFIGTYPETEMPTABLE (
ADJUSTMENT_TYPE,
DEDUCTION_TYPE,
GL_MONTH,
GL_YEAR,
GL_STRING,
GL_COMPANY_ID,
DIVISION,
BUSINESS_UNIT_ID,
COST_CENTER,
ACCOUNT,
BRAND_ID,
PROJECT,
FUTURE_1,
FUTURE_2,
ITEM_NO,
DEDUCTION_AMOUNT,
GL_COMPANY_NO,
GL_COMPANY_NAME,
BUSINESS_UNIT_NO,
BUSINESS_UNIT_NAME,
GL_DATE,
CREATED_DATE,
REDEMPTION_PERIOD,
CONTRACT_ID,
CONTRACT_NO,
CONTRACT_NAME,
COMPANY_ID,
COMPANY_NO,
COMPANY_NAME,
ITEM_ID,
ITEM_NAME,
BRAND_NAME,
DEDUCTION_ID,
DEDUCTION_NO,
DEDUCTION_NAME,
DEDUCTION_CATEGORY,
DEDUCTION_PROGRAM,
DEDUCTION_INCLUSION,
DEDUCTION_UDC_1,
DEDUCTION_UDC_2,
DEDUCTION_UDC_3,
DEDUCTION_UDC_4,
DEDUCTION_UDC_5,
DEDUCTION_UDC_6,
DEDUCTION_RATE,
UDC_1,
UDC_2,
UDC_3,
UDC_4,
UDC_5,
UDC_6,
ACCOUNT_TYPE,
ACCOUNT_CATEGORY,
ADJUSTMENT_LEVEL,
ACCOUNT_DESCRIPTION,
ACCOUNT_INDICATOR,
CALCULATION_PERIOD,
WORKFLOW_ID,
WORKFLOW_NAME,
WORKFLOW_STATUS)
                    SELECT       AC.TRANSACTION_NAME AS ADJUSTMENT_TYPE
        ,RTYPE.DESCRIPTION AS DEDUCTION_TYPE
        ,MONTH(GL_IMPACT_DATE) AS GL_MONTH
        ,YEAR(GL_IMPACT_DATE) AS GL_YEAR
        ,GL.COMPANY_ID+' - '+
	CASE WHEN 
		 (AAD.DIVISION='' OR AAd.DIVISION IS NULL) AND (AAD.COST_CENTER='' OR AAd.COST_CENTER IS NULL)
		THEN AAD.ACCOUNT+' - '+A.BRAND_ID+' - '+AAD.PROJECT+'- '+AAD.FUTURE_1+' - '+AAD.FUTURE_2
		WHEN (AAD.DIVISION='' OR AAd.DIVISION IS NULL) AND (AAD.COST_CENTER IS NOT NULL) THEN +AAD.COST_CENTER+' - '+AAD.ACCOUNT+' - '+A.BRAND_ID+' - '+AAD.PROJECT+'- '+AAD.FUTURE_1+' - '+AAD.FUTURE_2
		WHEN (AAD.DIVISION IS NOT NULL) AND (AAD.COST_CENTER='' OR AAd.COST_CENTER IS NULL) THEN AAD.DIVISION+' - '+AAD.ACCOUNT+' - '+A.BRAND_ID+' - '+AAD.PROJECT+'- '+AAD.FUTURE_1+' - '+AAD.FUTURE_2
		ELSE AAD.DIVISION+' - '+AAD.COST_CENTER+' - '+AAD.ACCOUNT+' - '+A.BRAND_ID+' - '+AAD.PROJECT+'- '+AAD.FUTURE_1+' - '+AAD.FUTURE_2
         END AS GLSTRING
        ,GL.COMPANY_ID AS GL_COMPANY_ID
        ,AAD.DIVISION       AS DIVISION
        ,BU.COMPANY_ID AS BU_COMPANY_ID
        ,AAD.COST_CENTER AS COST_CENTER
        ,AAD.ACCOUNT AS ACCOUNT
        ,A.BRAND_ID AS BRAND_ID
        ,AAD.PROJECT AS PROJECT
        ,AAD.FUTURE_1 AS FUTURE_1
        ,AAD.FUTURE_2 AS FUTURE_2
        ,A.ITEM_NO AS ITEM_NO
        ,CASE WHEN ISNULL(TP.DEBIT,0)-ISNULL(TP.CREDIT,0) > 0 THEN TP.DEBIT
		 ELSE TP.CREDIT * -1 END  AS ACCRUAL_AMOUNT
        ,GL.COMPANY_NO AS GL_COMPANY_NO
        ,GL.COMPANY_NAME AS GL_COMPANY_NAME
        ,BU.COMPANY_NO AS BU_COMPANY_NO
        ,BU.COMPANY_NAME AS BU_COMPANY_NAME
        ,GL_IMPACT_DATE AS GLDATE 
        ,A.CREATED_DATE AS CREATED_DATE
        ,CASE WHEN AC.REDEMPTION_PERIOD=1 THEN TP.PERIOD_DATE ELSE NULL END AS REDEMPTION_PERIOD
        ,A.CONTRACT_ID AS CONTRACT_ID
        ,A.CONTRACT_NO AS CONTRACT_NO
        ,A.CONTRACT_NAME AS CONTRACT_NAME
        ,A.COMPANY_ID AS COMPANY_ID
        ,A.COMPANY_NO AS COMPANY_NO
        ,A.COMPANY_NAME AS COMPANY_NAME
        ,A.ITEM_NO AS ITEM_ID
        ,A.ITEM_NAME AS ITEM_NAME
        ,A.BRAND_NAME AS BRAND_NAME
        ,A.RS_ID AS DEDUCTION_ID
        ,A.RS_NO AS DEDUCTION_NO
        ,A.RS_NAME AS DEDUCTION_NAME
        ,A.RS_CATEGORY AS DEDUCTION_CATEGORY
        ,A.REBATE_PROGRAM_TYPE AS REBATE_PROGRAM_TYPE
        ,A.DEDUCTION_INCLUSION AS DEDUCTION_INCLUSION
        ,A.RS_UDC_1 AS DEDUCTION_UDC_1
        ,A.RS_UDC_2 AS DEDUCTION_UDC_2
        ,A.RS_UDC_3 AS DEDUCTION_UDC_3
        ,A.RS_UDC_4 AS DEDUCTION_UDC_4
        ,A.RS_UDC_5 AS DEDUCTION_UDC_5
        ,A.RS_UDC_6 AS DEDUCTION_UDC_6
        ,TP.ACCRUAL_RATE AS RATE
        ,UDC1.DESCRIPTION AS UDC_1
        ,AAD.UDC_2 AS UDC_2
        ,AAD.UDC_3 AS UDC_3
        ,AAD.UDC_4 AS UDC_4
        ,AAD.UDC_5 AS UDC_5
        ,AAD.UDC_6 AS UDC_6
        ,AAD.ACCOUNT_TYPE AS ACCOUNT_TYPE
        ,AAD.ACCOUNT_CATEGORY AS ACCOUNT_CATEGORY
        ,AAD.ADJUSTMENT_LEVEL AS ADJUSTMENT_LEVEL
        ,AAD.ACCOUNT_DESC AS ACCOUNT_DESC
        ,AAD.ACCOUNT_INDICATOR AS ACCOUNT_INDICATOR
        ,TP.PERIOD_DATE AS CALCULATION_PERIOD
        ,A.WORKFLOW_ID
        ,A.WORKFLOW_NAME
        ,A.WORKFLOW_STATUS
                 FROM #TEMP_GTN A
       JOIN ARM_ADJUSTMENT_MASTER AM
         ON A.PROJECTION_MASTER_SID = AM.PROJECTION_MASTER_SID
            AND AM.PROJECTION_MASTER_SID = @PROJECTION_MASTER_SID
       JOIN ARM_ADJUSTMENT_CONFIG AC
         ON AM.TRANSACTION_TYPE = AC.ARM_ADJUSTMENT_CONFIG_SID
       JOIN ARM_ADJ_RES_CONFIG_MASTER AAM
         ON AAM.RS_CATEGORY = A.RS_CATEGORY
            AND AAM.RS_TYPE = A.RS_TYPE
            AND AAM.REBATE_PROGRAM_TYPE = A.REBATE_PROGRAM_TYPE
            AND AAM.GL_COMPANY_MASTER_SID = @GL_COMP
            AND AM.BU_COMPANY_MASTER_SID = AAM.BU_COMPANY_MASTER_SID
            AND AAM.CONFIGURATION_TYPE = 1
       JOIN ARM_ADJ_RES_CCP AAD
         ON AAD.ARM_ADJ_RES_CONFIG_MASTER_SID = AAM.ARM_ADJ_RES_CONFIG_MASTER_SID
            AND AC.ARM_ADJUSTMENT_CONFIG_SID = AAD.ADJUSTMENT_TYPE
            AND AAD.ARM_ADJUSTMENT_DETAILS_SID = A.ARM_ADJUSTMENT_DETAILS
       LEFT JOIN #TEMP_PROJ_GTN TP
              ON AAD.ARM_ADJUSTMENT_DETAILS_SID = TP.ARM_ADJUSTMENT_DETAILS_SID
                 AND AAD.ACCOUNT = TP.ACCOUNT  
       JOIN COMPANY_MASTER GL
         ON GL.COMPANY_MASTER_SID = @GL_COMP
            AND AAM.GL_COMPANY_MASTER_SID = GL.COMPANY_MASTER_SID
       JOIN COMPANY_MASTER BU
         ON BU.COMPANY_MASTER_SID = AM.BU_COMPANY_MASTER_SID
LEFT JOIN HELPER_TABLE UDC1 ON UDC1.HELPER_TABLE_SID=AAD.UDC_1
LEFT JOIN HELPER_TABLE RTYPE ON RTYPE.HELPER_TABLE_SID=A.RS_TYPE
WHERE 
?AMOUNTCONDITION
--TP.ACCRUAL_AMOUNT >0.01 AND 
AAD.ADJUSTMENT_TYPE = @ADJUSTMENT_TYPE
@CATEGORY
@TYPE
@ACCOUNT
  
                                
            ]]>  
        </query>
        
    </entity>
    
    <entity id="Adjustment GTN Details Trx6 query For data new">
     
        <query>
            <![CDATA[
 DECLARE
    @GL_COMP     INT = @GLCOMP,
   @PROJECTION_MASTER_SID INT = @PROJECTIONMASTER
   @SESSION_DECLARE  
   
IF EXISTS (SELECT 1 FROM @CONFIGTYPETEMPTABLE)
 BEGIN
 TRUNCATE TABLE @CONFIGTYPETEMPTABLE
 END

  IF OBJECT_ID ('TEMPDB..#TEMP_PROJ_GTN') IS NOT NULL
         DROP TABLE #TEMP_PROJ_GTN
 CREATE TABLE  #TEMP_PROJ_GTN
 (
    ARM_ADJUSTMENT_DETAILS_SID INT,
    CCP_DETAILS_SID INT,
    RS_MODEL_SID INT,
    PERIOD_DATE DATETIME,
    ACCOUNT VARCHAR(50),
    DEBIT NUMERIC(22, 6),
    CREDIT NUMERIC(22, 6),
    ACCRUAL_AMOUNT NUMERIC(22, 6),
    ACCRUAL_RATE NUMERIC(22, 6)
 )
 INSERT INTO #TEMP_PROJ_GTN
 (
    ARM_ADJUSTMENT_DETAILS_SID,
    CCP_DETAILS_SID,
    RS_MODEL_SID,
    PERIOD_DATE,
    ACCOUNT,
    DEBIT,
    CREDIT,
    ACCRUAL_AMOUNT,
    ACCRUAL_RATE
 )
 SELECT
 A.ARM_ADJUSTMENT_DETAILS_SID,
 A.CCP_DETAILS_SID,
 A.RS_MODEL_SID,
 P.PERIOD_DATE,
 AA.ACCOUNT,
 ISNULL(SUM(AA.DEBIT),0) AS DEBIT,
 ISNULL(SUM(AA.CREDIT),0) AS CREDIT,
 ISNULL(SUM(AA.CREDIT),0) - ISNULL(SUM(AA.DEBIT),0) AS ACCRUAL_AMOUNT,
 SUM(INFLATION_FACTOR) AS RATE
 FROM ARM_ADJUSTMENT_DETAILS A
JOIN @TABLE_1 B ON A.ARM_ADJUSTMENT_DETAILS_SID = B.ARM_ADJUSTMENT_DETAILS_SID
JOIN @TABLE_3 AA ON AA.ARM_ADJUSTMENT_DETAILS_SID = B.ARM_ADJUSTMENT_DETAILS_SID
 JOIN CCP_DETAILS CD
 ON A.CCP_DETAILS_SID=CD.CCP_DETAILS_SID
JOIN @TABLE_2 C ON A.PROJECTION_MASTER_SID=C.PROJECTION_MASTER_SID
 AND CD.COMPANY_MASTER_SID=C.COMPANY_MASTER_SID AND CD.ITEM_MASTER_SID=C.ITEM_MASTER_SID
 AND B.PERIOD_SID=C.PERIOD_SID
 JOIN PERIOD P ON P.PERIOD_SID=B.PERIOD_SID AND B.PERIOD_SID=AA.PERIOD_SID
 WHERE A.PROJECTION_MASTER_SID = @PROJECTION_MASTER_SID
@SESSION_INCLUDE
 GROUP BY A.ARM_ADJUSTMENT_DETAILS_SID,
 A.CCP_DETAILS_SID,
 A.RS_MODEL_SID ,
 P.PERIOD_DATE,
 AA.ACCOUNT

 IF OBJECT_ID
 (
    'TEMPDB..#TEMP_GTN'
 )
 IS NOT NULL DROP TABLE #TEMP_GTN
 CREATE TABLE #TEMP_GTN
 (
    ARM_ADJUSTMENT_DETAILS INT,
    CONTRACT_MASTER_SID INT,
    CONTRACT_ID VARCHAR(50),
    CONTRACT_NO VARCHAR(50),
    [CONTRACT_NAME] VARCHAR(100),
    COMPANY_MASTER_SID INT,
    COMPANY_ID VARCHAR(50),
    COMPANY_NO VARCHAR(50),
    COMPANY_NAME VARCHAR(100),
    ITEM_MASTER_SID INT,
    ITEM_ID VARCHAR(50),
    ITEM_NO VARCHAR(50),
    ITEM_NAME VARCHAR(100),
    BRAND_MASTER_SID INT,
    BRAND_ID VARCHAR(50),
    BRAND_NAME VARCHAR(100),
    RS_MODEL_SID INT,
    RS_CATEGORYÂ INT,
    RS_TYPEÂ INT,
    REBATE_PROGRAM_TYPEÂ INT,
    DEDUCTION_INCLUSION INT,
    RS_ID VARCHAR(50),
    RS_NAME VARCHAR(100),
    RS_NO VARCHAR(50),
    RS_UDC_1 INT,
    RS_UDC_2 INT,
    RS_UDC_3 INT,
    RS_UDC_4 INT,
    RS_UDC_5 INT,
    RS_UDC_6 INT,
    PROJECTION_MASTER_SID INT,
    WORKFLOW_MASTER_SID INT NULL ,
    CREATED_DATE DATETIME,
     WORKFLOW_ID VARCHAR(50),
     WORKFLOW_NAME VARCHAR(500),
     WORKFLOW_STATUS INT
 )
 INSERT INTO #TEMP_GTN
 (
    ARM_ADJUSTMENT_DETAILS,
    CONTRACT_MASTER_SID,
    CONTRACT_ID,
    CONTRACT_NO,
    [CONTRACT_NAME],
    COMPANY_MASTER_SID,
    COMPANY_ID,
    COMPANY_NO,
    COMPANY_NAME,
    ITEM_MASTER_SID,
    ITEM_ID,
    ITEM_NO,
    ITEM_NAME,
    BRAND_MASTER_SID,
    BRAND_ID,
    BRAND_NAME,
    RS_MODEL_SID,
    RS_CATEGORY,
    RS_TYPE,
    REBATE_PROGRAM_TYPE,
    DEDUCTION_INCLUSION,
    RS_ID,
    RS_NO,
    RS_NAME,
    RS_UDC_1,
    RS_UDC_2,
    RS_UDC_3,
    RS_UDC_4,
    RS_UDC_5,
    RS_UDC_6,
    PROJECTION_MASTER_SID,
    WORKFLOW_MASTER_SID,
    CREATED_DATE,
     WORKFLOW_ID ,
     WORKFLOW_NAME ,
     WORKFLOW_STATUS
 )
 SELECT
 A.ARM_ADJUSTMENT_DETAILS_SID,
 C.CONTRACT_MASTER_SID,
 CON.CONTRACT_ID,
 CON.CONTRACT_NO,
 CON.[CONTRACT_NAME],
 C.COMPANY_MASTER_SID,
 CM.COMPANY_ID,
 CM.COMPANY_NO,
 CM.COMPANY_NAME,
 C.ITEM_MASTER_SID,
 IM.ITEM_ID,
 IM.ITEM_NO,
 IM.ITEM_NAME,
 BM.BRAND_MASTER_SID,
 BM.BRAND_ID,
 BM.BRAND_NAME,
 A.RS_MODEL_SID,
 RS_CATEGORY,
 RS_TYPE,
 REBATE_PROGRAM_TYPE,
 DEDUCTION_INCLUSION,
 R.RS_ID,
 R.RS_NO,
 R.RS_NAME,
 U.UDC1 AS RS_UDC_1,
 U.UDC2 AS RS_UDC_2,
 U.UDC3 AS RS_UDC_3,
 U.UDC4 AS RS_UDC_4,
 U.UDC5 AS RS_UDC_5,
 U.UDC6 AS RS_UDC_6,
 A.PROJECTION_MASTER_SID,
 WM.WORKFLOW_MASTER_SID,
 WM.CREATED_DATE,
 WM.WORKFLOW_ID,
 PM.PROJECTION_DESCRIPTION,
 WM.WORKFLOW_STATUS_ID
 FROM ARM_ADJUSTMENT_DETAILS A
 JOIN CCP_DETAILS C ON C.CCP_DETAILS_SID = A.CCP_DETAILS_SID AND  A.PROJECTION_MASTER_SID = @PROJECTION_MASTER_SID
 JOIN PROJECTION_MASTER PM ON PM.PROJECTION_MASTER_SID=A.PROJECTION_MASTER_SID AND PM.PROJECTION_MASTER_SID=@PROJECTION_MASTER_SID
 JOIN ITEM_MASTER IM ON IM.ITEM_MASTER_SID = C.ITEM_MASTER_SID
 JOIN COMPANY_MASTER CM ON CM.COMPANY_MASTER_SID=C.COMPANY_MASTER_SID
 JOIN CONTRACT_MASTER CON ON CON.CONTRACT_MASTER_SID=C.CONTRACT_MASTER_SID
 JOIN BRAND_MASTER BM ON BM.BRAND_MASTER_SID = IM.BRAND_MASTER_SID
 JOIN RS_CONTRACT R ON R.RS_MODEL_SID = A.RS_MODEL_SID
 AND R.CONTRACT_MASTER_SID=C.CONTRACT_MASTER_SID
 JOIN ARM_DEDUCTION_SELECTION ADS ON ADS.RS_CONTRACT_SID=R.RS_CONTRACT_SID
 AND ADS.PROJECTION_MASTER_SID = PM.PROJECTION_MASTER_SID
 AND ADS.PROJECTION_MASTER_SID = @PROJECTION_MASTER_SID
 LEFT JOIN WORKFLOW_MASTER WM ON WM.PROJECTION_MASTER_SID=A.PROJECTION_MASTER_SID AND WM.PROJECTION_MASTER_SID = @PROJECTION_MASTER_SID
 LEFT JOIN UDCS U ON U.MASTER_SID=R.RS_CONTRACT_SID
 AND U.MASTER_TYPE='RS_CONTRACT'
 WHERE A.PROJECTION_MASTER_SID = @PROJECTION_MASTER_SID

  INSERT INTO @CONFIGTYPETEMPTABLE (
ADJUSTMENT_TYPE               ,
DEDUCTION_TYPE				  ,
GL_MONTH					  ,
GL_YEAR						  ,
GLSTRING                      ,
GL_COMPANY_ID				  ,
DIVISION					  ,
BU_COMPANY_ID				  ,
COST_CENTER					  ,
ACCOUNT						  ,
BRAND_ID					  ,
PROJECT						  ,
FUTURE_1					  ,
FUTURE_2					  ,
ITEM_NO						  ,
ACCRUAL_AMOUNT				  ,
GL_COMPANY_NO				  ,
GL_COMPANY_NAME				  ,
BU_COMPANY_NO				  ,
BU_COMPANY_NAME				  ,
GLDATE						  ,
CREATED_DATE				  ,
REDEMPTION_PERIOD			  ,
CONTRACT_ID					  ,
CONTRACT_NO					  ,
CONTRACT_NAME				  ,
COMPANY_ID					  ,
COMPANY_NO					  ,
COMPANY_NAME				  ,
ITEM_ID						  ,
ITEM_NAME					  ,
BRAND_NAME					  ,
DEDUCTION_ID				  ,
DEDUCTION_NO				  ,
DEDUCTION_NAME				  ,
DEDUCTION_CATEGORY			  ,
REBATE_PROGRAM_TYPE			  ,
DEDUCTION_INCLUSION			  ,
DEDUCTION_UDC_1				  ,
DEDUCTION_UDC_2				  ,
DEDUCTION_UDC_3				  ,
DEDUCTION_UDC_4				  ,
DEDUCTION_UDC_5				  ,
DEDUCTION_UDC_6				  ,
RATE						  ,
UDC_1						  ,
UDC_2						  ,
UDC_3						  ,
UDC_4						  ,
UDC_5						  ,
UDC_6						  ,
ACCOUNT_TYPE				  ,
ACCOUNT_CATEGORY			  ,
ADJUSTMENT_LEVEL			  ,
ACCOUNT_DESC				  ,
ACCOUNT_INDICATOR			  ,
CALCULATION_PERIOD			  ,
WORKFLOW_ID					  ,
WORKFLOW_NAME				  ,
WORKFLOW_STATUS)
                     SELECT         AC.TRANSACTION_NAME AS ADJUSTMENT_TYPE
         ,A.RS_TYPE AS DEDUCTION_TYPE
         ,MONTH(GL_IMPACT_DATE) AS GL_MONTH
         ,YEAR(GL_IMPACT_DATE) AS GL_YEAR
         ,GL.COMPANY_ID+' - '+
         CASE WHEN
               (AAD.DIVISION='' OR AAd.DIVISION IS NULL) AND (AAD.COST_CENTER='' OR AAd.COST_CENTER IS NULL)
              THEN AAD.ACCOUNT+' - '+A.BRAND_ID+' - '+AAD.PROJECT+'- '+AAD.FUTURE_1+' - '+AAD.FUTURE_2
              WHEN (AAD.DIVISION='' OR AAd.DIVISION IS NULL) AND (AAD.COST_CENTER IS NOT NULL) THEN +AAD.COST_CENTER+' - '+AAD.ACCOUNT+' - '+A.BRAND_ID+' - '+AAD.PROJECT+'- '+AAD.FUTURE_1+' - '+AAD.FUTURE_2
              WHEN (AAD.DIVISION IS NOT NULL) AND (AAD.COST_CENTER='' OR AAd.COST_CENTER IS NULL) THEN AAD.DIVISION+' - '+AAD.ACCOUNT+' - '+A.BRAND_ID+' - '+AAD.PROJECT+'- '+AAD.FUTURE_1+' - '+AAD.FUTURE_2
              ELSE AAD.DIVISION+' - '+AAD.COST_CENTER+' - '+AAD.ACCOUNT+' - '+A.BRAND_ID+' - '+AAD.PROJECT+'- '+AAD.FUTURE_1+' - '+AAD.FUTURE_2
          END AS GLSTRING
         ,GL.COMPANY_ID AS GL_COMPANY_ID
         ,AAD.DIVISION       AS DIVISION
         ,BU.COMPANY_ID AS BU_COMPANY_ID
         ,AAD.COST_CENTER AS COST_CENTER
         ,AAD.ACCOUNT AS ACCOUNT
         ,A.BRAND_ID AS BRAND_ID
         ,AAD.PROJECT AS PROJECT
         ,AAD.FUTURE_1 AS FUTURE_1
         ,AAD.FUTURE_2 AS FUTURE_2
         ,A.ITEM_NO AS ITEM_NO
          ,CASE WHEN ISNULL(TP.DEBIT,0)-ISNULL(TP.CREDIT,0) > 0 THEN TP.DEBIT
               ELSE TP.CREDIT * -1 END  AS ACCRUAL_AMOUNT
         ,GL.COMPANY_NO AS GL_COMPANY_NO
         ,GL.COMPANY_NAME AS GL_COMPANY_NAME
         ,BU.COMPANY_NO AS BU_COMPANY_NO
         ,BU.COMPANY_NAME AS BU_COMPANY_NAME
         ,GL_IMPACT_DATE AS GLDATE
         ,A.CREATED_DATE AS CREATED_DATE
         ,CASE WHEN AC.REDEMPTION_PERIOD=1 THEN TP.PERIOD_DATE ELSE NULL END AS REDEMPTION_PERIOD
         ,A.CONTRACT_ID AS CONTRACT_ID
         ,A.CONTRACT_NO AS CONTRACT_NO
         ,A.CONTRACT_NAME AS CONTRACT_NAME
         ,A.COMPANY_ID AS COMPANY_ID
         ,A.COMPANY_NO AS COMPANY_NO
         ,A.COMPANY_NAME AS COMPANY_NAME
         ,A.ITEM_NO AS ITEM_ID
         ,A.ITEM_NAME AS ITEM_NAME
         ,A.BRAND_NAME AS BRAND_NAME
         ,A.RS_ID AS DEDUCTION_ID
         ,A.RS_NO AS DEDUCTION_NO
         ,A.RS_NAME AS DEDUCTION_NAME
         ,A.RS_CATEGORY AS DEDUCTION_CATEGORY
         ,A.REBATE_PROGRAM_TYPE AS REBATE_PROGRAM_TYPE
         ,A.DEDUCTION_INCLUSION AS DEDUCTION_INCLUSION
         ,A.RS_UDC_1 AS DEDUCTION_UDC_1
         ,A.RS_UDC_2 AS DEDUCTION_UDC_2
         ,A.RS_UDC_3 AS DEDUCTION_UDC_3
         ,A.RS_UDC_4 AS DEDUCTION_UDC_4
         ,A.RS_UDC_5 AS DEDUCTION_UDC_5
         ,A.RS_UDC_6 AS DEDUCTION_UDC_6
         ,TP.ACCRUAL_RATE AS RATE
         ,AAD.UDC_1 AS UDC_1
         ,AAD.UDC_2 AS UDC_2
         ,AAD.UDC_3 AS UDC_3
         ,AAD.UDC_4 AS UDC_4
         ,AAD.UDC_5 AS UDC_5
         ,AAD.UDC_6 AS UDC_6
         ,AAD.ACCOUNT_TYPE AS ACCOUNT_TYPE
         ,AAD.ACCOUNT_CATEGORY AS ACCOUNT_CATEGORY
         ,AAD.ADJUSTMENT_LEVEL AS ADJUSTMENT_LEVEL
         ,AAD.ACCOUNT_DESC AS ACCOUNT_DESC
         ,AAD.ACCOUNT_INDICATOR AS ACCOUNT_INDICATOR
         ,TP.PERIOD_DATE AS CALCULATION_PERIOD
         ,A.WORKFLOW_ID
         ,A.WORKFLOW_NAME
         ,A.WORKFLOW_STATUS
                  FROM #TEMP_GTN A
 JOIN ARM_ADJUSTMENT_MASTER AM ON A.PROJECTION_MASTER_SID=AM.PROJECTION_MASTER_SID
 AND AM.PROJECTION_MASTER_SID = @PROJECTION_MASTER_SID
 JOIN ARM_ADJUSTMENT_CONFIG AC ON AM.TRANSACTION_TYPE=AC.ARM_ADJUSTMENT_CONFIG_SID
 JOIN ARM_ADJ_RES_CONFIG_MASTER AAM ON AAM.RS_CATEGORY = A.RS_CATEGORY
 AND AAM.RS_TYPE = A.RS_TYPE
 AND AAM.REBATE_PROGRAM_TYPE = A.REBATE_PROGRAM_TYPE
 AND AAM.GL_COMPANY_MASTER_SID = @GL_COMP
 AND AM.BU_COMPANY_MASTER_SID = AAM.BU_COMPANY_MASTER_SID
 AND AAM.CONFIGURATION_TYPE=1
 JOIN ARM_ADJ_RES_CCP AAD ON AAD.ARM_ADJ_RES_CONFIG_MASTER_SID = AAM.ARM_ADJ_RES_CONFIG_MASTER_SID
                           AND AC.ARM_ADJUSTMENT_CONFIG_SID=AAD.ADJUSTMENT_TYPE
						    AND AAD.ARM_ADJUSTMENT_DETAILS_SID = A.ARM_ADJUSTMENT_DETAILS
 LEFT JOIN #TEMP_PROJ_GTN TP ON 
   AAD.ARM_ADJUSTMENT_DETAILS_SID = TP.ARM_ADJUSTMENT_DETAILS_SID
  AND AAD.ACCOUNT=TP.ACCOUNT
 JOIN COMPANY_MASTER GL
          ON GL.COMPANY_MASTER_SID = @GL_COMP
             AND AAM.GL_COMPANY_MASTER_SID = GL.COMPANY_MASTER_SID
        JOIN COMPANY_MASTER BU
          ON BU.COMPANY_MASTER_SID = AM.BU_COMPANY_MASTER_SID
 WHERE
?AMOUNTCONDITION
--TP.ACCRUAL_AMOUNT >0.01 AND 
AAD.ADJUSTMENT_TYPE = @ADJUSTMENT_TYPE
@CATEGORY
@TYPE
@ACCOUNT

                                
            ]]>  
        </query>
        
    </entity>
    
    <entity id="Adjustment Reserve Details Data">
     
        <query>
            <![CDATA[
 
    SELECT
	ADJUSTMENT_TYPE,
	BALANCE_TYPE,
	[DATABASE],
	DATA_ACCESS_SET,
	CHART_OF_ACCOUNTS,
	LEDGER,
	CATEGORY,
	SOURCE,
	CURRENCY,
	ACCOUNTING_DATE,
	BATCH_NAME,
	JOURNAL_NAME,
	JOURNAL_DESCRIPTION,
	REVERSE_JOURNAL,
	REVERSAL_PERIOD_DATE,
	COMPANY,
	DIVISION,
	BUSINESS_UNIT,
	COST_CENTER,
	ACCOUNT,
	BRAND,
	PROJECT,
	FUTURE_1,
	FUTURE_2,
	DEBIT,
	CREDIT,
	LINE_DESCRIPTION,
	UDC_1,
	UDC_2,
	UDC_3,
	UDC_4,
	UDC_5,
	UDC_6,
	ACCOUNT_CATEGORY,
	ACCOUNT_TYPE,
	ADJUSTMENT_LEVEL,
	ACCOUNT_INDICATOR,
	ACCOUNT_DESC,
	REDEMPTION_PERIOD,
	CALCULATION_PERIOD,
	WORKFLOW_ID,
	WORKFLOW_NAME,
	WORKFLOW_STATUS
    FROM @CONFIGTYPETEMPTABLE
    @PAGINATION
                               
            ]]>  
        </query>
        
    </entity>
    <entity id="Adjustment Details Count">
     
        <query>
            <![CDATA[
        SELECT COUNT (*) FROM @CONFIGTYPETEMPTABLE
        @PAGINATION          
            ]]>  
        </query>
        
    </entity>
    <entity id="Adjustment GTN Details Data">
     
        <query>
            <![CDATA[
    SELECT
	ADJUSTMENT_TYPE,
	DEDUCTION_TYPE,
	GL_MONTH,
	GL_YEAR,
        GL_STRING,
	GL_COMPANY_ID,
	DIVISION,
        BUSINESS_UNIT_ID,
	COST_CENTER,
	ACCOUNT,
	BRAND_ID,
	PROJECT,
	FUTURE_1,
	FUTURE_2,
	ITEM_NO,
        DEDUCTION_AMOUNT,
	GL_COMPANY_NO,
	GL_COMPANY_NAME,
        BUSINESS_UNIT_NO,
        BUSINESS_UNIT_NAME,
        GL_DATE,
	CREATED_DATE,
	REDEMPTION_PERIOD,
	CONTRACT_ID,
	CONTRACT_NO,
	CONTRACT_NAME,
	COMPANY_ID,
	COMPANY_NO,
	COMPANY_NAME,
	ITEM_ID,
	ITEM_NAME,
	BRAND_NAME,
	DEDUCTION_ID,
	DEDUCTION_NO,
	DEDUCTION_NAME,
	DEDUCTION_CATEGORY,
        DEDUCTION_PROGRAM,
	DEDUCTION_INCLUSION,
	DEDUCTION_UDC_1,
	DEDUCTION_UDC_2,
	DEDUCTION_UDC_3,
	DEDUCTION_UDC_4,
	DEDUCTION_UDC_5,
	DEDUCTION_UDC_6,
        DEDUCTION_RATE,
	UDC_1,
	UDC_2,
	UDC_3,
	UDC_4,
	UDC_5,
	UDC_6,
	ACCOUNT_TYPE,
	ACCOUNT_CATEGORY,
	ADJUSTMENT_LEVEL,
	ACCOUNT_DESCRIPTION,
	ACCOUNT_INDICATOR,
	CALCULATION_PERIOD,
	WORKFLOW_ID,
	WORKFLOW_NAME,
	WORKFLOW_STATUS
    FROM
	@CONFIGTYPETEMPTABLE
        @PAGINATION
            ]]>  
        </query>
        
    </entity>
    <entity id="Adjustment GTN Details HelperInsert">
     
        <query>
            <![CDATA[
    IF Object_id('TEMPDB..#TEMP_HELPER') IS NOT NULL
  DROP TABLE #TEMP_HELPER

CREATE TABLE #TEMP_HELPER
  (
     HELPER_TABLE_SID INT,
     DESCRIPTION      VARCHAR(100),
     LIST_NAME        VARCHAR(100),
     PRIMARY KEY (HELPER_TABLE_SID)
  )

INSERT INTO #TEMP_HELPER
            (HELPER_TABLE_SID,
             DESCRIPTION,
             LIST_NAME)
SELECT HELPER_TABLE_SID,
       DESCRIPTION,
       LIST_NAME
FROM   HELPER_TABLE
WHERE  LIST_NAME IN ( 'RS_UDC1', 'RS_UDC2', 'RS_UDC3', 'RS_UDC4',
                      'RS_UDC5', 'RS_UDC6', 'LOCKED_STATUS', 'RS_CATEGORY', 'REBATE_PROGRAM_TYPE', 
					  'ARM_UDC_2','ARM_UDC_3','ARM_UDC_4','ARM_UDC_5','ARM_UDC_6','ARM_ACCOUNT_TYPE','ACCOUNT_CATEGORY',
					  'ARM_GTN_ADJUSTMENT_LEVEL','ACCOUNT_INDICTOR','WorkFlowStatus')

            ]]>  
        </query>
        
    </entity>
   
    <entity id="Adjustment GTN Details Trx6 query For data new">
     
        <query>
            <![CDATA[
  DECLARE
    @GL_COMP     INT = @GLCOMP,
   @PROJECTION_MASTER_SID INT = @PROJECTIONMASTER
   @SESSION_DECLARE  

IF EXISTS (SELECT 1 FROM @CONFIGTYPETEMPTABLE)
  BEGIN
 TRUNCATE TABLE @CONFIGTYPETEMPTABLE
  END


   IF OBJECT_ID ('TEMPDB..#TEMP_PROJ_GTN') IS NOT NULL
          DROP TABLE #TEMP_PROJ_GTN
  CREATE TABLE  #TEMP_PROJ_GTN
  (
     ARM_ADJUSTMENT_DETAILS_SID INT,
     CCP_DETAILS_SID INT,
     RS_MODEL_SID INT,
     PERIOD_DATE DATETIME,
     ACCOUNT VARCHAR(50),
     DEBIT NUMERIC(22, 6),
     CREDIT NUMERIC(22, 6),
     ACCRUAL_AMOUNT NUMERIC(22, 6),
     ACCRUAL_RATE NUMERIC(22, 6)
  )
  INSERT INTO #TEMP_PROJ_GTN
  (
     ARM_ADJUSTMENT_DETAILS_SID,
     CCP_DETAILS_SID,
     RS_MODEL_SID,
     PERIOD_DATE,
     ACCOUNT,
     DEBIT,
     CREDIT,
     ACCRUAL_AMOUNT,
     ACCRUAL_RATE
  )
  SELECT
  A.ARM_ADJUSTMENT_DETAILS_SID,
  A.CCP_DETAILS_SID,
  A.RS_MODEL_SID,
  P.PERIOD_DATE,
  ARC.ACCOUNT,
  ISNULL(SUM(AA.DEBIT),0) AS DEBIT,
  ISNULL(SUM(AA.CREDIT),0) AS CREDIT,
  ISNULL(SUM(AA.CREDIT),0) - ISNULL(SUM(AA.DEBIT),0) AS ACCRUAL_AMOUNT,
  SUM(C.INFLATION_FACTOR) AS RATE
  FROM ARM_ADJUSTMENT_DETAILS A
 JOIN @TABLE_1 B ON A.ARM_ADJUSTMENT_DETAILS_SID = B.ARM_ADJUSTMENT_DETAILS_SID
  JOIN ARM_ADJ_RES_CCP ARC ON ARC.ARM_ADJUSTMENT_DETAILS_SID=B.ARM_ADJUSTMENT_DETAILS_SID
 JOIN HELPER_TABLE HT ON HT.HELPER_TABLE_SID=ARC.ADJUSTMENT_LEVEL AND HT.DESCRIPTION='ITEM'
 JOIN PERIOD P ON P.PERIOD_SID=B.PERIOD_SID 
   JOIN CCP_DETAILS CD
  ON A.CCP_DETAILS_SID=CD.CCP_DETAILS_SID AND A.PROJECTION_MASTER_SID=@PROJECTION_MASTER_SID
 JOIN @TABLE_2 C ON C.PROJECTION_MASTER_SID=@PROJECTION_MASTER_SID
  AND CD.COMPANY_MASTER_SID=C.COMPANY_MASTER_SID AND CD.ITEM_MASTER_SID=C.ITEM_MASTER_SID
  AND B.PERIOD_SID=C.PERIOD_SID 
 LEFT JOIN @TABLE_3 AA ON AA.ARM_ADJUSTMENT_DETAILS_SID = B.ARM_ADJUSTMENT_DETAILS_SID
 AND ARC.ADJUSTMENT_TYPE=AA.ADJUSTMENT_TYPE
 AND ARC.ACCOUNT=AA.ACCOUNT AND B.PERIOD_SID= AA.PERIOD_SID
  WHERE A.PROJECTION_MASTER_SID = @PROJECTION_MASTER_SID
@SESSION_INCLUDE
    GROUP BY A.ARM_ADJUSTMENT_DETAILS_SID,
  A.CCP_DETAILS_SID,
  A.RS_MODEL_SID ,
  P.PERIOD_DATE,
  ARC.ACCOUNT

  IF OBJECT_ID
 (
    'TEMPDB..#TEMP_GTN'
 )
 IS NOT NULL DROP TABLE #TEMP_GTN
 CREATE TABLE #TEMP_GTN
 (
    ARM_ADJUSTMENT_DETAILS INT,
    CONTRACT_MASTER_SID INT,
    CONTRACT_ID VARCHAR(50),
    CONTRACT_NO VARCHAR(50),
    [CONTRACT_NAME] VARCHAR(100),
    COMPANY_MASTER_SID INT,
    COMPANY_ID VARCHAR(50),
    COMPANY_NO VARCHAR(50),
    COMPANY_NAME VARCHAR(100),
    ITEM_MASTER_SID INT,
    ITEM_ID VARCHAR(50),
    ITEM_NO VARCHAR(50),
    ITEM_NAME VARCHAR(100),
    BRAND_MASTER_SID INT,
    BRAND_ID VARCHAR(50),
    BRAND_NAME VARCHAR(100),
    RS_MODEL_SID INT,
    RS_CATEGORY INT,
    RS_TYPE INT,
    REBATE_PROGRAM_TYPE INT,
    DEDUCTION_INCLUSION INT,
    RS_ID VARCHAR(50),
    RS_NAME VARCHAR(100),
    RS_NO VARCHAR(50),
    RS_UDC_1 INT,
    RS_UDC_2 INT,
    RS_UDC_3 INT,
    RS_UDC_4 INT,
    RS_UDC_5 INT,
    RS_UDC_6 INT,
    PROJECTION_MASTER_SID INT,
    WORKFLOW_MASTER_SID INT NULL ,
    CREATED_DATE DATETIME,
     WORKFLOW_ID VARCHAR(50),
     WORKFLOW_NAME VARCHAR(500),
     WORKFLOW_STATUS INT
 )
 INSERT INTO #TEMP_GTN
 (
    ARM_ADJUSTMENT_DETAILS,
    CONTRACT_MASTER_SID,
    CONTRACT_ID,
    CONTRACT_NO,
    [CONTRACT_NAME],
    COMPANY_MASTER_SID,
    COMPANY_ID,
    COMPANY_NO,
    COMPANY_NAME,
    ITEM_MASTER_SID,
    ITEM_ID,
    ITEM_NO,
    ITEM_NAME,
    BRAND_MASTER_SID,
    BRAND_ID,
    BRAND_NAME,
    RS_MODEL_SID,
    RS_CATEGORY,
    RS_TYPE,
    REBATE_PROGRAM_TYPE,
    DEDUCTION_INCLUSION,
    RS_ID,
    RS_NO,
    RS_NAME,
    RS_UDC_1,
    RS_UDC_2,
    RS_UDC_3,
    RS_UDC_4,
    RS_UDC_5,
    RS_UDC_6,
    PROJECTION_MASTER_SID,
    WORKFLOW_MASTER_SID,
    CREATED_DATE,
     WORKFLOW_ID ,
     WORKFLOW_NAME ,
     WORKFLOW_STATUS
 )
 SELECT
 A.ARM_ADJUSTMENT_DETAILS_SID,
 C.CONTRACT_MASTER_SID,
 CON.CONTRACT_ID,
 CON.CONTRACT_NO,
 CON.[CONTRACT_NAME],
 C.COMPANY_MASTER_SID,
 CM.COMPANY_ID,
 CM.COMPANY_NO,
 CM.COMPANY_NAME,
 C.ITEM_MASTER_SID,
 IM.ITEM_ID,
 IM.ITEM_NO,
 IM.ITEM_NAME,
 BM.BRAND_MASTER_SID,
 BM.BRAND_ID,
 BM.BRAND_NAME,
 A.RS_MODEL_SID,
 RS_CATEGORY,
 RS_TYPE,
 REBATE_PROGRAM_TYPE,
 DEDUCTION_INCLUSION,
 R.RS_ID,
 R.RS_NO,
 R.RS_NAME,
 U.UDC1 AS RS_UDC_1,
 U.UDC2 AS RS_UDC_2,
 U.UDC3 AS RS_UDC_3,
 U.UDC4 AS RS_UDC_4,
 U.UDC5 AS RS_UDC_5,
 U.UDC6 AS RS_UDC_6,
 A.PROJECTION_MASTER_SID,
 WM.WORKFLOW_MASTER_SID,
 WM.CREATED_DATE,
 WM.WORKFLOW_ID,
 PM.PROJECTION_DESCRIPTION,
 WM.WORKFLOW_STATUS_ID
 FROM ARM_ADJUSTMENT_DETAILS A
 JOIN CCP_DETAILS C ON C.CCP_DETAILS_SID = A.CCP_DETAILS_SID AND  A.PROJECTION_MASTER_SID = @PROJECTION_MASTER_SID
 JOIN PROJECTION_MASTER PM ON PM.PROJECTION_MASTER_SID = A.PROJECTION_MASTER_SID AND PM.PROJECTION_MASTER_SID=@PROJECTION_MASTER_SID
 JOIN ITEM_MASTER IM ON IM.ITEM_MASTER_SID = C.ITEM_MASTER_SID
 JOIN COMPANY_MASTER CM ON CM.COMPANY_MASTER_SID=C.COMPANY_MASTER_SID
 JOIN CONTRACT_MASTER CON ON CON.CONTRACT_MASTER_SID=C.CONTRACT_MASTER_SID
 JOIN BRAND_MASTER BM ON BM.BRAND_MASTER_SID = IM.BRAND_MASTER_SID
 JOIN RS_CONTRACT R ON R.RS_MODEL_SID = A.RS_MODEL_SID
 AND R.CONTRACT_MASTER_SID=C.CONTRACT_MASTER_SID
 JOIN ARM_DEDUCTION_SELECTION ADS ON ADS.RS_CONTRACT_SID=R.RS_CONTRACT_SID
 AND ADS.PROJECTION_MASTER_SID = PM.PROJECTION_MASTER_SID
 AND ADS.PROJECTION_MASTER_SID = @PROJECTION_MASTER_SID
 LEFT JOIN WORKFLOW_MASTER WM ON WM.PROJECTION_MASTER_SID=A.PROJECTION_MASTER_SID AND WM.PROJECTION_MASTER_SID = @PROJECTION_MASTER_SID
 LEFT JOIN UDCS U ON U.MASTER_SID=R.RS_CONTRACT_SID
 AND U.MASTER_TYPE='RS_CONTRACT'
 WHERE A.PROJECTION_MASTER_SID = @PROJECTION_MASTER_SID

 INSERT INTO @CONFIGTYPETEMPTABLE (
 ADJUSTMENT_TYPE,
 DEDUCTION_TYPE,
 GL_MONTH,
 GL_YEAR,
 GL_STRING,
 GL_COMPANY_ID,
 DIVISION,
 BUSINESS_UNIT_ID,
 COST_CENTER,
 ACCOUNT,
 BRAND_ID,
 PROJECT,
 FUTURE_1,
 FUTURE_2,
 ITEM_NO,
 DEDUCTION_AMOUNT,
 GL_COMPANY_NO,
 GL_COMPANY_NAME,
 BUSINESS_UNIT_NO,
 BUSINESS_UNIT_NAME,
 GL_DATE,
 CREATED_DATE,
 REDEMPTION_PERIOD,
 CONTRACT_ID,
 CONTRACT_NO,
 CONTRACT_NAME,
 COMPANY_ID,
 COMPANY_NO,
 COMPANY_NAME,
 ITEM_ID,
 ITEM_NAME,
 BRAND_NAME,
 DEDUCTION_ID,
 DEDUCTION_NO,
 DEDUCTION_NAME,
 DEDUCTION_CATEGORY,
 DEDUCTION_PROGRAM,
 DEDUCTION_INCLUSION,
 DEDUCTION_UDC_1,
 DEDUCTION_UDC_2,
 DEDUCTION_UDC_3,
 DEDUCTION_UDC_4,
 DEDUCTION_UDC_5,
 DEDUCTION_UDC_6,
 DEDUCTION_RATE,
 UDC_1,
 UDC_2,
 UDC_3,
 UDC_4,
 UDC_5,
 UDC_6,
 ACCOUNT_TYPE,
 ACCOUNT_CATEGORY,
 ADJUSTMENT_LEVEL,
 ACCOUNT_DESCRIPTION,
 ACCOUNT_INDICATOR,
 CALCULATION_PERIOD,
 WORKFLOW_ID,
 WORKFLOW_NAME,
 WORKFLOW_STATUS)
                     SELECT       AC.TRANSACTION_NAME AS ADJUSTMENT_TYPE
         ,RTYPE.DESCRIPTION AS DEDUCTION_TYPE
         ,MONTH(GL_IMPACT_DATE) AS GL_MONTH
         ,YEAR(GL_IMPACT_DATE) AS GL_YEAR
         ,GL.COMPANY_ID+' - '+
      CASE WHEN
               (AAD.DIVISION='' OR AAd.DIVISION IS NULL) AND (AAD.COST_CENTER='' OR AAd.COST_CENTER IS NULL)
              THEN AAD.ACCOUNT+' - '+A.BRAND_ID+' - '+AAD.PROJECT+'- '+AAD.FUTURE_1+' - '+AAD.FUTURE_2
              WHEN (AAD.DIVISION='' OR AAd.DIVISION IS NULL) AND (AAD.COST_CENTER IS NOT NULL) THEN +AAD.COST_CENTER+' - '+AAD.ACCOUNT+' - '+A.BRAND_ID+' - '+AAD.PROJECT+'- '+AAD.FUTURE_1+' - '+AAD.FUTURE_2
              WHEN (AAD.DIVISION IS NOT NULL) AND (AAD.COST_CENTER='' OR AAd.COST_CENTER IS NULL) THEN AAD.DIVISION+' - '+AAD.ACCOUNT+' - '+A.BRAND_ID+' - '+AAD.PROJECT+'- '+AAD.FUTURE_1+' - '+AAD.FUTURE_2
              ELSE AAD.DIVISION+' - '+AAD.COST_CENTER+' - '+AAD.ACCOUNT+' - '+A.BRAND_ID+' - '+AAD.PROJECT+'- '+AAD.FUTURE_1+' - '+AAD.FUTURE_2
          END AS GLSTRING
         ,GL.COMPANY_ID AS GL_COMPANY_ID
         ,AAD.DIVISION       AS DIVISION
         ,BU.COMPANY_ID AS BU_COMPANY_ID
         ,AAD.COST_CENTER AS COST_CENTER
         ,AAD.ACCOUNT AS ACCOUNT
         ,A.BRAND_ID AS BRAND_ID
         ,AAD.PROJECT AS PROJECT
         ,AAD.FUTURE_1 AS FUTURE_1
         ,AAD.FUTURE_2 AS FUTURE_2
         ,A.ITEM_NO AS ITEM_NO
         ,CASE WHEN ISNULL(TP.DEBIT,0)-ISNULL(TP.CREDIT,0) > 0 THEN TP.DEBIT
               ELSE TP.CREDIT * -1 END  AS ACCRUAL_AMOUNT
         ,GL.COMPANY_NO AS GL_COMPANY_NO
         ,GL.COMPANY_NAME AS GL_COMPANY_NAME
         ,BU.COMPANY_NO AS BU_COMPANY_NO
         ,BU.COMPANY_NAME AS BU_COMPANY_NAME
         ,GL_IMPACT_DATE AS GLDATE
         ,A.CREATED_DATE AS CREATED_DATE
         ,CASE WHEN AC.REDEMPTION_PERIOD=1 THEN TP.PERIOD_DATE ELSE NULL END AS REDEMPTION_PERIOD
         ,A.CONTRACT_ID AS CONTRACT_ID
         ,A.CONTRACT_NO AS CONTRACT_NO
         ,A.CONTRACT_NAME AS CONTRACT_NAME
         ,A.COMPANY_ID AS COMPANY_ID
         ,A.COMPANY_NO AS COMPANY_NO
         ,A.COMPANY_NAME AS COMPANY_NAME
         ,A.ITEM_NO AS ITEM_ID
         ,A.ITEM_NAME AS ITEM_NAME
         ,A.BRAND_NAME AS BRAND_NAME
         ,A.RS_ID AS DEDUCTION_ID
         ,A.RS_NO AS DEDUCTION_NO
         ,A.RS_NAME AS DEDUCTION_NAME
         ,A.RS_CATEGORY AS DEDUCTION_CATEGORY
         ,A.REBATE_PROGRAM_TYPE AS REBATE_PROGRAM_TYPE
         ,A.DEDUCTION_INCLUSION AS DEDUCTION_INCLUSION
         ,A.RS_UDC_1 AS DEDUCTION_UDC_1
         ,A.RS_UDC_2 AS DEDUCTION_UDC_2
         ,A.RS_UDC_3 AS DEDUCTION_UDC_3
         ,A.RS_UDC_4 AS DEDUCTION_UDC_4
         ,A.RS_UDC_5 AS DEDUCTION_UDC_5
         ,A.RS_UDC_6 AS DEDUCTION_UDC_6
         ,TP.ACCRUAL_RATE AS RATE
         ,UDC1.DESCRIPTION AS UDC_1
         ,AAD.UDC_2 AS UDC_2
         ,AAD.UDC_3 AS UDC_3
         ,AAD.UDC_4 AS UDC_4
         ,AAD.UDC_5 AS UDC_5
         ,AAD.UDC_6 AS UDC_6
         ,AAD.ACCOUNT_TYPE AS ACCOUNT_TYPE
         ,AAD.ACCOUNT_CATEGORY AS ACCOUNT_CATEGORY
         ,AAD.ADJUSTMENT_LEVEL AS ADJUSTMENT_LEVEL
         ,AAD.ACCOUNT_DESC AS ACCOUNT_DESC
         ,AAD.ACCOUNT_INDICATOR AS ACCOUNT_INDICATOR
         ,TP.PERIOD_DATE AS CALCULATION_PERIOD
         ,A.WORKFLOW_ID
         ,A.WORKFLOW_NAME
         ,A.WORKFLOW_STATUS
                  FROM #TEMP_GTN A
        JOIN ARM_ADJUSTMENT_MASTER AM
          ON A.PROJECTION_MASTER_SID = AM.PROJECTION_MASTER_SID
             AND AM.PROJECTION_MASTER_SID = @PROJECTION_MASTER_SID
        JOIN ARM_ADJUSTMENT_CONFIG AC
          ON AM.TRANSACTION_TYPE = AC.ARM_ADJUSTMENT_CONFIG_SID
        JOIN ARM_ADJ_RES_CONFIG_MASTER AAM
          ON AAM.RS_CATEGORY = A.RS_CATEGORY
             AND AAM.RS_TYPE = A.RS_TYPE
             AND AAM.REBATE_PROGRAM_TYPE = A.REBATE_PROGRAM_TYPE
             AND AAM.GL_COMPANY_MASTER_SID = @GL_COMP
             AND AM.BU_COMPANY_MASTER_SID = AAM.BU_COMPANY_MASTER_SID
             AND AAM.CONFIGURATION_TYPE = 1
        JOIN ARM_ADJ_RES_CCP AAD
          ON AAD.ARM_ADJ_RES_CONFIG_MASTER_SID = AAM.ARM_ADJ_RES_CONFIG_MASTER_SID
             AND AC.ARM_ADJUSTMENT_CONFIG_SID = AAD.ADJUSTMENT_TYPE
             AND AAD.ARM_ADJUSTMENT_DETAILS_SID = A.ARM_ADJUSTMENT_DETAILS
        LEFT JOIN #TEMP_PROJ_GTN TP
               ON AAD.ARM_ADJUSTMENT_DETAILS_SID = TP.ARM_ADJUSTMENT_DETAILS_SID
                  AND AAD.ACCOUNT = TP.ACCOUNT
        JOIN COMPANY_MASTER GL
          ON GL.COMPANY_MASTER_SID = @GL_COMP
             AND AAM.GL_COMPANY_MASTER_SID = GL.COMPANY_MASTER_SID
        JOIN COMPANY_MASTER BU
          ON BU.COMPANY_MASTER_SID = AM.BU_COMPANY_MASTER_SID
 LEFT JOIN HELPER_TABLE UDC1 ON UDC1.HELPER_TABLE_SID=AAD.UDC_1
 LEFT JOIN HELPER_TABLE RTYPE ON RTYPE.HELPER_TABLE_SID=A.RS_TYPE
 WHERE
?AMOUNTCONDITION
 --TP.ACCRUAL_AMOUNT >0.01 AND
AAD.ADJUSTMENT_TYPE = @ADJUSTMENT_TYPE
@CATEGORY
@TYPE
@ACCOUNT                
            ]]>  
        </query>
    </entity>

</sql>