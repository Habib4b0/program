<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->


<sql>

    <entity id="getCountExclusionView">
        <query>
            <![CDATA[

                Select Count(DISTINCT AVM.ARM_VIEW_MASTER_SID) from ARM_View_Master AVM
        Join ARM_VIEW_DETAILS AVD ON AVD.ARM_VIEW_MASTER_SID=AVM.ARM_VIEW_MASTER_SID
        where AVM.VIEW_TYPE='Public' and VIEW_NAME like'@VIEW_NAME'

                    ]]>
        </query>
    </entity>
    <entity id="getExclusionData">
        <query>
            <![CDATA[
            Select DISTINCT AVM.ARM_VIEW_MASTER_SID as ID,AVM.VIEW_NAME AS VNAME,AVM.CREATED_BY AS CBY,AVM.CREATED_DATE AS CDAT from ARM_VIEW_MASTER AVM
            Join ARM_VIEW_DETAILS AVD ON AVD.ARM_VIEW_MASTER_SID=AVM.ARM_VIEW_MASTER_SID
            where AVM.VIEW_TYPE='Public' and AVM.VIEW_NAME like'@VIEW_NAME'

                    ]]>
        </query>
    </entity>
    <entity id="getExclusionCompanySid">
        <query>
            <![CDATA[
                Select Distinct CM.COMPANY_MASTER_SID from CUSTOMER_GTS_ACTUAL CGA
                JOIN dbo.COMPANY_MASTER CM ON CGA.ACCOUNT_ID=CM.COMPANY_ID
                where @FIELD_NAME IN(@FIELD_VALUE)

             ]]>
        </query>
    </entity>
    <entity id="getExclusionViewDetails">
        <query>
            <![CDATA[
               Select Distinct AVD.FIELD_NAME,AVD.Field_Values from  ARM_VIEW_DETAILS AVD
               where AVD.ARM_VIEW_MASTER_SID='@ARM_VIEW_MASTER_SID' ;

             ]]>
        </query>
    </entity>
    <entity id="saveORUpdateQuery">
        <query>
            <![CDATA[
            Delete from ARM_EXCLUSION_DETAIL where PROJECTION_MASTER_SID=@PROJECTION_MASTER_SID;
            Delete from ARM_PIPELINE_EXCLUSION_DETAILS where PROJECTION_MASTER_SID=@PROJECTION_MASTER_SID;
            Insert Into ARM_EXCLUSION_DETAIL  Values

             ]]>
        </query>
    </entity>
    <entity id="saveORUpdateQueryPipeline">
        <query>
            <![CDATA[
                  Insert INTO ARM_PIPELINE_EXCLUSION_DETAILS (PROJECTION_MASTER_SID,COMPANY_MASTER_SID)
                  Select DISTINCT  @PROJECTION_MASTER_SID As PROJECTION_MASTER_SID,CM.COMPANY_MASTER_SID
                  FROM  CUSTOMER_GTS_ACTUAL CGA
                  JOin dbo.COMPANY_MASTER CM ON CGA.ACCOUNT_ID = CM.COMPANY_ID
                 where CGA.CONTRACT_ID IN(@CONTRACT_ID) OR CM.COMPANY_NAME IN(@COMPANY_NAME) OR CM.COMPANY_ID IN (@COMPANY_ID)
             ]]>
        </query>
    </entity>
    <entity id="getIntialLoadQuery">
        <query>
            <![CDATA[
                  select  Distinct AED.FIELD_NAME,AED.FIELD_VALUES from ARM_EXCLUSION_DETAIL AED
                  where AED.PROJECTION_MASTER_SID=@PROJECTION_MASTER_SID;
             ]]>
        </query>
    </entity>
    <entity id="getIntialViewLoad">
        <query>
            <![CDATA[
                 Select VIEW_NAME from ARM_VIEW_MASTER where VIEW_NAME='@View_Name';
             ]]>
        </query>
    </entity>
    <entity id="deleteViewMasterQuery">
        <query>
            <![CDATA[
                Update ARM_ADJ_RATE_CONFIG_DETAIL set EXCLUSION_VIEW_MASTER = NULL where EXCLUSION_VIEW_MASTER=@ARM_VIEW_MASTER_SID;
                Delete ARM_VIEW_DETAILS where ARM_VIEW_MASTER_SID=@ARM_VIEW_MASTER_SID;
                Delete ARM_VIEW_MASTER where ARM_VIEW_MASTER_SID=@ARM_VIEW_MASTER_SID;               
               
             ]]>    
        </query>
    </entity>
    
    <entity id="deleteViewMasterQueryForInventory">
        <query> 
            <![CDATA[               
                Delete ARM_VIEW_DETAILS where ARM_VIEW_MASTER_SID=@ARM_VIEW_MASTER_SID;
                 Delete ARM_VIEW_MASTER where ARM_VIEW_MASTER_SID=@ARM_VIEW_MASTER_SID;
             ]]>    
        </query>
    </entity>
       
    <entity id="insertSaveViewQuery">
        <query>
            <![CDATA[
                Insert into ARM_VIEW_MASTER Values('@View_Name','@View_Type','@Created_By','@Created_Date',null,null);
                SELECT SCOPE_IDENTITY();
             ]]>
        </query>
    </entity>
    <entity id="updateMasterViewQuery">
        <query>
            <![CDATA[
                 Delete ARM_VIEW_DETAILS where ARM_VIEW_MASTER_SID=@ARM_VIEW_MASTER_SID;
                 Update  ARM_VIEW_MASTER set MODIFIED_BY='@MODIFIED_BY',MODIFIED_DATE ='@MODIFIED_DATE' where ARM_VIEW_MASTER_SID=@ARM_VIEW_MASTER_SID;
             ]]>
        </query>
    </entity>
    <entity id="insertViewDetailsQuery">
        <query>
            <![CDATA[
                Insert into ARM_VIEW_DETAILS (ARM_VIEW_MASTER_SID,COMPANY_MASTER_SID,COMPANY_GROUP_SID,CHECK_RECORD,INDICATOR,FIELD_NAME,FIELD_VALUES) Values
             ]]>
        </query>
    </entity>
    <entity id="loadCustomerGroupDetailsQuery">
        <query>
            <![CDATA[
            SELECT
CG.COMPANY_GROUP_SID,
CG.COMPANY_GROUP_NAME,
ARID."INDICATOR",
ARID.CHECK_RECORD
FROM
ST_ARM_TR_INVENTORY_DETAILS ARID
JOIN dbo.COMPANY_GROUP CG  ON CG.COMPANY_GROUP_SID = ARID.COMPANY_GROUP_SID
WHERE
ARID.COMPANY_GROUP_SID IS NOT NULL
AND ARID.CHECK_RECORD IS NOT NULL
AND ARID.PROJECTION_MASTER_SID =@PROJECTION_MASTER_SID
AND ARID.USER_ID =@USER_ID
AND ARID.SESSION_ID =@SESSION_ID;

             ]]>
        </query>
    </entity>
    <entity id="loadViewCustomerGroupDetails">
        <query>
            <![CDATA[
           select Distinct CG.COMPANY_GROUP_SID,CG.COMPANY_GROUP_NAME,AVM."INDICATOR",AVM.CHECK_RECORD from ARM_VIEW_DETAILS  AVM 
          JOIN dbo.COMPANY_GROUP CG ON CG.COMPANY_GROUP_SID=AVM.COMPANY_GROUP_SID
          where AVM.ARM_VIEW_MASTER_SID=@ARM_VIEW_MASTER_SID;
             ]]>
        </query>
    </entity>
    <entity id="loadCustomerDetailsQuery">
        <query>
            <![CDATA[
                SELECT
    CM.COMPANY_MASTER_SID,
    CM.COMPANY_NAME,
    AVD."INDICATOR",
    AVD.CHECK_RECORD
FROM ARM_VIEW_DETAILS AVD
JOIN COMPANY_MASTER CM  ON CM.COMPANY_MASTER_SID = AVD.COMPANY_MASTER_SID
WHERE
    AVD.COMPANY_MASTER_SID IS NOT NULL
    AND AVD.CHECK_RECORD IS NOT NULL
    AND AVD.ARM_VIEW_MASTER_SID = @ARM_VIEW_MASTER_SID;
             ]]>
        </query>
    </entity>

    <entity id="saveORUpdateQueryEdit">
        <query>
            <![CDATA[
            Delete from ARM_EXCLUSION_DETAIL where PROJECTION_MASTER_SID=@PROJECTION_MASTER_SID;
            
            Insert Into ARM_EXCLUSION_DETAIL  Values

             ]]>
        </query>
    </entity>

    <entity id="saveORUpdateQueryPipelineEdit">
        <query>
            <![CDATA[
                  Insert INTO [TABLE] (PROJECTION_MASTER_SID,COMPANY_MASTER_SID)
                  Select DISTINCT  @PROJECTION_MASTER_SID As PROJECTION_MASTER_SID,CM.COMPANY_MASTER_SID  
                  
                  FROM  CUSTOMER_GTS_ACTUAL CGA
                  JOin dbo.COMPANY_MASTER CM ON CGA.ACCOUNT_ID = CM.COMPANY_ID
                 where CGA.CONTRACT_ID IN(@CONTRACT_ID) OR CM.COMPANY_NAME IN(@COMPANY_NAME) OR CM.COMPANY_ID IN (@COMPANY_ID)
             ]]>
        </query>
    </entity>
    <entity id="getIntialInsertQueryFromARC">
        <query>
            <![CDATA[
                  SELECT AVD.FIELD_NAME,AVD.FIELD_VALUES FROM ARM_VIEW_DETAILS AVD WHERE ARM_VIEW_MASTER_SID in (
                    SELECT EXCLUSION_VIEW_MASTER FROM ARM_ADJ_RATE_CONFIG_DETAIL WHERE ARM_ADJ_RATE_CONFIG_MASTER_SID in 
                    (SELECT ARM_ADJ_RATE_CONFIG_MASTER_SID FROM ARM_ADJ_RATE_CONFIG_MASTER WHERE GL_COMPANY_MASTER_SID = ? and BU_COMPANY_MASTER_SID = ? and ADJUSTMENT_TYPE = '?') and "MONTH" = ?);
             ]]>
        </query>
    </entity>
    <entity id="getViewName">
        <query>
            <![CDATA[
                  SELECT AVM.VIEW_NAME, AVM.VIEW_TYPE,AVM.ARM_VIEW_MASTER_SID FROM ARM_VIEW_MASTER AVM WHERE ARM_VIEW_MASTER_SID in (
                    SELECT EXCLUSION_VIEW_MASTER FROM ARM_ADJ_RATE_CONFIG_DETAIL WHERE ARM_ADJ_RATE_CONFIG_MASTER_SID in 
                    (SELECT ARM_ADJ_RATE_CONFIG_MASTER_SID FROM ARM_ADJ_RATE_CONFIG_MASTER WHERE GL_COMPANY_MASTER_SID = ? and BU_COMPANY_MASTER_SID = ? and ADJUSTMENT_TYPE = '?') and "MONTH" = ?);
             ]]>
        </query>
    </entity>
    
    <entity id="LoadViewQuery">
        <query>
            <![CDATA[
            
            SELECT EXCLUSION_VIEW_MASTER FROM ARM_ADJ_RATE_CONFIG_DETAIL  AD  JOIN ARM_ADJ_RATE_CONFIG_MASTER AM
            ON AD.ARM_ADJ_RATE_CONFIG_MASTER_SID=AM.ARM_ADJ_RATE_CONFIG_MASTER_SID
            WHERE AM.ADJUSTMENT_TYPE = '@ADJUSTMENT_TYPE' AND AM.GL_COMPANY_MASTER_SID = @GL_COMPANY_MASTER_SID AND AM.BU_COMPANY_MASTER_SID = @BU_COMPANY_MASTER_SID AND AD."MONTH" = month(getDate());

             ]]>
        </query>
    </entity>
    
    <entity id="LoadViewNameQuery">
        <query>
            <![CDATA[
            
            select Distinct AVM.ARM_VIEW_MASTER_SID,AVM.VIEW_NAME,AVM.VIEW_TYPE from ARM_VIEW_MASTER AVM
            Join ARM_VIEW_DETAILS AVD ON AVD.ARM_VIEW_MASTER_SID=AVM.ARM_VIEW_MASTER_SID
            where AVD.ARM_VIEW_MASTER_SID = @VIEWID;
             ]]>
        </query>
    </entity>
    
    
</sql>
