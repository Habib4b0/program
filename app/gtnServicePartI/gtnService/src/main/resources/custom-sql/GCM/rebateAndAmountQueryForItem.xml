<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->

<custom-sql>
    <sql id="rebateCountForItem">
        <![CDATA[
            SELECT count(distinct RSC.REBATE_PROGRAM_TYPE) FROM   PROJECTION_DETAILS PD
            JOIN CCP_DETAILS CCPD ON CCPD.CCP_DETAILS_SID = PD.CCP_DETAILS_SID AND CCPD.ITEM_MASTER_SID in (select distinct IMTD.ITEM_MASTER_SID from  
            GCM_GLOBAL_DETAILS IMTD WHERE CHECK_RECORD='1' AND MODULE_NAME = 'ITEM_MANAGEMENT' AND SESSION_ID = '?' AND "OPERATION" = '?')  AND CCPD.CONTRACT_MASTER_SID = '?'
            JOIN ITEM_MASTER IM ON IM.ITEM_MASTER_SID = CCPD.ITEM_MASTER_SID AND IM.BRAND_MASTER_SID = '?'
            JOIN RS_CONTRACT RSC ON RSC.CONTRACT_MASTER_SID = CCPD.CONTRACT_MASTER_SID
            JOIN UDCS UDC ON UDC.MASTER_SID=RSC.RS_MODEL_SID
           LEFT JOIN HELPER_TABLE HT ON HT.HELPER_TABLE_SID = UDC.UDC2 AND UDC.MASTER_TYPE = 'RS_MODEL'AND HT.LIST_NAME = 'RS_UDC2' 
            WHERE  PD.PROJECTION_MASTER_SID = '?';
        ]]>
    </sql>
    <sql id="itemCountForRebateForItem">
        <![CDATA[
            SELECT count(distinct IM.ITEM_NAME) FROM   PROJECTION_DETAILS PD
            JOIN CCP_DETAILS CCPD ON CCPD.CCP_DETAILS_SID = PD.CCP_DETAILS_SID AND CCPD.ITEM_MASTER_SID in (select distinct IMTD.ITEM_MASTER_SID from  
            GCM_GLOBAL_DETAILS IMTD WHERE CHECK_RECORD='1' AND MODULE_NAME = 'ITEM_MANAGEMENT' AND SESSION_ID = '?' AND "OPERATION" = '?')  AND CCPD.CONTRACT_MASTER_SID = '?'
            JOIN ITEM_MASTER IM ON IM.ITEM_MASTER_SID = CCPD.ITEM_MASTER_SID AND IM.BRAND_MASTER_SID = '?'
            JOIN RS_CONTRACT RSC ON RSC.CONTRACT_MASTER_SID = CCPD.CONTRACT_MASTER_SID AND RSC.REBATE_PROGRAM_TYPE = '?'
            JOIN UDCS UDC ON UDC.MASTER_SID=RSC.RS_MODEL_SID
           LEFT JOIN HELPER_TABLE HT ON HT.HELPER_TABLE_SID = UDC.UDC2 AND UDC.MASTER_TYPE = 'RS_MODEL'AND HT.LIST_NAME = 'RS_UDC2' 
            WHERE  PD.PROJECTION_MASTER_SID = '?';
        ]]>
    </sql>
    <sql id="getContractForRebateForItem">
        <![CDATA[
            select CON.CONTRACT_MASTER_SID as ID,CON.CONTRACT_NAME as COM_NAME ,I."YEAR" as YEARS, I.? as PERIODS,
            sum(NMDP.?) as Amount,sum(NMDP.?) as Rate, CON.CONTRACT_NO  from  PROJECTION_DETAILS PD 
            join CCP_DETAILS CCPD ON CCPD.CCP_DETAILS_SID=PD.CCP_DETAILS_SID AND CCPD.ITEM_MASTER_SID in (select distinct IMTD.ITEM_MASTER_SID from  
            GCM_GLOBAL_DETAILS IMTD WHERE CHECK_RECORD='1' AND MODULE_NAME = 'ITEM_MANAGEMENT' AND SESSION_ID = '?' AND "OPERATION" = '?')  
             join CONTRACT_MASTER CON ON CON.CONTRACT_MASTER_SID=CCPD.CONTRACT_MASTER_SID 
            join ? NMDP  
            ON  NMDP.PROJECTION_DETAILS_SID=PD.PROJECTION_DETAILS_SID 
            join "PERIOD" I on I.PERIOD_SID = NMDP.PERIOD_SID WHERE PD.PROJECTION_MASTER_SID= '?'  
            group by CON.CONTRACT_MASTER_SID,CON.CONTRACT_NAME,I."YEAR", I.?,CON.CONTRACT_NO;
        ]]>
    </sql>
    <sql id="getCompanyForRebateForItem">
        <![CDATA[
            select COM.COMPANY_MASTER_SID as ID,
            COM.COMPANY_NAME as COM_NAME,I."YEAR" as YEARS, I.? as PERIODS,
            sum(NMDP.?) as Amount,sum(NMDP.?) as Rate, CCPD.CONTRACT_MASTER_SID,  
            COM.COMPANY_NO AS companyNo from  PROJECTION_DETAILS PD 
            join CCP_DETAILS CCPD ON CCPD.CCP_DETAILS_SID=PD.CCP_DETAILS_SID AND CCPD.ITEM_MASTER_SID in (select distinct IMTD.ITEM_MASTER_SID from  
            GCM_GLOBAL_DETAILS IMTD WHERE CHECK_RECORD='1' AND MODULE_NAME = 'ITEM_MANAGEMENT' AND SESSION_ID = '?' AND "OPERATION" = '?')  
            AND CCPD.CONTRACT_MASTER_SID='?' 
            join COMPANY_MASTER COM ON COM.COMPANY_MASTER_SID=CCPD.COMPANY_MASTER_SID
             join ? NMDP 
            ON  NMDP.PROJECTION_DETAILS_SID=PD.PROJECTION_DETAILS_SID 
            join "PERIOD" I on I.PERIOD_SID = NMDP.PERIOD_SID WHERE PD.PROJECTION_MASTER_SID= '?'  
            group by CCPD.CONTRACT_MASTER_SID, I."YEAR", I.?, COM.COMPANY_MASTER_SID, COM.COMPANY_NAME, COM.COMPANY_NO order by COM.COMPANY_MASTER_SID;
        ]]>
    </sql>
    <sql id="getBrandForRebateForItem">
        <![CDATA[
            select BM.BRAND_MASTER_SID as ID,BM.BRAND_NAME as COM_NAME,I."YEAR" as YEARS, I.? as PERIODS,
            sum(NMDP.?) as Sales,sum(NMDP.?) as Rate, CCPD.CONTRACT_MASTER_SID, CCPD.COMPANY_MASTER_SID, BM.BRAND_ID  from  PROJECTION_DETAILS PD 
            join CCP_DETAILS CCPD ON CCPD.CCP_DETAILS_SID=PD.CCP_DETAILS_SID AND CCPD.ITEM_MASTER_SID in (select distinct IMTD.ITEM_MASTER_SID from  
            GCM_GLOBAL_DETAILS IMTD WHERE CHECK_RECORD='1' AND MODULE_NAME = 'ITEM_MANAGEMENT' AND SESSION_ID = '?' AND "OPERATION" = '?')  
            AND CCPD.CONTRACT_MASTER_SID='?' 
            join ITEM_MASTER IM ON IM.ITEM_MASTER_SID=CCPD.ITEM_MASTER_SID 
            join BRAND_MASTER BM ON IM.BRAND_MASTER_SID=BM.BRAND_MASTER_SID 
             join ? NMDP 
            ON  NMDP.PROJECTION_DETAILS_SID=PD.PROJECTION_DETAILS_SID 
            join "PERIOD" I on I.PERIOD_SID = NMDP.PERIOD_SID WHERE PD.PROJECTION_MASTER_SID= '?'  
            group by CCPD.CONTRACT_MASTER_SID, CCPD.COMPANY_MASTER_SID,BM.BRAND_MASTER_SID, BM.BRAND_NAME,I."YEAR", I.?,BM.BRAND_ID order by BM.BRAND_MASTER_SID;
        ]]>
    </sql>
    <sql id="getRebateForItem">
        <![CDATA[
            SELECT RSC.REBATE_PROGRAM_TYPE    AS ID,
       RSC.RS_NAME            AS COM_NAME,
       I."YEAR"                   AS YEARS,
       I.?                  AS PERIODS,
       Sum(NMDP.?) AS Amount,
       Sum(NMDP.?) AS Rate,
       CCPD.CONTRACT_MASTER_SID,
       CCPD.COMPANY_MASTER_SID,
       IM.BRAND_MASTER_SID,
       RSC.RS_NO
FROM   PROJECTION_DETAILS PD
       JOIN CCP_DETAILS CCPD
         ON CCPD.CCP_DETAILS_SID = PD.CCP_DETAILS_SID
            AND CCPD.ITEM_MASTER_SID in (select distinct IMTD.ITEM_MASTER_SID from  
            GCM_GLOBAL_DETAILS IMTD WHERE CHECK_RECORD='1' AND MODULE_NAME = 'ITEM_MANAGEMENT' AND SESSION_ID = '?' AND "OPERATION" = '?') 
            AND CCPD.CONTRACT_MASTER_SID = '?'
       JOIN ITEM_MASTER IM
         ON IM.ITEM_MASTER_SID = CCPD.ITEM_MASTER_SID
            AND IM.BRAND_MASTER_SID = '?'
       JOIN RS_CONTRACT RSC
         ON RSC.CONTRACT_MASTER_SID = CCPD.CONTRACT_MASTER_SID
      JOIN UDCS UDC
	  ON UDC.MASTER_SID=RSC.RS_MODEL_SID
	LEFT   JOIN HELPER_TABLE HT
         ON HT.HELPER_TABLE_SID = UDC.UDC2
		 AND UDC.MASTER_TYPE = 'RS_MODEL'AND HT.LIST_NAME = 'RS_UDC2' 
       JOIN ? NMDP
         ON NMDP.PROJECTION_DETAILS_SID = PD.PROJECTION_DETAILS_SID
       JOIN "PERIOD" I
         ON I.PERIOD_SID = NMDP.PERIOD_SID
WHERE  PD.PROJECTION_MASTER_SID = '?'
GROUP  BY RSC.REBATE_PROGRAM_TYPE,
CCPD.CONTRACT_MASTER_SID,
       CCPD.COMPANY_MASTER_SID,
       IM.BRAND_MASTER_SID,
          RSC.RS_NAME,
          I."YEAR",
          I.?,RSC.RS_NO ORDER  BY RSC.REBATE_PROGRAM_TYPE;
        ]]>
    </sql>
    <sql id="getItemForRebateForItem">
        <![CDATA[
            SELECT IMTD.ITEM_MASTER_SID    AS ID,
       IM.ITEM_NAME             AS COM_NAME,
       I."YEAR"                   AS YEARS,
       I.?                  AS PERIODS,
       Sum(NMDP.?) AS Amount,
       Sum(NMDP.?) AS Rate,
       IM.ITEM_NO 
FROM   PROJECTION_DETAILS PD
       JOIN CCP_DETAILS CCPD
         ON CCPD.CCP_DETAILS_SID = PD.CCP_DETAILS_SID
            AND CCPD.COMPANY_MASTER_SID = '?'  
            AND CCPD.CONTRACT_MASTER_SID = '?'
             JOIN GCM_GLOBAL_DETAILS IMTD ON CHECK_RECORD='1' AND MODULE_NAME = 'ITEM_MANAGEMENT' AND SESSION_ID = '?' AND "OPERATION" = '?'
       JOIN ITEM_MASTER IM
       ON IM.ITEM_MASTER_SID=IMTD.ITEM_MASTER_SID
         AND IM.BRAND_MASTER_SID = '?'
       JOIN RS_CONTRACT RSC
         ON RSC.CONTRACT_MASTER_SID = CCPD.CONTRACT_MASTER_SID AND RSC.REBATE_PROGRAM_TYPE = '?'
      JOIN UDCS UDC
	  ON UDC.MASTER_SID=RSC.RS_MODEL_SID
	 LEFT  JOIN HELPER_TABLE HT
         ON HT.HELPER_TABLE_SID = UDC.UDC2
		 AND UDC.MASTER_TYPE = 'RS_MODEL'AND HT.LIST_NAME = 'RS_UDC2' 
       JOIN ? NMDP
         ON NMDP.PROJECTION_DETAILS_SID = PD.PROJECTION_DETAILS_SID
       JOIN "PERIOD" I
         ON I.PERIOD_SID = NMDP.PERIOD_SID
WHERE  PD.PROJECTION_MASTER_SID = '?'
GROUP  BY IMTD.ITEM_MASTER_SID,
          IM.ITEM_NAME,
          I."YEAR",
          I.?,IM.ITEM_NO ORDER  BY IMTD.ITEM_MASTER_SID;
        ]]>
    </sql>
</custom-sql>
