<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<sql>
<entity id="contractPriceDetails">
<query> <![CDATA[
		
			
SELECT
PS.PS_CONTRACT_SID,
PS.ITEM_MASTER_SID,
PS.CONTRACT_PRICE,
PS.CONTRACT_PRICE_START_DATE ,
PS.CONTRACT_PRICE_END_DATE ,
IFP.ITEM_START_DATE ,
IFP.ITEM_END_DATE ,
IM.ITEM_STATUS,
IM.ITEM_NO  ,
IM.ITEM_NAME,
IM.PACKAGE_SIZE ,
PS.PRICE_PROTECTION_START_DATE ,
PS.PRICE_PROTECTION_END_DATE ,
PS.PRICE_TOLERANCE_TYPE,
PS.PRICE_TOLERANCE,
PS.BASE_PRICE,
PS.PRICE_TOLERANCE_FREQUENCY,
PS.PRICE_TOLERANCE_INTERVAL,
PS.ITEM_PRICING_QUALIFIER_SID,
PS.PRICE,
IM.PRIMARY_UOM,
IM.SECONDARY_UOM,
PS.PS_CONTRACT_DETAILS_SID,
IFP.IFP_CONTRACT_DETAILS_SID,
IM.ITEM_ID

FROM PS_CONTRACT_DETAILS PS,
PS_CONTRACT PSC, 
IFP_CONTRACT IFPC,
IFP_CONTRACT_DETAILS IFP, 
ITEM_MASTER IM  
WHERE 
PSc.IFP_CONTRACT_SID = IFPc.IFP_CONTRACT_SID 
 AND (PSC.CFP_CONTRACT_SID = IFPC.CFP_CONTRACT_SID or 
IFPC.CFP_CONTRACT_SID is null or PSC.CFP_CONTRACT_SID  is null) 
AND PSC.CONTRACT_MASTER_SID = IFPC.CONTRACT_MASTER_SID AND PS.ITEM_MASTER_SID = IFP.ITEM_MASTER_SID 
AND PS.ITEM_MASTER_SID=IM.ITEM_MASTER_SID AND IFP.ITEM_MASTER_SID= IM.ITEM_MASTER_SID    
AND PSC.PS_CONTRACT_SID=PS.PS_CONTRACT_SID AND IFPC.IFP_CONTRACT_SID= IFP.IFP_CONTRACT_SID   
		
	]]> </query>
</entity>
<entity id="contractPriceProtectionDetails">
<query> <![CDATA[
    
        SELECT
        PS.PS_CONTRACT_SID,
        PS.ITEM_MASTER_SID,
        IM.ITEM_ID,       
        IM.ITEM_NO  ,
        IM.ITEM_NAME,
        IM.BRAND_MASTER_SID,
        PS.PRICE_PROTECTION_STATUS,
        PS.PRICE_PROTECTION_START_DATE ,
        PS.PRICE_PROTECTION_END_DATE ,
        PS.NEP,
        PS.NEP_FORMULA,
        PS.BASE_PRICE_TYPE,
        PS.BASE_PRICE_ENTRY,
        PS.BASE_PRICE_DDLB,
        PS.BASE_PRICE_DATE,
        PS.BASE_PRICE,
        PS.NET_BASE_PRICE,
        PS.NET_PRICE_TYPE_FORMULA,
        PS.SUBSEQUENT_PERIOD_PRICE_TYPE,
        PS.NET_SUBSEQUENT_PERIOD_PRICE,
        PS.NET_SUBSEQUENT_PRICE_FORMULA_ID,
        PS.PRICE_TOLERANCE_INTERVAL,
        PS.PRICE_TOLERANCE_FREQUENCY,
        PS.PRICE_TOLERANCE_TYPE,
        PS.PRICE_TOLERANCE,
        PS.MAX_INCREMENTAL_CHANGE,
        PS.RESET_ELIGIBLE,
        PS.RESET_TYPE,
        PS.RESET_DATE,
        PS.RESET_INTERVAL,
        PS.RESET_FREQUENCY,
        PS.RESET_PRICE_TYPE,
        PS.NET_RESET_PRICE_TYPE,
        PS.NET_RESET_PRICE_FORMULA_ID,
        PS.NET_PRICE_TYPE,
        PS.NET_PRICE_TYPE_FORMULA,
        PS.PS_CONTRACT_DETAILS_SID,
        IFP.IFP_CONTRACT_DETAILS_SID,
        PS.PRICE_PROTECTION_PRICE_TYPE,
        BM.BRAND_NAME
        FROM PS_CONTRACT_DETAILS PS,
        PS_CONTRACT PSC, 
        IFP_CONTRACT IFPC,
        IFP_CONTRACT_DETAILS IFP, 
        ITEM_MASTER IM  
        JOIN dbo.BRAND_MASTER BM on IM.BRAND_MASTER_SID = BM.BRAND_MASTER_SID
        WHERE 
        PSc.IFP_CONTRACT_SID = IFPc.IFP_CONTRACT_SID 
        AND (PSC.CFP_CONTRACT_SID = IFPC.CFP_CONTRACT_SID or 
        IFPC.CFP_CONTRACT_SID is null or PSC.CFP_CONTRACT_SID  is null) 
        AND PSC.CONTRACT_MASTER_SID = IFPC.CONTRACT_MASTER_SID AND PS.ITEM_MASTER_SID = IFP.ITEM_MASTER_SID 
        AND PS.ITEM_MASTER_SID=IM.ITEM_MASTER_SID AND IFP.ITEM_MASTER_SID= IM.ITEM_MASTER_SID    
        AND PSC.PS_CONTRACT_SID=PS.PS_CONTRACT_SID AND IFPC.IFP_CONTRACT_SID= IFP.IFP_CONTRACT_SID  
    
]]> </query>
</entity>
<entity id="validateCCPActuals">
<query> <![CDATA[
    
;WITH CTE
     AS (SELECT ICD.ITEM_MASTER_SID,
                IC.CONTRACT_MASTER_SID,
                CCD.COMPANY_MASTER_SID
         FROM   IFP_CONTRACT_DETAILS ICD
                INNER JOIN IFP_CONTRACT IC
                        ON ICD.IFP_CONTRACT_SID = IC.IFP_CONTRACT_SID
                INNER JOIN CFP_CONTRACT CC
                        ON CC.CFP_CONTRACT_SID = IC.CFP_CONTRACT_SID
                INNER JOIN CFP_CONTRACT_DETAILS CCD
                        ON CCD.CFP_CONTRACT_SID = CC.CFP_CONTRACT_SID
         WHERE  ICD.ITEM_MASTER_SID = @ITEMSID
                AND IC.CFP_CONTRACT_SID = @CFPSID
                AND IC.IFP_CONTRACT_SID = @IFPSID
                AND IC.CONTRACT_MASTER_SID = @CONSID )
SELECT Count(1)
FROM   ACTUALS_MASTER A
WHERE  EXISTS (SELECT 1
               FROM   CTE C
               WHERE  A.COMPANY_MASTER_SID = C.COMPANY_MASTER_SID
                      AND A.ITEM_MASTER_SID = C.ITEM_MASTER_SID
                      AND A.CONTRACT_MASTER_SID = C.CONTRACT_MASTER_SID) 
                       
]]> </query>
</entity>
</sql>
