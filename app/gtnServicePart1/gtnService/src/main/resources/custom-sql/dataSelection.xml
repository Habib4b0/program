<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<custom-sql>
    <sql id="getRelationForCCP1">
		<![CDATA[
			select HLD.levelNo, HLD.tableName, HLD.fieldName,
                        HLD.levelValueReference, RLD.relationshipLevelValues, RLD.parentNode,
                        RLD.levelName from HierarchyLevelDefinition HLD, RelationshipLevelDefinition RLD
                        WHERE RLD.levelNo = HLD.levelNo 
                        and HLD.hierarchyLevelDefinitionSid in 
                        (select distinct INR.hierarchyLevelDefinitionSid FROM RelationshipLevelDefinition INR
                        WHERE INR.relationshipLevelSid in (select distinct PH.relationshipLevelSid 
                        from 
		]]>
    </sql>
    <sql id="getRelationForCCP2">
		<![CDATA[
			) ) 
                        and  RLD.relationshipLevelSid 
                        in (select DISTINCT PHT.relationshipLevelSid from 
		]]>
    </sql>
    <sql id="getRelationForCCP3">
		<![CDATA[
			) 
                        and HLD.levelValueReference='Linked'
		]]>
    </sql>
        
    <sql id="getLevelsFromHierarchy">
		<![CDATA[
                select distinct RLD.LEVEL_NAME, RLD.LEVEL_NO, HLD.LEVEL_VALUE_REFERENCE, HLD."TABLE_NAME", HLD.FIELD_NAME  
                from RELATIONSHIP_LEVEL_DEFINITION RLD, RELATIONSHIP_BUILDER RB, HIERARCHY_LEVEL_DEFINITION HLD
                where RLD.RELATIONSHIP_BUILDER_SID in (select RBT.RELATIONSHIP_BUILDER_SID from RELATIONSHIP_BUILDER RBT where RBT.HIERARCHY_DEFINITION_SID = '
		]]>
    </sql>

    <sql id="getRbIdFromHier">
		<![CDATA[
                    select distinct RB.RELATIONSHIP_BUILDER_SID from RELATIONSHIP_BUILDER RB where RB.HIERARCHY_DEFINITION_SID = '?' 
		]]>
    </sql>
    <sql id="getLevelsFromHierarchy2">
		<![CDATA[
                ')
                and RLD.HIERARCHY_LEVEL_DEFINITION_SID = HLD.HIERARCHY_LEVEL_DEFINITION_SID order by RLD.LEVEL_NO asc;
		]]>
    </sql>
    
    <sql id="getCustomerGroup">
		<![CDATA[
                    select distinct CG.companyGroupSid, CG.companyGroupNo, CG.companyGroupName, CG.versionNo
                    FROM CompanyGroup CG, CompanyGroupDetails CGD
                    WHERE  CG.companyGroupSid = CGD.companyGroupSid 
		]]>
    </sql>
    <sql id="getProductGroup">
		<![CDATA[
                    select distinct IG.itemGroupSid, IG.itemGroupNo, IG.itemGroupName, CM.companyName, IG.versionNo
                    FROM ItemGroup IG, CompanyMaster CM, ItemGroupDetails IGD
                    WHERE IG.companyMasterSid = CM.companyMasterSid
                    AND IGD.itemGroupSid = IG.itemGroupSid 
		]]>
    </sql>
    
    <sql id="searchProjectionCount">
		<![CDATA[
                    SELECT count (DISTINCT PM.PROJECTION_MASTER_SID) projectionId
                     From PROJECTION_MASTER PM 
                  
                    JOIN HIERARCHY_DEFINITION HDC
                    ON HDC.HIERARCHY_DEFINITION_SID = PM.CUSTOMER_HIERARCHY_SID 

                    JOIN HIERARCHY_DEFINITION HDP
                    ON HDP.HIERARCHY_DEFINITION_SID = PM.PRODUCT_HIERARCHY_SID 

                    LEFT JOIN COMPANY_GROUP CG
                    ON CG.COMPANY_GROUP_SID  = PM.COMPANY_GROUP_SID 

                    LEFT JOIN ITEM_GROUP IG 
                    ON IG.ITEM_GROUP_SID = PM.ITEM_GROUP_SID   @ACCRUALPROJJOIN
                    
                    JOINPROJECTIONCUSTHIERARCHY
                    
                    JOINPROJECTIONPRODHIERARCHY
                    
                    JOIN COMPANY_MASTER CM1
                     on PM.BUSINESS_UNIT = CM1.COMPANY_MASTER_SID 
                    JOIN COMPANY_MASTER CM 
                        on PM.COMPANY_MASTER_SID = CM.COMPANY_MASTER_SID 
                    
                    WHERE  PM.IS_APPROVED not in ('Y','A','C') AND PM.SAVE_FLAG = 'true'    @WHEREFILTERVALUE

		]]>
    </sql>
    
    <sql id="searchProjectionCountForReturns">
		<![CDATA[
                    SELECT count (DISTINCT PM.PROJECTION_MASTER_SID) projectionId
                     From PROJECTION_MASTER PM 

                    JOIN HIERARCHY_DEFINITION HDP
                    ON HDP.HIERARCHY_DEFINITION_SID = PM.PRODUCT_HIERARCHY_SID 

                    LEFT JOIN COMPANY_GROUP CG
                    ON CG.COMPANY_GROUP_SID  = PM.COMPANY_GROUP_SID 

                    LEFT JOIN ITEM_GROUP IG 
                    ON IG.ITEM_GROUP_SID = PM.ITEM_GROUP_SID 
                    
                    JOINPROJECTIONPRODHIERARCHY
                    JOIN COMPANY_MASTER CM 
                      on PM.COMPANY_MASTER_SID = CM.COMPANY_MASTER_SID 
                    
                    JOIN COMPANY_MASTER CM1
                      on PM.BUSINESS_UNIT = CM1.COMPANY_MASTER_SID 
                    
                    WHERE  PM.IS_APPROVED not in ('Y','A') AND PM.SAVE_FLAG = 'true'

		]]>
    </sql>
    
    <sql id="searchProjectionForReturns">
		<![CDATA[
                    SELECT DISTINCT PM.PROJECTION_MASTER_SID projectionId, PM.PROJECTION_NAME projectionName, PM.PROJECTION_DESCRIPTION description , 
                    0 customerHierSid, 0 customerHierarchy, 0 customerHierarchyLevel, HDP.HIERARCHY_DEFINITION_SID prodHierSid, 
                    HDP.HIERARCHY_NAME productHierarchy, PM.PRODUCT_HIERARCHY_LEVEL productHierarchyLevel, PM.CREATED_BY createdBy, PM.CREATED_DATE createdDate, PM.MODIFIED_DATE modifiedBy, PM.COMPANY_MASTER_SID companySid, 
                    PM.COMPANY_GROUP_SID customerGrpSid,  CG.COMPANY_GROUP_NAME customerGroup, PM.ITEM_GROUP_SID prodGrpSid, IG.ITEM_GROUP_NAME productGroup, 0 customerHierarchyInnerLevel, 
                    PM.PRODUCT_HIERARCHY_INNER_LEVEL productHierarchyInnerLevel, 
                    0 custRelationshipBuilderSid, PM.PROD_RELATIONSHIP_BUILDER_SID prodRelationshipBuilderSid,PM.DISCOUNT_TYPE ,
                    CM.COMPANY_NAME company,PM.BUSINESS_UNIT AS BUSINESSUNIT, CM1.COMPANY_NAME AS  BUSINESSUNITNAME ,PROJECTION_CUST_VERSION,PROJECTION_PROD_VERSION,
	PM.CUSTOMER_HIER_VERSION_NO,
	PM.PRODUCT_HIER_VERSION_NO,
                    
                    From PROJECTION_MASTER PM
                  
                    JOIN HIERARCHY_DEFINITION HDP
                    ON HDP.HIERARCHY_DEFINITION_SID = PM.PRODUCT_HIERARCHY_SID 

                    LEFT JOIN COMPANY_GROUP CG
                    ON CG.COMPANY_GROUP_SID  = PM.COMPANY_GROUP_SID 

                    LEFT JOIN ITEM_GROUP IG 
                    ON IG.ITEM_GROUP_SID = PM.ITEM_GROUP_SID 
                                        
                    JOINPROJECTIONPRODHIERARCHY
                    
                    JOIN COMPANY_MASTER CM 
                    on PM.COMPANY_MASTER_SID = CM.COMPANY_MASTER_SID 
                        
                    JOIN COMPANY_MASTER CM1
                     on PM.BUSINESS_UNIT = CM1.COMPANY_MASTER_SID 
                    
                    WHERE  PM.IS_APPROVED not in ('Y','A')  AND PM.SAVE_FLAG = 'true'

		]]>
    </sql>
    
    
    <sql id="searchProjection">
		<![CDATA[
                    SELECT DISTINCT PM.PROJECTION_MASTER_SID projectionId, PM.PROJECTION_NAME projectionName, PM.PROJECTION_DESCRIPTION description , 
                    HDC.HIERARCHY_DEFINITION_SID customerHierSid, HDC.HIERARCHY_NAME customerHierarchy, PM.CUSTOMER_HIERARCHY_LEVEL customerHierarchyLevel, HDP.HIERARCHY_DEFINITION_SID prodHierSid, 
                    HDP.HIERARCHY_NAME productHierarchy, PM.PRODUCT_HIERARCHY_LEVEL productHierarchyLevel, PM.CREATED_BY createdBy, PM.CREATED_DATE createdDate, PM.MODIFIED_DATE modifiedBy, PM.COMPANY_MASTER_SID companySid, 
                    PM.COMPANY_GROUP_SID customerGrpSid,  CG.COMPANY_GROUP_NAME customerGroup, PM.ITEM_GROUP_SID prodGrpSid, IG.ITEM_GROUP_NAME productGroup, PM.CUSTOMER_HIERARCHY_INNER_LEVEL customerHierarchyInnerLevel, 
                    PM.PRODUCT_HIERARCHY_INNER_LEVEL productHierarchyInnerLevel, PM.CUST_RELATIONSHIP_BUILDER_SID custRelationshipBuilderSid, PM.PROD_RELATIONSHIP_BUILDER_SID prodRelationshipBuilderSid,PM.DISCOUNT_TYPE,CM.COMPANY_NAME company,PM.BUSINESS_UNIT AS BUSINESSUNIT,
                    CM1.COMPANY_NAME AS  BUSINESSUNITNAME, PM.from_Date FromDate,PM.TO_DATE ToPeriod,PROJECTION_CUST_VERSION,PROJECTION_PROD_VERSION,	PM.CUSTOMER_HIER_VERSION_NO,	PM.PRODUCT_HIER_VERSION_NO @ACCFIELDVALUE 
                    From PROJECTION_MASTER PM
                  
                    JOIN HIERARCHY_DEFINITION HDC
                    ON HDC.HIERARCHY_DEFINITION_SID = PM.CUSTOMER_HIERARCHY_SID 

                    JOIN HIERARCHY_DEFINITION HDP
                    ON HDP.HIERARCHY_DEFINITION_SID = PM.PRODUCT_HIERARCHY_SID 

                    JOIN COMPANY_MASTER CM 
                        on PM.COMPANY_MASTER_SID = CM.COMPANY_MASTER_SID 
                        
                    JOIN COMPANY_MASTER CM1
                        on PM.BUSINESS_UNIT = CM1.COMPANY_MASTER_SID 

                    LEFT JOIN COMPANY_GROUP CG
                    ON CG.COMPANY_GROUP_SID  = PM.COMPANY_GROUP_SID 

                    LEFT JOIN ITEM_GROUP IG 
                    ON IG.ITEM_GROUP_SID = PM.ITEM_GROUP_SID 
                    
                     @ACCRUALPROJJOIN
                    
                    JOINPROJECTIONCUSTHIERARCHY
                    
                    JOINPROJECTIONPRODHIERARCHY
                    
                    WHERE  PM.IS_APPROVED not in ('Y','A','C')  AND PM.SAVE_FLAG = 'true'  @WHEREFILTERVALUE

		]]>
    </sql>
    
    <sql id="getProjection">
		<![CDATA[
                    SELECT PM.projectionMasterSid, PM.projectionName, PM.projectionDescription, 
                    HDC.hierarchyDefinitionSid, HDC.hierarchyName, PM.customerHierarchyLevel, HDP.hierarchyDefinitionSid,
                    HDP.hierarchyName, PM.productHierarchyLevel, PM.createdBy, PM.createdDate, PM.modifiedDate, PM.companyMasterSid, 
                    PM.companyGroupSid, CG.companyGroupName, PM.itemGroupSid, IG.itemGroupName, PM.customerHierVersionNo, PM.productHierVersionNo,
                    PM.brandType, CM.companyName, PM.fromDate, PM.modifiedBy, PM.customerHierarchyLevel, PM.productHierarchyLevel
                    From ProjectionMaster PM, HierarchyDefinition HDC, HierarchyDefinition HDP, CompanyGroup CG, ItemGroup IG, CompanyMaster CM
                    WHERE PM.customerHierarchySid = HDC.hierarchyDefinitionSid 
                    AND PM.productHierarchySid = HDP.hierarchyDefinitionSid
                    AND CG.companyGroupSid = PM.companyGroupSid
                    AND IG.itemGroupSid = PM.itemGroupSid
                    AND CM.companyMasterSid = PM.companyMasterSid
		]]>
    </sql>
    
    <sql id="getProjectionJoin">
		<![CDATA[
                    SELECT PM.projection_Master_Sid ProjectionMasterSid, PM.projection_Name ProjectionName, PM.projection_Description ProjectionDescription, 
                    HDC.hierarchy_Definition_Sid CustHierSid, HDC.hierarchy_Name CustHierName, PM.customer_Hierarchy_Level CustHierLevel, HDP.hierarchy_Definition_Sid ProdHierSid,
                    HDP.hierarchy_Name ProdHierName, PM.product_Hierarchy_Level ProdHierLevel, PM.created_By CreatedBy, PM.created_Date CreatedDate, PM.modified_Date ModifiedDate, PM.company_Master_Sid CompanyMasterSid, 
                    PM.company_Group_Sid CompanyGroupSid, CG.company_Group_Name CompanyGroupName, PM.item_Group_Sid ItemGroupSid, IG.item_Group_Name ItemGroupName, PM.customer_Hier_Version_No CustHierVno,
                    PM.product_Hier_Version_No ProdHierVno, PM.brand_Type BrandType, CM.company_Name CompanyName, PM.from_Date FromDate, PM.modified_By ModifiedBy, PM.SAVE_FLAG SaveFlag,
                    PM.TO_DATE ToPeriod, PM.CUSTOMER_HIERARCHY_INNER_LEVEL customerHierarchyInnerLevel, PM.PRODUCT_HIERARCHY_INNER_LEVEL productHierarchyInnerLevel,
                    PM.CUST_RELATIONSHIP_BUILDER_SID custRelationshipBuilderSid, PM.PROD_RELATIONSHIP_BUILDER_SID prodRelationshipBuilderSid,PM.DISCOUNT_TYPE discount , HT.DESCRIPTION discountType,PM.BUSINESS_UNIT AS BUSINESSUNIT
                    From Projection_Master PM
                    LEFT JOIN Company_Group CG
                    ON CG.company_Group_Sid = PM.company_Group_Sid 
                    LEFT JOIN Item_Group IG
                    ON IG.item_Group_Sid = PM.item_Group_Sid 
                    LEFT JOIN Company_Master CM
                    ON CM.company_Master_Sid = PM.company_Master_Sid 
                    LEFT JOIN Hierarchy_Definition HDC
                    ON HDC.hierarchy_Definition_Sid = PM.customer_Hierarchy_Sid 
                    LEFT JOIN Hierarchy_Definition HDP
                    ON HDP.hierarchy_Definition_Sid = PM.product_Hierarchy_Sid  
                    LEFT JOIN HELPER_TABLE HT 
                    ON HT.HELPER_TABLE_SID = PM.DISCOUNT_TYPE AND HT.LIST_NAME = 'RS_TYPE' 

		]]>
    </sql>
    
    <sql id="getRelationshipValuesold">
         <![CDATA[
                select RLD.levelNo, RLD.relationshipLevelValues, RLD.parentNode, RLD.levelName, RLD.relationshipLevelSid 
                FROM RelationshipLevelDefinition RLD WHERE RLD.relationshipLevelSid 
                IN (select DISTINCT PH.relationshipLevelSid from 
        ]]>
    </sql>
    <sql id="getRelationshipValues">
         <![CDATA[
                select distinct RLD.level_No, RLD.relationship_Level_Values, RLD.parent_Node, RLD.level_Name, RLD.relationship_Level_Sid, HLD."TABLE_NAME", HLD.FIELD_NAME,  RLD.HIERARCHY_NO 
                FROM Relationship_Level_Definition RLD JOIN HIERARCHY_LEVEL_DEFINITION HLD ON RLD.HIERARCHY_LEVEL_DEFINITION_SID=HLD.HIERARCHY_LEVEL_DEFINITION_SID
                JOIN ? PH ON RLD.RELATIONSHIP_LEVEL_SID = PH.RELATIONSHIP_LEVEL_SID 
        ]]>
    </sql>
    <sql id="getRelationshipValuesforchannel">
         <![CDATA[
                select RLD.level_No, RLD.relationship_Level_Values, RLD.parent_Node, RLD.level_Name, RLD.relationship_Level_Sid, HLD."TABLE_NAME", HLD.FIELD_NAME,  RLD.HIERARCHY_NO 
                FROM Relationship_Level_Definition RLD JOIN HIERARCHY_LEVEL_DEFINITION HLD ON RLD.HIERARCHY_LEVEL_DEFINITION_SID=HLD.HIERARCHY_LEVEL_DEFINITION_SID
                JOIN ? PH ON RLD.RELATIONSHIP_LEVEL_SID = PH.RELATIONSHIP_LEVEL_SID 
        ]]>
    </sql>

    <sql id="TableNamesFordelete">
		<![CDATA[
                    PROJECTION_CUST_HIERARCHY,
                    PROJECTION_PROD_HIERARCHY,
                    PROJECTION_DETAILS,
                    PROJECTION_MASTER 
                ]]>
    </sql>
    <sql id="NM_FK_TableNamesFordelete">
		<![CDATA[
                    NM_ACTUAL_DISCOUNT,NM_ACTUAL_PPA,NM_ACTUAL_SALES,NM_DISCOUNT_PROJ_MASTER,NM_DISCOUNT_PROJECTION,
                    NM_PPA_PROJECTION,NM_PPA_PROJECTION_MASTER,NM_SALES_PROJECTION,NM_SALES_PROJECTION_MASTER,
                    ST_NM_ACTUAL_DISCOUNT,ST_NM_ACTUAL_PPA,ST_NM_ACTUAL_SALES,ST_NM_DISCOUNT_PROJ_MASTER,
                    ST_NM_DISCOUNT_PROJECTION,ST_NM_PPA_PROJECTION,ST_NM_PPA_PROJECTION_MASTER,ST_NM_SALES_PROJECTION,ST_NM_SALES_PROJECTION_MASTER
                ]]>
    </sql>
    <sql id="M_FK_TableNamesFordelete">
		<![CDATA[
                    M_ACTUAL_DISCOUNT, M_ACTUAL_SALES, M_DISCOUNT_PROJECTION, M_SALES_PROJECTION,M_SALES_PROJECTION_MASTER,
                    M_SUPPLEMENTAL_DISC_ACTUALS,M_SUPPLEMENTAL_DISC_MASTER,M_SUPPLEMENTAL_DISC_PROJ, 
                    ST_M_ACTUAL_SALES,ST_M_SALES_PROJECTION,ST_M_SALES_PROJECTION_MASTER,ST_M_SUPPLEMENTAL_DISC_ACTUALS,
                    ST_M_SUPPLEMENTAL_DISC_MASTER,ST_M_SUPPLEMENTAL_DISC_PROJ
                ]]>
    </sql>
    <sql id="getForcastViewCount">
		<![CDATA[
                SELECT FVM.VIEW_NAME, FVM.VIEW_TYPE,FVM.CREATED_BY FROM dbo.FORECASTING_VIEW_MASTER FVM, dbo.PROJECTION_MASTER PM 
                                where FVM.PROJECTION_ID = PM.PROJECTION_MASTER_SID 
                                and FVM.VIEW_NAME = '?VN'
                                and FVM.VIEW_TYPE = '?VT'
                                and PM.FORECASTING_TYPE = 'Channel';
                ]]>
    </sql>
    
    
    <sql id="getParentLevelsOld">
		<![CDATA[
                 select distinct RLD.levelNo, RLD.relationshipLevelValues, RLD.parentNode, RLD.levelName, HLD.levelValueReference, HLD.tableName, HLD.fieldName, RLD.relationshipLevelSid
                 FROM RelationshipLevelDefinition RLD, HierarchyLevelDefinition HLD 
                 WHERE RLD.hierarchyLevelDefinitionSid = HLD.hierarchyLevelDefinitionSid 
                 AND RLD.relationshipBuilderSid = (select RBLD.relationshipBuilderSid from RelationshipLevelDefinition RBLD where 
                ]]>
    </sql>
    
    
    <sql id="getParentLevels">
		<![CDATA[
                 select distinct RLD.levelNo, RLD.relationshipLevelValues, RLD.parentNode, RLD.levelName, HLD.levelValueReference, HLD.tableName, HLD.fieldName, RLD.relationshipLevelSid, RLD.hierarchyNo, RLD.relationshipBuilderSid,
                 RLD.VERSION_NO 
                 FROM RelationshipLevelDefinition RLD, HierarchyLevelDefinition HLD 
                 WHERE RLD.hierarchyLevelDefinitionSid = HLD.hierarchyLevelDefinitionSid 
                 AND RLD.relationshipBuilderSid = (select RBLD.relationshipBuilderSid from RelationshipLevelDefinition RBLD where 
                ]]>
    </sql>
    <sql id="getWorkFlowLists">
                <![CDATA[
              SELECT PM.PROJECTION_NAME,
       PM.PROJECTION_DESCRIPTION,
       CASE
         WHEN Count(DISTINCT HT.DESCRIPTION) > 1 THEN 'MULTIPLE'
         ELSE Max(HT.DESCRIPTION)
       END AS MARKET_TYPE,
       CASE
         WHEN Count(DISTINCT CM.COMPANY_NO) > 1 THEN 'MULTIPLE'
         ELSE Max(CM.COMPANY_NO)
       END AS CONTRACT_HOLDER,
       CASE
         WHEN Count(DISTINCT C.CONTRACT_NO) > 1 THEN 'MULTIPLE'
         ELSE Max(C.CONTRACT_NO)
       END AS CONTRACT,
       CASE
         WHEN Count(DISTINCT BM.BRAND_NAME) > 1 THEN 'MULTIPLE'
         ELSE Max(BM.BRAND_NAME)
       END AS BRAND,
       CASE
         WHEN Count(DISTINCT IM.ITEM_NO) > 1 THEN 'MULTIPLE'
         ELSE Max(IM.ITEM_NO)
       END AS ITEM_NO,
       CASE
         WHEN Count(DISTINCT IM.ITEM_NAME) > 1 THEN 'MULTIPLE'
         ELSE Max(IM.ITEM_NAME)
       END AS ITEM_NAME,
       PM.PROJECTION_MASTER_SID,
       PM.CREATED_DATE,
       PM.CREATED_BY
FROM   PROJECTION_MASTER PM
       INNER JOIN WORKFLOW_MASTER WM
               ON PM.PROJECTION_MASTER_SID = WM.PROJECTION_MASTER_SID
                      LEFT JOIN HELPER_TABLE HT1
              ON HT1.HELPER_TABLE_SID = WM.WORKFLOW_STATUS_ID
                 AND HT1.LIST_NAME = 'WORKFLOWSTATUS'
              
       INNER JOIN PROJECTION_DETAILS PD
               ON PD.PROJECTION_MASTER_SID = PM.PROJECTION_MASTER_SID
       INNER JOIN CCP_DETAILS CCP
               ON CCP.CCP_DETAILS_SID = PD.CCP_DETAILS_SID
                        JOIN PROJECTION_DETAILS CUR_PD
                ON CUR_PD.CCP_DETAILS_SID = PD.CCP_DETAILS_SID
       INNER JOIN CONTRACT_MASTER C
               ON C.CONTRACT_MASTER_SID = CCP.CONTRACT_MASTER_SID
       LEFT JOIN HELPER_TABLE HT
              ON C.CONTRACT_TYPE = HT.HELPER_TABLE_SID
                 AND ( HT.LIST_NAME = 'CONTRACT_TYPE'
                        )
       LEFT JOIN COMPANY_MASTER CM
              ON C.CONT_HOLD_COMPANY_MASTER_SID = CM.COMPANY_MASTER_SID
                
       JOIN ITEM_MASTER IM
         ON CCP.ITEM_MASTER_SID = IM.ITEM_MASTER_SID
       LEFT JOIN BRAND_MASTER BM
              ON BM.BRAND_MASTER_SID = IM.BRAND_MASTER_SID
                
WHERE 
                ]]>
    </sql>
    <sql id="getProjectionLists">
                <![CDATA[
                 SELECT PM.PROJECTION_NAME,
       PM.PROJECTION_DESCRIPTION,
       CASE
         WHEN Count(DISTINCT HT.DESCRIPTION) > 1 THEN 'MULTIPLE'
         ELSE Max(HT.DESCRIPTION)
       END AS MARKET_TYPE,
       CASE
         WHEN Count(DISTINCT CM.COMPANY_NO) > 1 THEN 'MULTIPLE'
         ELSE Max(CM.COMPANY_NO)
       END AS CONTRACT_HOLDER,
       CASE
         WHEN Count(DISTINCT C.CONTRACT_NO) > 1 THEN 'MULTIPLE'
         ELSE Max(C.CONTRACT_NO)
       END AS CONTRACT,
       CASE
         WHEN Count(DISTINCT BM.BRAND_NAME) > 1 THEN 'MULTIPLE'
         ELSE Max(BM.BRAND_NAME)
       END AS BRAND,
       CASE
         WHEN Count(DISTINCT IM.ITEM_NO) > 1 THEN 'MULTIPLE'
         ELSE Max(IM.ITEM_NO)
       END AS ITEM_NO,
       CASE
         WHEN Count(DISTINCT IM.ITEM_NAME) > 1 THEN 'MULTIPLE'
         ELSE Max(IM.ITEM_NAME)
       END AS ITEM_NAME,
       PM.PROJECTION_MASTER_SID,
       PM.CREATED_DATE,
       PM.CREATED_BY
FROM   PROJECTION_MASTER PM
  
       INNER JOIN PROJECTION_DETAILS PD
               ON PD.PROJECTION_MASTER_SID = PM.PROJECTION_MASTER_SID
       INNER JOIN CCP_DETAILS CCP
               ON CCP.CCP_DETAILS_SID = PD.CCP_DETAILS_SID
                        JOIN PROJECTION_DETAILS CUR_PD
                ON CUR_PD.CCP_DETAILS_SID = PD.CCP_DETAILS_SID
       INNER JOIN CONTRACT_MASTER C
               ON C.CONTRACT_MASTER_SID = CCP.CONTRACT_MASTER_SID
       LEFT JOIN HELPER_TABLE HT
              ON C.CONTRACT_TYPE = HT.HELPER_TABLE_SID
                 AND ( HT.LIST_NAME = 'CONTRACT_TYPE'
                        )
       LEFT JOIN COMPANY_MASTER CM
              ON C.CONT_HOLD_COMPANY_MASTER_SID = CM.COMPANY_MASTER_SID
                 
       JOIN ITEM_MASTER IM
         ON CCP.ITEM_MASTER_SID = IM.ITEM_MASTER_SID
       LEFT JOIN BRAND_MASTER BM
              ON BM.BRAND_MASTER_SID = IM.BRAND_MASTER_SID
                
WHERE 
                ]]>
    </sql>
    
    <sql id="getItemsFromBrand">
		<![CDATA[
                 select IM.itemMasterSid from ItemMaster IM where IM.brandMasterSid in (select BM.brandMasterSid from BrandMaster BM) 
                ]]>
    </sql>
    
    
    <sql id="getInnerLevel">
		<![CDATA[
                 select distinct RLD.relationship_Level_Values, RLD.level_No, RLD.parent_Node, RLD.relationship_Level_Sid, HLD.table_Name, HLD.field_Name, RLD.hierarchy_No, RB.relationship_Builder_Sid, RLD.level_Name
                from Relationship_Level_Definition RLD, Relationship_Builder RB, Hierarchy_Level_Definition HLD
                where RLD.relationship_Builder_Sid = RB.relationship_Builder_Sid 
                and HLD.hierarchy_Level_Definition_Sid = RLD.hierarchy_Level_Definition_Sid 
                ]]>
    </sql>
    
    
    <sql id="getInnerLevelChannel">
		<![CDATA[
                    SELECT  distinct RLD1.relationship_Level_Values, RLD1.level_No, RLD1.parent_Node, RLD1.relationship_Level_Sid, 
                    HLD.table_Name, HLD.field_Name, RLD1.hierarchy_No, RLD1.RELATIONSHIP_BUILDER_SID, RLD1.level_Name
                    FROM   RELATIONSHIP_LEVEL_DEFINITION RLD
                    JOIN RELATIONSHIP_LEVEL_DEFINITION RLD1
                    ON RLD.RELATIONSHIP_BUILDER_SID = RLD1.RELATIONSHIP_BUILDER_SID AND RLD1.LEVEL_NO = '?ln' AND RLD.RELATIONSHIP_BUILDER_SID = '?rbsid' ?notin
                    AND RLD.HIERARCHY_NO LIKE RLD1.HIERARCHY_NO + '%'
                    JOIN CCP_MAP CCPMAP
                    ON CCPMAP.RELATIONSHIP_LEVEL_SID = RLD.RELATIONSHIP_LEVEL_SID 
                    JOIN dbo.CCP_DETAILS CCP ON CCPMAP.CCP_DETAILS_SID=CCP.CCP_DETAILS_SID
                    JOIN dbo.RS_CONTRACT RS ON CCP.CONTRACT_MASTER_SID=RS.CONTRACT_MASTER_SID AND RS.RS_TYPE like '?rstype'
                    JOIN Hierarchy_Level_Definition HLD on HLD.hierarchy_Level_Definition_Sid = RLD.hierarchy_Level_Definition_Sid; 
                ]]>
    </sql>
    
    
    <sql id="getCcp">
		<![CDATA[
                  SELECT distinct ? PROJECTION_MASTER_SID, CCP1.CCP_DETAILS_SID FROM 
                    (SELECT CCP.CCP_DETAILS_SID 
                    FROM RELATIONSHIP_LEVEL_DEFINITION RLD, 
                    CCP_MAP CCP 
                    WHERE RLD.HIERARCHY_NO like '?%' 
                    AND CCP.RELATIONSHIP_LEVEL_SID=RLD.RELATIONSHIP_LEVEL_SID) CCP1, 
                    (SELECT CCP.CCP_DETAILS_SID FROM CCP_MAP CCP WHERE CCP.RELATIONSHIP_LEVEL_SID in (SELECT RLD.RELATIONSHIP_LEVEL_SID FROM RELATIONSHIP_LEVEL_DEFINITION RLD, 
                    (SELECT RLD.HIERARCHY_NO FROM RELATIONSHIP_LEVEL_DEFINITION RLD
                    WHERE RLD.HIERARCHY_NO in (?)) HNO
                    WHERE RLD.HIERARCHY_NO like HNO.HIERARCHY_NO+'%')) CCP2 
                    WHERE CCP1.CCP_DETAILS_SID=CCP2.CCP_DETAILS_SID ;

                ]]>
    </sql>
    <sql id="getCcpV2Insert">
		<![CDATA[
                  INSERT INTO PROJECTION_DETAILS(PROJECTION_MASTER_SID,CCP_DETAILS_SID)
		    SELECT distinct ? PROJECTION_MASTER_SID, CCP1.CCP_DETAILS_SID FROM 
                    (SELECT CCP.CCP_DETAILS_SID
                    FROM RELATIONSHIP_LEVEL_DEFINITION RLD, 
                    CCP_MAP CCP 
                    WHERE RLD.HIERARCHY_NO like '?%' 
                    AND CCP.RELATIONSHIP_LEVEL_SID=RLD.RELATIONSHIP_LEVEL_SID) CCP1, 
                    (SELECT distinct CCPD.CCP_DETAILS_SID 
                    FROM CCP_MAP CCP JOIN RELATIONSHIP_LEVEL_DEFINITION RLD 
                    ON CCP.RELATIONSHIP_LEVEL_SID=RLD.RELATIONSHIP_LEVEL_SID 
                    JOIN PROJECTION_PROD_HIERARCHY PPH 
                    ON PPH.RELATIONSHIP_LEVEL_SID=RLD.RELATIONSHIP_LEVEL_SID AND PPH.PROJECTION_MASTER_SID=?
                    JOIN CCP_DETAILS CCPD ON CCP.CCP_DETAILS_SID=CCPD.CCP_DETAILS_SID) CCP2 
                    WHERE CCP1.CCP_DETAILS_SID=CCP2.CCP_DETAILS_SID;

                ]]>
    </sql>
    <sql id="getCcpV2">
		<![CDATA[
		    SELECT distinct ? PROJECTION_MASTER_SID, CCP1.CCP_DETAILS_SID FROM 
                    (SELECT CCP.CCP_DETAILS_SID
                    FROM RELATIONSHIP_LEVEL_DEFINITION RLD, 
                    CCP_MAP CCP 
                    WHERE RLD.HIERARCHY_NO like '?%' 
                    AND CCP.RELATIONSHIP_LEVEL_SID=RLD.RELATIONSHIP_LEVEL_SID) CCP1, 
                    (SELECT distinct CCPD.CCP_DETAILS_SID FROM CCP_MAP CCP JOIN RELATIONSHIP_LEVEL_DEFINITION RLD 
                    ON CCP.RELATIONSHIP_LEVEL_SID=RLD.RELATIONSHIP_LEVEL_SID 
                    JOIN PROJECTION_PROD_HIERARCHY PPH 
                    ON PPH.RELATIONSHIP_LEVEL_SID=RLD.RELATIONSHIP_LEVEL_SID AND PPH.PROJECTION_MASTER_SID=?
                    JOIN CCP_DETAILS CCPD ON CCP.CCP_DETAILS_SID=CCPD.CCP_DETAILS_SID) CCP2 
                    WHERE CCP1.CCP_DETAILS_SID=CCP2.CCP_DETAILS_SID;
                ]]>
    </sql>
    
    <sql id="saveCcp">
		<![CDATA[
                 INSERT INTO PROJECTION_DETAILS(PROJECTION_MASTER_SID,CCP_DETAILS_SID) 
                  SELECT distinct ? PROJECTION_MASTER_SID, CCP1.CCP_DETAILS_SID FROM 
                    (SELECT CCP.CCP_DETAILS_SID 
                    FROM RELATIONSHIP_LEVEL_DEFINITION RLD, 
                    CCP_MAP CCP 
                    WHERE RLD.HIERARCHY_NO like '?%' 
                    AND CCP.RELATIONSHIP_LEVEL_SID=RLD.RELATIONSHIP_LEVEL_SID) CCP1, 
                    (SELECT CCP.CCP_DETAILS_SID 
                    FROM RELATIONSHIP_LEVEL_DEFINITION RLD, 
                    CCP_MAP CCP, 
                    PROJECTION_PROD_HIERARCHY PPH 
                    WHERE CCP.RELATIONSHIP_LEVEL_SID=RLD.RELATIONSHIP_LEVEL_SID 
                    AND PPH.RELATIONSHIP_LEVEL_SID=RLD.RELATIONSHIP_LEVEL_SID
                    AND PPH.PROJECTION_MASTER_SID=?) CCP2 
                    WHERE CCP1.CCP_DETAILS_SID=CCP2.CCP_DETAILS_SID ;

                ]]>
    </sql>
    
    
    <sql id="saveCcpMerge">
		<![CDATA[
                   MERGE PROJECTION_DETAILS AS TARGET
                   USING (SELECT distinct ? PROJECTION_MASTER_SID, CCP1.CCP_DETAILS_SID FROM 
                    (SELECT CCP.CCP_DETAILS_SID
                    FROM RELATIONSHIP_LEVEL_DEFINITION RLD, 
                    CCP_MAP CCP 
                    WHERE RLD.HIERARCHY_NO like '?%' 
                    AND CCP.RELATIONSHIP_LEVEL_SID=RLD.RELATIONSHIP_LEVEL_SID) CCP1, 
                    (SELECT distinct CCPD.CCP_DETAILS_SID 
                    FROM CCP_MAP CCP JOIN RELATIONSHIP_LEVEL_DEFINITION RLD 
                    ON CCP.RELATIONSHIP_LEVEL_SID=RLD.RELATIONSHIP_LEVEL_SID 
                                              JOIN PROJECTION_PROD_HIERARCHY PPH
                    ON PPH.RELATIONSHIP_LEVEL_SID=RLD.RELATIONSHIP_LEVEL_SID AND PPH.PROJECTION_MASTER_SID=?
                    JOIN CCP_DETAILS CCPD ON CCP.CCP_DETAILS_SID=CCPD.CCP_DETAILS_SID) CCP2 
                    WHERE CCP1.CCP_DETAILS_SID=CCP2.CCP_DETAILS_SID) AS SOURCE
                        ON ( TARGET.PROJECTION_MASTER_SID = SOURCE.PROJECTION_MASTER_SID
                   AND TARGET.CCP_DETAILS_SID = SOURCE.CCP_DETAILS_SID)
                        WHEN NOT MATCHED THEN
                   INSERT (PROJECTION_MASTER_SID,CCP_DETAILS_SID)
                   VALUES (SOURCE.PROJECTION_MASTER_SID, SOURCE.CCP_DETAILS_SID); 
	
                ]]>
    </sql>
    
    
    
    <sql id="getInnerLevelNdc">
		<![CDATA[
                    SELECT DISTINCT RLD.RELATIONSHIP_LEVEL_VALUES, 
                    RLD.LEVEL_NO, RLD.PARENT_NODE, 
                    RLD.RELATIONSHIP_LEVEL_SID, 
                    HLD."TABLE_NAME", 
                    HLD.FIELD_NAME, 
                    RLD.HIERARCHY_NO, 
                    IM.ITEM_MASTER_SID,
                    IM.FORM,
                    IM.STRENGTH,
                    RB.RELATIONSHIP_BUILDER_SID
                    FROM RELATIONSHIP_LEVEL_DEFINITION RLD, RELATIONSHIP_BUILDER RB, HIERARCHY_LEVEL_DEFINITION HLD, ITEM_MASTER IM
                    WHERE RLD.RELATIONSHIP_BUILDER_SID=RB.RELATIONSHIP_BUILDER_SID
                    AND HLD.HIERARCHY_LEVEL_DEFINITION_SID=RLD.HIERARCHY_LEVEL_DEFINITION_SID 
                    AND IM.ITEM_MASTER_SID = RLD.RELATIONSHIP_LEVEL_VALUES
                    AND RLD.LEVEL_NAME like 'NDC' 
                ]]>
    </sql>
    
    
    
    <sql id="getInnerLevelNdcJoin">
		<![CDATA[
                   SELECT DISTINCT RLD.RELATIONSHIP_LEVEL_VALUES RELATIONSHIPLEVELVALUES, 
                    RLD.LEVEL_NO LEVELNO, RLD.PARENT_NODE PARENTNODE, 
                    RLD.RELATIONSHIP_LEVEL_SID RELATIONSHIPSID, 
                    HLD."TABLE_NAME" TABLENAME, 
                    HLD.FIELD_NAME FIELDNAME, 
                    RLD.HIERARCHY_NO HIERARCHYNO, 
                    IM.ITEM_MASTER_SID ITEMSID,
                    H1.DESCRIPTION FORM, 
                    H2.DESCRIPTION STRENGTH,
                    RB.RELATIONSHIP_BUILDER_SID
                    from RELATIONSHIP_LEVEL_DEFINITION RLD, 
                    RELATIONSHIP_BUILDER RB, 
                    HIERARCHY_LEVEL_DEFINITION HLD, 
                    ITEM_MASTER IM,
                    HELPER_TABLE H1,
                    HELPER_TABLE H2
                    WHERE RLD.RELATIONSHIP_BUILDER_SID=RB.RELATIONSHIP_BUILDER_SID
                    AND HLD.HIERARCHY_LEVEL_DEFINITION_SID=RLD.HIERARCHY_LEVEL_DEFINITION_SID 
                    AND IM.ITEM_MASTER_SID = RLD.RELATIONSHIP_LEVEL_VALUES  AND IM.INBOUND_STATUS <> 'D'
                    AND H1.HELPER_TABLE_SID=IM.FORM
                    AND H2.HELPER_TABLE_SID=IM.STRENGTH 
                ]]>
    </sql>
    
    
    
    <sql id="hasTradingPartner">
		<![CDATA[
                    SELECT count(RLD.RELATIONSHIP_LEVEL_SID) RELATIONSHIP_LEVEL_SID FROM RELATIONSHIP_LEVEL_DEFINITION RLD, PROJECTION_CUST_HIERARCHY PCH 
                    WHERE PCH.RELATIONSHIP_LEVEL_SID=RLD.RELATIONSHIP_LEVEL_SID 
                    AND RLD.LEVEL_NAME='Trading Partner'
                    AND PCH.PROJECTION_MASTER_SID = 
         ]]>
    </sql>
    
    <sql id="ds.singleBrand">
		<![CDATA[
			SELECT count(distinct BR.BRAND_MASTER_SID) FROM dbo.PROJECTION_DETAILS PD
			JOIN dbo.CCP_DETAILS CCP ON PD.CCP_DETAILS_SID=CCP.CCP_DETAILS_SID AND PD.PROJECTION_MASTER_SID=?PID
			JOIN dbo.ITEM_MASTER IM ON CCP.ITEM_MASTER_SID=IM.ITEM_MASTER_SID
			JOIN dbo.BRAND_MASTER BR ON BR.BRAND_MASTER_SID=IM.BRAND_MASTER_SID
         ]]>
    </sql>
    
    <sql id="getParentLevelsWithHierarchyNo">
		<![CDATA[
                 select distinct RLD.levelNo, RLD.relationshipLevelValues, RLD.parentNode, RLD.levelName, HLD.levelValueReference, HLD.tableName, HLD.fieldName, RLD.relationshipLevelSid, RLD.hierarchyNo, RLD.relationshipBuilderSid 
                 FROM RelationshipLevelDefinition RLD, HierarchyLevelDefinition HLD 
                 WHERE RLD.hierarchyLevelDefinitionSid = HLD.hierarchyLevelDefinitionSid 
                 AND RLD.hierarchyNo in (?) ORDER by RLD.hierarchyNo asc  
                ]]>
    </sql>
    
    
    
    <sql id="getChildLevelsWithHierarchyNo">
		<![CDATA[
                 select distinct RLD.level_No, RLD.relationship_Level_Values, RLD.parent_Node, RLD.level_Name, HLD.level_Value_Reference, HLD.table_Name, HLD.field_Name, RLD.relationship_Level_Sid, RLD.hierarchy_No, RLD.relationship_Builder_Sid 
                 FROM Relationship_Level_Definition RLD, Hierarchy_Level_Definition HLD 
                 WHERE RLD.hierarchy_Level_Definition_Sid = HLD.hierarchy_Level_Definition_Sid 
                 AND RLD.hierarchy_No like '?%' AND RLD.hierarchy_No != '?'  AND RLD.level_No <= ? ORDER by RLD.hierarchy_No asc  
                ]]>
    </sql>
    
     
    <sql id="getUnsavedProjectionIds">
		<![CDATA[
                    SELECT DISTINCT PROJECTION_MASTER_SID FROM PROJECTION_MASTER WHERE SAVE_FLAG = 'false' AND FORECASTING_TYPE ='Non Mandated' AND CREATED_DATE < '?' ;
                ]]>
    </sql>
    <sql id="getUnsavedProjectionIdsforchannel">
		<![CDATA[
                    SELECT DISTINCT PROJECTION_MASTER_SID FROM PROJECTION_MASTER WHERE SAVE_FLAG = 'false' AND FORECASTING_TYPE = 'Channel'  AND CREATED_DATE < '?' ;
                ]]>
    </sql>

     
     
    <sql id="getChildLevelRLSid">
		<![CDATA[
                    SELECT RELATIONSHIP_LEVEL_SID FROM RELATIONSHIP_LEVEL_DEFINITION 
                ]]>
    </sql>
    
    <sql id="getChildLevelRL">
		<![CDATA[
                    SELECT distinct RLD.relationship_Level_Values, RLD.level_No, RLD.parent_Node, RLD.relationship_Level_Sid, HLD.table_Name, HLD.field_Name, RLD.hierarchy_No, RB.relationship_Builder_Sid, RLD.level_Name
                from Relationship_Level_Definition RLD, Relationship_Builder RB, Hierarchy_Level_Definition HLD
                where RLD.relationship_Builder_Sid = RB.relationship_Builder_Sid 
                and HLD.hierarchy_Level_Definition_Sid = RLD.hierarchy_Level_Definition_Sid 
                and HLD.table_Name in ('CONTRACT_MASTER', 'COMPANY_MASTER') 
                ]]>
    </sql>
    
     
    <sql id="getChildLevelRLSidFull">
		<![CDATA[
                    SELECT distinct RLD.RELATIONSHIP_LEVEL_SID
                    FROM RELATIONSHIP_LEVEL_DEFINITION RLD
                    WHERE (RLD.HIERARCHY_NO like '45-1.1.2%' or RLD.HIERARCHY_NO like '45-1.1.1%') and RLD.HIERARCHY_NO not in ('45-1.1.1', '45-1.1.2')
                    AND RLD.RELATIONSHIP_LEVEL_SID NOT IN (SELECT PH.RELATIONSHIP_LEVEL_SID FROM PROJECTION_CUST_HIERARCHY PH WHERE PH.PROJECTION_MASTER_SID = 246);
                ]]>
    </sql>
    
    <sql id="getChildLevelRLSidRestricted">
		<![CDATA[
                   SELECT distinct RLD.RELATIONSHIP_LEVEL_SID FROM RELATIONSHIP_LEVEL_DEFINITION RLD 
                ]]>
    </sql>
    
    <sql id="getUnsavedProjectionIdsforchannel">
		<![CDATA[
                    SELECT DISTINCT PROJECTION_MASTER_SID FROM PROJECTION_MASTER WHERE SAVE_FLAG = 'false' AND FORECASTING_TYPE = 'Channel'  AND CREATED_DATE < '?' ;
                ]]>
    </sql>
    
    <sql id="getForcastFile">
		<![CDATA[
                    SELECT TOP 1 FORECAST_NAME,VERSION FROM dbo.FILE_MANAGEMENT ORDER BY CREATED_DATE DESC;
                ]]>
    </sql>
    
    <sql id="getForcastFileDate">
		<![CDATA[
                SELECT DISTINCT TOP 1 FM.FORECAST_YEAR,FM.FORECAST_MONTH 
				FROM FORECASTING_MASTER FM WHERE  
				(FM.FORECAST_VER='?' or FM.FORECAST_VER='?')AND 
				FM.FORECAST_NAME='?' 
				ORDER BY FM.FORECAST_YEAR DESC,FM.FORECAST_MONTH DESC;
                ]]>
    </sql>
    
    <sql id="getRemovableChildren">
		<![CDATA[
                SELECT RLD.RELATIONSHIP_LEVEL_SID, RLD.HIERARCHY_NO FROM RELATIONSHIP_LEVEL_DEFINITION RLD  WHERE RLD.RELATIONSHIP_LEVEL_SID in (SELECT RLD.RELATIONSHIP_LEVEL_SID FROM RELATIONSHIP_LEVEL_DEFINITION RLD, 
                    (SELECT RLD.HIERARCHY_NO FROM RELATIONSHIP_LEVEL_DEFINITION RLD
                    WHERE RLD.RELATIONSHIP_LEVEL_SID in (?)) HNO
                    WHERE RLD.HIERARCHY_NO like HNO.HIERARCHY_NO+'%') AND RLD.RELATIONSHIP_LEVEL_SID NOT IN (?);
                ]]>
    </sql>
    
    
    
    <sql id="deleteTempOnUpdate">
		<![CDATA[
                DELETE FROM ?DTBL WHERE PROJECTION_DETAILS_SID in (Select distinct PD.PROJECTION_DETAILS_SID From PROJECTION_DETAILS PD, 
		(SELECT CCPMAP.CCP_DETAILS_SID
                  FROM   (SELECT RLD.HIERARCHY_NO,
                                 CCP.CCP_DETAILS_SID
                          FROM   RELATIONSHIP_LEVEL_DEFINITION RLD
                          JOIN   CCP_MAP CCP ON RLD.RELATIONSHIP_LEVEL_SID = CCP.RELATIONSHIP_LEVEL_SID
                          JOIN   PROJECTION_DETAILS PD ON PD.CCP_DETAILS_SID = CCP.CCP_DETAILS_SID AND PD.PROJECTION_MASTER_SID = ?PID
                          JOIN   ?HTBL  PCH ON PCH.RELATIONSHIP_LEVEL_SID = RLD.RELATIONSHIP_LEVEL_SID AND PCH.PROJECTION_MASTER_SID=?PID
                          ) CCPMAP JOIN 
                         (SELECT RLD1.HIERARCHY_NO
                          FROM   RELATIONSHIP_LEVEL_DEFINITION RLD1
                          JOIN   ?HTBL  PCH ON PCH.RELATIONSHIP_LEVEL_SID = RLD1.RELATIONSHIP_LEVEL_SID AND PCH.PROJECTION_MASTER_SID = ?PID 
                         AND  RLD1.HIERARCHY_NO LIKE '%') HLD ON CCPMAP.HIERARCHY_NO LIKE HLD.HIERARCHY_NO+'%' 
 					WHERE HLD.HIERARCHY_NO in(?HNO)) CCP
		  Where PD.PROJECTION_MASTER_SID = ?PID AND PD.CCP_DETAILS_SID=CCP.CCP_DETAILS_SID);
                ]]>
    </sql>
    <sql id="filterForGroupMap">
		<![CDATA[
                    SELECT distinct RLD.RELATIONSHIP_LEVEL_VALUES as relationshipLevelValues, RLD.LEVEL_NO as levelNo, RLD.LEVEL_NAME as levelName, 
                    RLD.PARENT_NODE as parentNode, RLD.RELATIONSHIP_LEVEL_SID as relationshipLevelSid, HLD.FIELD_NAME  as fieldName 
                    FROM RELATIONSHIP_LEVEL_DEFINITION RLD, HIERARCHY_LEVEL_DEFINITION HLD
                    WHERE RLD.HIERARCHY_LEVEL_DEFINITION_SID = HLD.HIERARCHY_LEVEL_DEFINITION_SID AND 
                    RLD.RELATIONSHIP_BUILDER_SID IN (SELECT RB.RELATIONSHIP_BUILDER_SID as relationshipBuilderSid FROM RELATIONSHIP_BUILDER RB 
                    WHERE RB.HIERARCHY_DEFINITION_SID = ?HDS) AND RLD.LEVEL_NO IN (?LN) AND HLD.LEVEL_VALUE_REFERENCE LIKE 'Linked';
                ]]>
    </sql>
    
    <sql id="deleteProjection">
		<![CDATA[
                DELETE FROM dbo.ST_NM_SALES_PROJECTION WHERE PROJECTION_DETAILS_SID in 
				(SELECT PROJECTION_DETAILS_SID FROM dbo.PROJECTION_DETAILS WHERE PROJECTION_MASTER_SID=?PID);
				DELETE FROM dbo.ST_NM_ACTUAL_SALES WHERE PROJECTION_DETAILS_SID in 
				(SELECT PROJECTION_DETAILS_SID FROM dbo.PROJECTION_DETAILS WHERE PROJECTION_MASTER_SID=?PID);
			    DELETE FROM dbo.ST_NM_SALES_PROJECTION_MASTER WHERE PROJECTION_DETAILS_SID in 
				(SELECT PROJECTION_DETAILS_SID FROM dbo.PROJECTION_DETAILS WHERE PROJECTION_MASTER_SID=?PID);
				
				DELETE FROM dbo.ST_NM_DISCOUNT_PROJECTION WHERE PROJECTION_DETAILS_SID in 
				(SELECT PROJECTION_DETAILS_SID FROM dbo.PROJECTION_DETAILS WHERE PROJECTION_MASTER_SID=?PID);
				DELETE FROM dbo.ST_NM_ACTUAL_DISCOUNT WHERE PROJECTION_DETAILS_SID in 
				(SELECT PROJECTION_DETAILS_SID FROM dbo.PROJECTION_DETAILS WHERE PROJECTION_MASTER_SID=?PID);
				DELETE FROM dbo.ST_NM_DISCOUNT_PROJ_MASTER WHERE PROJECTION_DETAILS_SID in 
				(SELECT PROJECTION_DETAILS_SID FROM dbo.PROJECTION_DETAILS WHERE PROJECTION_MASTER_SID=?PID);
				
				DELETE FROM dbo.ST_NM_PPA_PROJECTION WHERE PROJECTION_DETAILS_SID in 
				(SELECT PROJECTION_DETAILS_SID FROM dbo.PROJECTION_DETAILS WHERE PROJECTION_MASTER_SID=?PID);
				DELETE FROM dbo.ST_NM_ACTUAL_PPA WHERE PROJECTION_DETAILS_SID in 
				(SELECT PROJECTION_DETAILS_SID FROM dbo.PROJECTION_DETAILS WHERE PROJECTION_MASTER_SID=?PID);
				DELETE FROM dbo.ST_NM_PPA_PROJECTION_MASTER WHERE PROJECTION_DETAILS_SID in 
				(SELECT PROJECTION_DETAILS_SID FROM dbo.PROJECTION_DETAILS WHERE PROJECTION_MASTER_SID=?PID);
				
				DELETE FROM dbo.ST_NM_ASSUMPTIONS WHERE PROJECTION_DETAILS_SID in 
				(SELECT PROJECTION_DETAILS_SID FROM dbo.PROJECTION_DETAILS WHERE PROJECTION_MASTER_SID=?PID);
				
				DELETE FROM dbo.NM_SALES_PROJECTION WHERE PROJECTION_DETAILS_SID in 
				(SELECT PROJECTION_DETAILS_SID FROM dbo.PROJECTION_DETAILS WHERE PROJECTION_MASTER_SID=?PID);
				DELETE FROM dbo.NM_ACTUAL_SALES WHERE PROJECTION_DETAILS_SID in 
				(SELECT PROJECTION_DETAILS_SID FROM dbo.PROJECTION_DETAILS WHERE PROJECTION_MASTER_SID=?PID);
			    DELETE FROM dbo.NM_SALES_PROJECTION_MASTER WHERE PROJECTION_DETAILS_SID in 
				(SELECT PROJECTION_DETAILS_SID FROM dbo.PROJECTION_DETAILS WHERE PROJECTION_MASTER_SID=?PID);
				
				DELETE FROM dbo.NM_DISCOUNT_PROJECTION WHERE PROJECTION_DETAILS_SID in 
				(SELECT PROJECTION_DETAILS_SID FROM dbo.PROJECTION_DETAILS WHERE PROJECTION_MASTER_SID=?PID);
				DELETE FROM dbo.NM_ACTUAL_DISCOUNT WHERE PROJECTION_DETAILS_SID in 
				(SELECT PROJECTION_DETAILS_SID FROM dbo.PROJECTION_DETAILS WHERE PROJECTION_MASTER_SID=?PID);
				DELETE FROM dbo.NM_DISCOUNT_PROJ_MASTER WHERE PROJECTION_DETAILS_SID in 
				(SELECT PROJECTION_DETAILS_SID FROM dbo.PROJECTION_DETAILS WHERE PROJECTION_MASTER_SID=?PID);
				
				DELETE FROM dbo.NM_PPA_PROJECTION WHERE PROJECTION_DETAILS_SID in 
				(SELECT PROJECTION_DETAILS_SID FROM dbo.PROJECTION_DETAILS WHERE PROJECTION_MASTER_SID=?PID);
				DELETE FROM dbo.NM_ACTUAL_PPA WHERE PROJECTION_DETAILS_SID in 
				(SELECT PROJECTION_DETAILS_SID FROM dbo.PROJECTION_DETAILS WHERE PROJECTION_MASTER_SID=?PID);
				DELETE FROM dbo.NM_PPA_PROJECTION_MASTER WHERE PROJECTION_DETAILS_SID in 
				(SELECT PROJECTION_DETAILS_SID FROM dbo.PROJECTION_DETAILS WHERE PROJECTION_MASTER_SID=?PID);
				
				DELETE FROM dbo.NM_ASSUMPTIONS WHERE PROJECTION_DETAILS_SID in 
				(SELECT PROJECTION_DETAILS_SID FROM dbo.PROJECTION_DETAILS WHERE PROJECTION_MASTER_SID=?PID);
                                DELETE FROM  CUSTOM_CCP_MAP WHERE CUSTOM_VIEW_DETAILS_SID IN(
                                SELECT CUSTOM_VIEW_DETAILS_SID FROM CUSTOM_VIEW_DETAILS WHERE CUSTOM_VIEW_MASTER_SID IN (
                                 SELECT CUSTOM_VIEW_MASTER_SID FROM  CUSTOM_VIEW_MASTER WHERE PROJECTION_MASTER_SID= ?PID ));

                                DELETE FROM  CUSTOM_RELATIONSHIP_BUILDER WHERE CUSTOM_VIEW_DETAILS_SID IN(
                                SELECT CUSTOM_VIEW_DETAILS_SID FROM  CUSTOM_VIEW_DETAILS WHERE CUSTOM_VIEW_MASTER_SID IN (
                                 SELECT CUSTOM_VIEW_MASTER_SID FROM  CUSTOM_VIEW_MASTER WHERE PROJECTION_MASTER_SID= ?PID ));
                                
				DELETE FROM dbo.CUSTOM_VIEW_DETAILS WHERE CUSTOM_VIEW_MASTER_SID in 
				(SELECT CUSTOM_VIEW_MASTER_SID FROM CUSTOM_VIEW_MASTER WHERE PROJECTION_MASTER_SID=?PID);
				DELETE FROM dbo.CUSTOM_VIEW_MASTER WHERE PROJECTION_MASTER_SID =?PID;
				
				DELETE FROM dbo.NM_PROJECTION_SELECTION WHERE PROJECTION_MASTER_SID =?PID;
                ]]>
    </sql>
    
    
    <sql id="getFSValue">
		<![CDATA[
                    SELECT H1.DESCRIPTION as form, H2.DESCRIPTION as strength
                    FROM ITEM_MASTER IM
                    JOIN HELPER_TABLE H1 ON H1.HELPER_TABLE_SID = IM.FORM
                    JOIN HELPER_TABLE H2 ON H2.HELPER_TABLE_SID = IM.STRENGTH
                    WHERE IM.ITEM_MASTER_SID = '?RLC?';
                ]]>
    </sql>
    
    <sql id="getHierarchyMapQuery">
		<![CDATA[
                    SELECT RLD.RELATIONSHIP_LEVEL_SID,
                    RLD.RELATIONSHIP_LEVEL_VALUES,
                    RLD.LEVEL_NO,
                    RLD.LEVEL_NAME,
                    RLD.HIERARCHY_NO,
                    CASE WHEN HLD.TABLE_NAME=JVIEW.REFERENCE_TABLE_NAME THEN HLD.TABLE_NAME ELSE JVIEW.REFERENCE_TABLE_NAME  END AS TABLE_NAME,
                    CASE WHEN JVIEW.MAPPING_COLUMN_NAME is null THEN JVIEW.PRIMARY_KEY_COLUMN_NAME ELSE JVIEW.MAPPING_COLUMN_NAME  END AS FIELD_NAME,
                    HT.DESCRIPTION,
                    RLD.PARENT_NODE, RLD.FLAG
                    FROM RELATIONSHIP_LEVEL_DEFINITION RLD 
                    JOIN HIERARCHY_LEVEL_DEFINITION HLD ON HLD.HIERARCHY_LEVEL_DEFINITION_SID=RLD.HIERARCHY_LEVEL_DEFINITION_SID 
                        AND (HLD.TABLE_NAME <>'') 
                    AND RLD.RELATIONSHIP_BUILDER_SID = ? 
                    JOIN HIERARCHY_DEFINITION HD ON HD.HIERARCHY_DEFINITION_SID=HLD.HIERARCHY_DEFINITION_SID
                    JOIN vw_helper_list JVIEW ON JVIEW.ACTUAL_TABLE_NAME=HLD.TABLE_NAME AND JVIEW.ACTUAL_COLUMN_NAME=HLD.FIELD_NAME
                    JOIN HELPER_TABLE HT ON HT.HELPER_TABLE_SID=HD.HIERARCHY_CATEGORY 
                    ORDER BY RLD.HIERARCHY_NO;
                ]]>
    </sql>
    
    <sql id="getHierarchyTableDetails">
		<![CDATA[
                    SELECT distinct 
                    CASE WHEN HLD.LEVEL_VALUE_REFERENCE='User Defined'  THEN 'LEVEL_VALUES' ELSE 
                        CASE WHEN HLD.TABLE_NAME=JVIEW.REFERENCE_TABLE_NAME OR JVIEW.REFERENCE_TABLE_NAME='HELPER_TABLE' THEN JVIEW.REFERENCE_COLUMN_NAME ELSE JVIEW.DESC_COLUMN_NAME END END DISPLAY_COLUMN,
                    CASE WHEN HLD.LEVEL_VALUE_REFERENCE='User Defined'  THEN 'HIERARCHY_LEVEL_VALUES' ELSE 
                        CASE WHEN HLD.TABLE_NAME=JVIEW.REFERENCE_TABLE_NAME THEN HLD.TABLE_NAME ELSE JVIEW.REFERENCE_TABLE_NAME  END END H_TABLE_NAME,
                    CASE WHEN HLD.LEVEL_VALUE_REFERENCE='User Defined'  THEN 'HIERARCHY_LEVEL_VALUES_SID' ELSE 
                        CASE WHEN JVIEW.MAPPING_COLUMN_NAME is null THEN JVIEW.PRIMARY_KEY_COLUMN_NAME ELSE JVIEW.MAPPING_COLUMN_NAME END END FIELD_NAME,
                    RLD.LEVEL_NO
                    FROM RELATIONSHIP_LEVEL_DEFINITION RLD 
                    JOIN HIERARCHY_LEVEL_DEFINITION HLD ON HLD.HIERARCHY_LEVEL_DEFINITION_SID=RLD.HIERARCHY_LEVEL_DEFINITION_SID AND RLD.RELATIONSHIP_BUILDER_SID =?RBSID
                    JOIN HIERARCHY_DEFINITION HD ON HD.HIERARCHY_DEFINITION_SID=HLD.HIERARCHY_DEFINITION_SID
                    LEFT JOIN vw_helper_list JVIEW ON JVIEW.ACTUAL_TABLE_NAME=HLD.TABLE_NAME AND JVIEW.ACTUAL_COLUMN_NAME=HLD.FIELD_NAME
                    JOIN HELPER_TABLE HT ON HT.HELPER_TABLE_SID=HD.HIERARCHY_CATEGORY ORDER BY RLD.LEVEL_NO;
                ]]>
    </sql>
    
    <sql id="getRelationshipLevelValues">
		<![CDATA[
                    SELECT RLD.HIERARCHY_NO , TEMP.?FIELD VALUE FROM RELATIONSHIP_LEVEL_DEFINITION RLD 
                    JOIN ?TABLE TEMP ON TEMP.?IDCOL=RLD.RELATIONSHIP_LEVEL_VALUES AND 
                    RLD.RELATIONSHIP_BUILDER_SID =?RBSID AND RLD.LEVEL_NO=?LNO 
                ]]>
    </sql>
    
    <sql id = "companyFilter">
        <![CDATA[
            SELECT DISTINCT ITEM.ITEM_MASTER_SID
            FROM GL_COST_CENTER_MASTER GLCOMP
            JOIN COMPANY_MASTER COMPANY ON GLCOMP.COMPANY_CODE = COMPANY.COMPANY_ID
            JOIN ITEM_MASTER ITEM ON ITEM.NDC8 = GLCOMP.NDC8
            WHERE COMPANY.COMPANY_MASTER_SID = 
        ]]>
    </sql> 
    <sql id="getHierarchyGroup">
		<![CDATA[
                        SELECT ?SELECTION? 
                        FROM HIERARCHY_LEVEL_DEFINITION A, HIERARCHY_LEVEL_DEFINITION B, HIERARCHY_DEFINITION C 
			WHERE A.HIERARCHY_DEFINITION_SID = B.HIERARCHY_DEFINITION_SID AND A.HIERARCHY_DEFINITION_SID = C.HIERARCHY_DEFINITION_SID 
			AND C.HIERARCHY_CATEGORY IN (SELECT HT.HELPER_TABLE_SID FROM HELPER_TABLE HT where HT.LIST_NAME = 'HIERARCHY_CATEGORY' AND HT.DESCRIPTION LIKE '?HIERARCHY_TYPE?') 
			AND B.HIERARCHY_DEFINITION_SID = C.HIERARCHY_DEFINITION_SID 
                        AND A.LEVEL_NO IN (SELECT MAX(H.LEVEL_NO) FROM HIERARCHY_LEVEL_DEFINITION H WHERE H.HIERARCHY_DEFINITION_SID = A.HIERARCHY_DEFINITION_SID) 
			AND B.LEVEL_NO IN (SELECT MIN(H.LEVEL_NO) FROM HIERARCHY_LEVEL_DEFINITION H WHERE H.HIERARCHY_DEFINITION_SID = B.HIERARCHY_DEFINITION_SID) 
			?HIERARCHY_NAME_CONDITION?
			?HIERARCHY_TYPE_CONDITION?
                        ?FILTER? 
                        ?ORDER_BY?
                ]]>
    </sql>
    
       
    <sql id="getInnerLevelCustomer">
		<![CDATA[
                   SELECT RLD.RELATIONSHIP_LEVEL_VALUES RELATIONSHIPLEVELVALUES, 
                    RLD.LEVEL_NO LEVELNO, RLD.PARENT_NODE PARENTNODE, 
                    RLD.RELATIONSHIP_LEVEL_SID RELATIONSHIPSID, 
                    HLD."TABLE_NAME" TABLENAME, 
                    HLD.FIELD_NAME FIELDNAME, 
                    RLD.HIERARCHY_NO HIERARCHYNO, 
                    CM.COMPANY_MASTER_SID COMPANYSID,
                    RB.RELATIONSHIP_BUILDER_SID
                    from RELATIONSHIP_LEVEL_DEFINITION RLD, 
                    RELATIONSHIP_BUILDER RB, 
                    HIERARCHY_LEVEL_DEFINITION HLD, 
                    COMPANY_MASTER CM
                    WHERE RLD.RELATIONSHIP_BUILDER_SID=RB.RELATIONSHIP_BUILDER_SID
                    AND HLD.HIERARCHY_LEVEL_DEFINITION_SID=RLD.HIERARCHY_LEVEL_DEFINITION_SID 
                    AND CM.COMPANY_MASTER_SID = RLD.RELATIONSHIP_LEVEL_VALUES AND CM.INBOUND_STATUS <> 'D'
                ]]>
    </sql>
    
       
    <sql id="getInnerLevelContract">
		<![CDATA[
                   SELECT RLD.RELATIONSHIP_LEVEL_VALUES RELATIONSHIPLEVELVALUES, 
                    RLD.LEVEL_NO LEVELNO, RLD.PARENT_NODE PARENTNODE, 
                    RLD.RELATIONSHIP_LEVEL_SID RELATIONSHIPSID, 
                    HLD."TABLE_NAME" TABLENAME, 
                    HLD.FIELD_NAME FIELDNAME, 
                    RLD.HIERARCHY_NO HIERARCHYNO, 
                    CN.CONTRACT_MASTER_SID CONTRACTSID,
                    RB.RELATIONSHIP_BUILDER_SID
                    from RELATIONSHIP_LEVEL_DEFINITION RLD, 
                    RELATIONSHIP_BUILDER RB, 
                    HIERARCHY_LEVEL_DEFINITION HLD, 
                    CONTRACT_MASTER CN
                    WHERE RLD.RELATIONSHIP_BUILDER_SID=RB.RELATIONSHIP_BUILDER_SID
                    AND HLD.HIERARCHY_LEVEL_DEFINITION_SID=RLD.HIERARCHY_LEVEL_DEFINITION_SID 
                    AND CN.CONTRACT_MASTER_SID = RLD.RELATIONSHIP_LEVEL_VALUES AND CN.INBOUND_STATUS <> 'D'
                ]]>
    </sql>
    <sql id="searchProjectionforchannel">
		<![CDATA[
                    SELECT PM.PROJECTION_MASTER_SID projectionId, PM.PROJECTION_NAME projectionName, PM.PROJECTION_DESCRIPTION description , 
                    HDC.HIERARCHY_DEFINITION_SID customerHierSid, HDC.HIERARCHY_NAME customerHierarchy, PM.CUSTOMER_HIERARCHY_LEVEL customerHierarchyLevel, HDP.HIERARCHY_DEFINITION_SID prodHierSid, 
                    HDP.HIERARCHY_NAME productHierarchy, PM.PRODUCT_HIERARCHY_LEVEL productHierarchyLevel, PM.CREATED_BY createdBy, PM.CREATED_DATE createdDate, PM.MODIFIED_DATE modifiedBy, PM.COMPANY_MASTER_SID companySid, 
                    PM.COMPANY_GROUP_SID customerGrpSid,  CG.COMPANY_GROUP_NAME customerGroup, PM.ITEM_GROUP_SID prodGrpSid, IG.ITEM_GROUP_NAME productGroup, PM.CUSTOMER_HIERARCHY_INNER_LEVEL customerHierarchyInnerLevel, 
                    PM.PRODUCT_HIERARCHY_INNER_LEVEL productHierarchyInnerLevel, PM.CUST_RELATIONSHIP_BUILDER_SID custRelationshipBuilderSid, PM.PROD_RELATIONSHIP_BUILDER_SID prodRelationshipBuilderSid, PM.DISCOUNT_TYPE discount,HT.DESCRIPTION discountType
                    From PROJECTION_MASTER PM
                  
                    JOIN HIERARCHY_DEFINITION HDC
                    ON HDC.HIERARCHY_DEFINITION_SID = PM.CUSTOMER_HIERARCHY_SID 

                    JOIN HIERARCHY_DEFINITION HDP
                    ON HDP.HIERARCHY_DEFINITION_SID = PM.PRODUCT_HIERARCHY_SID 
                    
                    JOIN HELPER_TABLE HT 
                    ON HT.HELPER_TABLE_SID = PM.DISCOUNT_TYPE AND HT.LIST_NAME = 'RS_TYPE'

                    LEFT JOIN COMPANY_GROUP CG
                    ON CG.COMPANY_GROUP_SID  = PM.COMPANY_GROUP_SID 

                    LEFT JOIN ITEM_GROUP IG 
                    ON IG.ITEM_GROUP_SID = PM.ITEM_GROUP_SID 
                    
                    
                    JOINPROJECTIONCUSTHIERARCHY
                    
                    JOINPROJECTIONPRODHIERARCHY
                    
                    WHERE  PM.IS_APPROVED not in ('Y','A')  AND PM.SAVE_FLAG = 'true'  AND PM.FORECASTING_TYPE like 'Channel' 

		]]>
    </sql>
    <sql id="searchProjectionCountforchannel">
		<![CDATA[
                    SELECT count (PM.PROJECTION_MASTER_SID) projectionId
                     From PROJECTION_MASTER PM 
                  
                    JOIN HIERARCHY_DEFINITION HDC
                    ON HDC.HIERARCHY_DEFINITION_SID = PM.CUSTOMER_HIERARCHY_SID 

                    JOIN HIERARCHY_DEFINITION HDP
                    ON HDP.HIERARCHY_DEFINITION_SID = PM.PRODUCT_HIERARCHY_SID 
                    
                    JOIN HELPER_TABLE HT 
                    ON HT.HELPER_TABLE_SID = PM.DISCOUNT_TYPE AND HT.LIST_NAME = 'RS_TYPE'

                    LEFT JOIN COMPANY_GROUP CG
                    ON CG.COMPANY_GROUP_SID  = PM.COMPANY_GROUP_SID 

                    LEFT JOIN ITEM_GROUP IG 
                    ON IG.ITEM_GROUP_SID = PM.ITEM_GROUP_SID 
                    
                    JOINPROJECTIONCUSTHIERARCHY
                    
                    JOINPROJECTIONPRODHIERARCHY
                    
                    WHERE  PM.IS_APPROVED not in ('Y','A') AND PM.SAVE_FLAG = 'true' AND PM.FORECASTING_TYPE like 'Channel' 

		]]>
    </sql>
    <sql id="loadAvailableProducts">
		<![CDATA[
	select distinct IM.ITEM_NO,IM.ITEM_NAME,IM.ITEM_MASTER_SID from dbo.COMPANY_MASTER CM
        join dbo.GL_COST_CENTER_MASTER GCM on GCM.COMPANY_CODE= CM.COMPANY_ID 
        join dbo.ITEM_MASTER IM  on IM.NDC8=GCM.NDC8         
		]]>
    </sql>
    
    <sql id="getProductGroups">
		<![CDATA[
                
                        SELECT DISTINCT IG.ITEM_GROUP_NO,
                        IG.ITEM_GROUP_NAME,
                        IG.ITEM_GROUP_SID,
                        CM.COMPANY_NAME,
                        CM.COMPANY_MASTER_SID,
                        IG.ITEM_GROUP_DESCRIPTION
                        FROM ITEM_GROUP IG  
                        JOIN COMPANY_MASTER CM ON CM.COMPANY_MASTER_SID = IG.COMPANY_MASTER_SID 


                ]]>
    </sql> 
    <sql id="getProductGroupsCount">
		<![CDATA[
                
                       SELECT count (DISTINCT IG.ITEM_GROUP_SID)
                        FROM ITEM_GROUP IG  
                        JOIN COMPANY_MASTER CM ON CM.COMPANY_MASTER_SID = IG.COMPANY_MASTER_SID 


                ]]>
    </sql> 
    <sql id="getProductNamesFromGroup">
            <![CDATA[
                SELECT DISTINCT IM.ITEM_NO,IM.ITEM_NAME,IM.ITEM_MASTER_SID,IM.THERAPEUTIC_CLASS from ITEM_MASTER IM
                join ITEM_GROUP_DETAILS IGD on IGD.ITEM_MASTER_SID = IM.ITEM_MASTER_SID 
                join ITEM_GROUP IG on IG.ITEM_GROUP_SID = IGD.ITEM_GROUP_SID ?PGQUERY 
                left join dbo.GL_COST_CENTER_MASTER GCM on GCM.NDC8= IM.NDC8 
                left join COMPANY_MASTER CM ON CM.COMPANY_ID=GCM.COMPANY_CODE ?CMQUERY 
                        ?TCQUERY 
            ]]>
    </sql>
   
    <sql id="getTableResults">
            <![CDATA[
                SELECT DISTINCT NAM.NA_PROJ_NAME,CM.COMPANY_NAME,IG.ITEM_GROUP_NAME,HT.DESCRIPTION,NAM.CREATED_DATE,NAM.MODIFIED_DATE,NAM.CREATED_BY,NAM.NA_PROJ_MASTER_SID,CM1.COMPANY_NAME  AS BU
                from NA_PROJ_MASTER NAM
                join NA_PROJ_DETAILS NAD on NAM.NA_PROJ_MASTER_SID=NAD.NA_PROJ_MASTER_SID 
                join ITEM_MASTER IM on IM.ITEM_MASTER_SID=NAD.ITEM_MASTER_SID 
                join COMPANY_MASTER CM on NAM.COMPANY_MASTER_SID =CM.COMPANY_MASTER_SID 
                left join ITEM_GROUP IG on IG.ITEM_GROUP_SID=NAM.ITEM_GROUP_SID 
                left join HELPER_TABLE HT on HT.HELPER_TABLE_SID=NAM.THERAPEUTIC_CLASS  
                join COMPANY_MASTER CM1 on NAM.BUSINESS_UNIT =CM1.COMPANY_MASTER_SID
                
            ]]>
    </sql>   
    <sql id="getTableResultsCount">
            <![CDATA[
           SELECT count(DISTINCT NAM.NA_PROJ_MASTER_SID)
                from NA_PROJ_MASTER NAM
                join NA_PROJ_DETAILS NAD on NAM.NA_PROJ_MASTER_SID=NAD.NA_PROJ_MASTER_SID 
                join ITEM_MASTER IM on IM.ITEM_MASTER_SID=NAD.ITEM_MASTER_SID 
                join COMPANY_MASTER CM on NAM.COMPANY_MASTER_SID =CM.COMPANY_MASTER_SID 
                left join ITEM_GROUP IG on IG.ITEM_GROUP_SID=NAM.ITEM_GROUP_SID 
                left join HELPER_TABLE HT on HT.HELPER_TABLE_SID=NAM.THERAPEUTIC_CLASS  
                join COMPANY_MASTER CM1 on NAM.BUSINESS_UNIT =CM1.COMPANY_MASTER_SID
                
            ]]>
    </sql>   
    <sql id="na.deleteMain">
                   <![CDATA[
                    Declare @NA_PROJ_MASTER_SID INT=?PID

                    DELETE from NA_PROJECTION_SELECTION where NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID

                    DELETE from NATIONAL_ASSUMPTIONS where NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID

                    DELETE FROM MEDICAID_URA_ACTUALS WHERE NA_PROJ_DETAILS_SID in (Select PD.NA_PROJ_DETAILS_SID FROM   NA_PROJ_MASTER PM,
                           NA_PROJ_DETAILS PD     
                    WHERE  PM.NA_PROJ_MASTER_SID = PD.NA_PROJ_MASTER_SID
                           AND PM.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID)

                    DELETE FROM MEDICAID_URA_PROJ WHERE NA_PROJ_DETAILS_SID in (Select PD.NA_PROJ_DETAILS_SID FROM   NA_PROJ_MASTER PM,
                           NA_PROJ_DETAILS PD     
                    WHERE  PM.NA_PROJ_MASTER_SID = PD.NA_PROJ_MASTER_SID
                           AND PM.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID)

                    DELETE FROM FCP_ACTUALS WHERE NA_PROJ_DETAILS_SID in (Select PD.NA_PROJ_DETAILS_SID FROM   NA_PROJ_MASTER PM,
                           NA_PROJ_DETAILS PD     
                    WHERE  PM.NA_PROJ_MASTER_SID = PD.NA_PROJ_MASTER_SID
                           AND PM.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID)

                    DELETE FROM FCP_PROJ WHERE NA_PROJ_DETAILS_SID in (Select PD.NA_PROJ_DETAILS_SID FROM   NA_PROJ_MASTER PM,
                           NA_PROJ_DETAILS PD     
                    WHERE  PM.NA_PROJ_MASTER_SID = PD.NA_PROJ_MASTER_SID
                           AND PM.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID)

                    DELETE FROM PHS_ACTUALS WHERE NA_PROJ_DETAILS_SID in (Select PD.NA_PROJ_DETAILS_SID FROM   NA_PROJ_MASTER PM,
                           NA_PROJ_DETAILS PD     
                    WHERE  PM.NA_PROJ_MASTER_SID = PD.NA_PROJ_MASTER_SID
                           AND PM.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID)

                    DELETE FROM PHS_PROJ WHERE NA_PROJ_DETAILS_SID in (Select PD.NA_PROJ_DETAILS_SID FROM   NA_PROJ_MASTER PM,
                           NA_PROJ_DETAILS PD     
                    WHERE  PM.NA_PROJ_MASTER_SID = PD.NA_PROJ_MASTER_SID
                           AND PM.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID)
                    
                    DELETE from ST_NATIONAL_ASSUMPTIONS where NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID

                    DELETE FROM ST_MEDICAID_URA_ACTUALS WHERE NA_PROJ_DETAILS_SID in (Select PD.NA_PROJ_DETAILS_SID FROM   NA_PROJ_MASTER PM,
                           NA_PROJ_DETAILS PD     
                    WHERE  PM.NA_PROJ_MASTER_SID = PD.NA_PROJ_MASTER_SID
                           AND PM.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID)


                    DELETE FROM ST_MEDICAID_URA_PROJ WHERE NA_PROJ_DETAILS_SID in (Select PD.NA_PROJ_DETAILS_SID FROM   NA_PROJ_MASTER PM,
                           NA_PROJ_DETAILS PD     
                    WHERE  PM.NA_PROJ_MASTER_SID = PD.NA_PROJ_MASTER_SID
                           AND PM.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID)

                    DELETE FROM ST_FCP_ACTUALS WHERE NA_PROJ_DETAILS_SID in (Select PD.NA_PROJ_DETAILS_SID FROM   NA_PROJ_MASTER PM,
                           NA_PROJ_DETAILS PD     
                    WHERE  PM.NA_PROJ_MASTER_SID = PD.NA_PROJ_MASTER_SID
                           AND PM.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID)

                    DELETE FROM ST_FCP_PROJ WHERE NA_PROJ_DETAILS_SID in (Select PD.NA_PROJ_DETAILS_SID FROM   NA_PROJ_MASTER PM,
                           NA_PROJ_DETAILS PD     
                    WHERE  PM.NA_PROJ_MASTER_SID = PD.NA_PROJ_MASTER_SID
                           AND PM.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID)

                    DELETE FROM ST_PHS_ACTUALS WHERE NA_PROJ_DETAILS_SID in (Select PD.NA_PROJ_DETAILS_SID FROM   NA_PROJ_MASTER PM,
                           NA_PROJ_DETAILS PD     
                    WHERE  PM.NA_PROJ_MASTER_SID = PD.NA_PROJ_MASTER_SID
                           AND PM.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID)

                    DELETE FROM ST_PHS_PROJ WHERE NA_PROJ_DETAILS_SID in (Select PD.NA_PROJ_DETAILS_SID FROM   NA_PROJ_MASTER PM,
                           NA_PROJ_DETAILS PD     
                    WHERE  PM.NA_PROJ_MASTER_SID = PD.NA_PROJ_MASTER_SID
                           AND PM.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID)
                
                   
                    ]]>
    </sql>
       
    <sql id="na.update">
                   <![CDATA[
                    
                    DELETE FROM MEDICAID_URA_ACTUALS WHERE NA_PROJ_DETAILS_SID in (?PID)

                    DELETE FROM MEDICAID_URA_PROJ WHERE NA_PROJ_DETAILS_SID in (?PID)

                    DELETE FROM FCP_ACTUALS WHERE NA_PROJ_DETAILS_SID in (?PID)

                    DELETE FROM FCP_PROJ WHERE NA_PROJ_DETAILS_SID in (?PID)

                    DELETE FROM PHS_ACTUALS WHERE NA_PROJ_DETAILS_SID in (?PID)

                    DELETE FROM PHS_PROJ WHERE NA_PROJ_DETAILS_SID in (?PID)
                 
                    DELETE FROM ST_MEDICAID_URA_ACTUALS WHERE NA_PROJ_DETAILS_SID in (?PID)

                    DELETE FROM ST_MEDICAID_URA_PROJ WHERE NA_PROJ_DETAILS_SID in (?PID)

                    DELETE FROM ST_FCP_ACTUALS WHERE NA_PROJ_DETAILS_SID in (?PID)

                    DELETE FROM ST_FCP_PROJ WHERE NA_PROJ_DETAILS_SID in (?PID)

                    DELETE FROM ST_PHS_ACTUALS WHERE NA_PROJ_DETAILS_SID in (?PID)

                    DELETE FROM ST_PHS_PROJ WHERE NA_PROJ_DETAILS_SID in (?PID)
                
                   
                    ]]>
    </sql>
    <sql id="getProjectionListsCount">
                <![CDATA[ 
                 SELECT Count(*)
FROM   (SELECT PM.PROJECTION_NAME,
               PM.PROJECTION_DESCRIPTION,
               CASE
                 WHEN Count(DISTINCT HT.DESCRIPTION) > 1 THEN 'MULTIPLE'
                 ELSE Max(HT.DESCRIPTION)
               END AS MARKET_TYPE,
               CASE
                 WHEN Count(DISTINCT CM.COMPANY_NO) > 1 THEN 'MULTIPLE'
                 ELSE Max(CM.COMPANY_NO)
               END AS CONTRACT_HOLDER,
               CASE
                 WHEN Count(DISTINCT C.CONTRACT_NO) > 1 THEN 'MULTIPLE'
                 ELSE Max(C.CONTRACT_NO)
               END AS CONTRACT,
               CASE
                 WHEN Count(DISTINCT BM.BRAND_NAME) > 1 THEN 'MULTIPLE'
                 ELSE Max(BM.BRAND_NAME)
               END AS BRAND,
               CASE
                 WHEN Count(DISTINCT IM.ITEM_NO) > 1 THEN 'MULTIPLE'
                 ELSE Max(IM.ITEM_NO)
               END AS ITEM_NO,
               CASE
                 WHEN Count(DISTINCT IM.ITEM_NAME) > 1 THEN 'MULTIPLE'
                 ELSE Max(IM.ITEM_NAME)
               END AS ITEM_NAME,
               PM.PROJECTION_MASTER_SID,
               PM.CREATED_DATE,
               PM.CREATED_BY
        FROM   PROJECTION_MASTER PM
               INNER JOIN PROJECTION_DETAILS PD
                       ON PD.PROJECTION_MASTER_SID = PM.PROJECTION_MASTER_SID
               INNER JOIN CCP_DETAILS CCP
                       ON CCP.CCP_DETAILS_SID = PD.CCP_DETAILS_SID
                       JOIN PROJECTION_DETAILS CUR_PD
                ON CUR_PD.CCP_DETAILS_SID = PD.CCP_DETAILS_SID
               INNER JOIN CONTRACT_MASTER C
                       ON C.CONTRACT_MASTER_SID = CCP.CONTRACT_MASTER_SID
               LEFT JOIN HELPER_TABLE HT
                      ON C.CONTRACT_TYPE = HT.HELPER_TABLE_SID
                         AND ( HT.LIST_NAME = 'CONTRACT_TYPE')
               LEFT JOIN COMPANY_MASTER CM
                      ON C.CONT_HOLD_COMPANY_MASTER_SID = CM.COMPANY_MASTER_SID
                         
               JOIN ITEM_MASTER IM
                 ON CCP.ITEM_MASTER_SID = IM.ITEM_MASTER_SID
               LEFT JOIN BRAND_MASTER BM
                      ON BM.BRAND_MASTER_SID = IM.BRAND_MASTER_SID
                        
        WHERE
                ]]>
    </sql>
    <sql id="getWorkFlowListsCount">
                <![CDATA[
               SELECT Count(*)
FROM   (SELECT PM.PROJECTION_NAME,
               PM.PROJECTION_DESCRIPTION,
               CASE
                 WHEN Count(DISTINCT HT.DESCRIPTION) > 1 THEN 'MULTIPLE'
                 ELSE Max(HT.DESCRIPTION)
               END AS MARKET_TYPE,
               CASE
                 WHEN Count(DISTINCT CM.COMPANY_NO) > 1 THEN 'MULTIPLE'
                 ELSE Max(CM.COMPANY_NO)
               END AS CONTRACT_HOLDER,
               CASE
                 WHEN Count(DISTINCT C.CONTRACT_NO) > 1 THEN 'MULTIPLE'
                 ELSE Max(C.CONTRACT_NO)
               END AS CONTRACT,
               CASE
                 WHEN Count(DISTINCT BM.BRAND_NAME) > 1 THEN 'MULTIPLE'
                 ELSE Max(BM.BRAND_NAME)
               END AS BRAND,
               CASE
                 WHEN Count(DISTINCT IM.ITEM_NO) > 1 THEN 'MULTIPLE'
                 ELSE Max(IM.ITEM_NO)
               END AS ITEM_NO,
               CASE
                 WHEN Count(DISTINCT IM.ITEM_NAME) > 1 THEN 'MULTIPLE'
                 ELSE Max(IM.ITEM_NAME)
               END AS ITEM_NAME,
               PM.PROJECTION_MASTER_SID,
               PM.CREATED_DATE,
               PM.CREATED_BY
        FROM   PROJECTION_MASTER PM
               INNER JOIN WORKFLOW_MASTER WM
                       ON PM.PROJECTION_MASTER_SID = WM.PROJECTION_MASTER_SID
               LEFT JOIN HELPER_TABLE HT1
                      ON HT1.HELPER_TABLE_SID = WM.WORKFLOW_STATUS_ID
                         AND HT1.LIST_NAME = 'WORKFLOWSTATUS'
                       
               INNER JOIN PROJECTION_DETAILS PD
                       ON PD.PROJECTION_MASTER_SID = PM.PROJECTION_MASTER_SID
               INNER JOIN CCP_DETAILS CCP
                       ON CCP.CCP_DETAILS_SID = PD.CCP_DETAILS_SID
                       JOIN PROJECTION_DETAILS CUR_PD
                ON CUR_PD.CCP_DETAILS_SID = PD.CCP_DETAILS_SID
               INNER JOIN CONTRACT_MASTER C
                       ON C.CONTRACT_MASTER_SID = CCP.CONTRACT_MASTER_SID
               LEFT JOIN HELPER_TABLE HT
                      ON C.CONTRACT_TYPE = HT.HELPER_TABLE_SID
                         AND ( HT.LIST_NAME = 'CONTRACT_TYPE'
                                )
               LEFT JOIN COMPANY_MASTER CM
                      ON C.CONT_HOLD_COMPANY_MASTER_SID = CM.COMPANY_MASTER_SID
                       
               JOIN ITEM_MASTER IM
                 ON CCP.ITEM_MASTER_SID = IM.ITEM_MASTER_SID
               LEFT JOIN BRAND_MASTER BM
                      ON BM.BRAND_MASTER_SID = IM.BRAND_MASTER_SID
                         
        WHERE
                ]]>
    </sql>
    <sql id="getCustomerGroupPaged">
		<![CDATA[
                    SELECT ?SELECTION?
                    FROM COMPANY_GROUP CG, COMPANY_GROUP_DETAILS CGD
                    WHERE  CG.COMPANY_GROUP_SID = CGD.COMPANY_GROUP_SID 
		]]>
    </sql>
    <sql id="getProductGroupPaged">
		<![CDATA[
                    SELECT ?SELECTION?
                    FROM ITEM_GROUP IG, COMPANY_MASTER CM, ITEM_GROUP_DETAILS IGD
                    WHERE IG.COMPANY_MASTER_SID = CM.COMPANY_MASTER_SID
                    AND IGD.ITEM_GROUP_SID = IG.ITEM_GROUP_SID 
		]]>
    </sql>
    
    <sql id="getFileEndDate">
    <![CDATA[
            WITH CTE
             AS (SELECT FORECAST_NAME,
                        [VERSION],
                        DESCRIPTION AS FILE_TYPE
                 FROM   (SELECT FT.FORECAST_NAME,
                                FT.[VERSION],
                                HT.DESCRIPTION,
                                FT.FROM_PERIOD,
                                Row_number()
                                  OVER (
                                    PARTITION BY FT.FILE_TYPE
                                    ORDER BY FT.FROM_PERIOD DESC) RN
                         FROM   FILE_MANAGEMENT FT
                                INNER JOIN HELPER_TABLE HT
                                        ON HT.HELPER_TABLE_SID = FT.FILE_TYPE
                         WHERE  ( CONVERT(DATE, FT.FROM_PERIOD) <= CONVERT(DATE, Getdate())
                                  AND FT.FROM_PERIOD IS NOT NULL )
                                AND ( CONVERT(DATE, FT.TO_PERIOD) >= CONVERT(DATE, Getdate())
                                       OR FT.TO_PERIOD IS NULL )
                                AND HT.LIST_NAME = 'FILE_TYPE'
                                AND HT.DESCRIPTION IN ( 'EX-FACTORY SALES', 'DEMAND', 'INVENTORY WITHDRAWAL - FORECAST SUMMARY' )
                                AND FT.BUSINESS_UNIT = [?BUSINESS_UNIT] )A
                 WHERE  RN = 1)
            SELECT TOP 1 FORECAST_YEAR,
                         FORECAST_MONTH
            FROM   (SELECT Cast(FORECAST_YEAR AS INT)  FORECAST_YEAR,
                           Cast(FORECAST_MONTH AS INT) FORECAST_MONTH
                    FROM   FORECASTING_MASTER f
                           INNER JOIN CTE c
                                   ON c.FORECAST_NAME = f.FORECAST_NAME
                                      AND FORECAST_VER IN ( c.[VERSION], Floor(c.VERSION) )
                    UNION ALL
                    SELECT FORECAST_YEAR,
                           FORECAST_MONTH
                    FROM   DEMAND_FORECAST f
                           INNER JOIN CTE c
                                   ON c.FORECAST_NAME = f.FORECAST_NAME
                                      AND FORECAST_VER IN ( c.[VERSION], Floor(c.VERSION) )
                    UNION ALL
                    SELECT YEAR,
                           MONTH
                    FROM   INVENTORY_WD_PROJ_MAS f
                           INNER JOIN CTE c
                                   ON c.FORECAST_NAME = f.FORECAST_NAME
                                      AND FORECAST_VER IN ( c.[VERSION], Floor(c.VERSION) )) A
            ORDER  BY FORECAST_YEAR DESC,
                      FORECAST_MONTH DESC;
        ]]>
    </sql>
    <sql id="getAccrualSelection">
		<![CDATA[
                    SELECT FIELD_NAME, FIELD_VALUES FROM ACCRUAL_PROJ_SELECTION WHERE PROJECTION_MASTER_SID = ?PROJECTION_ID; 
		]]>
    </sql>
    

    <sql id="get-inner-level-companies">        
            <![CDATA[
                SELECT DISTINCT
                    RLD.RELATIONSHIP_LEVEL_VALUES RELATIONSHIPLEVELVALUES,
                    RLD.LEVEL_NO LEVELNO,
                    RLD.PARENT_NODE PARENTNODE,
                    RLD.RELATIONSHIP_LEVEL_SID RELATIONSHIPSID,
                    HLD."TABLE_NAME" TABLENAME,
                    HLD.FIELD_NAME FIELDNAME,
                    RLD.HIERARCHY_NO HIERARCHYNO,
                    CM.COMPANY_MASTER_SID COMPANYSID,
                    RB.RELATIONSHIP_BUILDER_SID
                FROM
                    RELATIONSHIP_LEVEL_DEFINITION RLD,
                    RELATIONSHIP_BUILDER RB,
                    HIERARCHY_LEVEL_DEFINITION HLD,
                    COMPANY_MASTER CM,
                    GL_COST_CENTER_MASTER GLC,
                    ITEM_MASTER IM
                WHERE
                    RLD.RELATIONSHIP_BUILDER_SID = RB.RELATIONSHIP_BUILDER_SID
                    AND HLD.HIERARCHY_LEVEL_DEFINITION_SID = RLD.HIERARCHY_LEVEL_DEFINITION_SID
                    AND CM.COMPANY_MASTER_SID = RLD.RELATIONSHIP_LEVEL_VALUES
                    AND CM.INBOUND_STATUS <> 'D'
            ]]>        
    </sql>
    
    <sql id="get-inner-level-brand-therapeutic-class">
        
            <![CDATA[
                select
                    distinct RLD.relationship_Level_Values,
                    RLD.level_No,
                    RLD.parent_Node,
                    RLD.relationship_Level_Sid,
                    HLD.table_Name,
                    HLD.field_Name,
                    RLD.hierarchy_No,
                    RB.relationship_Builder_Sid,
                    RLD.level_Name
                from
                    Relationship_Level_Definition RLD,
                    Relationship_Builder RB,
                    Hierarchy_Level_Definition HLD
                where
                    RLD.relationship_Builder_Sid = RB.relationship_Builder_Sid
                    and HLD.hierarchy_Level_Definition_Sid = RLD.hierarchy_Level_Definition_Sid
      ]]>
        
    </sql>
    
    <sql id="get-inner-level-products">
       
            <![CDATA[
                SELECT
                    DISTINCT RLD.RELATIONSHIP_LEVEL_VALUES RELATIONSHIPLEVELVALUES,
                    RLD.LEVEL_NO LEVELNO,
                    RLD.PARENT_NODE PARENTNODE,
                    RLD.RELATIONSHIP_LEVEL_SID RELATIONSHIPSID,
                    HLD."TABLE_NAME" TABLENAME,
                    HLD.FIELD_NAME FIELDNAME,
                    RLD.HIERARCHY_NO HIERARCHYNO,
                    IM.ITEM_MASTER_SID ITEMSID,
                    H1.DESCRIPTION FORM,
                    H2.DESCRIPTION STRENGTH,
                    RB.RELATIONSHIP_BUILDER_SID
            from
                    RELATIONSHIP_LEVEL_DEFINITION RLD,
                    RELATIONSHIP_BUILDER RB,
                    HIERARCHY_LEVEL_DEFINITION HLD,
                    ITEM_MASTER IM,
                    HELPER_TABLE H1,
                    HELPER_TABLE H2,
                    COMPANY_MASTER CM,
                    GL_COST_CENTER_MASTER GLC
            WHERE
                    RLD.RELATIONSHIP_BUILDER_SID = RB.RELATIONSHIP_BUILDER_SID
                    AND HLD.HIERARCHY_LEVEL_DEFINITION_SID = RLD.HIERARCHY_LEVEL_DEFINITION_SID
                    AND IM.ITEM_MASTER_SID = RLD.RELATIONSHIP_LEVEL_VALUES
                    AND IM.INBOUND_STATUS <> 'D'
                    AND H1.HELPER_TABLE_SID = IM.FORM
                    AND H2.HELPER_TABLE_SID = IM.STRENGTH
            ]]>
       
    </sql>
    
    <sql id="get-lower-levels-based-on-hierarchy-no">
        
            <![CDATA[
                DECLARE @BU_COMPANY_MASTER_SID    INT = [?BU_COMPANY_MASTER_SID],
                        @PROJECTION_MASTER_SID    INT = [?PROJECTION_MASTER_SID]

                IF Object_id('TEMPDB..#DETAILS') IS NOT NULL
                  DROP TABLE #DETAILS

                CREATE TABLE #DETAILS
                  (
                     RELATIONSHIP_LEVEL_SID INT,
                     MASTER_SID             INT,
                     LEVEL_NAME             VARCHAR(50)
                  )

                IF Object_id('TEMPDB..#RESULT') IS NOT NULL
                  DROP TABLE #RESULT

                CREATE TABLE #RESULT
                  (
                     RELATIONSHIP_LEVEL_SID INT,
                     LEVEL_NAME             VARCHAR(50)
                  )

                INSERT INTO #DETAILS
                SELECT RELATIONSHIP_LEVEL_SID,
                       RELATIONSHIP_LEVEL_VALUES AS MASTER_SID,
                       RLD.LEVEL_NAME
                FROM   RELATIONSHIP_LEVEL_DEFINITION RLD
                       JOIN HIERARCHY_LEVEL_DEFINITION HLD
                         ON HLD.HIERARCHY_LEVEL_DEFINITION_SID = RLD.HIERARCHY_LEVEL_DEFINITION_SID
                WHERE  ( [?HIERARCHY_INCLUDE] )
                       AND HIERARCHY_NO NOT IN ( [?HIERARCHY_EXCLUDE] )

                IF EXISTS (SELECT 1
                           FROM   #DETAILS
                           WHERE  LEVEL_NAME IN ('COMPANY','GLCOMP'))
                  INSERT INTO #RESULT
                              (RELATIONSHIP_LEVEL_SID,
                               LEVEL_NAME)
                  SELECT d.RELATIONSHIP_LEVEL_SID,
                         LEVEL_NAME
                  FROM   GL_COST_CENTER_MASTER GL
                         JOIN COMPANY_MASTER CM
                           ON GL.COMPANY_CODE = CM.COMPANY_ID
                         JOIN ITEM_MASTER IM
                           ON IM.NDC8 = GL.NDC8
                         JOIN #DETAILS D
                           ON D.MASTER_SID = CM.COMPANY_MASTER_SID
                  WHERE  GL.INBOUND_STATUS <> 'D'
                         AND IM.ORGANIZATION_KEY = @BU_COMPANY_MASTER_SID

                IF EXISTS (SELECT 1
                           FROM   #DETAILS
                           WHERE  LEVEL_NAME = 'BRAND')
                  INSERT INTO #RESULT
                              (RELATIONSHIP_LEVEL_SID,
                               LEVEL_NAME)
                  SELECT d.RELATIONSHIP_LEVEL_SID,
                         LEVEL_NAME
                  FROM   ITEM_MASTER IM
                         JOIN #DETAILS D
                           ON D.MASTER_SID = IM.BRAND_MASTER_SID
                  WHERE  IM.ORGANIZATION_KEY = @BU_COMPANY_MASTER_SID

                IF EXISTS (SELECT 1
                           FROM   #DETAILS
                           WHERE  LEVEL_NAME IN ( 'NDC', 'N.D.C.','ITEM','PRODUCT' ))
                  INSERT INTO #RESULT
                              (RELATIONSHIP_LEVEL_SID,
                               LEVEL_NAME)
                  SELECT d.RELATIONSHIP_LEVEL_SID,
                         LEVEL_NAME
                  FROM   #DETAILS D
                         JOIN ITEM_MASTER IM
                           ON IM.ITEM_MASTER_SID = D.MASTER_SID
                  WHERE  IM.ORGANIZATION_KEY = @BU_COMPANY_MASTER_SID

                IF EXISTS (SELECT 1
                           FROM   #DETAILS
                           WHERE  LEVEL_NAME LIKE '%THERAPEUTIC%CLASS%')
                  INSERT INTO #RESULT
                              (RELATIONSHIP_LEVEL_SID,
                               LEVEL_NAME)
                  SELECT d.RELATIONSHIP_LEVEL_SID,
                         LEVEL_NAME
                  FROM   ITEM_MASTER IM
                         JOIN #DETAILS D
                           ON D.MASTER_SID = IM.THERAPEUTIC_CLASS
                  WHERE  IM.ORGANIZATION_KEY = @BU_COMPANY_MASTER_SID

                SELECT RELATIONSHIP_LEVEL_SID
                FROM   #RESULT TEMP_RES
                WHERE
                TEMP_RES.RELATIONSHIP_LEVEL_SID NOT IN(
		SELECT
			PH.RELATIONSHIP_LEVEL_SID
		FROM
			[?HIERARCHY_TABLE] PH
		WHERE
			PH.[?MASTER_TABLE_SID_COLUMN] = @PROJECTION_MASTER_SID );
         ]]>        
    </sql>
      <sql id="getChildLevelsBasedonBU">
		<![CDATA[
                 IF Object_id('TEMPDB..#DETAILS') IS NOT NULL
                 DROP TABLE #DETAILS

                CREATE TABLE #DETAILS
                  (
                     RELATIONSHIP_LEVEL_SID INT,
                     RELATIONSHIP_LEVEL_VALUES VARCHAR(50),
                     LEVEL_NAME             VARCHAR(50),
                     RELATIONSHIP_BUILDER_SID INT,
                     LEVEL_NO          VARCHAR(50),
                     PARENT_NODE VARCHAR(100),
                     HIERARCHY_NO VARCHAR(50),
                     LEVEL_VALUE_REFERENCE VARCHAR(20),
                     TABLE_NAME VARCHAR(128),
                     FIELD_NAME VARCHAR(128)  
                  )

                IF Object_id('TEMPDB..#RESULT') IS NOT NULL
                  DROP TABLE #RESULT

                CREATE TABLE #RESULT
                  (
                     RELATIONSHIP_LEVEL_SID INT,
                     RELATIONSHIP_LEVEL_VALUES VARCHAR(50),
                     LEVEL_NAME             VARCHAR(50),
                     RELATIONSHIP_BUILDER_SID INT,
                     LEVEL_NO          VARCHAR(50),
                     PARENT_NODE VARCHAR(100),
                     HIERARCHY_NO VARCHAR(50),
                     LEVEL_VALUE_REFERENCE VARCHAR(20),
                     TABLE_NAME VARCHAR(128),
                     FIELD_NAME VARCHAR(128)      
                  )

                INSERT INTO #DETAILS
                (
                     RELATIONSHIP_LEVEL_SID ,
                     RELATIONSHIP_LEVEL_VALUES,
                     LEVEL_NAME             ,
                     RELATIONSHIP_BUILDER_SID ,
                     LEVEL_NO          ,
                     PARENT_NODE ,
                     HIERARCHY_NO ,
                     LEVEL_VALUE_REFERENCE ,
                     TABLE_NAME ,
                     FIELD_NAME   
                  )
                SELECT RELATIONSHIP_LEVEL_SID,
                       RELATIONSHIP_LEVEL_VALUES,
                       RLD.LEVEL_NAME AS LEVEL_NAME,
                       RELATIONSHIP_BUILDER_SID,
                       RLD.LEVEL_NO AS LEVEL_NO,
                       PARENT_NODE,
                       HIERARCHY_NO,
                       LEVEL_VALUE_REFERENCE,
                       TABLE_NAME,
                       FIELD_NAME
                       
                FROM   RELATIONSHIP_LEVEL_DEFINITION RLD
                       JOIN HIERARCHY_LEVEL_DEFINITION HLD
                         ON HLD.HIERARCHY_LEVEL_DEFINITION_SID = RLD.HIERARCHY_LEVEL_DEFINITION_SID
                WHERE   RLD.HIERARCHY_NO LIKE '@HIERNO1%' AND RLD.HIERARCHY_NO != '@HIERNO2'  AND RLD.LEVEL_NO <= @LVLNO
                  

                IF EXISTS (SELECT 1
                           FROM   #DETAILS
                           WHERE  LEVEL_NAME IN ('COMPANY','GLCOMP'))
                  INSERT INTO #RESULT
                              ( RELATIONSHIP_LEVEL_SID,
                     RELATIONSHIP_LEVEL_VALUES,
                     LEVEL_NAME,
                     RELATIONSHIP_BUILDER_SID,
                     LEVEL_NO,
                     PARENT_NODE,
                     HIERARCHY_NO,
                     LEVEL_VALUE_REFERENCE,
                     TABLE_NAME,
                     FIELD_NAME)
                  SELECT D.RELATIONSHIP_LEVEL_SID,
                        D.RELATIONSHIP_LEVEL_VALUES,
                       D.LEVEL_NAME,
                       D.RELATIONSHIP_BUILDER_SID,
                       D.LEVEL_NO,
                       D.PARENT_NODE,
                       D.HIERARCHY_NO,
                       D.LEVEL_VALUE_REFERENCE,
                       D.TABLE_NAME,
                       D.FIELD_NAME
                  FROM   GL_COST_CENTER_MASTER GL
                         JOIN COMPANY_MASTER CM
                           ON GL.COMPANY_CODE = CM.COMPANY_ID
                         JOIN ITEM_MASTER IM
                           ON IM.NDC8 = GL.NDC8
                         JOIN #DETAILS D
                           ON D.RELATIONSHIP_LEVEL_VALUES = CM.COMPANY_MASTER_SID
                  WHERE  GL.INBOUND_STATUS <> 'D'
                         AND IM.ORGANIZATION_KEY = @BU_COMPANY_MASTER_SID

                IF EXISTS (SELECT 1
                           FROM   #DETAILS
                           WHERE  LEVEL_NAME = 'BRAND')
                  INSERT INTO #RESULT
                              (RELATIONSHIP_LEVEL_SID,
                     RELATIONSHIP_LEVEL_VALUES,
                     LEVEL_NAME,
                     RELATIONSHIP_BUILDER_SID,
                     LEVEL_NO,
                     PARENT_NODE,
                     HIERARCHY_NO,
                     LEVEL_VALUE_REFERENCE,
                     TABLE_NAME,
                     FIELD_NAME)
              SELECT D.RELATIONSHIP_LEVEL_SID,
                        D.RELATIONSHIP_LEVEL_VALUES,
                       D.LEVEL_NAME,
                       D.RELATIONSHIP_BUILDER_SID,
                       D.LEVEL_NO,
                       D.PARENT_NODE,
                       D.HIERARCHY_NO,
                       D.LEVEL_VALUE_REFERENCE,
                       D.TABLE_NAME,
                       D.FIELD_NAME
                  FROM   ITEM_MASTER IM
                         JOIN #DETAILS D
                           ON D.RELATIONSHIP_LEVEL_VALUES = IM.BRAND_MASTER_SID
                  WHERE  IM.ORGANIZATION_KEY = @BU_COMPANY_MASTER_SID

                IF EXISTS (SELECT 1
                           FROM   #DETAILS
                           WHERE  LEVEL_NAME IN ( 'NDC', 'N.D.C.','ITEM','PRODUCT' ))
                  INSERT INTO #RESULT
                              (RELATIONSHIP_LEVEL_SID,
                     RELATIONSHIP_LEVEL_VALUES,
                     LEVEL_NAME,
                     RELATIONSHIP_BUILDER_SID,
                     LEVEL_NO,
                     PARENT_NODE,
                     HIERARCHY_NO,
                     LEVEL_VALUE_REFERENCE,
                     TABLE_NAME,
                     FIELD_NAME)
               SELECT D.RELATIONSHIP_LEVEL_SID,
                        D.RELATIONSHIP_LEVEL_VALUES,
                       D.LEVEL_NAME,
                       D.RELATIONSHIP_BUILDER_SID,
                      D.LEVEL_NO,
                       D.PARENT_NODE,
                       D.HIERARCHY_NO,
                       D.LEVEL_VALUE_REFERENCE,
                       D.TABLE_NAME,
                       D.FIELD_NAME
                  FROM   #DETAILS D
                         JOIN ITEM_MASTER IM
                           ON IM.ITEM_MASTER_SID = D.RELATIONSHIP_LEVEL_VALUES
                  WHERE  IM.ORGANIZATION_KEY = @BU_COMPANY_MASTER_SID

                IF EXISTS (SELECT 1
                           FROM   #DETAILS
                           WHERE  LEVEL_NAME LIKE '%THERAPEUTIC%CLASS%')
                  INSERT INTO #RESULT
                              (RELATIONSHIP_LEVEL_SID,
                     RELATIONSHIP_LEVEL_VALUES,
                     LEVEL_NAME,
                     RELATIONSHIP_BUILDER_SID,
                     LEVEL_NO,
                     PARENT_NODE,
                     HIERARCHY_NO,
                     LEVEL_VALUE_REFERENCE,
                     TABLE_NAME,
                     FIELD_NAME)
                   SELECT D.RELATIONSHIP_LEVEL_SID,
                        D.RELATIONSHIP_LEVEL_VALUES,
                       D.LEVEL_NAME,
                       D.RELATIONSHIP_BUILDER_SID,
                       D.LEVEL_NO,
                       D.PARENT_NODE,
                       D.HIERARCHY_NO,
                       D.LEVEL_VALUE_REFERENCE,
                       D.TABLE_NAME,
                       D.FIELD_NAME
                  FROM   ITEM_MASTER IM
                         JOIN #DETAILS D
                           ON D.RELATIONSHIP_LEVEL_VALUES = IM.THERAPEUTIC_CLASS
                  WHERE  IM.ORGANIZATION_KEY = @BU_COMPANY_MASTER_SID

  SELECT
  LEVEL_NO,
  RELATIONSHIP_LEVEL_VALUES,
  PARENT_NODE,
  LEVEL_NAME,
  LEVEL_VALUE_REFERENCE,
  TABLE_NAME,
  FIELD_NAME,
  RELATIONSHIP_LEVEL_SID,
  HIERARCHY_NO,
  RELATIONSHIP_BUILDER_SID
  FROM #RESULT TEMP_RES


		]]>
    </sql>
     <sql id="get-lower-levels-based-on-hierarchy-no-with-projId">
        
            <![CDATA[
                DECLARE @BU_COMPANY_MASTER_SID    INT = [?BU_COMPANY_MASTER_SID],
                        @PROJECTION_MASTER_SID    INT = [?PROJECTION_MASTER_SID]

                IF Object_id('TEMPDB..#DETAILS') IS NOT NULL
                  DROP TABLE #DETAILS

                CREATE TABLE #DETAILS
                  (
                     RELATIONSHIP_LEVEL_SID INT,
                     MASTER_SID             INT,
                     LEVEL_NAME             VARCHAR(50)
                  )

                IF Object_id('TEMPDB..#RESULT') IS NOT NULL
                  DROP TABLE #RESULT

                CREATE TABLE #RESULT
                  (
                     RELATIONSHIP_LEVEL_SID INT,
                     LEVEL_NAME             VARCHAR(50)
                  )

                INSERT INTO #DETAILS
                SELECT RELATIONSHIP_LEVEL_SID,
                       RELATIONSHIP_LEVEL_VALUES AS MASTER_SID,
                       RLD.LEVEL_NAME
                FROM   RELATIONSHIP_LEVEL_DEFINITION RLD
                       JOIN HIERARCHY_LEVEL_DEFINITION HLD
                         ON HLD.HIERARCHY_LEVEL_DEFINITION_SID = RLD.HIERARCHY_LEVEL_DEFINITION_SID
                WHERE  ( [?HIERARCHY_INCLUDE] )
                       AND HIERARCHY_NO NOT IN ( [?HIERARCHY_EXCLUDE] )

                IF EXISTS (SELECT 1
                           FROM   #DETAILS
                           WHERE  LEVEL_NAME IN ('COMPANY','GLCOMP'))
                  INSERT INTO #RESULT
                              (RELATIONSHIP_LEVEL_SID,
                               LEVEL_NAME)
                  SELECT d.RELATIONSHIP_LEVEL_SID,
                         LEVEL_NAME
                  FROM   GL_COST_CENTER_MASTER GL
                         JOIN COMPANY_MASTER CM
                           ON GL.COMPANY_CODE = CM.COMPANY_ID
                         JOIN ITEM_MASTER IM
                           ON IM.NDC8 = GL.NDC8
                         JOIN #DETAILS D
                           ON D.MASTER_SID = CM.COMPANY_MASTER_SID
                  WHERE  GL.INBOUND_STATUS <> 'D'
                         AND IM.ORGANIZATION_KEY = @BU_COMPANY_MASTER_SID

                IF EXISTS (SELECT 1
                           FROM   #DETAILS
                           WHERE  LEVEL_NAME = 'BRAND')
                  INSERT INTO #RESULT
                              (RELATIONSHIP_LEVEL_SID,
                               LEVEL_NAME)
                  SELECT d.RELATIONSHIP_LEVEL_SID,
                         LEVEL_NAME
                  FROM   ITEM_MASTER IM
                         JOIN #DETAILS D
                           ON D.MASTER_SID = IM.BRAND_MASTER_SID
                  WHERE  IM.ORGANIZATION_KEY = @BU_COMPANY_MASTER_SID

                IF EXISTS (SELECT 1
                           FROM   #DETAILS
                           WHERE  LEVEL_NAME IN ( 'NDC', 'N.D.C.','ITEM','PRODUCT' ))
                  INSERT INTO #RESULT
                              (RELATIONSHIP_LEVEL_SID,
                               LEVEL_NAME)
                  SELECT d.RELATIONSHIP_LEVEL_SID,
                         LEVEL_NAME
                  FROM   #DETAILS D
                         JOIN ITEM_MASTER IM
                           ON IM.ITEM_MASTER_SID = D.MASTER_SID
                  WHERE  IM.ORGANIZATION_KEY = @BU_COMPANY_MASTER_SID

                IF EXISTS (SELECT 1
                           FROM   #DETAILS
                           WHERE  LEVEL_NAME LIKE '%THERAPEUTIC%CLASS%')
                  INSERT INTO #RESULT
                              (RELATIONSHIP_LEVEL_SID,
                               LEVEL_NAME)
                  SELECT d.RELATIONSHIP_LEVEL_SID,
                         LEVEL_NAME
                  FROM   ITEM_MASTER IM
                         JOIN #DETAILS D
                           ON D.MASTER_SID = IM.THERAPEUTIC_CLASS
                  WHERE  IM.ORGANIZATION_KEY = @BU_COMPANY_MASTER_SID
                 
                
               
         ]]>        
    </sql>
    <sql id="get-lower-levels-based-on-hierarchy-no-with-projId-Select">
          <![CDATA[
         SELECT @PROJECTION_MASTER_SID,RELATIONSHIP_LEVEL_SID
                FROM   #RESULT TEMP_RES
                WHERE
                TEMP_RES.RELATIONSHIP_LEVEL_SID NOT IN(
		SELECT
			PH.RELATIONSHIP_LEVEL_SID
		FROM
			[?HIERARCHY_TABLE] PH
		WHERE
			PH.[?MASTER_TABLE_SID_COLUMN] = @PROJECTION_MASTER_SID );
         ]]> 
    </sql>
</custom-sql>
