<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE xml>
<!-- To change this license header, choose License Headers in Project Properties. 
	To change this template file, choose Tools | Templates and open the template 
	in the editor. -->

<sql>
	<entity id="GET_PROJECTION_DETAILS">
		<query> 
		                    <![CDATA[
  SELECT DISTINCT
        PM.PROJECTION_NAME projectionName,
        PM.PROJECTION_DESCRIPTION description,
        PM.PRODUCT_HIERARCHY_LEVEL productLevel,
        PM.BUSINESS_UNIT AS businessUnit,
        PM.COMPANY_MASTER_SID companySid,
        PM.ITEM_GROUP_SID prodGrpSid,
        PM.PRODUCT_HIERARCHY_SID productHierarchySid,
        PM.PROD_RELATIONSHIP_BUILDER_SID relationshipSid,
        PM.PRODUCT_HIERARCHY_INNER_LEVEL innerHierarchyLevel,
        FP.PERIOD_SID fromPeriod,
        TP.PERIOD_SID toPeriod
From
        PROJECTION_MASTER PM
JOIN HIERARCHY_DEFINITION HDP ON
        HDP.HIERARCHY_DEFINITION_SID = PM.PRODUCT_HIERARCHY_SID
LEFT JOIN COMPANY_GROUP CG ON
        CG.COMPANY_GROUP_SID = PM.COMPANY_GROUP_SID
LEFT JOIN ITEM_GROUP IG ON
        IG.ITEM_GROUP_SID = PM.ITEM_GROUP_SID
JOIN PROJECTION_PROD_HIERARCHY PPH ON
        PPH.PROJECTION_MASTER_SID = PM.PROJECTION_MASTER_SID
LEFT JOIN RELATIONSHIP_LEVEL_DEFINITION RLD
        ON RLD.RELATIONSHIP_LEVEL_SID = PPH.RELATIONSHIP_LEVEL_SID
JOIN COMPANY_MASTER CM on
        PM.COMPANY_MASTER_SID = CM.COMPANY_MASTER_SID
JOIN COMPANY_MASTER CM1 on
       PM.BUSINESS_UNIT = CM1.COMPANY_MASTER_SID
JOIN dbo.PERIOD FP on
       FP."YEAR" = YEAR(PM.FROM_DATE) and FP."MONTH" = MONTH(FROM_DATE)
JOIN dbo.PERIOD TP on
       TP."YEAR" = YEAR(PM.TO_DATE) and TP."MONTH" = MONTH(TO_DATE)
      
WHERE PM.FORECASTING_TYPE like 'Returns' AND PM.PROJECTION_MASTER_SID=?

 ]]>
		</query>
	</entity>


</sql>
         
