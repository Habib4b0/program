<?xml version="1.0" encoding="UTF-8"?>
<custom-sql>
    <sql id="com.contractDashboard.process.loadTempRS">
        <![CDATA[
        INSERT INTO dbo.IMTD_ITEM_PRICE_REBATE_DETAILS 
            (ITEM_MASTER_SID, ITEM_ID, ITEM_NO, ITEM_NAME,ITEM_TYPE,PRIMARY_UOM,PACKAGE_SIZE, UDC1, UDC2, UDC3, UDC4, UDC5, UDC6, 
            START_DATE, END_DATE, ATTACHED_STATUS, ATTACHED_DATE, IFP_DETAILS_SID, 
            CONTRACT_MASTER_SID, CFP_MODEL_SID, IFP_MODEL_SID, PS_MODEL_SID, 
            CONTRACT_PRICE, CONTRACT_PRICE_START_DATE, CONTRACT_PRICE_END_DATE, PRICE_PROTECTION_START_DATE, PRICE_PROTECTION_END_DATE, PRICE_TOLERANCE_TYPE, 
            PRICE_TOLERANCE, BASE_PRICE, PRICE_TOLERANCE_FREQUENCY, PRICE_TOLERANCE_INTERVAL, PRICE_TYPE, PRICE, PS_STATUS, PS_DETAILS_SID, 
            RS_MODEL_SID, FORMULA_ID, REBATE_AMOUNT, RS_DETAILS_SID, 
            ITEM_REBATE_START_DATE, ITEM_REBATE_END_DATE, REBATE_PLAN_SYSTEM_ID, BUNDLE_NO,
            USERS_SID, SESSION_ID, CHECK_RECORD, IMTD_CREATED_DATE, "OPERATION", CREATED_BY, CREATED_DATE,
            BRAND_MASTER_SID,NEP,PRICE_PROTECTION_STATUS,PRICE_PROTECTION_PRICE_TYPE,NEP_FORMULA,MAX_INCREMENTAL_CHANGE,RESET_ELIGIBLE,RESET_TYPE,RESET_DATE,RESET_INTERVAL
            ,RESET_FREQUENCY,NET_PRICE_TYPE,NET_PRICE_TYPE_FORMULA,Base_Price_Type,Base_Price_Entry,Base_Price_Date,Net_Base_Price,Base_Price_ddlb,Net_Base_Price_Formula_ID,Subsequent_Period_Price_Type
            ,Net_Subsequent_Period_price,Net_Subsequent_Price_Formula_Id,Reset_Price_Type,Net_Reset_Price_Type,Net_Reset_Price_Formula_Id, RS_ATTACHED_STATUS, NET_SALES_FORMULA_MASTER_SID,
            NET_SALES_RULE, EVALUATION_RULE, EVALUATION_RULE_BUNDLE, CALCULATION_RULE, CALCULATION_RULE_BUNDLE,DEDUCTION_CALENDAR_MASTER_SID
            ,"SOURCE",SUGGESTED_PRICE) 
        SELECT DISTINCT 
            IM.ITEM_MASTER_SID, IM.ITEM_ID,  IM.ITEM_NO, IM.ITEM_NAME,IM.ITEM_TYPE,IM.PRIMARY_UOM,IM.PACKAGE_SIZE, 0 UDC1, 0 UDC2, 0 UDC3, 0 UDC4, 0 UDC5, 0 UDC6, 
            IFPCD.ITEM_START_DATE, IFPCD.ITEM_END_DATE, IFPCD.ITEM_STATUS, IFPCD.IFP_CONTRACT_ATTACHED_DATE, IFPCD.IFP_CONTRACT_DETAILS_SID, 
            RSC.CONTRACT_MASTER_SID, RSC.CFP_CONTRACT_SID, RSC.IFP_CONTRACT_SID, 
            RSC.PS_CONTRACT_SID, PSCD.CONTRACT_PRICE, PSCD.CONTRACT_PRICE_START_DATE, PSCD.CONTRACT_PRICE_END_DATE, 
            PSCD.PRICE_PROTECTION_START_DATE, PSCD.PRICE_PROTECTION_END_DATE, PSCD.PRICE_TOLERANCE_TYPE, PSCD.PRICE_TOLERANCE, 
            PSCD.BASE_PRICE, PSCD.PRICE_TOLERANCE_FREQUENCY, PSCD.PRICE_TOLERANCE_INTERVAL, 
            PSCD.ITEM_PRICING_QUALIFIER_SID, PSCD.PRICE, PSCD.PS_CONTRACT_ATTACHED_STATUS, PSCD.PS_CONTRACT_DETAILS_SID, 
            RSC.RS_MODEL_SID,RSCD.FORMULA_ID, RSCD.REBATE_AMOUNT, RSCD.RS_CONTRACT_DETAILS_SID,  
            RSCD.ITEM_REBATE_START_DATE, RSCD.ITEM_REBATE_END_DATE, RSCD.REBATE_PLAN_MASTER_SID, RSCD.BUNDLE_NO, 
            '?' USERS_SID, '?' SESSION_ID, 1 CHECK_RECORD, '?' IMTD_CREATED_DATE, 'U' "Operation", IFPCD.CREATED_BY, IFPCD.CREATED_DATE 
            ,PSCD.BRAND_MASTER_SID,PSCD.NEP,PSCD.PRICE_PROTECTION_STATUS,PSCD.PRICE_PROTECTION_PRICE_TYPE,PSCD.NEP_FORMULA,PSCD.MAX_INCREMENTAL_CHANGE,PSCD.RESET_ELIGIBLE,PSCD.RESET_TYPE,
             PSCD.RESET_DATE,PSCD.RESET_INTERVAL,PSCD.RESET_FREQUENCY,PSCD.NET_PRICE_TYPE,PSCD.NET_PRICE_TYPE_FORMULA,PSCD.Base_Price_Type,PSCD.Base_Price_Entry,PSCD.Base_Price_Date,PSCD.Net_Base_Price,
             PSCD.Base_Price_ddlb,PSCD.Net_Base_Price_Formula_ID,PSCD.Subsequent_Period_Price_Type,PSCD.Net_Subsequent_Period_price,PSCD.Net_Subsequent_Price_Formula_Id,PSCD.Reset_Price_Type,PSCD.Net_Reset_Price_Type,
             PSCD.Net_Reset_Price_Formula_Id, RSCD.RS_CONTRACT_ATTACHED_STATUS,
            RSCD.NET_SALES_FORMULA_MASTER_SID, RSCD.NET_SALES_RULE, RSCD.EVALUATION_RULE, RSCD.EVALUATION_RULE_BUNDLE, RSCD.CALCULATION_RULE, RSCD.CALCULATION_RULE_BUNDLE, RSCD.DEDUCTION_CALENDAR_MASTER_SID
            ,PSCD."SOURCE",PSCD.SUGGESTED_PRICE
        FROM 

            IFP_CONTRACT_DETAILS IFPCD,
            PS_CONTRACT_DETAILS PSCD,            
            RS_CONTRACT RSC, 
            RS_CONTRACT_DETAILS RSCD, 
            ITEM_MASTER IM
        WHERE 
            RSC.CONTRACT_MASTER_SID=?            
            AND RSC.CFP_CONTRACT_SID=? 
            AND RSC.IFP_CONTRACT_SID=?
            AND RSC.PS_CONTRACT_SID=?             
            AND RSC.RS_CONTRACT_SID=?
            
            AND PSCD.PS_CONTRACT_SID=?
            AND IFPCD.IFP_CONTRACT_SID=?
                                                        
            AND RSC.RS_CONTRACT_SID=RSCD.RS_CONTRACT_SID
            
            AND RSCD.ITEM_MASTER_SID = IM.ITEM_MASTER_SID
            AND PSCD.ITEM_MASTER_SID = IM.ITEM_MASTER_SID
            AND IFPCD.ITEM_MASTER_SID = IM.ITEM_MASTER_SID
                        
            
            AND IM.INBOUND_STATUS <> 'D'
            AND IFPCD.INBOUND_STATUS <> 'D'
            AND PSCD.INBOUND_STATUS <> 'D'
            AND RSCD.INBOUND_STATUS <> 'D';
        ]]>
    </sql>
    
    <sql id="com.contractDashboard.process.loadTempPS">
        <![CDATA[
        INSERT INTO dbo.IMTD_ITEM_PRICE_REBATE_DETAILS 
            (ITEM_MASTER_SID, ITEM_ID, ITEM_NO, ITEM_NAME,PRIMARY_UOM,PACKAGE_SIZE, UDC1, UDC2, UDC3, UDC4, UDC5, UDC6, 
            START_DATE, END_DATE,  
            CONTRACT_MASTER_SID, IFP_MODEL_SID, PS_MODEL_SID, 
            CONTRACT_PRICE, CONTRACT_PRICE_START_DATE, CONTRACT_PRICE_END_DATE, PRICE_PROTECTION_START_DATE, PRICE_PROTECTION_END_DATE, PRICE_TOLERANCE_TYPE, 
            PRICE_TOLERANCE, BASE_PRICE, PRICE_TOLERANCE_FREQUENCY, PRICE_TOLERANCE_INTERVAL, PRICE_TYPE, Price, PS_STATUS, PS_DETAILS_SID, IFP_DETAILS_SID,
            USERS_SID, SESSION_ID, CHECK_RECORD,  IMTD_CREATED_DATE, "Operation", CREATED_BY, CREATED_DATE, MODIFIED_BY, MODIFIED_DATE, ATTACHED_STATUS,
            MAX_INCREMENTAL_CHANGE,RESET_ELIGIBLE,RESET_TYPE,RESET_DATE,RESET_INTERVAL,RESET_FREQUENCY,NET_PRICE_TYPE,NET_PRICE_TYPE_FORMULA,PRICE_PROTECTION_PRICE_TYPE,
            NEP,NEP_FORMULA,BRAND_MASTER_SID,PRICE_PROTECTION_STATUS,Base_Price_Type,Base_Price_Entry,Base_Price_Date,Base_Price_ddlb,Net_Base_Price,Net_Base_Price_Formula_ID,Subsequent_Period_Price_Type,
            Net_Subsequent_Period_price,Net_Subsequent_Price_Formula_Id,Reset_Price_Type,Net_Reset_Price_Type,Net_Reset_Price_Formula_Id,"SOURCE",SUGGESTED_PRICE ) 
        SELECT Distinct
            IM.ITEM_MASTER_SID, IM.ITEM_ID,  IM.ITEM_NO, IM.ITEM_NAME,IM.PRIMARY_UOM,IM.PACKAGE_SIZE, 0 UDC1, 0 UDC2, 0 UDC3, 0 UDC4, 0 UDC5, 0 UDC6, 
            IFP.ITEM_START_DATE, IFP.ITEM_END_DATE,
            PSC.CONTRACT_MASTER_SID,IFPC.IFP_MODEL_SID, PSC.PS_MODEL_SID,
            PS.CONTRACT_PRICE, PS.CONTRACT_PRICE_START_DATE, PS.CONTRACT_PRICE_END_DATE, 
            PS.PRICE_PROTECTION_START_DATE, PS.PRICE_PROTECTION_END_DATE, PS.PRICE_TOLERANCE_TYPE, PS.PRICE_TOLERANCE, 
            PS.BASE_PRICE, PS.PRICE_TOLERANCE_FREQUENCY, PS.PRICE_TOLERANCE_INTERVAL, 
            PS.ITEM_PRICING_QUALIFIER_SID, PS.PRICE, PS.PS_CONTRACT_ATTACHED_STATUS, PS.PS_CONTRACT_DETAILS_SID, IFP.IFP_CONTRACT_DETAILS_SID,
            ? USERS_SID, '?' SESSION_ID, 1 CHECK_RECORD, '?' IMTD_CREATED_DATE, 'U' "Operation", IFP.CREATED_BY, IFP.CREATED_DATE, IFP.MODIFIED_BY, IFP.MODIFIED_DATE, IFP.ITEM_STATUS,
            PS.MAX_INCREMENTAL_CHANGE,PS.RESET_ELIGIBLE,PS.RESET_TYPE,PS.RESET_DATE,PS.RESET_INTERVAL,PS.RESET_FREQUENCY,PS.NET_PRICE_TYPE,PS.NET_PRICE_TYPE_FORMULA,PS.PRICE_PROTECTION_PRICE_TYPE,
            PS.NEP,PS.NEP_FORMULA,PS.BRAND_MASTER_SID,PS.PRICE_PROTECTION_STATUS,PS.Base_Price_Type,PS.Base_Price_Entry,PS.Base_Price_Date,PS.Base_Price_ddlb,PS.Net_Base_Price,PS.Net_Base_Price_Formula_ID,
            PS.Subsequent_Period_Price_Type,PS.Net_Subsequent_Period_price,PS.Net_Subsequent_Price_Formula_Id,PS.Reset_Price_Type,PS.Net_Reset_Price_Type,PS.Net_Reset_Price_Formula_Id 
            ,PS."SOURCE",PS.SUGGESTED_PRICE
        FROM 
            PS_CONTRACT_DETAILS PS,
            PS_CONTRACT PSC, 
            IFP_CONTRACT_DETAILS IFP, 
            IFP_CONTRACT IFPC,
            ITEM_MASTER IM
        WHERE 
            PSC.CONTRACT_MASTER_SID=? 
            AND PSC.CFP_CONTRACT_SID=? 
            AND PSC.IFP_CONTRACT_SID=?
            AND PSC.PS_CONTRACT_SID=?
            
            AND IFPC.CFP_CONTRACT_SID=?
            AND PSC.IFP_CONTRACT_SID=IFPC.IFP_CONTRACT_SID
            
            AND PS.ITEM_MASTER_SID = IFP.ITEM_MASTER_SID
            AND PS.ITEM_MASTER_SID = IM.ITEM_MASTER_SID
            
            AND PSC.PS_CONTRACT_SID = PS.PS_CONTRACT_SID
            AND IFP.IFP_CONTRACT_SID = IFPC.IFP_CONTRACT_SID
            
            AND IM.INBOUND_STATUS <> 'D' 
            AND IFP.INBOUND_STATUS <> 'D'
            AND IFPC.INBOUND_STATUS <> 'D' 
            AND PSC.INBOUND_STATUS <> 'D' 
            AND PS.INBOUND_STATUS <> 'D';
        ]]>
    </sql>
    
    <sql id="com.contractDashboard.process.loadTempIFP">
        <![CDATA[
        INSERT INTO dbo.IMTD_ITEM_PRICE_REBATE_DETAILS 
            (ITEM_MASTER_SID, ITEM_ID, ITEM_NO, ITEM_NAME, PS_STATUS,PRIMARY_UOM,PACKAGE_SIZE, UDC1, UDC2, UDC3, UDC4, UDC5, UDC6, 
            START_DATE, END_DATE, IFP_DETAILS_SID, 
            CONTRACT_MASTER_SID,IFP_MODEL_SID, 
            USERS_SID, SESSION_ID, CHECK_RECORD, IMTD_CREATED_DATE, "Operation", CREATED_BY, CREATED_DATE, MODIFIED_BY, MODIFIED_DATE,ATTACHED_STATUS) 
        SELECT 
            IM.ITEM_MASTER_SID, IM.ITEM_ID,  IM.ITEM_NO, IM.ITEM_NAME, IFP.ITEM_STATUS,IM.PRIMARY_UOM,IM.PACKAGE_SIZE, 0 UDC1, 0 UDC2, 0 UDC3, 0 UDC4, 0 UDC5, 0 UDC6, 
            IFP.ITEM_START_DATE, IFP.ITEM_END_DATE, IFP.IFP_CONTRACT_DETAILS_SID, 
            IFPC.CONTRACT_MASTER_SID,IFPC.IFP_MODEL_SID, 
            ? USERS_SID, '?' SESSION_ID, 1 CHECK_RECORD, '?' IMTD_CREATED_DATE, 'U' "Operation", IFP.CREATED_BY, IFP.CREATED_DATE, IFP.MODIFIED_BY, IFP.MODIFIED_DATE ,IFP.IFP_CONTRACT_ATTACHED_STATUS
        FROM 
            IFP_CONTRACT_DETAILS IFP, 
            IFP_CONTRACT IFPC,
            ITEM_MASTER IM
        WHERE 
            IFPC.CONTRACT_MASTER_SID=? 
            AND IFPC.CFP_CONTRACT_SID=?
            AND IFPC.IFP_CONTRACT_SID=?
            AND IFP.IFP_CONTRACT_SID=IFPC.IFP_CONTRACT_SID
            AND IM.ITEM_MASTER_SID=IFP.ITEM_MASTER_SID 
            AND IM.INBOUND_STATUS <> 'D' 
            AND IFP.INBOUND_STATUS <> 'D'
            AND IFPC.INBOUND_STATUS <> 'D';
        ]]>
    </sql>
    
    <sql id="com.contractDashboard.process.addTempRS">
        <![CDATA[
        UPDATE dbo.IMTD_ITEM_PRICE_REBATE_DETAILS 
            SET "Operation"='U' WHERE USERS_SID=? AND SESSION_ID = '?' AND "Operation"='D' AND ITEM_MASTER_SID 
            IN (SELECT IM.ITEM_MASTER_SID FROM ITEM_MASTER IM WHERE IM.? like '?' AND IM.INBOUND_STATUS <> 'D');
        INSERT INTO dbo.IMTD_ITEM_PRICE_REBATE_DETAILS 
            (ITEM_MASTER_SID, ITEM_ID, ITEM_NO, ITEM_NAME,BRAND_MASTER_SID,  UDC1, UDC2, UDC3, UDC4, UDC5, UDC6, 
            CONTRACT_MASTER_SID, CFP_MODEL_SID, IFP_MODEL_SID, PS_MODEL_SID, RS_MODEL_SID, 
            USERS_SID, SESSION_ID, CHECK_RECORD,  IMTD_CREATED_DATE, "Operation", CREATED_BY, CREATED_DATE) 
        SELECT 
            IM.ITEM_MASTER_SID, IM.ITEM_ID,  IM.ITEM_NO, IM.ITEM_NAME,IM.BRAND_MASTER_SID, '0' UDC1, '0' UDC2, '0' UDC3, '0' UDC4, '0' UDC5, '0' UDC6, 
            ? CONTRACT_MASTER_SID, ? COMPANY_FAMILYPLAN_SYSTEM_ID, ? IFP_MODEL_SID, ? PS_MODEL_SID, ? RS_MODEL_SID,  
            ? USERS_SID, '?' SESSION_ID, 0 CHECK_RECORD, '?' IMTD_CREATED_DATE, 'A' "Operation", '?' CREATED_BY, '?' CREATED_DATE 
        FROM 
            ITEM_MASTER IM 
        WHERE 
            IM.? like '?' 
            AND IM.INBOUND_STATUS <> 'D' 
            AND IM.ITEM_MASTER_SID NOT IN (SELECT ITEM_MASTER_SID from dbo.IMTD_ITEM_PRICE_REBATE_DETAILS WHERE USERS_SID=? AND SESSION_ID='?');
        ]]>
    </sql>
    
    <sql id="com.contractDashboard.process.addTempPS">
        <![CDATA[
        UPDATE dbo.IMTD_ITEM_PRICE_REBATE_DETAILS 
            SET "Operation"='U' WHERE USERS_SID=? AND SESSION_ID = '?' AND "Operation"='D' AND ITEM_MASTER_SID 
            IN (SELECT IM.ITEM_MASTER_SID FROM ITEM_MASTER IM WHERE IM.? like '?' AND IM.INBOUND_STATUS <> 'D');
        INSERT INTO dbo.IMTD_ITEM_PRICE_REBATE_DETAILS 
            (ITEM_MASTER_SID, ITEM_ID, ITEM_NO, ITEM_NAME,BRAND_MASTER_SID, UDC1, UDC2, UDC3, UDC4, UDC5, UDC6, 
            CONTRACT_MASTER_SID, CFP_MODEL_SID, IFP_MODEL_SID, PS_MODEL_SID, 
            USERS_SID, SESSION_ID, CHECK_RECORD,  IMTD_CREATED_DATE, "Operation", CREATED_BY, CREATED_DATE, MODIFIED_BY, MODIFIED_DATE) 
        SELECT 
            IM.ITEM_MASTER_SID, IM.ITEM_ID,  IM.ITEM_NO, IM.ITEM_NAME,IM.BRAND_MASTER_SID, '0' UDC1, '0' UDC2, '0' UDC3, '0' UDC4, '0' UDC5, '0' UDC6, 
            ? CONTRACT_MASTER_SID, ? COMPANY_FAMILYPLAN_SYSTEM_ID, ? IFP_MODEL_SID, ? PS_MODEL_SID, 
            ? USERS_SID, '?' SESSION_ID, 0 CHECK_RECORD, '?' IMTD_CREATED_DATE, 'A' "Operation", '?' CREATED_BY, '?' CREATED_DATE , '?' MODIFIED_BY, '?' MODIFIED_DATE 
        FROM 
            ITEM_MASTER IM 
        WHERE 
            IM.? like '?' 
            AND IM.INBOUND_STATUS <> 'D' 
            AND IM.ITEM_MASTER_SID NOT IN (SELECT ITEM_MASTER_SID from dbo.IMTD_ITEM_PRICE_REBATE_DETAILS WHERE USERS_SID=? AND SESSION_ID='?');
        ]]>
    </sql>
    
    <sql id="com.contractDashboard.process.loadTempIFPForIfp">
        <![CDATA[
        INSERT INTO dbo.IMTD_ITEM_PRICE_REBATE_DETAILS 
            (ITEM_MASTER_SID, ITEM_ID, ITEM_NO, ITEM_NAME, PS_STATUS,PRIMARY_UOM,PACKAGE_SIZE, UDC1, UDC2, UDC3, UDC4, UDC5, UDC6, 
            START_DATE, END_DATE, IFP_DETAILS_SID, 
            CONTRACT_MASTER_SID,IFP_MODEL_SID, 
            USERS_SID, SESSION_ID, CHECK_RECORD,  IMTD_CREATED_DATE, "Operation", CREATED_BY, CREATED_DATE, MODIFIED_BY, MODIFIED_DATE,ATTACHED_STATUS) 
        SELECT 
            IM.ITEM_MASTER_SID, IM.ITEM_ID,  IM.ITEM_NO, IM.ITEM_NAME, IFP.ITEM_STATUS,IM.PRIMARY_UOM,IM.PACKAGE_SIZE, 0 UDC1, 0 UDC2, 0 UDC3, 0 UDC4, 0 UDC5, 0 UDC6, 
            IFP.ITEM_START_DATE, IFP.ITEM_END_DATE, IFP.IFP_CONTRACT_DETAILS_SID, 
            IFPC.CONTRACT_MASTER_SID,IFPC.IFP_MODEL_SID, 
            ? USERS_SID, '?' SESSION_ID, 1 CHECK_RECORD, '?' IMTD_CREATED_DATE, 'U' "Operation", IFP.CREATED_BY, IFP.CREATED_DATE, IFP.MODIFIED_BY, IFP.MODIFIED_DATE ,IFP.IFP_CONTRACT_ATTACHED_STATUS
        FROM 
            IFP_CONTRACT_DETAILS IFP, 
            IFP_CONTRACT IFPC,
            ITEM_MASTER IM
        WHERE 
            IFPC.CONTRACT_MASTER_SID=? 
            AND IFPC.CFP_CONTRACT_SID=?
            AND IFPC.IFP_CONTRACT_SID=?
            AND IFP.IFP_CONTRACT_SID=IFPC.IFP_CONTRACT_SID
            AND IM.ITEM_MASTER_SID=IFP.ITEM_MASTER_SID 
            AND IM.INBOUND_STATUS <> 'D' 
            AND IFP.INBOUND_STATUS <> 'D'
            AND IFPC.INBOUND_STATUS <> 'D';
        ]]>
    </sql>
    
    <sql id="com.contractDashboard.process.addTempRSForIfp">
        <![CDATA[
        UPDATE dbo.IMTD_ITEM_PRICE_REBATE_DETAILS 
            SET "Operation"='U' WHERE USERS_SID=? AND SESSION_ID = '?' AND "Operation"='D' AND ITEM_MASTER_SID 
            IN (SELECT IFPD.ITEM_MASTER_SID FROM IFP_DETAILS IFPD, IFP_MODEL IFPM WHERE IFPM.IFP_MODEL_SID=IFPD.IFP_MODEL_SID AND IFPM.? like '?' AND IFPM.INBOUND_STATUS <> 'D' AND IFPD.INBOUND_STATUS <> 'D');
        INSERT INTO dbo.IMTD_ITEM_PRICE_REBATE_DETAILS 
            (ITEM_MASTER_SID, ITEM_ID, ITEM_NO, ITEM_NAME,BRAND_MASTER_SID, UDC1, UDC2, UDC3, UDC4, UDC5, UDC6, 
            CONTRACT_MASTER_SID, CFP_MODEL_SID, IFP_MODEL_SID, PS_MODEL_SID, RS_MODEL_SID, 
            USERS_SID, SESSION_ID, CHECK_RECORD,  IMTD_CREATED_DATE, "Operation", CREATED_BY, CREATED_DATE) 
        SELECT 
            IM.ITEM_MASTER_SID, IM.ITEM_ID,  IM.ITEM_NO, IM.ITEM_NAME,IM.BRAND_MASTER_SID, '0' UDC1, '0' UDC2, '0' UDC3, '0' UDC4, '0' UDC5, '0' UDC6, 
            ? CONTRACT_MASTER_SID, ? COMPANY_FAMILYPLAN_SYSTEM_ID, ? IFP_MODEL_SID, ? PS_MODEL_SID, ? RS_MODEL_SID,  
            ? USERS_SID, '?' SESSION_ID, 0 CHECK_RECORD, '?' IMTD_CREATED_DATE, 'A' "Operation", '?' CREATED_BY, '?' CREATED_DATE 
        FROM 
            ITEM_MASTER IM 
        WHERE 
            IM.ITEM_MASTER_SID 
            IN (SELECT IFPD.ITEM_MASTER_SID FROM IFP_DETAILS IFPD, IFP_MODEL IFPM WHERE IFPM.IFP_MODEL_SID=IFPD.IFP_MODEL_SID AND IFPM.? like '?' AND IFPM.INBOUND_STATUS <> 'D' AND IFPD.INBOUND_STATUS <> 'D')
            AND IM.INBOUND_STATUS <> 'D' 
            AND IM.ITEM_MASTER_SID NOT IN (SELECT ITEM_MASTER_SID from dbo.IMTD_ITEM_PRICE_REBATE_DETAILS WHERE USERS_SID=? AND SESSION_ID='?');
        ]]>
    </sql>
    
    <sql id="com.contractDashboard.process.addTempPSForIfp">
        <![CDATA[
        UPDATE dbo.IMTD_ITEM_PRICE_REBATE_DETAILS 
            SET "Operation"='U' WHERE USERS_SID=? AND SESSION_ID = '?' AND "Operation"='D' AND ITEM_MASTER_SID 
            IN (SELECT IFPD.ITEM_MASTER_SID FROM IFP_DETAILS IFPD, IFP_MODEL IFPM WHERE IFPM.IFP_MODEL_SID=IFPD.IFP_MODEL_SID AND IFPM.? like '?' AND IFPM.INBOUND_STATUS <> 'D' AND IFPD.INBOUND_STATUS <> 'D');
        INSERT INTO dbo.IMTD_ITEM_PRICE_REBATE_DETAILS 
            (ITEM_MASTER_SID, ITEM_ID, ITEM_NO, ITEM_NAME,BRAND_MASTER_SID, UDC1, UDC2, UDC3, UDC4, UDC5, UDC6, 
            CONTRACT_MASTER_SID, CFP_MODEL_SID, IFP_MODEL_SID, PS_MODEL_SID, 
            USERS_SID, SESSION_ID, CHECK_RECORD,  IMTD_CREATED_DATE, "Operation", CREATED_BY, CREATED_DATE, MODIFIED_BY, MODIFIED_DATE) 
        SELECT 
            IM.ITEM_MASTER_SID, IM.ITEM_ID,  IM.ITEM_NO, IM.ITEM_NAME,IM.BRAND_MASTER_SID, '0' UDC1, '0' UDC2, '0' UDC3, '0' UDC4, '0' UDC5, '0' UDC6, 
            ? CONTRACT_MASTER_SID, ? COMPANY_FAMILYPLAN_SYSTEM_ID, ? IFP_MODEL_SID, ? PS_MODEL_SID, 
            ? USERS_SID, '?' SESSION_ID, 0 CHECK_RECORD, '?' IMTD_CREATED_DATE, 'A' "Operation", '?' CREATED_BY, '?' CREATED_DATE , '?' MODIFIED_BY, '?' MODIFIED_DATE 
        FROM 
            ITEM_MASTER IM 
        WHERE 
            IM.ITEM_MASTER_SID 
            IN (SELECT IFPD.ITEM_MASTER_SID FROM IFP_DETAILS IFPD, IFP_MODEL IFPM WHERE IFPM.IFP_MODEL_SID=IFPD.IFP_MODEL_SID AND IFPM.? like '?' AND IFPM.INBOUND_STATUS <> 'D' AND IFPD.INBOUND_STATUS <> 'D')
            AND IM.INBOUND_STATUS <> 'D' 
            AND IM.ITEM_MASTER_SID NOT IN (SELECT ITEM_MASTER_SID from dbo.IMTD_ITEM_PRICE_REBATE_DETAILS WHERE USERS_SID=? AND SESSION_ID='?');
        ]]>
    </sql>
    
    <sql id="com.contractDashboard.process.addTempIFP">
        <![CDATA[ 
        UPDATE dbo.IMTD_ITEM_PRICE_REBATE_DETAILS 
            SET "Operation"='U' WHERE USERS_SID=? AND SESSION_ID = '?' AND "Operation"='D' AND ITEM_MASTER_SID 
            IN (SELECT IM.ITEM_MASTER_SID FROM ITEM_MASTER IM WHERE IM.? like '?' AND IM.INBOUND_STATUS <> 'D');
        INSERT INTO dbo.IMTD_ITEM_PRICE_REBATE_DETAILS 
            (ITEM_MASTER_SID, ITEM_ID, ITEM_NO, ITEM_NAME,BRAND_MASTER_SID,  UDC1, UDC2, UDC3, UDC4, UDC5, UDC6, 
            CONTRACT_MASTER_SID, CFP_MODEL_SID, IFP_MODEL_SID, 
            USERS_SID, SESSION_ID, CHECK_RECORD, IMTD_CREATED_DATE, "Operation", CREATED_BY, CREATED_DATE, MODIFIED_BY, MODIFIED_DATE) 
        SELECT 
            IM.ITEM_MASTER_SID, IM.ITEM_ID,  IM.ITEM_NO, IM.ITEM_NAME,IM.BRAND_MASTER_SID, '0' UDC1, '0' UDC2, '0' UDC3, '0' UDC4, '0' UDC5, '0' UDC6, 
            ? CONTRACT_MASTER_SID, ? CFP_MODEL_SID, ? IFP_MODEL_SID,  
            ? USERS_SID, '?' SESSION_ID, 0 CHECK_RECORD, '?' IMTD_CREATED_DATE, 'A' "Operation", '?' CREATED_BY, '?' CREATED_DATE, '?' MODIFIED_BY, '?' MODIFIED_DATE 
        FROM 
            ITEM_MASTER IM
        WHERE 
            IM.? like '?' 
            AND IM.INBOUND_STATUS <> 'D' 
            AND IM.ITEM_MASTER_SID NOT IN (SELECT ITEM_MASTER_SID from dbo.IMTD_ITEM_PRICE_REBATE_DETAILS WHERE USERS_SID=? AND SESSION_ID='?');
        ]]>
    </sql>
    
    <sql id="com.contractDashboard.process.populateAllTempIFP">
        <![CDATA[
        UPDATE dbo.IMTD_ITEM_PRICE_REBATE_DETAILS SET ?='?', MODIFIED_BY=?, MODIFIED_DATE=? WHERE USERS_SID='?' AND SESSION_ID='?' AND "Operation" <> 'D';
        ]]>
    </sql>

    <sql id="com.contractDashboard.process.populateTempIFP">
        <![CDATA[
        UPDATE dbo.IMTD_ITEM_PRICE_REBATE_DETAILS SET ?='?', MODIFIED_BY=?, MODIFIED_DATE=? WHERE USERS_SID='?' AND SESSION_ID='?' AND ?=1 AND "Operation" <> 'D';
        ]]>
    </sql>

    <sql id="com.contractDashboard.process.deleteOnBackTempIFP">
        <![CDATA[
        DELETE FROM dbo.IMTD_ITEM_PRICE_REBATE_DETAILS WHERE USERS_SID='?' AND SESSION_ID='?';
        ]]>
    </sql>

    <sql id="com.contractDashboard.process.deleteOnLoadTempIFP">
        <![CDATA[
        DELETE FROM dbo.IMTD_ITEM_PRICE_REBATE_DETAILS WHERE (USERS_SID='?' AND SESSION_ID='?') OR IMTD_CREATED_DATE < '?';
        ]]>
    </sql>

    <sql id="com.contractDashboard.process.deleteByDTempIFP">
        <![CDATA[
        DELETE FROM dbo.IMTD_ITEM_PRICE_REBATE_DETAILS WHERE USERS_SID='?' AND SESSION_ID='?' AND "Operation" = 'D';
        ]]>
    </sql>
    
    <sql id="com.contractDashboard.process.deleteByNotDTempIFP">
        <![CDATA[
        DELETE FROM dbo.IMTD_ITEM_PRICE_REBATE_DETAILS WHERE USERS_SID='?' AND SESSION_ID='?' AND "Operation" <> 'D';
        ]]>
    </sql>
    
    <sql id="com.contractDashboard.process.updateOperationIFP">
        <![CDATA[
        UPDATE dbo.IMTD_ITEM_PRICE_REBATE_DETAILS SET "Operation"='D' WHERE USERS_SID='?' AND SESSION_ID='?' AND "Operation"='U';
        ]]>
    </sql>
    
    <sql id="com.contractDashboard.process.saveIFP">
        <![CDATA[
        UPDATE IFP_CONTRACT_DETAILS SET INBOUND_STATUS='D' WHERE IFP_CONTRACT_DETAILS_SID in 
        (SELECT IFP_DETAILS_SID FROM dbo.IMTD_ITEM_PRICE_REBATE_DETAILS WHERE USERS_SID=? AND SESSION_ID='?' AND (CHECK_RECORD=0 OR "Operation" = 'D'));

        DELETE FROM dbo.IMTD_ITEM_PRICE_REBATE_DETAILS WHERE USERS_SID='?' AND SESSION_ID='?' AND (CHECK_RECORD=0 OR "Operation" = 'D');
       
        MERGE IFP_CONTRACT_DETAILS AS Target USING 
        (SELECT ATTACHED_STATUS, START_DATE, END_DATE, ATTACHED_DATE, IFP_DETAILS_SID, CREATED_DATE, CREATED_BY, MODIFIED_DATE, MODIFIED_BY,ITEM_MASTER_SID  
        FROM dbo.IMTD_ITEM_PRICE_REBATE_DETAILS WHERE USERS_SID=? AND SESSION_ID='?' AND ( "Operation" = 'U'
                    OR "Operation" = 'A' )) AS Source 
        ON (Target.IFP_CONTRACT_SID = ?
    AND TARGET.ITEM_MASTER_SID = SOURCE.ITEM_MASTER_SID 
) 
        WHEN MATCHED THEN 
        UPDATE SET 
        Target.ITEM_STATUS = Source.ATTACHED_STATUS, 
        Target.ITEM_START_DATE = Source.START_DATE, 
        Target.ITEM_END_DATE = Source.End_Date, 
        Target.CREATED_DATE = Source.CREATED_DATE, 
Target.IFP_CONTRACT_ATTACHED_STATUS = Source.ATTACHED_STATUS,
        Target.IFP_CONTRACT_ATTACHED_DATE = Source.ATTACHED_DATE,
        Target.CREATED_BY = Source.CREATED_BY, 
        Target.MODIFIED_DATE = Source.MODIFIED_DATE, 
        Target.MODIFIED_BY = Source.MODIFIED_BY, 
        Target.INBOUND_STATUS = 'U'
 WHEN NOT MATCHED THEN      
        INSERT (IFP_CONTRACT_SID, ITEM_MASTER_SID, ITEM_STATUS,
        ITEM_START_DATE, ITEM_END_DATE,INBOUND_STATUS, RECORD_LOCK_STATUS, CREATED_DATE, CREATED_BY, MODIFIED_DATE, MODIFIED_BY, IFP_CONTRACT_ATTACHED_STATUS,IFP_CONTRACT_ATTACHED_DATE) 
        Values( ? , SOURCE.ITEM_MASTER_SID, SOURCE.ATTACHED_STATUS,
        SOURCE.START_DATE, SOURCE.END_DATE, 'A'  ,'false' , SOURCE.CREATED_DATE, SOURCE.CREATED_BY, SOURCE.MODIFIED_DATE, SOURCE.MODIFIED_BY, SOURCE.ATTACHED_STATUS,GETDATE());
        ]]>
    </sql>
    
    <sql id="com.contractDashboard.process.savePS">
        <![CDATA[
        UPDATE PS_CONTRACT_DETAILS SET INBOUND_STATUS='D' WHERE PS_CONTRACT_DETAILS_SID in 
        (SELECT PS_DETAILS_SID FROM dbo.IMTD_ITEM_PRICE_REBATE_DETAILS WHERE USERS_SID=? AND SESSION_ID='?' AND (CHECK_RECORD=0 OR "Operation" = 'D'));

        DELETE FROM dbo.IMTD_ITEM_PRICE_REBATE_DETAILS WHERE USERS_SID='?' AND SESSION_ID='?' AND (CHECK_RECORD=0 OR "Operation" = 'D');

        MERGE PS_CONTRACT_DETAILS AS Target USING 
        (SELECT CONTRACT_PRICE, CONTRACT_PRICE_START_DATE, CONTRACT_PRICE_END_DATE, PRICE_PROTECTION_START_DATE, PRICE_PROTECTION_END_DATE, PRICE_TOLERANCE_TYPE, 
        PRICE_TOLERANCE, BASE_PRICE, PRICE_TOLERANCE_FREQUENCY, PRICE_TOLERANCE_INTERVAL, PRICE_TYPE, PRICE, PS_STATUS, PS_DETAILS_SID, CREATED_DATE, CREATED_BY, MODIFIED_DATE, MODIFIED_BY, ATTACHED_STATUS 
        ,MAX_INCREMENTAL_CHANGE,RESET_ELIGIBLE,RESET_TYPE,RESET_DATE,RESET_INTERVAL,RESET_FREQUENCY,NET_PRICE_TYPE,nullif(NET_PRICE_TYPE_FORMULA , 0) as NET_PRICE_TYPE_FORMULA,PRICE_PROTECTION_PRICE_TYPE,NEP,NEP_FORMULA, nullif(BRAND_MASTER_SID,0) AS BRAND_MASTER_SID, PRICE_PROTECTION_STATUS,Base_Price_Type,Base_Price_Entry
        ,Base_Price_Date,Base_Price_ddlb,Net_Base_Price,Net_Base_Price_Formula_ID,Subsequent_Period_Price_Type,Net_Subsequent_Period_price,Net_Subsequent_Price_Formula_Id,Reset_Price_Type,Net_Reset_Price_Type
        ,Net_Reset_Price_Formula_Id,SUGGESTED_PRICE,"SOURCE",ATTACHED_DATE,ITEM_MASTER_SID
        FROM dbo.IMTD_ITEM_PRICE_REBATE_DETAILS WHERE USERS_SID=? AND SESSION_ID='?' AND  ( "Operation" = 'U'
                    OR "Operation" = 'A' )) AS Source 
        ON (Target.PS_CONTRACT_SID = ?
    AND TARGET.ITEM_MASTER_SID = SOURCE.ITEM_MASTER_SID ) 
        WHEN MATCHED THEN 
        UPDATE SET 
        Target.CONTRACT_PRICE = Source.CONTRACT_PRICE, 
        Target.CONTRACT_PRICE_START_DATE = Source.CONTRACT_PRICE_START_DATE, 
        Target.CONTRACT_PRICE_END_DATE = Source.CONTRACT_PRICE_END_DATE, 
        Target.PRICE_PROTECTION_START_DATE = Source.PRICE_PROTECTION_START_DATE, 
        Target.PRICE_PROTECTION_END_DATE = Source.PRICE_PROTECTION_END_DATE, 
        Target.PRICE_TOLERANCE_TYPE = Source.PRICE_TOLERANCE_TYPE, 
        Target.PRICE_TOLERANCE = Source.PRICE_TOLERANCE, 
        Target.BASE_PRICE = Source.BASE_PRICE, 
        Target.ITEM_PRICING_QUALIFIER_SID = Source.PRICE_TYPE,
        Target.PRICE_TOLERANCE_FREQUENCY = Source.PRICE_TOLERANCE_FREQUENCY, 
        Target.PRICE_TOLERANCE_INTERVAL = Source.PRICE_TOLERANCE_INTERVAL, 
        Target.PRICE = Source.PRICE,  
        Target.CREATED_DATE = Source.CREATED_DATE, 
        Target.CREATED_BY = Source.CREATED_BY, 
        Target.MODIFIED_DATE = Source.MODIFIED_DATE, 
        Target.MODIFIED_BY = Source.MODIFIED_BY, 
        Target.INBOUND_STATUS = 'C',
        Target.PS_CONTRACT_ATTACHED_STATUS = Source.PS_STATUS,
        Target.PS_CONTRACT_ATTACHED_DATE = Source.ATTACHED_DATE,
        Target.MAX_INCREMENTAL_CHANGE = Source.MAX_INCREMENTAL_CHANGE,
        Target.RESET_ELIGIBLE = Source.RESET_ELIGIBLE,
        Target.RESET_TYPE = Source.RESET_TYPE,
        Target.RESET_DATE = Source.RESET_DATE,
        Target.RESET_INTERVAL = Source.RESET_INTERVAL,
        Target.RESET_FREQUENCY = Source.RESET_FREQUENCY,
        Target.NET_PRICE_TYPE = Source.NET_PRICE_TYPE,
        Target.NET_PRICE_TYPE_FORMULA = Source.NET_PRICE_TYPE_FORMULA,
        Target.PRICE_PROTECTION_PRICE_TYPE = Source.PRICE_PROTECTION_PRICE_TYPE,
        Target.NEP = Source.NEP,
        Target.NEP_FORMULA = Source.NEP_FORMULA,
        Target.BRAND_MASTER_SID = Source.BRAND_MASTER_SID,
        Target.PRICE_PROTECTION_STATUS = Source.PRICE_PROTECTION_STATUS,
        Target.Base_Price_Type = Source.Base_Price_Type,
        Target.Base_Price_Entry = Source.Base_Price_Entry,
        Target.Base_Price_Date = Source.Base_price_Date,
        Target.Base_Price_ddlb = Source.Base_Price_ddlb,
        Target.Net_Base_Price = Source.Net_Base_Price,
        Target.Net_Base_Price_Formula_ID = Source.Net_Base_Price_Formula_ID,
        Target.Subsequent_Period_Price_Type = Source.Subsequent_Period_Price_Type,
        Target.Net_Subsequent_Period_price = Source.Net_Subsequent_Period_price,
        Target.Net_Subsequent_Price_Formula_Id = Source.Net_Subsequent_Price_Formula_Id,
        Target.Reset_Price_Type = Source.Reset_Price_Type,
        Target.Net_Reset_Price_Type = Source.Net_Reset_Price_Type,
        Target.Net_Reset_Price_Formula_Id = Source.Net_Reset_Price_Formula_Id,
        Target.SUGGESTED_PRICE = Source.SUGGESTED_PRICE,
        Target."SOURCE" = Source."SOURCE"
        WHEN NOT MATCHED THEN
  INSERT (PS_CONTRACT_SID, ITEM_MASTER_SID, 
        CONTRACT_PRICE, CONTRACT_PRICE_START_DATE, CONTRACT_PRICE_END_DATE, PRICE_PROTECTION_START_DATE, PRICE_PROTECTION_END_DATE, 
        PRICE_TOLERANCE_TYPE, PRICE_TOLERANCE, BASE_PRICE, PRICE_TOLERANCE_FREQUENCY, PRICE_TOLERANCE_INTERVAL, ITEM_PRICING_QUALIFIER_SID, PRICE,   
        INBOUND_STATUS, RECORD_LOCK_STATUS, CREATED_DATE, CREATED_BY, MODIFIED_DATE, MODIFIED_BY, PS_CONTRACT_ATTACHED_STATUS
        ,MAX_INCREMENTAL_CHANGE,RESET_ELIGIBLE,RESET_TYPE,RESET_DATE,RESET_INTERVAL,RESET_FREQUENCY,NET_PRICE_TYPE,NET_PRICE_TYPE_FORMULA,PRICE_PROTECTION_PRICE_TYPE,NEP,NEP_FORMULA,BRAND_MASTER_SID,PRICE_PROTECTION_STATUS,Base_Price_Type,Base_Price_Entry
        ,Base_Price_Date,Base_Price_ddlb,Net_Base_Price,Net_Base_Price_Formula_ID,Subsequent_Period_Price_Type,Net_Subsequent_Period_price,Net_Subsequent_Price_Formula_Id,Reset_Price_Type,Net_Reset_Price_Type
        ,Net_Reset_Price_Formula_Id,SUGGESTED_PRICE,"SOURCE",PS_CONTRACT_ATTACHED_DATE
         ) VALUES( 
         ? ,SOURCE.ITEM_MASTER_SID, 
        SOURCE.CONTRACT_PRICE, SOURCE.CONTRACT_PRICE_START_DATE, SOURCE.CONTRACT_PRICE_END_DATE, SOURCE.PRICE_PROTECTION_START_DATE, SOURCE.PRICE_PROTECTION_END_DATE, SOURCE.PRICE_TOLERANCE_TYPE, 
        SOURCE.PRICE_TOLERANCE, SOURCE.BASE_PRICE, SOURCE.PRICE_TOLERANCE_FREQUENCY, SOURCE.PRICE_TOLERANCE_INTERVAL, SOURCE.PRICE_TYPE, SOURCE.PRICE, 'A'  ,'false'  , SOURCE.CREATED_DATE, SOURCE.CREATED_BY, SOURCE.MODIFIED_DATE, SOURCE.MODIFIED_BY, SOURCE.PS_STATUS 
        ,SOURCE.MAX_INCREMENTAL_CHANGE,SOURCE.RESET_ELIGIBLE,SOURCE.RESET_TYPE,SOURCE.RESET_DATE,SOURCE.RESET_INTERVAL,SOURCE.RESET_FREQUENCY,SOURCE.NET_PRICE_TYPE,nullif(SOURCE.NET_PRICE_TYPE_FORMULA , 0) ,SOURCE.PRICE_PROTECTION_PRICE_TYPE,SOURCE.NEP,SOURCE.NEP_FORMULA, 
        NULLIF(
            SOURCE.BRAND_MASTER_SID,
            0
          ) ,SOURCE.PRICE_PROTECTION_STATUS,SOURCE.Base_Price_Type,SOURCE.Base_Price_Entry
        ,SOURCE.Base_Price_Date,SOURCE.Base_Price_ddlb,SOURCE.Net_Base_Price,SOURCE.Net_Base_Price_Formula_ID,SOURCE.Subsequent_Period_Price_Type,SOURCE.Net_Subsequent_Period_price,SOURCE.Net_Subsequent_Price_Formula_Id,SOURCE.Reset_Price_Type,SOURCE.Net_Reset_Price_Type
        ,SOURCE.Net_Reset_Price_Formula_Id,SOURCE.SUGGESTED_PRICE,SOURCE."SOURCE",SOURCE.ATTACHED_DATE);
        ]]>
    </sql>
    
    <sql id="com.contractDashboard.process.saveRS">
        <![CDATA[
        UPDATE RS_CONTRACT_DETAILS SET INBOUND_STATUS='D' WHERE RS_CONTRACT_DETAILS_SID in 
        (SELECT RS_DETAILS_SID FROM dbo.IMTD_ITEM_PRICE_REBATE_DETAILS WHERE USERS_SID=? AND SESSION_ID='?' AND (CHECK_RECORD=0 OR "Operation" = 'D'));

       DELETE FROM dbo.IMTD_ITEM_PRICE_REBATE_DETAILS WHERE USERS_SID='?' AND SESSION_ID='?' AND (CHECK_RECORD=0 OR "Operation" = 'D'); 

        MERGE dbo.RS_CONTRACT_DETAILS AS Target USING 
        (SELECT REBATE_AMOUNT, ITEM_REBATE_START_DATE, ITEM_REBATE_END_DATE, RS_DETAILS_SID, CREATED_DATE, CREATED_BY, MODIFIED_DATE, MODIFIED_BY, BUNDLE_NO, REBATE_PLAN_SYSTEM_ID,FORMULA_ID, RS_ATTACHED_STATUS,RS_ATTACHED_DATE,
         DEDUCTION_CALENDAR_MASTER_SID, NET_SALES_FORMULA_MASTER_SID, FORMULA_TYPE, NET_SALES_RULE, EVALUATION_RULE, EVALUATION_RULE_BUNDLE, CALCULATION_RULE, CALCULATION_RULE_BUNDLE, ITEM_MASTER_SID 
        FROM dbo.IMTD_ITEM_PRICE_REBATE_DETAILS WHERE USERS_SID=? AND SESSION_ID='?' AND ( "Operation" = 'U'
                    OR "Operation" = 'A' )) 
 AS Source 
        ON (Target.RS_CONTRACT_SID = ?
    AND TARGET.ITEM_MASTER_SID = SOURCE.ITEM_MASTER_SID 
) 
      WHEN MATCHED THEN
        UPDATE SET 
       
        Target.ITEM_REBATE_START_DATE = Source.ITEM_REBATE_START_DATE, 
        Target.ITEM_REBATE_END_DATE = Source.ITEM_REBATE_END_DATE,
        Target.REBATE_AMOUNT = Source.REBATE_AMOUNT, 
        
        Target.CREATED_DATE = Source.CREATED_DATE, 
        Target.CREATED_BY = Source.CREATED_BY, 
        Target.MODIFIED_DATE = Source.MODIFIED_DATE, 
        Target.MODIFIED_BY = Source.MODIFIED_BY, 
        Target.BUNDLE_NO = Source.BUNDLE_NO, 
        Target.REBATE_PLAN_MASTER_SID = Source.REBATE_PLAN_SYSTEM_ID, 
        Target.FORMULA_ID=Source.FORMULA_ID,
        Target.RS_CONTRACT_ATTACHED_STATUS = Source.RS_ATTACHED_STATUS,
        Target.RS_CONTRACT_ATTACHED_DATE = Source.RS_ATTACHED_DATE,
        Target.DEDUCTION_CALENDAR_MASTER_SID = Source.DEDUCTION_CALENDAR_MASTER_SID,
        Target.NET_SALES_FORMULA_MASTER_SID = Source.NET_SALES_FORMULA_MASTER_SID,
        Target.FORMULA_TYPE = Source.FORMULA_TYPE,
        Target.NET_SALES_RULE = Source.NET_SALES_RULE,
        Target.EVALUATION_RULE = Source.EVALUATION_RULE,
        Target.EVALUATION_RULE_BUNDLE = Source.EVALUATION_RULE_BUNDLE,
        Target.CALCULATION_RULE = Source.CALCULATION_RULE,
        Target.CALCULATION_RULE_BUNDLE = Source.CALCULATION_RULE_BUNDLE,
        Target.INBOUND_STATUS = 'C'
WHEN NOT MATCHED THEN
  INSERT (RS_CONTRACT_SID, ITEM_MASTER_SID, ITEM_REBATE_START_DATE, 
        REBATE_AMOUNT, 
        INBOUND_STATUS, RECORD_LOCK_STATUS, CREATED_DATE, CREATED_BY, MODIFIED_DATE, MODIFIED_BY, BUNDLE_NO, REBATE_PLAN_MASTER_SID,FORMULA_ID,
         RS_CONTRACT_ATTACHED_STATUS, DEDUCTION_CALENDAR_MASTER_SID, NET_SALES_FORMULA_MASTER_SID, FORMULA_TYPE, NET_SALES_RULE, EVALUATION_RULE, EVALUATION_RULE_BUNDLE, CALCULATION_RULE, CALCULATION_RULE_BUNDLE) 
        Values( ? , SOURCE.ITEM_MASTER_SID, SOURCE.ITEM_REBATE_START_DATE,   
        SOURCE.REBATE_AMOUNT, 'A'  ,'false' , SOURCE.CREATED_DATE, SOURCE.CREATED_BY, SOURCE.MODIFIED_DATE, SOURCE.MODIFIED_BY, SOURCE.BUNDLE_NO, SOURCE.REBATE_PLAN_SYSTEM_ID,SOURCE.FORMULA_ID, SOURCE.RS_ATTACHED_STATUS,
         SOURCE.DEDUCTION_CALENDAR_MASTER_SID, SOURCE.NET_SALES_FORMULA_MASTER_SID, SOURCE.FORMULA_TYPE, SOURCE.NET_SALES_RULE, SOURCE.EVALUATION_RULE, SOURCE.EVALUATION_RULE_BUNDLE, SOURCE.CALCULATION_RULE, SOURCE.CALCULATION_RULE_BUNDLE
        );
        ]]>
    </sql>
    
    <sql id="com.contractDashboard.process.saveIFPNullValidation">
        <![CDATA[
        select count(IMTD_ITEM_PRICE_REBATE_SID) from dbo.IMTD_ITEM_PRICE_REBATE_DETAILS where USERS_SID=? AND SESSION_ID = '?' AND (? is null OR ? ='') AND "OPERATION" <> 'D' AND CHECK_RECORD=1
        ]]>
    </sql>
    
    <sql id="com.contractDashboard.process.saveIFPNnumericValidation">
        <![CDATA[
        select count(IMTD_ITEM_PRICE_REBATE_SID) from dbo.IMTD_ITEM_PRICE_REBATE_DETAILS where USERS_SID=? AND SESSION_ID = '?' AND (? is null OR ? =0) AND "OPERATION" <> 'D'
        ]]>
    </sql>
     <sql id="com.contractDashboard.process.saveIFPAlphaNumericValidation">
        <![CDATA[
        select count(IMTD_ITEM_PRICE_REBATE_SID) from dbo.IMTD_ITEM_PRICE_REBATE_DETAILS where USERS_SID=? AND SESSION_ID = '?' AND (? is null OR ? ='0' OR ? ='') AND "OPERATION" <> 'D'
        ]]>
    </sql>

    <sql id="com.contractDashboard.process.loadImtdCRS">
        <![CDATA[
        INSERT INTO dbo.IMTD_ITEM_PRICE_REBATE_DETAILS 
            (ITEM_MASTER_SID, ITEM_ID, ITEM_NO, ITEM_NAME, PS_STATUS,PRIMARY_UOM,PACKAGE_SIZE,
            CONTRACT_MASTER_SID, CFP_MODEL_SID, IFP_MODEL_SID, PS_MODEL_SID,                        
            RS_MODEL_SID, FORMULA_ID, REBATE_AMOUNT, RS_DETAILS_SID, 
            ITEM_REBATE_START_DATE, ITEM_REBATE_END_DATE, REBATE_PLAN_SYSTEM_ID, RSCD.BUNDLE_NO, 
            USERS_SID, SESSION_ID, CHECK_RECORD,  IMTD_CREATED_DATE, "OPERATION", CREATED_BY, CREATED_DATE) 
        SELECT DISTINCT 
            IM.ITEM_MASTER_SID, IM.ITEM_ID,  IM.ITEM_NO, IM.ITEM_NAME, IM.ITEM_STATUS,IM.PRIMARY_UOM,IM.PACKAGE_SIZE,
            RSC.CONTRACT_MASTER_SID, RSC.CFP_CONTRACT_SID, RSC.IFP_CONTRACT_SID, RSC.PS_CONTRACT_SID,                        
            RSC.RS_MODEL_SID,RSCD.FORMULA_ID, RSCD.REBATE_AMOUNT, RSCD.RS_CONTRACT_DETAILS_SID,  
            RSCD.ITEM_REBATE_START_DATE, RSCD.ITEM_REBATE_END_DATE, RSCD.REBATE_PLAN_MASTER_SID,  RSCD.BUNDLE_NO,
            '?' USERS_SID, '?' SESSION_ID, 0 CHECK_RECORD, '?' IMTD_CREATED_DATE, 'U' "Operation", RSCD.CREATED_BY, RSCD.CREATED_DATE 
        FROM 
            RS_CONTRACT RSC, 
            RS_CONTRACT_DETAILS RSCD, 
            ITEM_MASTER IM
        WHERE 
            RSC.CONTRACT_MASTER_SID=?            
            AND RSC.CFP_CONTRACT_SID=? 
            AND RSC.IFP_CONTRACT_SID is null
            AND RSC.PS_CONTRACT_SID is null             
            AND RSC.RS_CONTRACT_SID=?
                                                                    
            AND RSC.RS_CONTRACT_SID=RSCD.RS_CONTRACT_SID            
            AND RSCD.ITEM_MASTER_SID = IM.ITEM_MASTER_SID
                                    
            AND IM.INBOUND_STATUS <> 'D'
            AND RSCD.INBOUND_STATUS <> 'D';
        ]]>
    </sql>
    
    <sql id="com.contractDashboard.process.loadImtdCPS">
        <![CDATA[
        INSERT INTO dbo.IMTD_ITEM_PRICE_REBATE_DETAILS 
            (ITEM_MASTER_SID, ITEM_ID, ITEM_NO, ITEM_NAME,PRIMARY_UOM,PACKAGE_SIZE,
            CONTRACT_MASTER_SID, PS_MODEL_SID, 
            CONTRACT_PRICE, CONTRACT_PRICE_START_DATE, CONTRACT_PRICE_END_DATE, PRICE_PROTECTION_START_DATE, PRICE_PROTECTION_END_DATE, PRICE_TOLERANCE_TYPE, 
            PRICE_TOLERANCE, BASE_PRICE, PRICE_TOLERANCE_FREQUENCY, PRICE_TOLERANCE_INTERVAL, PRICE_TYPE, Price, PS_STATUS, PS_DETAILS_SID, 
            PRICE_PROTECTION_STATUS, BRAND_MASTER_SID, PRICE_PROTECTION_PRICE_TYPE, NEP, NEP_FORMULA,
            MAX_INCREMENTAL_CHANGE, RESET_ELIGIBLE, RESET_TYPE, RESET_DATE, RESET_INTERVAL, RESET_FREQUENCY, NET_PRICE_TYPE, NET_PRICE_TYPE_FORMULA,
            USERS_SID, SESSION_ID, CHECK_RECORD, IMTD_CREATED_DATE, "Operation", CREATED_BY, CREATED_DATE, MODIFIED_BY, MODIFIED_DATE,"SOURCE",SUGGESTED_PRICE) 
        SELECT Distinct
            IM.ITEM_MASTER_SID, IM.ITEM_ID,  IM.ITEM_NO, IM.ITEM_NAME,IM.PRIMARY_UOM,IM.PACKAGE_SIZE,
            PSC.CONTRACT_MASTER_SID, PSC.PS_MODEL_SID,
            PS.CONTRACT_PRICE, PS.CONTRACT_PRICE_START_DATE, PS.CONTRACT_PRICE_END_DATE, 
            PS.PRICE_PROTECTION_START_DATE, PS.PRICE_PROTECTION_END_DATE, PS.PRICE_TOLERANCE_TYPE, PS.PRICE_TOLERANCE, 
            PS.BASE_PRICE, PS.PRICE_TOLERANCE_FREQUENCY, PS.PRICE_TOLERANCE_INTERVAL, 
            PS.ITEM_PRICING_QUALIFIER_SID, PS.PRICE, PS.PS_CONTRACT_ATTACHED_STATUS, PS.PS_CONTRACT_DETAILS_SID, 
            PS.PRICE_PROTECTION_STATUS,PS.BRAND_MASTER_SID,PS.PRICE_PROTECTION_PRICE_TYPE,PS.NEP,PS.NEP_FORMULA,
            PS.MAX_INCREMENTAL_CHANGE,PS.RESET_ELIGIBLE,PS.RESET_TYPE,PS.RESET_DATE,PS.RESET_INTERVAL,PS.RESET_FREQUENCY,PS.NET_PRICE_TYPE,PS.NET_PRICE_TYPE_FORMULA, 
            ? USERS_SID, '?' SESSION_ID, 0 CHECK_RECORD, '?' IMTD_CREATED_DATE, 'U' "Operation", PS.CREATED_BY, PS.CREATED_DATE, PS.MODIFIED_BY, PS.MODIFIED_DATE,PS."SOURCE",PS.SUGGESTED_PRICE 
        FROM 
            PS_CONTRACT_DETAILS PS,
            PS_CONTRACT PSC, 
            ITEM_MASTER IM
        WHERE 
            PSC.CONTRACT_MASTER_SID=? 
            AND PSC.CFP_CONTRACT_SID=?  
            AND PSC.IFP_CONTRACT_SID is null
            AND PSC.PS_CONTRACT_SID=?
                        
            AND PS.ITEM_MASTER_SID = IM.ITEM_MASTER_SID            
            AND PSC.PS_CONTRACT_SID = PS.PS_CONTRACT_SID
            
            AND IM.INBOUND_STATUS <> 'D'  
            AND PSC.INBOUND_STATUS <> 'D' 
            AND PS.INBOUND_STATUS <> 'D';
        ]]>
    </sql>    
    
    <sql id="com.contractDashboard.process.loadImtdCPSRS">
        <![CDATA[
        INSERT INTO dbo.IMTD_ITEM_PRICE_REBATE_DETAILS 
            (ITEM_MASTER_SID, ITEM_ID, ITEM_NO, ITEM_NAME,PRIMARY_UOM,PACKAGE_SIZE,             
            CONTRACT_MASTER_SID, CFP_MODEL_SID, IFP_MODEL_SID, PS_MODEL_SID, 
            CONTRACT_PRICE, CONTRACT_PRICE_START_DATE, CONTRACT_PRICE_END_DATE, PRICE_PROTECTION_START_DATE, PRICE_PROTECTION_END_DATE, PRICE_TOLERANCE_TYPE, 
            PRICE_TOLERANCE, BASE_PRICE, PRICE_TOLERANCE_FREQUENCY, PRICE_TOLERANCE_INTERVAL, PRICE_TYPE, PRICE, PS_STATUS, PS_DETAILS_SID, 
            RS_MODEL_SID, FORMULA_ID, REBATE_AMOUNT, RS_DETAILS_SID, 
            ITEM_REBATE_START_DATE, ITEM_REBATE_END_DATE, REBATE_PLAN_SYSTEM_ID, BUNDLE_NO,
            USERS_SID, SESSION_ID, CHECK_RECORD,  IMTD_CREATED_DATE, "OPERATION", CREATED_BY, CREATED_DATE,"SOURCE",SUGGESTED_PRICE )
        SELECT DISTINCT 
            IM.ITEM_MASTER_SID, IM.ITEM_ID,  IM.ITEM_NO, IM.ITEM_NAME,IM.PRIMARY_UOM,IM.PACKAGE_SIZE,             
            RSC.CONTRACT_MASTER_SID, RSC.CFP_CONTRACT_SID, RSC.IFP_CONTRACT_SID, 
            RSC.PS_CONTRACT_SID, PSCD.CONTRACT_PRICE, PSCD.CONTRACT_PRICE_START_DATE, PSCD.CONTRACT_PRICE_END_DATE, 
            PSCD.PRICE_PROTECTION_START_DATE, PSCD.PRICE_PROTECTION_END_DATE, PSCD.PRICE_TOLERANCE_TYPE, PSCD.PRICE_TOLERANCE, 
            PSCD.BASE_PRICE, PSCD.PRICE_TOLERANCE_FREQUENCY, PSCD.PRICE_TOLERANCE_INTERVAL, 
            PSCD.ITEM_PRICING_QUALIFIER_SID, PSCD.PRICE, PSCD.PS_CONTRACT_ATTACHED_STATUS, PSCD.PS_CONTRACT_DETAILS_SID, 
            RSC.RS_MODEL_SID,RSCD.FORMULA_ID, RSCD.REBATE_AMOUNT, RSCD.RS_CONTRACT_DETAILS_SID,  
            RSCD.ITEM_REBATE_START_DATE, RSCD.ITEM_REBATE_END_DATE, RSCD.REBATE_PLAN_MASTER_SID, RSCD.BUNDLE_NO, 
            '?' USERS_SID, '?' SESSION_ID, 0 CHECK_RECORD, '?' IMTD_CREATED_DATE, 'U' "Operation", PSCD.CREATED_BY, PSCD.CREATED_DATE ,PSCD."SOURCE",PSCD.SUGGESTED_PRICE
        FROM             
            PS_CONTRACT_DETAILS PSCD,            
            RS_CONTRACT RSC, 
            RS_CONTRACT_DETAILS RSCD, 
            ITEM_MASTER IM
        WHERE 
            RSC.CONTRACT_MASTER_SID=?            
            AND RSC.CFP_CONTRACT_SID=?  
            AND RSC.IFP_CONTRACT_SID is null
            AND RSC.PS_CONTRACT_SID=?             
            AND RSC.RS_CONTRACT_SID=?            
            AND PSCD.PS_CONTRACT_SID=?
                                                                    
            AND RSC.RS_CONTRACT_SID=RSCD.RS_CONTRACT_SID            
            AND RSCD.ITEM_MASTER_SID = IM.ITEM_MASTER_SID
            AND PSCD.ITEM_MASTER_SID = IM.ITEM_MASTER_SID
                                                
            AND IM.INBOUND_STATUS <> 'D'            
            AND PSCD.INBOUND_STATUS <> 'D'
            AND RSCD.INBOUND_STATUS <> 'D';
        ]]>
    </sql>          

    <sql id="com.contractDashboard.process.loadImtdCIFPRS">
        <![CDATA[
        INSERT INTO dbo.IMTD_ITEM_PRICE_REBATE_DETAILS 
            (ITEM_MASTER_SID, ITEM_ID, ITEM_NO, ITEM_NAME, PS_STATUS,PRIMARY_UOM,PACKAGE_SIZE, UDC1, UDC2, UDC3, UDC4, UDC5, UDC6, 
            START_DATE, END_DATE, ATTACHED_STATUS, ATTACHED_DATE, IFP_DETAILS_SID, 
            CONTRACT_MASTER_SID, CFP_MODEL_SID, IFP_MODEL_SID, PS_MODEL_SID, 
            RS_MODEL_SID, FORMULA_ID, REBATE_AMOUNT, RS_DETAILS_SID, 
            ITEM_REBATE_START_DATE, ITEM_REBATE_END_DATE, REBATE_PLAN_SYSTEM_ID, BUNDLE_NO,
            USERS_SID, SESSION_ID, CHECK_RECORD,  IMTD_CREATED_DATE, "OPERATION", CREATED_BY, CREATED_DATE) 
        SELECT DISTINCT 
            IM.ITEM_MASTER_SID, IM.ITEM_ID,  IM.ITEM_NO, IM.ITEM_NAME, IFPCD.ITEM_STATUS,IM.PRIMARY_UOM,IM.PACKAGE_SIZE, 0 UDC1, 0 UDC2, 0 UDC3, 0 UDC4, 0 UDC5, 0 UDC6, 
            IFPCD.ITEM_START_DATE, IFPCD.ITEM_END_DATE, IFPCD.ITEM_STATUS, IFPCD.IFP_CONTRACT_ATTACHED_DATE, IFPCD.IFP_CONTRACT_DETAILS_SID, 
            RSC.CONTRACT_MASTER_SID, RSC.CFP_CONTRACT_SID, RSC.IFP_CONTRACT_SID, 
            RSC.PS_CONTRACT_SID, 
            RSC.RS_MODEL_SID,RSCD.FORMULA_ID, RSCD.REBATE_AMOUNT, RSCD.RS_CONTRACT_DETAILS_SID,  
            RSCD.ITEM_REBATE_START_DATE, RSCD.ITEM_REBATE_END_DATE, RSCD.REBATE_PLAN_MASTER_SID, RSCD.BUNDLE_NO,
            '?' USERS_SID, '?' SESSION_ID, 0 CHECK_RECORD, '?' IMTD_CREATED_DATE, 'U' "Operation", IFPCD.CREATED_BY, IFPCD.CREATED_DATE 
        FROM 
            IFP_CONTRACT_DETAILS IFPCD,           
            RS_CONTRACT RSC, 
            RS_CONTRACT_DETAILS RSCD, 
            ITEM_MASTER IM
        WHERE 
            RSC.CONTRACT_MASTER_SID=?            
            AND RSC.CFP_CONTRACT_SID=? 
            AND RSC.IFP_CONTRACT_SID=?
            AND RSC.PS_CONTRACT_SID is null             
            AND RSC.RS_CONTRACT_SID=?            
            AND IFPCD.IFP_CONTRACT_SID=?                                                        
            AND RSC.RS_CONTRACT_SID=RSCD.RS_CONTRACT_SID            
            AND RSCD.ITEM_MASTER_SID = IM.ITEM_MASTER_SID
            AND IFPCD.ITEM_MASTER_SID = IM.ITEM_MASTER_SID                                    
            AND IM.INBOUND_STATUS <> 'D'
            AND IFPCD.INBOUND_STATUS <> 'D'
            AND RSCD.INBOUND_STATUS <> 'D';
        ]]>
    </sql>
    <sql id="com.contractDashboard.process.addTempRSForBranch">
        <![CDATA[
        UPDATE dbo.IMTD_ITEM_PRICE_REBATE_DETAILS 
            SET "Operation"='U' WHERE USERS_SID=? AND SESSION_ID = '?' AND "Operation"='D' AND ITEM_MASTER_SID 
            IN (SELECT IM1.ITEM_MASTER_SID FROM ITEM_MASTER IM1 WHERE IM1.BRAND_MASTER_SID IN (SELECT BM.BRAND_MASTER_SID FROM BRAND_MASTER BM where BM.? LIKE '?' AND BM.INBOUND_STATUS <> 'D' AND BM.BRAND_NAME IS NOT NULL) AND IM1.INBOUND_STATUS <> 'D');
        INSERT INTO dbo.IMTD_ITEM_PRICE_REBATE_DETAILS 
            (ITEM_MASTER_SID, ITEM_ID, ITEM_NO, ITEM_NAME,BRAND_MASTER_SID, UDC1, UDC2, UDC3, UDC4, UDC5, UDC6, 
            CONTRACT_MASTER_SID, CFP_MODEL_SID, IFP_MODEL_SID, PS_MODEL_SID, RS_MODEL_SID, 
            USERS_SID, SESSION_ID, CHECK_RECORD,  IMTD_CREATED_DATE, "Operation", CREATED_BY, CREATED_DATE) 
        SELECT 
            IM.ITEM_MASTER_SID, IM.ITEM_ID,  IM.ITEM_NO, IM.ITEM_NAME,IM.BRAND_MASTER_SID, '0' UDC1, '0' UDC2, '0' UDC3, '0' UDC4, '0' UDC5, '0' UDC6, 
            ? CONTRACT_MASTER_SID, ? COMPANY_FAMILYPLAN_SYSTEM_ID, ? IFP_MODEL_SID, ? PS_MODEL_SID, ? RS_MODEL_SID,  
            ? USERS_SID, '?' SESSION_ID, 0 CHECK_RECORD, '?' IMTD_CREATED_DATE, 'A' "Operation", '?' CREATED_BY, '?' CREATED_DATE 
        FROM 
            ITEM_MASTER IM 
        WHERE 
            IM.ITEM_MASTER_SID 
            IN (SELECT IM1.ITEM_MASTER_SID FROM ITEM_MASTER IM1 WHERE IM1.BRAND_MASTER_SID IN (SELECT BM.BRAND_MASTER_SID FROM BRAND_MASTER BM where BM.? LIKE '?' AND BM.INBOUND_STATUS <> 'D' AND BM.BRAND_NAME IS NOT NULL) AND IM1.INBOUND_STATUS <> 'D')
            AND IM.INBOUND_STATUS <> 'D' 
            AND IM.ITEM_MASTER_SID NOT IN (SELECT ITEM_MASTER_SID from dbo.IMTD_ITEM_PRICE_REBATE_DETAILS WHERE USERS_SID=? AND SESSION_ID='?');
        ]]>
    </sql>
    
    <sql id="com.contractDashboard.process.addTempPSForBranch">
        <![CDATA[
        UPDATE dbo.IMTD_ITEM_PRICE_REBATE_DETAILS 
            SET "Operation"='U' WHERE USERS_SID=? AND SESSION_ID = '?' AND "Operation"='D' AND ITEM_MASTER_SID 
            IN (SELECT IM1.ITEM_MASTER_SID FROM ITEM_MASTER IM1 WHERE IM1.BRAND_MASTER_SID IN (SELECT BM.BRAND_MASTER_SID FROM BRAND_MASTER BM where BM.? LIKE '?' AND BM.INBOUND_STATUS <> 'D' AND BM.BRAND_NAME IS NOT NULL) AND IM1.INBOUND_STATUS <> 'D');
        INSERT INTO dbo.IMTD_ITEM_PRICE_REBATE_DETAILS 
            (ITEM_MASTER_SID, ITEM_ID, ITEM_NO, ITEM_NAME,BRAND_MASTER_SID, UDC1, UDC2, UDC3, UDC4, UDC5, UDC6, 
            CONTRACT_MASTER_SID, CFP_MODEL_SID, IFP_MODEL_SID, PS_MODEL_SID, 
            USERS_SID, SESSION_ID, CHECK_RECORD,  IMTD_CREATED_DATE, "Operation", CREATED_BY, CREATED_DATE, MODIFIED_BY, MODIFIED_DATE) 
        SELECT 
            IM.ITEM_MASTER_SID, IM.ITEM_ID,  IM.ITEM_NO, IM.ITEM_NAME,IM.BRAND_MASTER_SID, '0' UDC1, '0' UDC2, '0' UDC3, '0' UDC4, '0' UDC5, '0' UDC6, 
            ? CONTRACT_MASTER_SID, ? COMPANY_FAMILYPLAN_SYSTEM_ID, ? IFP_MODEL_SID, ? PS_MODEL_SID, 
            ? USERS_SID, '?' SESSION_ID, 0 CHECK_RECORD, '?' IMTD_CREATED_DATE, 'A' "Operation", '?' CREATED_BY, '?' CREATED_DATE , '?' MODIFIED_BY, '?' MODIFIED_DATE 
        FROM 
            ITEM_MASTER IM 
        WHERE 
            IM.ITEM_MASTER_SID 
            IN (SELECT IM1.ITEM_MASTER_SID FROM ITEM_MASTER IM1 WHERE IM1.BRAND_MASTER_SID IN (SELECT BM.BRAND_MASTER_SID FROM BRAND_MASTER BM where BM.? LIKE '?' AND BM.INBOUND_STATUS <> 'D' AND BM.BRAND_NAME IS NOT NULL) AND IM1.INBOUND_STATUS <> 'D')
            AND IM.INBOUND_STATUS <> 'D' 
            AND IM.ITEM_MASTER_SID NOT IN (SELECT ITEM_MASTER_SID from dbo.IMTD_ITEM_PRICE_REBATE_DETAILS WHERE USERS_SID=? AND SESSION_ID='?');
        ]]>
    </sql>
    
    <sql id="contractItemPricingSelectTempTableCount">
        <![CDATA[   
            SELECT COUNT(IMTD.IMTD_ITEM_PRICE_REBATE_SID) FROM IMTD_ITEM_PRICE_REBATE_DETAILS IMTD
	]]>
    </sql>
      <sql id="contractIFPItemSelectTempTableCount">
        <![CDATA[   
            SELECT COUNT(IMTD.IMTD_ITEM_PRICE_REBATE_SID) FROM IMTD_ITEM_PRICE_REBATE_DETAILS IMTD
            LEFT JOIN dbo.ITEM_MASTER IM
            on IM.ITEM_MASTER_SID=IMTD.ITEM_MASTER_SID
	]]>
    </sql>
    
    <sql id="contractItemPricingSelectTempTableData">
        <![CDATA[
            SELECT IMTD.ITEM_MASTER_SID,IMTD.ITEM_NO,IMTD.ITEM_NAME, IMTD.IMTD_ITEM_PRICE_REBATE_SID, IMTD.ITEM_ID,
            IMTD.START_DATE, IMTD.END_DATE, IMTD.PRICE, IMTD.PRICE_TYPE, IMTD.CONTRACT_PRICE, IMTD.CONTRACT_PRICE_START_DATE,
            IMTD.CONTRACT_PRICE_END_DATE, IMTD.PS_STATUS, IMTD.PRICE_TOLERANCE, IMTD.PRICE_PROTECTION_START_DATE,
            IMTD.PRICE_PROTECTION_END_DATE, IMTD.PRICE_TOLERANCE_TYPE, IMTD.PRICE_TOLERANCE_INTERVAL, IMTD.PRICE_TOLERANCE_FREQUENCY,
            IMTD.BASE_PRICE, IMTD.ITEM_PRICE_REVISION_DATE, IMTD.ATTACHED_STATUS, IMTD.ATTACHED_DATE, IMTD.CHECK_RECORD,
            IMTD.REBATE_REVISION_DATE, IMTD.PRIMARY_UOM, IMTD.PACKAGE_SIZE,IMTD."SOURCE",IMTD.SUGGESTED_PRICE,IMTD.CREATED_BY,IMTD.CREATED_DATE,BM.BRAND_NAME 
            FROM IMTD_ITEM_PRICE_REBATE_DETAILS IMTD
            LEFT JOIN BRAND_MASTER BM ON IMTD.BRAND_MASTER_SID=BM.BRAND_MASTER_SID
        ]]>
    </sql>
     <sql id="contractIfpItemSelectTempTableData">
        <![CDATA[
            SELECT IMTD.ITEM_MASTER_SID,IMTD.ITEM_NO,IMTD.ITEM_NAME, IMTD.IMTD_ITEM_PRICE_REBATE_SID, IMTD.ITEM_ID,
            IMTD.START_DATE, IMTD.END_DATE, IMTD.PRICE, IMTD.PRICE_TYPE, IMTD.CONTRACT_PRICE, IMTD.CONTRACT_PRICE_START_DATE,
            IMTD.CONTRACT_PRICE_END_DATE, IMTD.PS_STATUS, IMTD.PRICE_TOLERANCE, IMTD.PRICE_PROTECTION_START_DATE,
            IMTD.PRICE_PROTECTION_END_DATE, IMTD.PRICE_TOLERANCE_TYPE, IMTD.PRICE_TOLERANCE_INTERVAL, IMTD.PRICE_TOLERANCE_FREQUENCY,
            IMTD.BASE_PRICE, IMTD.ITEM_PRICE_REVISION_DATE, IMTD.ATTACHED_STATUS, IMTD.ATTACHED_DATE, IMTD.CHECK_RECORD,
            IMTD.REBATE_REVISION_DATE, IMTD.PRIMARY_UOM, IMTD.PACKAGE_SIZE,IMTD."SOURCE",IMTD.SUGGESTED_PRICE,IMTD.CREATED_BY,IMTD.CREATED_DATE,IMTD.MODIFIED_BY,IMTD.MODIFIED_DATE,
            IMTD.BRAND_MASTER_SID,IM.THERAPEUTIC_CLASS,IM.STRENGTH,IM.FORM,IM.ITEM_DESC
            FROM dbo.IMTD_ITEM_PRICE_REBATE_DETAILS IMTD
            LEFT JOIN dbo.ITEM_MASTER IM
             on IM.ITEM_MASTER_SID=IMTD.ITEM_MASTER_SID
    
        ]]>
    </sql>
    <sql id="contractRebateSelectTempTableCount">
        <![CDATA[   
            SELECT COUNT(IMTD.IMTD_ITEM_PRICE_REBATE_SID)FROM IMTD_ITEM_PRICE_REBATE_DETAILS IMTD
            LEFT JOIN DBO.FORECASTING_FORMULA FF ON FF.FORECASTING_FORMULA_SID = IMTD.FORMULA_ID 
            LEFT JOIN DBO.NET_SALES_FORMULA_MASTER NSFM ON NSFM.NET_SALES_FORMULA_MASTER_SID = IMTD.NET_SALES_FORMULA_MASTER_SID
            LEFT JOIN DBO.CDR_MODEL NET ON NET.CDR_MODEL_SID = IMTD.NET_SALES_RULE
            LEFT JOIN DBO.CDR_MODEL EVA ON EVA.CDR_MODEL_SID = IMTD.EVALUATION_RULE
            LEFT JOIN DBO.CDR_MODEL CAL ON CAL.CDR_MODEL_SID = IMTD.CALCULATION_RULE
            LEFT JOIN DBO.REBATE_PLAN_MASTER RPM ON RPM.REBATE_PLAN_MASTER_SID = IMTD.REBATE_PLAN_SYSTEM_ID
            LEFT JOIN DBO.DEDUCTION_CALENDAR_MASTER DC ON DC.DEDUCTION_CALENDAR_MASTER_SID = IMTD.DEDUCTION_CALENDAR_MASTER_SID
	]]>
    </sql>
    
    <sql id="contractRebateSelectTempTableData">
        <![CDATA[
            SELECT IMTD.ITEM_MASTER_SID, IMTD.ITEM_NO, IMTD.ITEM_NAME, IMTD.IMTD_ITEM_PRICE_REBATE_SID, IMTD.FORMULA_ID, FF.FORMULA_NAME, IMTD.REBATE_AMOUNT, 
            IMTD.ITEM_REBATE_START_DATE, IMTD.ITEM_REBATE_END_DATE, IMTD.REBATE_REVISION_DATE, IMTD.BUNDLE_NO, IMTD.REBATE_PLAN_SYSTEM_ID, IMTD.CHECK_RECORD, IMTD.ITEM_TYPE, 
            IMTD.ITEM_ID, IMTD.RS_ATTACHED_STATUS, FF.FORMULA_NO, NSFM.NET_SALES_FORMULA_NO, NET.RULE_NAME as NET_SALES_RULE,
            EVA.RULE_NAME AS EVA_RULE, IMTD.EVALUATION_RULE_BUNDLE, CAL.RULE_NAME as CAL_RULE, IMTD.CALCULATION_RULE_BUNDLE, RPM.REBATE_PLAN_NO, DC.DEDUCTION_CALENDAR_NO, DC.DEDUCTION_CALENDAR_NAME FROM dbo.IMTD_ITEM_PRICE_REBATE_DETAILS IMTD 
            LEFT JOIN DBO.FORECASTING_FORMULA FF ON FF.FORECASTING_FORMULA_SID = IMTD.FORMULA_ID 
            LEFT JOIN DBO.NET_SALES_FORMULA_MASTER NSFM ON NSFM.NET_SALES_FORMULA_MASTER_SID = IMTD.NET_SALES_FORMULA_MASTER_SID
            LEFT JOIN DBO.CDR_MODEL NET ON NET.CDR_MODEL_SID = IMTD.NET_SALES_RULE
            LEFT JOIN DBO.CDR_MODEL EVA ON EVA.CDR_MODEL_SID = IMTD.EVALUATION_RULE
            LEFT JOIN DBO.CDR_MODEL CAL ON CAL.CDR_MODEL_SID = IMTD.CALCULATION_RULE
            LEFT JOIN DBO.REBATE_PLAN_MASTER RPM ON RPM.REBATE_PLAN_MASTER_SID = IMTD.REBATE_PLAN_SYSTEM_ID
            LEFT JOIN DBO.DEDUCTION_CALENDAR_MASTER DC ON DC.DEDUCTION_CALENDAR_MASTER_SID = IMTD.DEDUCTION_CALENDAR_MASTER_SID
        ]]>
    </sql>
    
    <sql
        id="com.rsModel.massPopulateContractRebate">
        <![CDATA[   
                UPDATE 
                    dbo.IMTD_ITEM_PRICE_REBATE_DETAILS 
                SET 
                    REBATE_PLAN_SYSTEM_ID = '@REBATE_PLAN_MASTER_SID',
                    RS_CONTRACT_DETAILS_REBATE_PLAN_NAME = '@RS_DETAILS_REBATE_PLAN_NAME'    
                WHERE
                    USERS_SID LIKE '@USERS_SID'
                    AND SESSION_ID LIKE '@SESSION_ID'
                    AND "OPERATION" != 'D'
                    AND CHECK_RECORD = 1;
	]]>
    </sql>
      <sql
        id="com.rsModel.massPopulateContractRebate populate All">
        <![CDATA[   
                UPDATE 
                    dbo.IMTD_ITEM_PRICE_REBATE_DETAILS 
                SET 
                    REBATE_PLAN_SYSTEM_ID = '@REBATE_PLAN_MASTER_SID',
                    RS_CONTRACT_DETAILS_REBATE_PLAN_NAME = '@RS_DETAILS_REBATE_PLAN_NAME'    
                WHERE
                    USERS_SID LIKE '@USERS_SID'
                    AND SESSION_ID LIKE '@SESSION_ID'
                    AND "OPERATION" != 'D'
                   
	]]>
    </sql>
    
    <sql
        id="com.rsModel.massPopulateFormulaForContract">
        <![CDATA[
                UPDATE 
                    IMTD_ITEM_PRICE_REBATE_DETAILS 
                SET 
                    RS_CONTRACT_DETAILS_FORMULA_NO = '@RS_DETAILS_FORMULA_NO',
                    FORMULA_NAME = '@RS_DETAILS_FORMULA_NAME',
                    FORMULA_ID = '@RS_DETAILS_FORMULA_ID'
                WHERE
                    USERS_SID LIKE '@USERS_SID'
                    AND SESSION_ID LIKE '@SESSION_ID'
                    AND "OPERATION" != 'D'
                    AND CHECK_RECORD = 1;
        ]]>
    </sql>
    <sql
        id="com.rsModel.massPopulateFormulaForContract populate All">
        <![CDATA[
                UPDATE 
                    IMTD_ITEM_PRICE_REBATE_DETAILS 
                SET 
                    RS_CONTRACT_DETAILS_FORMULA_NO = '@RS_DETAILS_FORMULA_NO',
                    FORMULA_NAME = '@RS_DETAILS_FORMULA_NAME',
                    FORMULA_ID = '@RS_DETAILS_FORMULA_ID'
                WHERE
                    USERS_SID LIKE '@USERS_SID'
                    AND SESSION_ID LIKE '@SESSION_ID'
                    AND "OPERATION" != 'D'
                   
        ]]>
    </sql>

    <sql
        id="com.rsModel.massPopulateDeductionForContract">
        <![CDATA[
                UPDATE 
                    IMTD_ITEM_PRICE_REBATE_DETAILS 
                SET 
                    DEDUCTION_CALENDAR_MASTER_SID = '@DEDUCTION_CALENDAR_MASTER_SID',
                    RS_CONTRACT_DETAILS_DEDUCTION_CALENDAR_NO = '@RS_DETAILS_DEDUCTION_CALENDAR_NO',
                    RS_CONTRACT_DETAILS_DEDUCTION_CALENDAR_NAME = '@RS_DETAILS_DEDUCTION_CALENDAR_NAME'
                WHERE
                    USERS_SID LIKE '@USERS_SID'
                    AND SESSION_ID LIKE '@SESSION_ID'
                    AND "OPERATION" != 'D'
            ]]>
    </sql>
    
    <sql
        id="com.rsModel.massPopulateNetSalesForContract">
        <![CDATA[
                UPDATE 
                    IMTD_ITEM_PRICE_REBATE_DETAILS 
                SET 
                    NET_SALES_FORMULA_MASTER_SID = '@NET_SALES_FORMULA_MASTER_SID',
                    RS_CONTRACT_DETAILS_NET_SALES_FORMULA_NO = '@RS_DETAILS_NET_SALES_FORMULA_NO',
                    RS_CONTRACT_DETAILS_NET_SALES_FORMULA_NAME = '@RS_DETAILS_NET_SALES_FORMULA_NAME'
                WHERE
                    USERS_SID LIKE '@USERS_SID'
                    AND SESSION_ID LIKE '@SESSION_ID'
                    AND "OPERATION" != 'D'
             ]]>
    </sql>         
    <sql
        id="com.rsModel.massPopulateNetSalesRuleForContract">
        <![CDATA[
                UPDATE 
                    IMTD_ITEM_PRICE_REBATE_DETAILS 
                SET 
                    NET_SALES_RULE ='@NET_SALES_RULE'
                WHERE
                    USERS_SID LIKE '@USERS_SID'
                    AND SESSION_ID LIKE '@SESSION_ID'
                    AND "OPERATION" != 'D'
             ]]>
    </sql>     
    <sql
        id="com.rsModel.massPopulateCalculationRuleForContract">
        <![CDATA[
                UPDATE 
                    IMTD_ITEM_PRICE_REBATE_DETAILS 
                SET 
                    CALCULATION_RULE = '@CALCULATION_RULE'
                WHERE
                    USERS_SID LIKE '@USERS_SID'
                    AND SESSION_ID LIKE '@SESSION_ID'
                    AND "OPERATION" != 'D'
             ]]>
    </sql>     
    <sql
        id="com.rsModel.massPopulateEvaluationRuleForContract">
        <![CDATA[
                UPDATE 
                    IMTD_ITEM_PRICE_REBATE_DETAILS 
                SET 
                    EVALUATION_RULE = '@EVALUATION_RULE'
                WHERE
                    USERS_SID LIKE '@USERS_SID'
                    AND SESSION_ID LIKE '@SESSION_ID'
                    AND "OPERATION" != 'D'
             ]]>
    </sql>
    <sql id="contractPriceProtectionSelectTempTableCount">
        <![CDATA[   
            SELECT Count(IMTD.IMTD_ITEM_PRICE_REBATE_SID)
FROM   IMTD_ITEM_PRICE_REBATE_DETAILS IMTD
       LEFT JOIN BRAND_MASTER BM
              ON IMTD.BRAND_MASTER_SID = BM.BRAND_MASTER_SID
       LEFT JOIN NET_SALES_FORMULA_MASTER HT_NEP_FORMULA
              ON HT_NEP_FORMULA.NET_SALES_FORMULA_MASTER_SID = IMTD.NEP_FORMULA
       LEFT JOIN NET_SALES_FORMULA_MASTER HT_NET_BASE_FORMULA
              ON HT_NET_BASE_FORMULA.NET_SALES_FORMULA_MASTER_SID = IMTD.NET_BASE_PRICE_FORMULA_ID
       LEFT JOIN NET_SALES_FORMULA_MASTER HT_NET_SUB_FORMULA
              ON HT_NET_SUB_FORMULA.NET_SALES_FORMULA_MASTER_SID = IMTD.NET_SUBSEQUENT_PRICE_FORMULA_ID
       LEFT JOIN NET_SALES_FORMULA_MASTER HT_NET_RESET_FORMULA
              ON HT_NET_RESET_FORMULA.NET_SALES_FORMULA_MASTER_SID = IMTD.NET_RESET_PRICE_FORMULA_ID
       LEFT JOIN NET_SALES_FORMULA_MASTER HT_NET_PRICE_FORMULA
              ON HT_NET_PRICE_FORMULA.NET_SALES_FORMULA_MASTER_SID = IMTD.NET_PRICE_TYPE_FORMULA

	]]>
    </sql>
    
    <sql id="contractPriceProtectionSelectTempTableData">
        <![CDATA[
            SELECT IMTD.ITEM_MASTER_SID, IMTD.ITEM_ID, IMTD.ITEM_NO, IMTD.ITEM_NAME, IMTD.PRICE_PROTECTION_STATUS,
            IMTD.PRICE_PROTECTION_START_DATE, IMTD.PRICE_PROTECTION_END_DATE, IMTD.PRICE_PROTECTION_PRICE_TYPE,
            IMTD.NEP, IMTD.NEP_FORMULA, IMTD.BASE_PRICE, IMTD.PRICE_TOLERANCE_INTERVAL, IMTD.PRICE_TOLERANCE_FREQUENCY, IMTD.PRICE_TOLERANCE_TYPE,
            IMTD.PRICE_TOLERANCE, IMTD.MAX_INCREMENTAL_CHANGE, IMTD.RESET_ELIGIBLE, IMTD.RESET_TYPE, IMTD.RESET_DATE,
            IMTD.RESET_INTERVAL, IMTD.RESET_FREQUENCY, IMTD.NET_PRICE_TYPE, IMTD.NET_PRICE_TYPE_FORMULA, IMTD.ATTACHED_DATE,
            IMTD.BRAND_MASTER_SID,
            BM.BRAND_NAME, IMTD.IMTD_ITEM_PRICE_REBATE_SID ,IMTD.CHECK_RECORD,
            IMTD.BASE_PRICE_TYPE,IMTD.BASE_PRICE_DDLB, IMTD.BASE_PRICE_ENTRY, IMTD.BASE_PRICE_DATE,
            IMTD.NET_BASE_PRICE, IMTD.NET_BASE_PRICE_FORMULA_ID, IMTD.SUBSEQUENT_PERIOD_PRICE_TYPE,
            IMTD.NET_SUBSEQUENT_PERIOD_PRICE, IMTD.NET_SUBSEQUENT_PRICE_FORMULA_ID, IMTD.NET_RESET_PRICE_TYPE,
            IMTD.NET_RESET_PRICE_FORMULA_ID,IMTD.RESET_PRICE_TYPE  FROM IMTD_ITEM_PRICE_REBATE_DETAILS IMTD 
            LEFT JOIN BRAND_MASTER BM ON IMTD.BRAND_MASTER_SID=BM.BRAND_MASTER_SID  
            ]]>
    </sql>
</custom-sql>
