<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<sql>
<entity id="getFcpParent">
<query> <![CDATA[
              
   
     DECLARE @NA_PROJ_MASTER_SID INT=?PID,
        @BRAND_MASTER_SID   INT=?BID,
	@TH_CLASS varchar(50)=?TID,
        @OFFSET   INT=?OFFSET,
        @LIMIT   INT=?LIMIT

SELECT ITEM_NO,ITEM_MASTER_SID,ITEM_DESC,ROWNUM
FROM(
SELECT IM.ITEM_NO,
       IM.ITEM_MASTER_SID,
       IM.ITEM_DESC,
       ROW_NUMBER() OVER (ORDER BY IM.ITEM_MASTER_SID ASC) AS ROWNUM 
FROM   NA_PROJ_MASTER PM,
       NA_PROJ_DETAILS PD,
       ITEM_MASTER IM
WHERE  PM.NA_PROJ_MASTER_SID = PD.NA_PROJ_MASTER_SID
       AND PD.ITEM_MASTER_SID = IM.ITEM_MASTER_SID
       AND PM.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
       AND ( IM.BRAND_MASTER_SID = @BRAND_MASTER_SID
              OR @BRAND_MASTER_SID IS NULL ) 
		AND ( IM.THERAPEUTIC_CLASS = @TH_CLASS
              OR @TH_CLASS IS NULL ))A
WHERE ROWNUM >= @OFFSET
AND ROWNUM < @OFFSET + @LIMIT
    
    ]]> </query>
</entity>
<entity id="getFcpAmount">
<query> <![CDATA[
             
        DECLARE @NA_PROJ_MASTER_SID     INT=?PID,
        @ITEM_MASTER_SID        INT=?IMID,
        @PRICE_TYPE             VARCHAR(1000)='?PT'



SELECT @PRICE_TYPE = Replace(Replace(Replace(@PRICE_TYPE, 'NON-FAMP', 'ANON-FAMP'), 'WAC', 'AVGY'), 'FSS', 'AFSS')
SELECT @PRICE_TYPE = (Replace(@PRICE_TYPE, 'AFSS (OGA) Discount', 'FSS (OGA) Discount'))

SELECT A.NA_PROJ_MASTER_SID,
       A.ITEM_MASTER_SID,
       A.NDC11,
       Isnull(A.ACTUAL_PRICE, 0) ACTUAL_PRICE,
       PROJECTION_PRICE=Isnull(B.PROJECTION_PRICE, 0),
       A.[YEAR],
       PRICE_TYPE= CASE A.PRICE_TYPE
                     WHEN 'ANON-FAMP' THEN 'NON-FAMP'
                     WHEN 'AVGY' THEN 'WAC'
                     WHEN 'AFSS' THEN 'FSS'
                     ELSE A.PRICE_TYPE
                   END,
       'ACTUALS'                 AS [SOURCE]
FROM   (SELECT ND.NA_PROJ_MASTER_SID,
               IM.ITEM_MASTER_SID,
               IM.ITEM_NO AS NDC11,
               ACTUAL_PRICE,
               P.[YEAR],
               P.[QUARTER],
               PRICE_TYPE
        FROM   ST_FCP_ACTUALS FA
               JOIN NA_PROJ_DETAILS ND
                 ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
               JOIN ITEM_MASTER IM
                 ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
               JOIN PERIOD P
                 ON P.PERIOD_SID = FA.PERIOD_SID
        WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
               AND IM.ITEM_MASTER_SID = @ITEM_MASTER_SID
               AND PRICE_TYPE IN(SELECT TOKEN
                                 FROM   DBO.Udf_splitstring(@PRICE_TYPE, ','))
              ) A
       LEFT OUTER JOIN (SELECT ITEM_MASTER_SID=@ITEM_MASTER_SID,
                               P.[YEAR],
                               P.[QUARTER],
                               PP.PRICE_TYPE,
                               PROJECTION_PRICE=Isnull(PP.PROJECTION_PRICE, 0)
                        FROM   FCP_PROJ PP
                               INNER JOIN PERIOD P
                                       ON PP.PERIOD_SID = P.PERIOD_SID
                        WHERE  EXISTS (SELECT 1
                                       FROM   NA_PROJ_DETAILS NPD
                                       WHERE  NPD.NA_PROJ_DETAILS_SID = PP.NA_PROJ_DETAILS_SID
                                              AND NPD.NA_PROJ_MASTER_SID = (SELECT TOP 1 NPM.NA_PROJ_MASTER_SID
                                                                            FROM   NA_PROJ_MASTER NPM
                                                                                   INNER JOIN NA_PROJ_DETAILS NPD
                                                                                           ON NPM.NA_PROJ_MASTER_SID = NPD.NA_PROJ_MASTER_SID
                                                                            WHERE  ITEM_MASTER_SID = @ITEM_MASTER_SID
                                                                                   AND SAVE_FLAG = 1
                                                                            ORDER  BY MODIFIED_DATE DESC)
                                              AND NPD.ITEM_MASTER_SID = @ITEM_MASTER_SID)
                               AND PP.PRICE_TYPE IN(SELECT TOKEN
                                                    FROM   DBO.Udf_splitstring(@PRICE_TYPE, ','))) B
                    ON A.ITEM_MASTER_SID = B.ITEM_MASTER_SID
                       AND A.PRICE_TYPE = B.PRICE_TYPE
                       AND A.[YEAR] = B.[YEAR]
                       AND A.[QUARTER] = B.[QUARTER]
UNION ALL
SELECT ND.NA_PROJ_MASTER_SID,
       IM.ITEM_MASTER_SID,
       IM.ITEM_NO                  AS NDC11,
       0                           AS ACTUALS_PRICE,
       Isnull(PROJECTION_PRICE, 0) PROJECTION_PRICE,
       P.[YEAR],
       PRICE_TYPE= CASE PRICE_TYPE
                     WHEN 'ANON-FAMP' THEN 'NON-FAMP'
                     WHEN 'AVGY' THEN 'WAC'
                     WHEN 'AFSS' THEN 'FSS'
                     ELSE PRICE_TYPE
                   END,
       'PROJ'                      AS [SOURCE]
FROM   ST_FCP_PROJ FA
       JOIN NA_PROJ_DETAILS ND
         ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
       JOIN ITEM_MASTER IM
         ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
       JOIN PERIOD P
         ON P.PERIOD_SID = FA.PERIOD_SID
WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
       AND IM.ITEM_MASTER_SID = @ITEM_MASTER_SID
       AND PRICE_TYPE IN(SELECT TOKEN
                         FROM   DBO.Udf_splitstring(@PRICE_TYPE, ','))

              

    ]]> </query>
</entity>
<entity id="getFcpAmountForView">
<query> <![CDATA[
             
        DECLARE @NA_PROJ_MASTER_SID     INT=?PID,
        @ITEM_MASTER_SID        INT=?IMID,
        @PRICE_TYPE             VARCHAR(1000)='?PT'      


SELECT @PRICE_TYPE = Replace(Replace(Replace(@PRICE_TYPE, 'NON-FAMP', 'ANON-FAMP'), 'WAC', 'AVGY'), 'FSS', 'AFSS')
SELECT @PRICE_TYPE = (Replace(@PRICE_TYPE, 'AFSS (OGA) Discount', 'FSS (OGA) Discount'))

SELECT A.NA_PROJ_MASTER_SID,
       A.ITEM_MASTER_SID,
       A.NDC11,
       Isnull(A.ACTUAL_PRICE, 0) ACTUAL_PRICE,
       PROJECTION_PRICE=Isnull(B.PROJECTION_PRICE, 0),
       A.[YEAR],
       PRICE_TYPE= CASE A.PRICE_TYPE
                     WHEN 'ANON-FAMP' THEN 'NON-FAMP'
                     WHEN 'AVGY' THEN 'WAC'
                     WHEN 'AFSS' THEN 'FSS'
                     ELSE A.PRICE_TYPE
                   END,
       'ACTUALS'                 AS [SOURCE]
FROM   (SELECT ND.NA_PROJ_MASTER_SID,
               IM.ITEM_MASTER_SID,
               IM.ITEM_NO AS NDC11,
               ACTUAL_PRICE,
               P.[YEAR],
               P.[QUARTER],
               PRICE_TYPE
        FROM   FCP_ACTUALS FA
               JOIN NA_PROJ_DETAILS ND
                 ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
               JOIN ITEM_MASTER IM
                 ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
               JOIN PERIOD P
                 ON P.PERIOD_SID = FA.PERIOD_SID
        WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
               AND IM.ITEM_MASTER_SID = @ITEM_MASTER_SID
               AND PRICE_TYPE IN(SELECT TOKEN
                                 FROM   DBO.Udf_splitstring(@PRICE_TYPE, ','))
               ) A
       LEFT OUTER JOIN (SELECT ITEM_MASTER_SID=@ITEM_MASTER_SID,
                               P.[YEAR],
                               P.[QUARTER],
                               PP.PRICE_TYPE,
                               PROJECTION_PRICE=Isnull(PP.PROJECTION_PRICE, 0)
                        FROM   FCP_PROJ PP
                               INNER JOIN PERIOD P
                                       ON PP.PERIOD_SID = P.PERIOD_SID
                        WHERE  EXISTS (SELECT 1
                                       FROM   NA_PROJ_DETAILS NPD
                                       WHERE  NPD.NA_PROJ_DETAILS_SID = PP.NA_PROJ_DETAILS_SID
                                              AND NPD.NA_PROJ_MASTER_SID = (SELECT TOP 1 NPM.NA_PROJ_MASTER_SID
                                                                            FROM   NA_PROJ_MASTER NPM
                                                                                   INNER JOIN NA_PROJ_DETAILS NPD
                                                                                           ON NPM.NA_PROJ_MASTER_SID = NPD.NA_PROJ_MASTER_SID
                                                                            WHERE  ITEM_MASTER_SID = @ITEM_MASTER_SID
                                                                                   AND SAVE_FLAG = 1
                                                                            ORDER  BY MODIFIED_DATE DESC)
                                              AND NPD.ITEM_MASTER_SID = @ITEM_MASTER_SID)
                               AND PP.PRICE_TYPE IN(SELECT TOKEN
                                                    FROM   DBO.Udf_splitstring(@PRICE_TYPE, ','))) B
                    ON A.ITEM_MASTER_SID = B.ITEM_MASTER_SID
                       AND A.PRICE_TYPE = B.PRICE_TYPE
                       AND A.[YEAR] = B.[YEAR]
                       AND A.[QUARTER] = B.[QUARTER]
UNION ALL
SELECT ND.NA_PROJ_MASTER_SID,
       IM.ITEM_MASTER_SID,
       IM.ITEM_NO                  AS NDC11,
       0                           AS ACTUALS_PRICE,
       Isnull(PROJECTION_PRICE, 0) PROJECTION_PRICE,
       P.[YEAR],
       PRICE_TYPE= CASE PRICE_TYPE
                     WHEN 'ANON-FAMP' THEN 'NON-FAMP'
                     WHEN 'AVGY' THEN 'WAC'
                     WHEN 'AFSS' THEN 'FSS'
                     ELSE PRICE_TYPE
                   END,
       'PROJ'                      AS [SOURCE]
FROM   FCP_PROJ FA
       JOIN NA_PROJ_DETAILS ND
         ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
       JOIN ITEM_MASTER IM
         ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
       JOIN PERIOD P
         ON P.PERIOD_SID = FA.PERIOD_SID
WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
       AND IM.ITEM_MASTER_SID = @ITEM_MASTER_SID
       AND PRICE_TYPE IN(SELECT TOKEN
                         FROM   DBO.Udf_splitstring(@PRICE_TYPE, ','))
      

              

    ]]> </query>
</entity>
<entity id="getFcpPercentage">
<query> <![CDATA[
             
        DECLARE @NA_PROJ_MASTER_SID     INT=?PID,
        @ITEM_MASTER_SID        INT=?IMID,
        @PRICE_TYPE             VARCHAR(1000)='?PT'

SELECT @PRICE_TYPE = Replace(Replace(Replace(@PRICE_TYPE, 'NON-FAMP', 'ANON-FAMP'), 'WAC', 'AVGY'), 'FSS', 'AFSS')
SELECT @PRICE_TYPE = (Replace(@PRICE_TYPE, 'AFSS (OGA) Discount', 'FSS (OGA) Discount'))

SELECT A.NA_PROJ_MASTER_SID,
       A.ITEM_MASTER_SID,
       A.NDC11,
       Isnull(A.ACTUAL_PRICE, 0) ACTUAL_PRICE,
       PROJECTION_PRICE=Isnull(B.PROJECTION_PRICE, 0),
       A.[YEAR],
       PRICE_TYPE= CASE A.PRICE_TYPE
                     WHEN 'ANON-FAMP' THEN 'NON-FAMP'
                     WHEN 'AVGY' THEN 'WAC'
                     WHEN 'AFSS' THEN 'FSS'
                     ELSE A.PRICE_TYPE
                   END,
       'ACTUALS'                 AS [SOURCE]
FROM   (SELECT ND.NA_PROJ_MASTER_SID,
               IM.ITEM_MASTER_SID,
               IM.ITEM_NO AS NDC11,
               ACTUAL_PRICE=Isnull(FA.ACTUAL_PRICE / NULLIF(PA.ACTUAL_PRICE, 0), 0) * 100,
               P.[YEAR],
               P.[QUARTER],
               FA.PRICE_TYPE
        FROM   ST_FCP_ACTUALS FA
               JOIN NA_PROJ_DETAILS ND
                 ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
               JOIN ITEM_MASTER IM
                 ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
               JOIN PERIOD P
                 ON P.PERIOD_SID = FA.PERIOD_SID
               INNER JOIN ST_FCP_ACTUALS PA
                       ON PA.NA_PROJ_DETAILS_SID = FA.NA_PROJ_DETAILS_SID
                          AND FA.PERIOD_SID = PA.PERIOD_SID
                          AND PA.PRICE_TYPE = 'AVGY'
        WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
               AND IM.ITEM_MASTER_SID = @ITEM_MASTER_SID
               AND FA.PRICE_TYPE IN(SELECT TOKEN
                                    FROM   DBO.Udf_splitstring(@PRICE_TYPE, ','))
               ) A
       LEFT OUTER JOIN (SELECT ITEM_MASTER_SID=@ITEM_MASTER_SID,
                               P.[YEAR],
                               P.[QUARTER],
                               PP.PRICE_TYPE,
                               PROJECTION_PRICE=Isnull(PP.PROJECTION_PRICE / NULLIF(PP_WAC.PROJECTION_PRICE, 0), 0) * 100
                        FROM   FCP_PROJ PP
                               INNER JOIN FCP_PROJ PP_WAC
                                       ON PP.NA_PROJ_DETAILS_SID = PP_WAC.NA_PROJ_DETAILS_SID
                                          AND PP.PERIOD_SID = PP_WAC.PERIOD_SID
                                          AND PP_WAC.PRICE_TYPE = 'AVGY'
                               INNER JOIN PERIOD P
                                       ON PP.PERIOD_SID = P.PERIOD_SID
                        WHERE  EXISTS (SELECT 1
                                       FROM   NA_PROJ_DETAILS NPD
                                       WHERE  NPD.NA_PROJ_DETAILS_SID = PP.NA_PROJ_DETAILS_SID
                                              AND NPD.NA_PROJ_MASTER_SID = (SELECT TOP 1 NPM.NA_PROJ_MASTER_SID
                                                                            FROM   NA_PROJ_MASTER NPM
                                                                                   INNER JOIN NA_PROJ_DETAILS NPD
                                                                                           ON NPM.NA_PROJ_MASTER_SID = NPD.NA_PROJ_MASTER_SID
                                                                            WHERE  ITEM_MASTER_SID = @ITEM_MASTER_SID
                                                                                   AND SAVE_FLAG = 1
                                                                            ORDER  BY MODIFIED_DATE DESC)
                                              AND NPD.ITEM_MASTER_SID = @ITEM_MASTER_SID)
                               AND PP.PRICE_TYPE IN(SELECT TOKEN
                                                    FROM   DBO.Udf_splitstring(@PRICE_TYPE, ','))) B
                    ON A.ITEM_MASTER_SID = B.ITEM_MASTER_SID
                       AND A.PRICE_TYPE = B.PRICE_TYPE
                       AND A.[YEAR] = B.[YEAR]
                       AND A.[QUARTER] = B.[QUARTER]
UNION ALL
SELECT ND.NA_PROJ_MASTER_SID,
       IM.ITEM_MASTER_SID,
       IM.ITEM_NO AS NDC11,
       ACTUAL_PRICE= 0,
       PROJECTION_PRICE=Isnull(FA.PROJECTION_PRICE / NULLIF(PA.PROJECTION_PRICE, 0), 0) * 100,
       P.[YEAR],
       PRICE_TYPE= CASE FA.PRICE_TYPE
                     WHEN 'ANON-FAMP' THEN 'NON-FAMP'
                     WHEN 'AVGY' THEN 'WAC'
                     WHEN 'AFSS' THEN 'FSS'
                     ELSE FA.PRICE_TYPE
                   END,
       'PROJ'     AS [SOURCE]
FROM   ST_FCP_PROJ FA
       JOIN NA_PROJ_DETAILS ND
         ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
       JOIN ITEM_MASTER IM
         ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
       JOIN PERIOD P
         ON P.PERIOD_SID = FA.PERIOD_SID
       INNER JOIN ST_FCP_PROJ PA
               ON PA.NA_PROJ_DETAILS_SID = FA.NA_PROJ_DETAILS_SID
                  AND FA.PERIOD_SID = PA.PERIOD_SID
                  AND PA.PRICE_TYPE = 'AVGY'
WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
       AND IM.ITEM_MASTER_SID = @ITEM_MASTER_SID
       AND FA.PRICE_TYPE IN(SELECT TOKEN
                            FROM   DBO.Udf_splitstring(@PRICE_TYPE, ','))
ORDER  BY [SOURCE],
          PRICE_TYPE,
          [YEAR] 

              

    ]]> </query>
</entity>
<entity id="getFcpPercentageForView">
<query> <![CDATA[
             
        DECLARE @NA_PROJ_MASTER_SID     INT=?PID,
        @ITEM_MASTER_SID        INT=?IMID,
        @PRICE_TYPE             VARCHAR(1000)='?PT'
       

SELECT @PRICE_TYPE = Replace(Replace(Replace(@PRICE_TYPE, 'NON-FAMP', 'ANON-FAMP'), 'WAC', 'AVGY'), 'FSS', 'AFSS')
SELECT @PRICE_TYPE = (Replace(@PRICE_TYPE, 'AFSS (OGA) Discount', 'FSS (OGA) Discount'))

SELECT A.NA_PROJ_MASTER_SID,
       A.ITEM_MASTER_SID,
       A.NDC11,
       Isnull(A.ACTUAL_PRICE, 0) ACTUAL_PRICE,
       PROJECTION_PRICE=Isnull(B.PROJECTION_PRICE, 0),
       A.[YEAR],
       PRICE_TYPE= CASE A.PRICE_TYPE
                     WHEN 'ANON-FAMP' THEN 'NON-FAMP'
                     WHEN 'AVGY' THEN 'WAC'
                     WHEN 'AFSS' THEN 'FSS'
                     ELSE A.PRICE_TYPE
                   END,
       'ACTUALS'                 AS [SOURCE]
FROM   (SELECT ND.NA_PROJ_MASTER_SID,
               IM.ITEM_MASTER_SID,
               IM.ITEM_NO AS NDC11,
               ACTUAL_PRICE=Isnull(FA.ACTUAL_PRICE / NULLIF(PA.ACTUAL_PRICE, 0), 0) * 100,
               P.[YEAR],
               P.[QUARTER],
               FA.PRICE_TYPE
        FROM   FCP_ACTUALS FA
               JOIN NA_PROJ_DETAILS ND
                 ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
               JOIN ITEM_MASTER IM
                 ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
               JOIN PERIOD P
                 ON P.PERIOD_SID = FA.PERIOD_SID
               INNER JOIN FCP_ACTUALS PA
                       ON PA.NA_PROJ_DETAILS_SID = FA.NA_PROJ_DETAILS_SID
                          AND FA.PERIOD_SID = PA.PERIOD_SID
                          AND PA.PRICE_TYPE = 'AVGY'
                          
        WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
               AND IM.ITEM_MASTER_SID = @ITEM_MASTER_SID
               AND FA.PRICE_TYPE IN(SELECT TOKEN
                                    FROM   DBO.Udf_splitstring(@PRICE_TYPE, ','))
               ) A
       LEFT OUTER JOIN (SELECT ITEM_MASTER_SID=@ITEM_MASTER_SID,
                               P.[YEAR],
                               P.[QUARTER],
                               PP.PRICE_TYPE,
                               PROJECTION_PRICE=Isnull(PP.PROJECTION_PRICE / NULLIF(PP_WAC.PROJECTION_PRICE, 0), 0) * 100
                        FROM   FCP_PROJ PP
                               INNER JOIN FCP_PROJ PP_WAC
                                       ON PP.NA_PROJ_DETAILS_SID = PP_WAC.NA_PROJ_DETAILS_SID
                                          AND PP.PERIOD_SID = PP_WAC.PERIOD_SID
                                          AND PP_WAC.PRICE_TYPE = 'AVGY'
                               INNER JOIN PERIOD P
                                       ON PP.PERIOD_SID = P.PERIOD_SID
                        WHERE  EXISTS (SELECT 1
                                       FROM   NA_PROJ_DETAILS NPD
                                       WHERE  NPD.NA_PROJ_DETAILS_SID = PP.NA_PROJ_DETAILS_SID
                                              AND NPD.NA_PROJ_MASTER_SID = (SELECT TOP 1 NPM.NA_PROJ_MASTER_SID
                                                                            FROM   NA_PROJ_MASTER NPM
                                                                                   INNER JOIN NA_PROJ_DETAILS NPD
                                                                                           ON NPM.NA_PROJ_MASTER_SID = NPD.NA_PROJ_MASTER_SID
                                                                            WHERE  ITEM_MASTER_SID = @ITEM_MASTER_SID
                                                                                   AND SAVE_FLAG = 1
                                                                            ORDER  BY MODIFIED_DATE DESC)
                                              AND NPD.ITEM_MASTER_SID = @ITEM_MASTER_SID)
                               AND PP.PRICE_TYPE IN(SELECT TOKEN
                                                    FROM   DBO.Udf_splitstring(@PRICE_TYPE, ','))) B
                    ON A.ITEM_MASTER_SID = B.ITEM_MASTER_SID
                       AND A.PRICE_TYPE = B.PRICE_TYPE
                       AND A.[YEAR] = B.[YEAR]
                       AND A.[QUARTER] = B.[QUARTER]
UNION ALL
SELECT ND.NA_PROJ_MASTER_SID,
       IM.ITEM_MASTER_SID,
       IM.ITEM_NO AS NDC11,
       ACTUAL_PRICE= 0,
       PROJECTION_PRICE=Isnull(FA.PROJECTION_PRICE / NULLIF(PA.PROJECTION_PRICE, 0), 0) * 100,
       P.[YEAR],
       PRICE_TYPE= CASE FA.PRICE_TYPE
                     WHEN 'ANON-FAMP' THEN 'NON-FAMP'
                     WHEN 'AVGY' THEN 'WAC'
                     WHEN 'AFSS' THEN 'FSS'
                     ELSE FA.PRICE_TYPE
                   END,
       'PROJ'     AS [SOURCE]
FROM   FCP_PROJ FA
       JOIN NA_PROJ_DETAILS ND
         ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
       JOIN ITEM_MASTER IM
         ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
       JOIN PERIOD P
         ON P.PERIOD_SID = FA.PERIOD_SID
       INNER JOIN FCP_PROJ PA
               ON PA.NA_PROJ_DETAILS_SID = FA.NA_PROJ_DETAILS_SID
                  AND FA.PERIOD_SID = PA.PERIOD_SID
                  AND PA.PRICE_TYPE = 'AVGY'
                  
WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
       AND IM.ITEM_MASTER_SID = @ITEM_MASTER_SID
       AND FA.PRICE_TYPE IN(SELECT TOKEN
                            FROM   DBO.Udf_splitstring(@PRICE_TYPE, ','))
       
ORDER  BY [SOURCE],
          PRICE_TYPE,
          [YEAR] 

              

    ]]> </query>
</entity>
<entity id="getNonFampAmount">
<query> <![CDATA[

 DECLARE @NA_PROJ_MASTER_SID INT=?PID,
        @BRAND_MASTER_SID INT=?BID,
        @TH_CLASS varchar(50)=?TID

SELECT A.NA_PROJ_MASTER_SID,
       A.ITEM_MASTER_SID,
	   A.ITEM_DESC,
       A.NDC11,
       ISNULL(A.ACTUAL_PRICE, 0) ACTUAL_PRICE,
       PROJECTION_PRICE=ISNULL(B.PROJECTION_PRICE, 0),
       A.[YEAR],
       A.[QUARTER],
       [SOURCE] = 'ACTUALS'
FROM   (SELECT ND.NA_PROJ_MASTER_SID,
               IM.ITEM_MASTER_SID,
			   IM.ITEM_DESC,
               IM.ITEM_NO AS NDC11,
               ACTUAL_PRICE,
               P.[YEAR],
               P.[QUARTER],
               PRICE_TYPE
        FROM   ST_FCP_ACTUALS FA
               JOIN NA_PROJ_DETAILS ND
                 ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
               JOIN ITEM_MASTER IM
                 ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
               JOIN PERIOD P
                 ON P.PERIOD_SID = FA.PERIOD_SID
        WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
               AND ND.ITEM_MASTER_SID IN (?LID)
               AND PRICE_TYPE = 'QNON-FAMP'
             ) A
       LEFT OUTER JOIN (SELECT ITEM_MASTER_SID,
                               P.[YEAR],
                               P.[QUARTER],
                               PP.PRICE_TYPE,
                               PROJECTION_PRICE=ISNULL(PP.PROJECTION_PRICE, 0)
                        FROM   FCP_PROJ PP
                               INNER JOIN PERIOD P
                                       ON PP.PERIOD_SID = P.PERIOD_SID
                               JOIN NA_PROJ_DETAILS ND
                                 ON PP.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
                        WHERE  EXISTS (SELECT TOP 1 NPM.NA_PROJ_MASTER_SID
                                       FROM   NA_PROJ_MASTER NPM
                                              INNER JOIN NA_PROJ_DETAILS NPD
                                                      ON NPM.NA_PROJ_MASTER_SID = NPD.NA_PROJ_MASTER_SID
                                       WHERE  ITEM_MASTER_SID IN (?LID)
                                              AND SAVE_FLAG = 1
                                       ORDER  BY MODIFIED_DATE DESC)
                               AND PP.PRICE_TYPE = 'QNON-FAMP') B
                    ON A.ITEM_MASTER_SID = B. ITEM_MASTER_SID
                       AND A.PRICE_TYPE = B.PRICE_TYPE
                       AND A.[YEAR] = B.[YEAR]
                       AND A.[QUARTER] = B.[QUARTER]
UNION ALL
SELECT ND.NA_PROJ_MASTER_SID,
       IM.ITEM_MASTER_SID,
	   IM.ITEM_DESC,
       IM.ITEM_NO AS NDC11,
       0 AS ACTUALS_PRICE,
       PROJECTION_PRICE=ISNULL(PROJECTION_PRICE, 0),
       P.[YEAR],
       P.[QUARTER],
       'PROJ'
FROM   ST_FCP_PROJ FA
       JOIN NA_PROJ_DETAILS ND
         ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
       JOIN ITEM_MASTER IM
         ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
       JOIN PERIOD P
         ON P.PERIOD_SID = FA.PERIOD_SID
WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
       AND ND.ITEM_MASTER_SID IN (?LID)
       AND PRICE_TYPE = 'QNON-FAMP'

 

    ]]> </query>
</entity>
<entity id="getNonFampAmountForView">
<query> <![CDATA[

 DECLARE @NA_PROJ_MASTER_SID INT=?PID,
        @BRAND_MASTER_SID INT=?BID,
        @TH_CLASS varchar(50)=?TID

SELECT A.NA_PROJ_MASTER_SID,
       A.ITEM_MASTER_SID,
	   A.ITEM_DESC,
       A.NDC11,
       ISNULL(A.ACTUAL_PRICE, 0) ACTUAL_PRICE,
       PROJECTION_PRICE=ISNULL(B.PROJECTION_PRICE, 0),
       A.[YEAR],
       A.[QUARTER],
       [SOURCE] = 'ACTUALS'
FROM   (SELECT ND.NA_PROJ_MASTER_SID,
               IM.ITEM_MASTER_SID,
			   IM.ITEM_DESC,
               IM.ITEM_NO AS NDC11,
               ACTUAL_PRICE,
               P.[YEAR],
               P.[QUARTER],
               PRICE_TYPE
        FROM   FCP_ACTUALS FA
               JOIN NA_PROJ_DETAILS ND
                 ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
               JOIN ITEM_MASTER IM
                 ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
               JOIN PERIOD P
                 ON P.PERIOD_SID = FA.PERIOD_SID
        WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
               AND ND.ITEM_MASTER_SID IN (?LID)
               AND PRICE_TYPE = 'QNON-FAMP'
             ) A
       LEFT OUTER JOIN (SELECT ITEM_MASTER_SID,
                               P.[YEAR],
                               P.[QUARTER],
                               PP.PRICE_TYPE,
                               PROJECTION_PRICE=ISNULL(PP.PROJECTION_PRICE, 0)
                        FROM   FCP_PROJ PP
                               INNER JOIN PERIOD P
                                       ON PP.PERIOD_SID = P.PERIOD_SID
                               JOIN NA_PROJ_DETAILS ND
                                 ON PP.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
                        WHERE  EXISTS (SELECT TOP 1 NPM.NA_PROJ_MASTER_SID
                                       FROM   NA_PROJ_MASTER NPM
                                              INNER JOIN NA_PROJ_DETAILS NPD
                                                      ON NPM.NA_PROJ_MASTER_SID = NPD.NA_PROJ_MASTER_SID
                                       WHERE  ITEM_MASTER_SID IN (?LID)
                                              AND SAVE_FLAG = 1
                                       ORDER  BY MODIFIED_DATE DESC)
                               AND PP.PRICE_TYPE = 'QNON-FAMP') B
                    ON A.ITEM_MASTER_SID = B. ITEM_MASTER_SID
                       AND A.PRICE_TYPE = B.PRICE_TYPE
                       AND A.[YEAR] = B.[YEAR]
                       AND A.[QUARTER] = B.[QUARTER]
UNION ALL
SELECT ND.NA_PROJ_MASTER_SID,
       IM.ITEM_MASTER_SID,
	   IM.ITEM_DESC,
       IM.ITEM_NO AS NDC11,
       0 AS ACTUALS_PRICE,
       PROJECTION_PRICE=ISNULL(PROJECTION_PRICE, 0),
       P.[YEAR],
       P.[QUARTER],
       'PROJ'
FROM   FCP_PROJ FA
       JOIN NA_PROJ_DETAILS ND
         ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
       JOIN ITEM_MASTER IM
         ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
       JOIN PERIOD P
         ON P.PERIOD_SID = FA.PERIOD_SID
WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
       AND ND.ITEM_MASTER_SID IN (?LID)
       AND PRICE_TYPE = 'QNON-FAMP'
       

 

    ]]> </query>
</entity>
<entity id="getNonFampPercentage">
<query> <![CDATA[

        
 DECLARE @NA_PROJ_MASTER_SID INT=?PID,
        @BRAND_MASTER_SID INT=?BID,
        @TH_CLASS varchar(50)=?TID 

SELECT A.NA_PROJ_MASTER_SID,
       A.ITEM_MASTER_SID,
       A.ITEM_DESC,
       A.NDC11,
       ISNULL(A.ACTUAL_PRICE, 0) ACTUAL_PRICE,
       PROJECTION_PRICE=ISNULL(B.PROJECTION_PRICE, 0),
       A.[YEAR],
       A.[QUARTER],
       [SOURCE] = 'ACTUALS'
FROM   (SELECT ND.NA_PROJ_MASTER_SID,
               IM.ITEM_MASTER_SID,
               IM.ITEM_DESC,
               IM.ITEM_NO AS NDC11,
               ACTUAL_PRICE=ISNULL(FA.ACTUAL_PRICE / NULLIF(PA.ACTUAL_PRICE, 0), 0) * 100,
               P.[YEAR],
               P.[QUARTER],
               FA.PRICE_TYPE
        FROM   ST_FCP_ACTUALS FA
               JOIN NA_PROJ_DETAILS ND
                 ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
               JOIN ITEM_MASTER IM
                 ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
               JOIN PERIOD P
                 ON P.PERIOD_SID = FA.PERIOD_SID
               INNER JOIN ST_FCP_ACTUALS PA
                       ON PA.NA_PROJ_DETAILS_SID = FA.NA_PROJ_DETAILS_SID
                          AND FA.PERIOD_SID = PA.PERIOD_SID
                          AND PA.PRICE_TYPE = 'WAC'
        WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
               AND ND.ITEM_MASTER_SID IN (?LID) 
               AND FA.PRICE_TYPE = 'QNON-FAMP'
               ) A
       LEFT OUTER JOIN (SELECT ITEM_MASTER_SID,
                               P.[YEAR],
                               P.[QUARTER],
                               PP.PRICE_TYPE,
                               PROJECTION_PRICE=ISNULL(PP.PROJECTION_PRICE / NULLIF(PP_WAC.PROJECTION_PRICE, 0), 0) * 100
                        FROM   FCP_PROJ PP
                               INNER JOIN FCP_PROJ PP_WAC
                                       ON PP.NA_PROJ_DETAILS_SID = PP_WAC.NA_PROJ_DETAILS_SID
                                          AND PP.PERIOD_SID = PP_WAC.PERIOD_SID
                                          AND PP_WAC.PRICE_TYPE = 'WAC'
                               INNER JOIN PERIOD P
                                       ON PP.PERIOD_SID = P.PERIOD_SID
                               INNER JOIN NA_PROJ_DETAILS ND
                                       ON PP.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
                        WHERE  EXISTS (SELECT TOP 1 NPM.NA_PROJ_MASTER_SID
                                       FROM   NA_PROJ_MASTER NPM
                                              INNER JOIN NA_PROJ_DETAILS NPD
                                                      ON NPM.NA_PROJ_MASTER_SID = NPD.NA_PROJ_MASTER_SID
                                       WHERE  ITEM_MASTER_SID IN (?LID)
                                              AND SAVE_FLAG = 1
                                       ORDER  BY MODIFIED_DATE DESC)
                               AND PP.PRICE_TYPE = 'QNON-FAMP') B
                    ON A.ITEM_MASTER_SID = B.ITEM_MASTER_SID
                       AND A.PRICE_TYPE = B.PRICE_TYPE
                       AND A.[YEAR] = B.[YEAR]
                       AND A.[QUARTER] = B.[QUARTER]
UNION ALL
SELECT ND.NA_PROJ_MASTER_SID,
       IM.ITEM_MASTER_SID,
       IM.ITEM_DESC,
       IM.ITEM_NO AS NDC11,
       ACTUAL_PRICE= 0,
       PROJECTION_PRICE=ISNULL(FA.PROJECTION_PRICE / NULLIF(PA.PROJECTION_PRICE, 0), 0) * 100,
       P.[YEAR],
       P.[QUARTER],
       'PROJ'
FROM   ST_FCP_PROJ FA
       JOIN NA_PROJ_DETAILS ND
         ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
       JOIN ITEM_MASTER IM
         ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
       JOIN PERIOD P
         ON P.PERIOD_SID = FA.PERIOD_SID
       INNER JOIN ST_FCP_PROJ PA
               ON PA.NA_PROJ_DETAILS_SID = FA.NA_PROJ_DETAILS_SID
                  AND FA.PERIOD_SID = PA.PERIOD_SID
                  AND PA.PRICE_TYPE = 'WAC'
WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
       AND ND.ITEM_MASTER_SID IN (?LID)
       AND FA.PRICE_TYPE = 'QNON-FAMP'
ORDER  BY [SOURCE],
		  A.ITEM_MASTER_SID,
          YEAR,
          QUARTER 

  

    ]]> </query>
</entity>
<entity id="getNonFampPercentageForView">
<query> <![CDATA[

        
 DECLARE @NA_PROJ_MASTER_SID INT=?PID,
        @BRAND_MASTER_SID INT=?BID,
        @TH_CLASS varchar(50)=?TID

SELECT A.NA_PROJ_MASTER_SID,
       A.ITEM_MASTER_SID,
       A.ITEM_DESC,
       A.NDC11,
       ISNULL(A.ACTUAL_PRICE, 0) ACTUAL_PRICE,
       PROJECTION_PRICE=ISNULL(B.PROJECTION_PRICE, 0),
       A.[YEAR],
       A.[QUARTER],
       [SOURCE] = 'ACTUALS'
FROM   (SELECT ND.NA_PROJ_MASTER_SID,
               IM.ITEM_MASTER_SID,
               IM.ITEM_DESC,
               IM.ITEM_NO AS NDC11,
               ACTUAL_PRICE=ISNULL(FA.ACTUAL_PRICE / NULLIF(PA.ACTUAL_PRICE, 0), 0) * 100,
               P.[YEAR],
               P.[QUARTER],
               FA.PRICE_TYPE
        FROM   FCP_ACTUALS FA
               JOIN NA_PROJ_DETAILS ND
                 ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
               JOIN ITEM_MASTER IM
                 ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
               JOIN PERIOD P
                 ON P.PERIOD_SID = FA.PERIOD_SID
               INNER JOIN FCP_ACTUALS PA
                       ON PA.NA_PROJ_DETAILS_SID = FA.NA_PROJ_DETAILS_SID
                          AND FA.PERIOD_SID = PA.PERIOD_SID
                          AND PA.PRICE_TYPE = 'WAC'
        WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
               AND ND.ITEM_MASTER_SID IN (?LID) 
               AND FA.PRICE_TYPE = 'QNON-FAMP'
) A
       LEFT OUTER JOIN (SELECT ITEM_MASTER_SID,
                               P.[YEAR],
                               P.[QUARTER],
                               PP.PRICE_TYPE,
                               PROJECTION_PRICE=ISNULL(PP.PROJECTION_PRICE / NULLIF(PP_WAC.PROJECTION_PRICE, 0), 0) * 100
                        FROM   FCP_PROJ PP
                               INNER JOIN FCP_PROJ PP_WAC
                                       ON PP.NA_PROJ_DETAILS_SID = PP_WAC.NA_PROJ_DETAILS_SID
                                          AND PP.PERIOD_SID = PP_WAC.PERIOD_SID
                                          AND PP_WAC.PRICE_TYPE = 'WAC'
                               INNER JOIN PERIOD P
                                       ON PP.PERIOD_SID = P.PERIOD_SID
                               INNER JOIN NA_PROJ_DETAILS ND
                                       ON PP.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
                        WHERE  EXISTS (SELECT TOP 1 NPM.NA_PROJ_MASTER_SID
                                       FROM   NA_PROJ_MASTER NPM
                                              INNER JOIN NA_PROJ_DETAILS NPD
                                                      ON NPM.NA_PROJ_MASTER_SID = NPD.NA_PROJ_MASTER_SID
                                       WHERE  ITEM_MASTER_SID IN (?LID)
                                              AND SAVE_FLAG = 1
                                       ORDER  BY MODIFIED_DATE DESC)
                               AND PP.PRICE_TYPE = 'QNON-FAMP') B
                    ON A.ITEM_MASTER_SID = B.ITEM_MASTER_SID
                       AND A.PRICE_TYPE = B.PRICE_TYPE
                       AND A.[YEAR] = B.[YEAR]
                       AND A.[QUARTER] = B.[QUARTER]
UNION ALL
SELECT ND.NA_PROJ_MASTER_SID,
       IM.ITEM_MASTER_SID,
       IM.ITEM_DESC,
       IM.ITEM_NO AS NDC11,
       ACTUAL_PRICE= 0,
       PROJECTION_PRICE=ISNULL(FA.PROJECTION_PRICE / NULLIF(PA.PROJECTION_PRICE, 0), 0) * 100,
       P.[YEAR],
       P.[QUARTER],
       'PROJ'
FROM   FCP_PROJ FA
       JOIN NA_PROJ_DETAILS ND
         ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
       JOIN ITEM_MASTER IM
         ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
       JOIN PERIOD P
         ON P.PERIOD_SID = FA.PERIOD_SID
       INNER JOIN FCP_PROJ PA
               ON PA.NA_PROJ_DETAILS_SID = FA.NA_PROJ_DETAILS_SID
                  AND FA.PERIOD_SID = PA.PERIOD_SID
                  AND PA.PRICE_TYPE = 'WAC'
                  
WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
       AND ND.ITEM_MASTER_SID IN (?LID)
       AND FA.PRICE_TYPE = 'QNON-FAMP'
     
ORDER  BY [SOURCE],
		  A.ITEM_MASTER_SID,
          YEAR,
          QUARTER 

  

    ]]> </query>
</entity>
<entity id="getFcpParentCount">
<query> <![CDATA[

     DECLARE @NA_PROJ_MASTER_SID INT=?PID,
        @BRAND_MASTER_SID   INT=?BID,
        @TH_CLASS varchar(50)=?TID

SELECT count(distinct IM.ITEM_MASTER_SID)
FROM   NA_PROJ_MASTER PM,
       NA_PROJ_DETAILS PD,
       ITEM_MASTER IM
WHERE  PM.NA_PROJ_MASTER_SID = PD.NA_PROJ_MASTER_SID
       AND PD.ITEM_MASTER_SID = IM.ITEM_MASTER_SID
       AND PM.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
       AND ( IM.BRAND_MASTER_SID = @BRAND_MASTER_SID
              OR @BRAND_MASTER_SID IS NULL ) 
		AND ( IM.THERAPEUTIC_CLASS = @TH_CLASS
              OR @TH_CLASS IS NULL )  
    
    ]]> </query>
</entity>
<entity id="getFcpRowIndex">
<query> <![CDATA[

         DECLARE @NA_PROJ_MASTER_SID INT=?PID,
                @BRAND_MASTER_SID   INT=?BID,
		@TH_CLASS varchar(50)=?TID,
		@NA_ITEM_MASTER_SID INT=?IMD

select A.TEMP_INDEX from (

SELECT IM.ITEM_NO,
       IM.ITEM_MASTER_SID,
       IM.ITEM_DESC,
	   ROW_NUMBER() OVER (ORDER BY IM.ITEM_MASTER_SID ASC) AS TEMP_INDEX
FROM   NA_PROJ_MASTER PM,
       NA_PROJ_DETAILS PD,
       ITEM_MASTER IM
WHERE  PM.NA_PROJ_MASTER_SID = PD.NA_PROJ_MASTER_SID
       AND PD.ITEM_MASTER_SID = IM.ITEM_MASTER_SID
       AND PM.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
       AND ( IM.BRAND_MASTER_SID = @BRAND_MASTER_SID
              OR @BRAND_MASTER_SID IS NULL ) 
		AND ( IM.THERAPEUTIC_CLASS = @TH_CLASS
              OR @TH_CLASS IS NULL ) 
			
) A where A.ITEM_MASTER_SID=@NA_ITEM_MASTER_SID;
 

    ]]> </query>
</entity>
<entity id="getFcpWorkSheetQtrValues">
<query> <![CDATA[
        
 DECLARE @NA_PROJ_MASTER_SID INT=?PID,
        @ITEM_MASTER_SID INT=?IMID

SELECT CASE
         WHEN PRICE_TYPE IN ( 'WAC', 'WAC INCREASE %' ) THEN PRICE_TYPE
         WHEN PRICE_TYPE = 'QNON-FAMP' THEN 'HISTORICAL NON-FAMP'
         WHEN PRICE_TYPE = 'QFSS' THEN 'HISTORICAL FSS (OGA) PRICING'
	 WHEN PRICE_TYPE = 'CMS UNITS' THEN 'CMS UNITS'
         WHEN PRICE_TYPE in ('wac-fss','wac-fcp') then PRICE_TYPE
       END                     PRICE_TYPE,
       ISNULL(ACTUAL_PRICE, 0) AS ACTUAL_PRICE,
       0                       AS PROJECTION_PRICE,
       P.YEAR,
       P.QUARTER,
       NOTES,
       0                       AS ADJUSTMENT,
       'ACTUALS'               AS [SOURCE]
FROM   ST_FCP_ACTUALS FA
       JOIN NA_PROJ_DETAILS ND
         ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
       JOIN ITEM_MASTER IM
         ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
       JOIN PERIOD P
         ON P.PERIOD_SID = FA.PERIOD_SID
WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
       AND IM.ITEM_MASTER_SID = @ITEM_MASTER_SID
       AND FA.PRICE_TYPE NOT IN ( 'FCP', 'ANON-FAMP', 'AFSS', 'TRI-CARE',
                                  'CPI-U', 'AVGY', 'CPI-URA' )
UNION ALL
SELECT CASE
         WHEN PRICE_TYPE IN ( 'WAC', 'WAC INCREASE %' ) THEN PRICE_TYPE
         WHEN PRICE_TYPE = 'QNON-FAMP' THEN 'FORECAST NON-FAMP'
         WHEN PRICE_TYPE = 'CPI-U' THEN 'FORECAST CPI-U'
         WHEN PRICE_TYPE = 'QFSS' THEN 'FORECAST FSS (OGA) PRICING'
	 WHEN PRICE_TYPE = 'CMS UNITS' THEN 'CMS UNITS'
         WHEN PRICE_TYPE in ('wac-fss','wac-fcp') then PRICE_TYPE
       END                         PRICE_TYPE,
       0                           AS ACTUAL_PRICE,
       ISNULL(PROJECTION_PRICE, 0) AS PROJECTION_PRICE,
       P.YEAR,
       P.QUARTER,
       NOTES,
       ISNULL(ADJUSTMENT, 0)       ADJUSTMENT,
       'PROJ'                      AS [SOURCE]
FROM   ST_FCP_PROJ FA
       JOIN NA_PROJ_DETAILS ND
         ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
       JOIN ITEM_MASTER IM
         ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
       JOIN PERIOD P
         ON P.PERIOD_SID = FA.PERIOD_SID
WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
       AND IM.ITEM_MASTER_SID = @ITEM_MASTER_SID
       AND FA.PRICE_TYPE NOT IN ( 'FCP', 'ANON-FAMP', 'AFSS', 'TRI-CARE',
                                  'AVGY', 'CPI-URA', 'MAX FSS','CPI-U ADJUSTMENT' )
ORDER  BY [SOURCE],
          PRICE_TYPE,
          P.YEAR 



    ]]> </query>
</entity>
<entity id="getFcpWorkSheetQtrValuesForView">
<query> <![CDATA[
        
 DECLARE @NA_PROJ_MASTER_SID INT=?PID,
        @ITEM_MASTER_SID INT=?IMID
       

SELECT CASE
         WHEN PRICE_TYPE IN ( 'WAC', 'WAC INCREASE %' ) THEN PRICE_TYPE
         WHEN PRICE_TYPE = 'QNON-FAMP' THEN 'HISTORICAL NON-FAMP'
         WHEN PRICE_TYPE = 'QFSS' THEN 'HISTORICAL FSS (OGA) PRICING'
	 WHEN PRICE_TYPE = 'CMS UNITS' THEN 'CMS UNITS'
         WHEN PRICE_TYPE in ('WAC-FSS','WAC-FCP') THEN PRICE_TYPE
       END                     PRICE_TYPE,
       ISNULL(ACTUAL_PRICE, 0) AS ACTUAL_PRICE,
       0                       AS PROJECTION_PRICE,
       P.YEAR,
       P.QUARTER,
       NOTES,
       0                       AS ADJUSTMENT,
       'ACTUALS'               AS [SOURCE]
FROM   FCP_ACTUALS FA
       JOIN NA_PROJ_DETAILS ND
         ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
       JOIN ITEM_MASTER IM
         ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
       JOIN PERIOD P
         ON P.PERIOD_SID = FA.PERIOD_SID
WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
       AND IM.ITEM_MASTER_SID = @ITEM_MASTER_SID      
       AND FA.PRICE_TYPE NOT IN ( 'FCP', 'ANON-FAMP', 'AFSS', 'TRI-CARE',
                                  'CPI-U', 'AVGY', 'CPI-URA' )
UNION ALL
SELECT CASE
         WHEN PRICE_TYPE IN ( 'WAC', 'WAC INCREASE %' ) THEN PRICE_TYPE
         WHEN PRICE_TYPE = 'QNON-FAMP' THEN 'FORECAST NON-FAMP'
         WHEN PRICE_TYPE = 'CPI-U' THEN 'FORECAST CPI-U'
         WHEN PRICE_TYPE = 'QFSS' THEN 'FORECAST FSS (OGA) PRICING'
	 WHEN PRICE_TYPE = 'CMS UNITS' THEN 'CMS UNITS'
         WHEN PRICE_TYPE in ('WAC-FSS','WAC-FCP') THEN PRICE_TYPE
       END                         PRICE_TYPE,
       0                           AS ACTUAL_PRICE,
       ISNULL(PROJECTION_PRICE, 0) AS PROJECTION_PRICE,
       P.YEAR,
       P.QUARTER,
       NOTES,
       ISNULL(ADJUSTMENT, 0)       ADJUSTMENT,
       'PROJ'                      AS [SOURCE]
FROM   FCP_PROJ FA
       JOIN NA_PROJ_DETAILS ND
         ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
       JOIN ITEM_MASTER IM
         ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
       JOIN PERIOD P
         ON P.PERIOD_SID = FA.PERIOD_SID
WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
       AND IM.ITEM_MASTER_SID = @ITEM_MASTER_SID     
       AND FA.PRICE_TYPE NOT IN ( 'FCP', 'ANON-FAMP', 'AFSS', 'TRI-CARE',
                                  'AVGY', 'CPI-URA', 'MAX FSS','CPI-U ADJUSTMENT' )
ORDER  BY [SOURCE],
          PRICE_TYPE,
          P.YEAR 



    ]]> </query>
</entity>
<entity id="getFcpWorkSheetYearValues">
<query> <![CDATA[
        
 DECLARE @NA_PROJ_MASTER_SID INT=?PID,
        @ITEM_MASTER_SID INT=?IMID
        
SELECT CASE
         WHEN FA.PRICE_TYPE = 'FCP' THEN 'REPORTED FCP-(CALENDER YEAR)'
         WHEN FA.PRICE_TYPE = 'ANON-FAMP' THEN 'NON-FAMP'
         WHEN FA.PRICE_TYPE = 'TRI-CARE' THEN 'MANDATED DISCOUNT ($)'
       END                     PRICE_TYPE,
       ISNULL(ACTUAL_PRICE, 0) AS ACTUAL_PRICE,
       0                       AS PROJECTION_PRICE,
       P.YEAR,
       NOTES,
       0                       AS ADJUSTMENT,
       'ACTUALS'               AS [SOURCE]
FROM   ST_FCP_ACTUALS FA
       JOIN NA_PROJ_DETAILS ND
         ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
       JOIN ITEM_MASTER IM
         ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
       JOIN PERIOD P
         ON P.PERIOD_SID = FA.PERIOD_SID
WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
       AND IM.ITEM_MASTER_SID = @ITEM_MASTER_SID
	   AND FA.PRICE_TYPE NOT IN ('AVGY','CPI-U', 'CPI-URA', 'WAC', 'WAC INCREASE %','QNON-FAMP','QFSS','MAX FSS','AFSS')
UNION ALL
SELECT CASE
         WHEN FA.PRICE_TYPE = 'FCP' THEN 'FORECAST FCP CALCULATED'
         WHEN FA.PRICE_TYPE = 'Max FSS' THEN 'MAXIMUM FSS PRICE (OGA)'
         WHEN FA.PRICE_TYPE = 'ANON-FAMP' THEN 'NON-FAMP'
         WHEN FA.PRICE_TYPE = 'TRI-CARE' THEN 'MANDATED DISCOUNT ($)'
		 WHEN FA.PRICE_TYPE = 'CPI-U' THEN 'FORECAST CPI-U'
		 WHEN FA.PRICE_TYPE = 'CPI-U ADJUSTMENT' THEN PRICE_TYPE 
       END                         PRICE_TYPE,
       0                           AS ACTUAL_PRICE,
       COALESCE(adjustment_price, projection_price, 0) AS PROJECTION_PRICE,
       P.YEAR,
       NOTES,
       ISNULL(ADJUSTMENT, 0)       ADJUSTMENT,
       'PROJ'                      AS [SOURCE]
FROM   ST_FCP_PROJ FA
       JOIN NA_PROJ_DETAILS ND
         ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
       JOIN ITEM_MASTER IM
         ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
       JOIN PERIOD P
         ON P.PERIOD_SID = FA.PERIOD_SID
WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
       AND IM.ITEM_MASTER_SID = @ITEM_MASTER_SID
	   AND FA.PRICE_TYPE NOT IN ('AVGY', 'CPI-URA', 'WAC', 'WAC INCREASE %','QNON-FAMP','QFSS','AFSS')
ORDER  BY [SOURCE],
          PRICE_TYPE,
          P.YEAR 



    ]]> </query>
</entity>
<entity id="getFcpWorkSheetYearValuesForView">
<query> <![CDATA[
        
 DECLARE @NA_PROJ_MASTER_SID INT=?PID,
        @ITEM_MASTER_SID INT=?IMID       
        
SELECT CASE
         WHEN FA.PRICE_TYPE = 'FCP' THEN 'REPORTED FCP-(CALENDER YEAR)'
         WHEN FA.PRICE_TYPE = 'ANON-FAMP' THEN 'NON-FAMP'
         WHEN FA.PRICE_TYPE = 'TRI-CARE' THEN 'MANDATED DISCOUNT ($)'
       END                     PRICE_TYPE,
       ISNULL(ACTUAL_PRICE, 0) AS ACTUAL_PRICE,
       0                       AS PROJECTION_PRICE,
       P.YEAR,
       NOTES,
       0                       AS ADJUSTMENT,
       'ACTUALS'               AS [SOURCE]
FROM   FCP_ACTUALS FA
       JOIN NA_PROJ_DETAILS ND
         ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
       JOIN ITEM_MASTER IM
         ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
       JOIN PERIOD P
         ON P.PERIOD_SID = FA.PERIOD_SID
WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
       AND IM.ITEM_MASTER_SID = @ITEM_MASTER_SID
      
	   AND FA.PRICE_TYPE NOT IN ('AVGY','CPI-U', 'CPI-URA', 'WAC', 'WAC INCREASE %','QNON-FAMP','QFSS','MAX FSS','AFSS')
UNION ALL
SELECT CASE
         WHEN FA.PRICE_TYPE = 'FCP' THEN 'FORECAST FCP CALCULATED'
         WHEN FA.PRICE_TYPE = 'Max FSS' THEN 'MAXIMUM FSS PRICE (OGA)'
         WHEN FA.PRICE_TYPE = 'ANON-FAMP' THEN 'NON-FAMP'
         WHEN FA.PRICE_TYPE = 'TRI-CARE' THEN 'MANDATED DISCOUNT ($)'
		 WHEN FA.PRICE_TYPE = 'CPI-U' THEN 'FORECAST CPI-U'
		 WHEN FA.PRICE_TYPE = 'CPI-U ADJUSTMENT' THEN PRICE_TYPE 
       END                         PRICE_TYPE,
       0                           AS ACTUAL_PRICE,
       COALESCE(adjustment_price, projection_price, 0) AS PROJECTION_PRICE,
       P.YEAR,
       NOTES,
       ISNULL(ADJUSTMENT, 0)       ADJUSTMENT,
       'PROJ'                      AS [SOURCE]
FROM   FCP_PROJ FA
       JOIN NA_PROJ_DETAILS ND
         ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
       JOIN ITEM_MASTER IM
         ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
       JOIN PERIOD P
         ON P.PERIOD_SID = FA.PERIOD_SID
WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
       AND IM.ITEM_MASTER_SID = @ITEM_MASTER_SID      
        AND FA.PRICE_TYPE NOT IN ('AVGY', 'CPI-URA', 'WAC', 'WAC INCREASE %','QNON-FAMP','QFSS','AFSS')
ORDER  BY [SOURCE],
          PRICE_TYPE,
          P.YEAR 



    ]]> </query>
</entity>
<entity id="getFcpWorkSheetQtrAdjustment">
<query> <![CDATA[

 

DECLARE @NA_PROJ_MASTER_SID INT=?PID,
        @ITEM_MASTER_SID INT=?IMID

SELECT CASE
         WHEN PRICE_TYPE IN ( 'WAC', 'WAC INCREASE %' ) THEN PRICE_TYPE
         WHEN PRICE_TYPE = 'QNON-FAMP' THEN 'HISTORICAL NON-FAMP'
         WHEN PRICE_TYPE = 'QFSS' THEN 'HISTORICAL FSS (OGA) PRICING'
	 WHEN PRICE_TYPE = 'CMS UNITS' THEN 'CMS UNITS'
         WHEN PRICE_TYPE in ('WAC-FSS','WAC-FCP') THEN PRICE_TYPE
       END                     PRICE_TYPE,
       Isnull(ACTUAL_PRICE, 0) AS ACTUAL_PRICE,
       0                       AS PROJECTION_PRICE,
       P.YEAR,
       P.QUARTER,
       NOTES,
       0                       AS ADJUSTMENT,
       'ACTUALS'               AS [SOURCE]
FROM   ST_FCP_ACTUALS FA
       JOIN NA_PROJ_DETAILS ND
         ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
       JOIN ITEM_MASTER IM
         ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
       JOIN PERIOD P
         ON P.PERIOD_SID = FA.PERIOD_SID
WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
       AND IM.ITEM_MASTER_SID = @ITEM_MASTER_SID
       AND FA.PRICE_TYPE NOT IN ( 'FCP', 'ANON-FAMP', 'AFSS', 'TRI-CARE',
                                  'CPI-U', 'AVGY', 'CPI-URA' )
UNION ALL
SELECT CASE
         WHEN PRICE_TYPE IN ( 'WAC', 'WAC INCREASE %' ) THEN PRICE_TYPE
         WHEN PRICE_TYPE = 'QNON-FAMP' THEN 'FORECAST NON-FAMP'
         WHEN PRICE_TYPE = 'CPI-U' THEN 'FORECAST CPI-U'
         WHEN PRICE_TYPE = 'QFSS' THEN 'FORECAST FSS (OGA) PRICING'
	 WHEN PRICE_TYPE = 'CMS UNITS' THEN 'CMS UNITS'
         WHEN PRICE_TYPE in ('WAC-FSS','WAC-FCP') THEN PRICE_TYPE
       END                                             PRICE_TYPE,
       0                                               AS ACTUAL_PRICE,
       COALESCE(ADJUSTMENT_PRICE, PROJECTION_PRICE, 0) AS PROJECTION_PRICE,
       P.YEAR,
       P.QUARTER,
       NOTES,
       Isnull(ADJUSTMENT, 0)                           ADJUSTMENT,
       'PROJ'                                          AS [SOURCE]
FROM   ST_FCP_PROJ FA
       JOIN NA_PROJ_DETAILS ND
         ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
       JOIN ITEM_MASTER IM
         ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
       JOIN PERIOD P
         ON P.PERIOD_SID = FA.PERIOD_SID
WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
       AND IM.ITEM_MASTER_SID = @ITEM_MASTER_SID
       AND FA.PRICE_TYPE NOT IN ( 'FCP', 'ANON-FAMP', 'AFSS', 'TRI-CARE',
                                  'AVGY', 'CPI-URA', 'MAX FSS', 'CPI-U ADJUSTMENT' )
ORDER  BY [SOURCE],
          PRICE_TYPE,
          P.YEAR 



 
       
    ]]> </query>
</entity>
<entity id="getFcpWorkSheetQtrAdjustmentForView">
<query> <![CDATA[

 

DECLARE @NA_PROJ_MASTER_SID INT=?PID,
        @ITEM_MASTER_SID INT=?IMID
        
SELECT CASE
         WHEN PRICE_TYPE IN ( 'WAC', 'WAC INCREASE %' ) THEN PRICE_TYPE
         WHEN PRICE_TYPE = 'QNON-FAMP' THEN 'HISTORICAL NON-FAMP'
         WHEN PRICE_TYPE = 'QFSS' THEN 'HISTORICAL FSS (OGA) PRICING'
	 WHEN PRICE_TYPE = 'CMS UNITS' THEN 'CMS UNITS'
         WHEN PRICE_TYPE in ('WAC-FSS','WAC-FCP') THEN PRICE_TYPE
       END                     PRICE_TYPE,
       Isnull(ACTUAL_PRICE, 0) AS ACTUAL_PRICE,
       0                       AS PROJECTION_PRICE,
       P.YEAR,
       P.QUARTER,
       NOTES,
       0                       AS ADJUSTMENT,
       'ACTUALS'               AS [SOURCE]
FROM   FCP_ACTUALS FA
       JOIN NA_PROJ_DETAILS ND
         ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
       JOIN ITEM_MASTER IM
         ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
       JOIN PERIOD P
         ON P.PERIOD_SID = FA.PERIOD_SID
WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
       AND IM.ITEM_MASTER_SID = @ITEM_MASTER_SID       
       AND FA.PRICE_TYPE NOT IN ( 'FCP', 'ANON-FAMP', 'AFSS', 'TRI-CARE',
                                  'CPI-U', 'AVGY', 'CPI-URA' )
UNION ALL
SELECT CASE
         WHEN PRICE_TYPE IN ( 'WAC', 'WAC INCREASE %' ) THEN PRICE_TYPE
         WHEN PRICE_TYPE = 'QNON-FAMP' THEN 'FORECAST NON-FAMP'
         WHEN PRICE_TYPE = 'CPI-U' THEN 'FORECAST CPI-U'
         WHEN PRICE_TYPE = 'QFSS' THEN 'FORECAST FSS (OGA) PRICING'
	 WHEN PRICE_TYPE = 'CMS UNITS' THEN 'CMS UNITS'
         WHEN PRICE_TYPE in ('WAC-FSS','WAC-FCP') THEN PRICE_TYPE
       END                                             PRICE_TYPE,
       0                                               AS ACTUAL_PRICE,
       COALESCE(ADJUSTMENT_PRICE, PROJECTION_PRICE, 0) AS PROJECTION_PRICE,
       P.YEAR,
       P.QUARTER,
       NOTES,
       Isnull(ADJUSTMENT, 0)                           ADJUSTMENT,
       'PROJ'                                          AS [SOURCE]
FROM   FCP_PROJ FA
       JOIN NA_PROJ_DETAILS ND
         ON FA.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
       JOIN ITEM_MASTER IM
         ON IM.ITEM_MASTER_SID = ND.ITEM_MASTER_SID
       JOIN PERIOD P
         ON P.PERIOD_SID = FA.PERIOD_SID
WHERE  ND.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
       AND IM.ITEM_MASTER_SID = @ITEM_MASTER_SID     
       AND FA.PRICE_TYPE NOT IN ( 'FCP', 'ANON-FAMP', 'AFSS', 'TRI-CARE',
                                  'AVGY', 'CPI-URA', 'MAX FSS', 'CPI-U ADJUSTMENT' )
ORDER  BY [SOURCE],
          PRICE_TYPE,
          P.YEAR 



 
       
    ]]> </query>
</entity>
<entity id="getFcpAdjSumbitUpdate">
<query> <![CDATA[

 
    UPDATE MUP
SET    PROJECTION_PRICE = COALESCE(ADJUSTMENT_PRICE, PROJECTION_PRICE),
       ADJUSTMENT_PRICE = NULL,
       ADJUSTMENT = NULL
FROM   ST_FCP_PROJ MUP
       JOIN NA_PROJ_DETAILS ND
         ON MUP.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
WHERE  EXISTS (SELECT 1
               FROM   NA_PROJ_DETAILS NPD
                      INNER JOIN ITEM_MASTER IM
                              ON IM.ITEM_MASTER_SID = NPD.ITEM_MASTER_SID
               WHERE  MUP.NA_PROJ_DETAILS_SID = NPD.NA_PROJ_DETAILS_SID
                      AND IM.ITEM_MASTER_SID = ?IMID)
    
    
    
    ]]> </query>
</entity>
<entity id="getFcpAdjCloseUpdate">
<query> <![CDATA[
 

UPDATE MUP
SET    ADJUSTMENT_PRICE = NULL, ADJUSTMENT = NULL
FROM   ST_FCP_PROJ MUP
       JOIN NA_PROJ_DETAILS ND
         ON MUP.NA_PROJ_DETAILS_SID = ND.NA_PROJ_DETAILS_SID
WHERE  EXISTS (SELECT 1
               FROM   NA_PROJ_DETAILS NPD INNER JOIN ITEM_MASTER IM ON IM.ITEM_MASTER_SID = NPD.ITEM_MASTER_SID
				WHERE  MUP.NA_PROJ_DETAILS_SID = NPD.NA_PROJ_DETAILS_SID
						AND IM.ITEM_MASTER_SID = ?IMID)

          
    
    ]]> </query>
</entity>
<entity id="getFCPLevelFilter">
<query> <![CDATA[

  DECLARE @NA_PROJ_MASTER_SID INT=?PID,
        @BRAND_MASTER_SID   INT=?BID,
	@TH_CLASS varchar(50)=?TID

SELECT IM.ITEM_NO,
       IM.ITEM_MASTER_SID,
       IM.ITEM_DESC
FROM   NA_PROJ_MASTER PM,
       NA_PROJ_DETAILS PD,
       ITEM_MASTER IM
WHERE  PM.NA_PROJ_MASTER_SID = PD.NA_PROJ_MASTER_SID
       AND PD.ITEM_MASTER_SID = IM.ITEM_MASTER_SID
       AND PM.NA_PROJ_MASTER_SID = @NA_PROJ_MASTER_SID
       AND ( IM.BRAND_MASTER_SID = @BRAND_MASTER_SID
              OR @BRAND_MASTER_SID IS NULL ) 
		AND ( IM.THERAPEUTIC_CLASS = @TH_CLASS
              OR @TH_CLASS IS NULL ) 
       
    ]]> </query>
</entity>
</sql>
